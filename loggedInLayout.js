function initLoggedInLayout(){var t=this,n=Q.defer(),i=new UsersService;return appViewModel=LoggedInViewModel.create(i),$(".hidden-before-binding").show(),ko.applyBindings(appViewModel),CacheHandler.getInstance().clearExpiredItems(),appViewModel.init().then(function(){WebApi.getInstance().initialize();$.cookie("tutorialStep")&&$.cookie("tutorialStep")>=TutorialStep.LineupIntro&&$.cookie("tutorialStep")<TutorialStep.Reward&&$("#tutorial-overlay").show();$("#header").load("/Cached/Header?v="+buildReleaseVersion,null,function(){ko.applyBindings(appViewModel,$("#header")[0]);appViewModel.isHeaderLoaded(!0);$("#navbar-mobile").load("/Static/MenuMobile.html?v="+buildReleaseVersion,null,function(){ko.applyBindings(appViewModel,$("#navbar-mobile")[0]);$(document).on("click","#mobile-menu .mobile-menu-item-container",function(n){n.stopPropagation();$("#menu-accordion").find(".collapse.in").collapse("toggle");$($(t).data("target")).collapse("toggle")});$(document).on("click",".stop-propagation",function(n){n.stopPropagation()})})});$("#subheader").load("/Cached/SubHeader?v="+buildReleaseVersion,null,function(){ko.applyBindings(appViewModel,$("#subheader")[0]);appViewModel.isSubHeaderLoaded(!0);$("#navbar").load("/Static/Menu.html?v="+buildReleaseVersion,null,function(){ko.applyBindings(appViewModel,$("#navbar")[0])})});$("#modal-templates").load("/Cached/Modals?v="+buildReleaseVersion,null,function(){n.resolve()});$(document).on("show.bs.dropdown","#navbar .dropdown, #header .dropdown",function(){appViewModel.adsPartial()&&appViewModel.adsPartial().isLeaderboardClickEnabled(!1)});$(document).on("hide.bs.dropdown","#navbar .dropdown, #header .dropdown",function(){appViewModel.adsPartial()&&appViewModel.adsPartial().isLeaderboardClickEnabled(!0)})}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleError(n)}).done(),n.promise}var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),EventNotificationPartial=function(n){function t(t){var i=n.call(this)||this;return i.todoNotificationType=TodoNotificationType.EventNotification,Helper.copyProperties(t,i),i}return __extends(t,n),t.prototype.iconType=function(){return"icon-notification-"+this.getIconSpriteName()},t.prototype.getIconSpriteName=function(){switch(this.type){case EventNotificationType.Doctor:return"doctor";case EventNotificationType.Friendlies:return"friendlies";case EventNotificationType.Lawyer:return"lawyer";case EventNotificationType.LineUp:return"lineup";case EventNotificationType.SecretTraining:case EventNotificationType.TrainingCamp:return"trainingcamp";case EventNotificationType.Specialists:return"specialists";case EventNotificationType.Sponsors:return"sponsor";case EventNotificationType.TransferList:return"transfer";case EventNotificationType.Tactics:return"tactic";case EventNotificationType.Spy:return"spy";case EventNotificationType.Stadium:return"stadium";case EventNotificationType.Training:return"training";case EventNotificationType.Scout:case EventNotificationType.Shop:case EventNotificationType.BusinessClub:case EventNotificationType.Career:case EventNotificationType.ChooseLeague:case EventNotificationType.ChooseTeam:case EventNotificationType.Friends:default:return"tutorial"}},t.prototype.getEventUrl=function(){switch(this.type){case EventNotificationType.Shop:return Urls.store;case EventNotificationType.BusinessClub:return Urls.businessClub;case EventNotificationType.Career:return Urls.career;case EventNotificationType.ChooseLeague:return Urls.chooseLeague;case EventNotificationType.ChooseTeam:return Urls.chooseLeague;case EventNotificationType.Doctor:return Urls.doctor;case EventNotificationType.Friendlies:return Urls.friendlies;case EventNotificationType.Friends:return Urls.friends;case EventNotificationType.Lawyer:return Urls.lawyer;case EventNotificationType.LineUp:return Urls.lineup;case EventNotificationType.Scout:return Urls.scout;case EventNotificationType.SecretTraining:return Urls.secretTraining;case EventNotificationType.Specialists:return Urls.specialists;case EventNotificationType.Sponsors:return Urls.sponsors;case EventNotificationType.TransferList:return Urls.transferlist;case EventNotificationType.TrainingCamp:return Urls.trainingCamp;case EventNotificationType.Tactics:return Urls.tactics;case EventNotificationType.Spy:return Urls.spy;case EventNotificationType.Stadium:return Urls.stadium;case EventNotificationType.Training:return Urls.training}},t.prototype.goToEvent=function(){var n=this.getEventUrl();n!==undefined&&window.location.href.indexOf(n)===-1&&(window.location.href=n)},t}(EventNotification),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),WebAndEventNotificationsPagingPartial=function(n){function t(t,i,r){var u=n.call(this,3)||this;return u._notificationService=t,u.addEventNotificationItemsFromModels(r),u.addNotificationItemsFromModels(i),u}return __extends(t,n),t.prototype.addNotificationItemsFromModels=function(n){var t=this;n&&n.forEach(function(n){t.addItem(new NotificationPartial(n))})},t.prototype.addEventNotificationItemsFromModels=function(n){var r=this,i,t;if(n){try{i=$.cookie(CookieHelper.CookieKeys.ignoredEventNotifications);t=JSON.parse(i);t&&(n=Enumerable.from(n).where(function(n){return!Enumerable.from(t).any(function(t){return t===n.id})}).toArray())}catch(u){}n.forEach(function(n){r.addItem(new EventNotificationPartial(n))})}},t.prototype.redirectNotification=function(n){n&&(Enumerable.from([NotificationGroupType.Offer,NotificationGroupType.Transfer]).contains(n.group)?this.redirectAndRemoveNotification(n):this.redirect(n))},t.prototype.removeNotification=function(n){var t=Q.defer(),i;return this.removeNotificationFromList(n)?(WebApi.getInstance().execute(this._notificationService.remove(SessionManager.getLeagueId(),SessionManager.getTeamId(),n.id)).then(function(){t.resolve()}).fail(function(n){var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not remove notification because of a webapi error");t.reject(i);ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(),t.promise):(i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Could not remove notification from list because it does not exist."),Q.reject(i))},t.prototype.removeEventNotification=function(n){var r=Q.defer();if(!this.removeNotificationFromList(n))return Q.reject();var i=$.cookie(CookieHelper.CookieKeys.ignoredEventNotifications),t=[];return i&&(t=JSON.parse(i)),t.push(n.id),$.cookie(CookieHelper.CookieKeys.ignoredEventNotifications,JSON.stringify(t),{expires:1,path:"/",domain:appViewModel.getDomain()}),r.promise},t.prototype.removeNotificationFromList=function(n){return n?(this.removeItemByFunction(function(t){return t.id===n.id}),!0):!1},t.prototype.redirectAndRemoveNotification=function(n){var t=this;n.isLoading(!0);this.removeNotification(n).then(function(){t.redirect(n)}).fail(function(){n.isLoading(!1)}).done()},t.prototype.redirect=function(n){var t;switch(n.group){case NotificationGroupType.Lineup:t=Urls.lineup;break;case NotificationGroupType.Offer:t=Urls.offers+"/"+n.objectId;break;case NotificationGroupType.Scout:t=Urls.scout;break;case NotificationGroupType.Sponsor:case NotificationGroupType.ShirtSponsor:t=Urls.sponsors;break;case NotificationGroupType.Spy:t=Urls.spy;break;case NotificationGroupType.Stadium:t=Urls.stadium;break;case NotificationGroupType.Tactic:t=Urls.tactics;break;case NotificationGroupType.Training:t=Urls.training;break;case NotificationGroupType.Doctor:t=Urls.doctor;break;case NotificationGroupType.Lawyer:t=Urls.lawyer;break;case NotificationGroupType.Specialists:t=Urls.specialists;break;case NotificationGroupType.Transfer:t=Urls.transferlistHistory;break;case NotificationGroupType.TrainingCamp:t=Urls.trainingCamp;break;case NotificationGroupType.Friendlies:t=Urls.friendlies;break;case NotificationGroupType.Moderator:t=n.notificationType===NotificationType.RequestAccessToLeague?Urls.requests:Urls.moderatorTools}t!==undefined&&window.location.href.indexOf(t)===-1&&(window.location.href=t)},t.prototype.hasActiveEvent=function(n){var t=Helper.unixTimeStamp();return Enumerable.from(this.getItems()).any(function(i){return i.todoNotificationType===TodoNotificationType.EventNotification&&i instanceof EventNotificationPartial&&i.type===n&&i.endTimestamp>t&&i.startTimestamp<t})},t}(PagingViewModel),ServerService=function(){function n(){}return n.prototype.currentTime=function(){var n=(new breeze.EntityQuery).from("servertime");return RequestItemFactory.getInstance().createRequestItemSingle(n)},n.prototype.fetchAll=function(){var n=(new breeze.EntityQuery).from("/server/fetchall/");return RequestItemFactory.getInstance().createRequestItem(n)},n}(),EventNotificationsService=function(){function n(){}return n.prototype.getAll=function(n){n===void 0&&(n=!0);var i=(new breeze.EntityQuery).from("eventnotifications"),t=RequestItemFactory.getInstance().createRequestItem(i,CacheKey[CacheKey.EventNotifications],!0);return t.cacheDurationInMinutes=appViewModel.sessionSettings.refeshbosscoincachetime,t},n}(),TeamFinancesService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/finances");return RequestItemFactory.getInstance().createRequestItemSingle(i,!1)},n.prototype.getBalanceAndSavingsByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/finances/balanceandsavings");return RequestItemFactory.getInstance().createRequestItemSingle(i,!1)},n.prototype.buyClubFunds=function(n,t,i,r){var u={clubFundsToConvert:i,productId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/buyclubfunds",HttpMethod.Put,u)},n.prototype.transfer=function(n,t){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/savings/transfer",HttpMethod.Put)},n}(),HistoryService=function(){function n(){}return n.prototype.getCacheKey=function(n){return n?CacheKey[CacheKey.HistoryCollection]+"_"+n:CacheKey[CacheKey.HistoryCollection]},n.prototype.getCollection=function(n){n===void 0&&(n=null);var t=n?"/users/"+n+"/history":"/user/history",i=(new breeze.EntityQuery).from(t);return RequestItemFactory.getInstance().createRequestItemSingle(i,this.getCacheKey(n),!0)},n.prototype.claim=function(n){return RequestItemFactory.getInstance().createRequestItemSingle("user/history/"+n+"/claim",HttpMethod.Put)},n}(),TeamsService=function(){function n(){}return n.prototype.getCacheKey=function(n,t){return n?CacheKey[CacheKey.Teams]+"_"+t:null},n.prototype.getByLeague=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams");return RequestItemFactory.getInstance().createRequestItem(i,this.getCacheKey(t,n))},n.prototype.getByLeagueFilteredByTeamId=function(n,t,i){i===void 0&&(i=!1);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/teams"),r=RequestItemFactory.getInstance().createRequestItemSingle(u,this.getCacheKey(i,n));return r.predicate=function(n){return n.id===t},r},n.prototype.getTeamsStatistics=function(n){var t=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/statistics");return RequestItemFactory.getInstance().createRequestItem(t,!1)},n.prototype.getAvailable=function(n){var t=(new breeze.EntityQuery).from("leaguetypes/"+n+"/availableteams");return RequestItemFactory.getInstance().createRequestItem(t,!0)},n.prototype.signContractForSlot=function(n,t,i){var r="leagues/"+n+"/teams/"+t+"/signcontract/"+i;return RequestItemFactory.getInstance().createRequestItemSingle(r,HttpMethod.Put)},n.prototype.signContractForVipLeague=function(n,t,i,r){var u="leagues/"+n+"/teams/"+t+"/signcontract/"+i+"/consumereward",f={rewardId:r};return RequestItemFactory.getInstance().createRequestItemSingle(u,HttpMethod.Put,f)},n}(),ConversationsService=function(){function n(){}return n.prototype.getUnreadCountByIdentity=function(){var n=(new breeze.EntityQuery).from("conversations/unreadCount");return RequestItemFactory.getInstance().createRequestItemSingle(n)},n.prototype.getAllByIdentity=function(){var n=(new breeze.EntityQuery).from("conversations");return RequestItemFactory.getInstance().createRequestItem(n,!0)},n.prototype.startConversation=function(n){var t={participantNames:n};return RequestItemFactory.getInstance().createRequestItemSingle("conversations",HttpMethod.Post,t)},n.prototype.setMessagesRead=function(n){return RequestItemFactory.getInstance().createRequestItemSingle("conversations/"+n+"/read",HttpMethod.Post)},n.prototype.remove=function(n){return RequestItemFactory.getInstance().createRequestItemSingle("conversations/"+n,HttpMethod.Delete)},n}(),LeagueTypesService=function(){function n(){}return n.prototype.getById=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagueTypes/"+n),r=t?CacheKey[CacheKey.LeagueTypes]+"_"+n:null;return RequestItemFactory.getInstance().createRequestItemSingle(i,r)},n.prototype.getByName=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagueTypes/name/"+n),r=t?CacheKey[CacheKey.LeagueTypes]+"_"+n:null;return RequestItemFactory.getInstance().createRequestItemSingle(i,r)},n.prototype.getByIdWithStats=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagueTypes/stats/"+n+"/"+t),u=i?CacheKey[CacheKey.LeagueTypes]+"_"+n+"_"+t:null;return RequestItemFactory.getInstance().createRequestItemSingle(r,u)},n.prototype.getAll=function(n){var t=(new breeze.EntityQuery).from("/leagueTypes/stats"),i=n?CacheKey[CacheKey.LeagueTypes]:null;return RequestItemFactory.getInstance().createRequestItem(t,i)},n.prototype.getAllFromServer=function(n){var t=(new breeze.EntityQuery).from("/leagueTypes/stats/"+n);return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.getActive=function(n){var t=(new breeze.EntityQuery).from("/leagueTypes"),i=n?CacheKey[CacheKey.LeagueTypes]+"_active":null;return RequestItemFactory.getInstance().createRequestItem(t,i)},n.prototype.getFavourites=function(n){var t=(new breeze.EntityQuery).from("/leagueTypes/favourites/"+n);return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.filter=function(n){var t=(new breeze.EntityQuery).from("/leagueTypes/filter?query="+encodeURIComponent(n));return RequestItemFactory.getInstance().createRequestItem(t,!0)},n}(),LeaguesService=function(){function n(){}return n.prototype.getLeagueCacheKey=function(n,t){return n?CacheKey[CacheKey.League]+"_"+t:null},n.prototype.getBySession=function(n){n===void 0&&(n=!1);var t=this.getByLeagueId(SessionManager.getLeagueId(),n);return t.deferred.promise.fail(function(n){SessionManager.getLeagueId()>0&&n.httpStatus===HttpStatus.NotFound&&(SessionManager.getInstance().resetLeagueAndTeam(),WebApiConfig.getInstance().removeAccessToken(),window.location.href=Urls.career)}).done(),t},n.prototype.getByLeagueId=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("leagues/"+n);return RequestItemFactory.getInstance().createRequestItemSingle(i,this.getLeagueCacheKey(t,n))},n.prototype.getByVipLeagueEventId=function(n){var t=(new breeze.EntityQuery).from("vipleagueevents/"+n+"/league");return RequestItemFactory.getInstance().createRequestItemSingle(t,!0)},n.prototype.getAvailable=function(n){var t=(new breeze.EntityQuery).from("leagueTypes/"+n+"/available");return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.getLeaguesPerServerByLeagueType=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/"+t);return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.createFirstLeague=function(n,t,i,r){r===void 0&&(r=LeagueMode.Normal);return RequestItemFactory.getInstance().createRequestItemSingle("leagues",HttpMethod.Post,{leagueTypeId:n,teamId:t,name:null,settings:null,slotIndex:i,productId:null,leagueMode:r})},n.prototype.createLeagueForOccupiedTeam=function(n,t,i,r,u){u===void 0&&(u=LeagueMode.Normal);return RequestItemFactory.getInstance().createRequestItemSingle("leagues",HttpMethod.Post,{leagueTypeId:n,teamId:t,name:null,settings:null,slotIndex:i,productId:r,leagueMode:u})},n.prototype.createLeagueWithSettings=function(n,t,i,r,u,f,e){e===void 0&&(e=LeagueMode.Normal);return RequestItemFactory.getInstance().createRequestItemSingle("leagues",HttpMethod.Post,{leagueTypeId:n,teamId:t,name:i,settings:r,slotIndex:u,productId:f,leagueMode:e})},n.prototype.updateName=function(n,t){var i="leagues/"+n;return RequestItemFactory.getInstance().createRequestItemSingle(i,HttpMethod.Put,{name:t})},n.prototype.filter=function(n){var t=(new breeze.EntityQuery).from("/leagues/filter?query="+encodeURIComponent(n));return RequestItemFactory.getInstance().createRequestItem(t,!0)},n.prototype.validateJoiningPhase=function(n){var t=(new breeze.EntityQuery).from("leagues/"+n+"/validatejoiningphase");return RequestItemFactory.getInstance().createRequestItemSingle(t)},n}(),LeagueSettingsService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i){return n?CacheKey[CacheKey.LeagueSettings]+"_"+t.toString()+"_"+i.toString():null},n.prototype.getCacheKeyForLeagueType=function(n,t){return n?CacheKey[CacheKey.LeagueSettings]+"_"+t.toString():null},n.prototype.getByLeagueId=function(n,t,i){i===void 0&&(i=!1);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/settings"),r=RequestItemFactory.getInstance().createRequestItem(u,this.getCacheKey(i,n,t));return r.predicate=function(n){return n.seasonNr===t},r},n.prototype.getProtectedSettingForLeagueType=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagueType/"+n+"/"+t+"/settings");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKeyForLeagueType(i,t))},n.prototype.getByLeagueTypeId=function(n){var t=(new breeze.EntityQuery).from("/leagueType/"+n+"/settings");return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.updateSettings=function(n,t,i){i===void 0&&(i=null);var r="/leagues/"+n+"/settings";return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.LeagueSettings),RequestItemFactory.getInstance().createRequestItemSingle(r,HttpMethod.Put,{leagueId:n,settings:t,productId:i})},n}(),BossCoinProductsService=function(){function n(){}return n.prototype.getBossCoinProducts=function(n){n===void 0&&(n=!1);var t=(new breeze.EntityQuery).from("bosscoinproducts"),i=n?CacheKey[CacheKey.BossCoinProducts]:null;return RequestItemFactory.getInstance().createRequestItem(t,i)},n.prototype.getAll=function(n){n===void 0&&(n=!1);var t=this.getBossCoinProducts(n);return t.predicateAll=LeanplumHelper.getInstance().filterGameSettingsWithVariables,t.orderBy=function(n){return n.increment},t},n}(),GameSettingsService=function(){function n(){}return n.prototype.getGameSettings=function(n){n===void 0&&(n=!1);var t=(new breeze.EntityQuery).from("gamesettings"),i=n?CacheKey[CacheKey.GameSettings]:null;return RequestItemFactory.getInstance().createRequestItem(t,i)},n.prototype.getAll=function(n){n===void 0&&(n=!1);var t=this.getGameSettings(n);return t.predicateAll=LeanplumHelper.getInstance().filterGameSettingsWithVariables,t.orderBy=function(n){return n.name},t},n.prototype.getAllByCategory=function(n,t){t===void 0&&(t=!1);var i=this.getAll(t);return i.predicate=function(t){return t.category===n},i},n}(),MatchesService=function(){function n(){}return n.prototype.getCacheKeyForWeek=function(n,t,i){return n?CacheKey[CacheKey.MatchesByWeek]+"_"+t+"_"+i:null},n.prototype.getCacheKeyForTeam=function(n,t,i){return n?CacheKey[CacheKey.Matches]+"_"+t+"_"+i:null},n.prototype.getAllLeagueAndCup=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?type="+MatchType.League+"&type="+MatchType.Cup),r=t?CacheKey[CacheKey.Matches]+"_"+n.toString():null;return RequestItemFactory.getInstance().createRequestItem(i,r)},n.prototype.getByWeekLeagueAndCup=function(n,t,i,r){i===void 0&&(i=!1);r===void 0&&(r=!0);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?weekNr="+t+"&type="+MatchType.League+"&type="+MatchType.Cup);return RequestItemFactory.getInstance().createRequestItem(u,this.getCacheKeyForWeek(i,n,t),r)},n.prototype.getByTeamLeagueAndCup=function(n,t,i){i===void 0&&(i=!1);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?teamId="+t+"&type="+MatchType.League+"&type="+MatchType.Cup),r=RequestItemFactory.getInstance().createRequestItem(u,this.getCacheKeyForTeam(i,n,t));return r.orderBy=function(n){return n.weekNr},r},n.prototype.getFriendliesByTeamFilteredByWeek=function(n,t,i,r,u){u===void 0&&(u=!1);var e=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?teamId="+t+"&weekNr="+i+"&type="+MatchType.Friendly),o=u?CacheKey[CacheKey.Friendlies]+"_"+n+"_"+t+"_"+i:null,f=RequestItemFactory.getInstance().createRequestItem(e,o,r);return f.orderBy=function(n){return n.weekNr},f},n.prototype.getCupMatches=function(n,t){t===void 0&&(t=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?type="+MatchType.Cup),u=t?CacheKey[CacheKey.CupMatches]+"_"+n:null,i=RequestItemFactory.getInstance().createRequestItem(r,u);return i.orderBy=function(n){return n.weekNr},i},n.prototype.getByMatchId=function(n,t,i,r,u,f){var e,o,s;return f===void 0&&(f=!1),u?(e=(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?teamId="+SessionManager.getTeamId()+"&weekNr="+t+"&type="+MatchType.Friendly),o=f?CacheKey[CacheKey.CupMatches]+"_"+n:null):(e=r?(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?teamId="+SessionManager.getTeamId()+"&type="+MatchType.League+"&type="+MatchType.Cup):(new breeze.EntityQuery).from("/leagues/"+n+"/matches/filter?weekNr="+t+"&type="+MatchType.League+"&type="+MatchType.Cup),o=r?this.getCacheKeyForTeam(f,n,SessionManager.getTeamId()):this.getCacheKeyForWeek(f,n,t)),s=RequestItemFactory.getInstance().createRequestItemSingle(e,o),s.predicate=function(n){return n.matchId===i&&n.weekNr===t},s},n.prototype.post=function(n,t,i,r,u){var f={opponentId:i,productId:r,isTutorialFriendly:u};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/matches",HttpMethod.Post,f)},n}(),ManagersService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i,r){return(i===void 0&&(i=!0),r===void 0&&(r=!0),!r)?null:t?CacheKey[CacheKey.Managers]+"_"+n.toString()+"_"+t.toString():i?CacheKey[CacheKey.Managers]+"_"+n.toString():CacheKey[CacheKey.ManagersFetchedWithoutPoints]+"_"+n.toString()},n.prototype.getByLeagueWithPoints=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/managers");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,null,!0,t),i)},n.prototype.getByLeagueWithoutPoints=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/managerswithoutpoints");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,null,!1,t),i)},n.prototype.getByLeagueAndTeamId=function(n,t,i,r){i===void 0&&(i=!1);r===void 0&&(r=!1);var f=(new breeze.EntityQuery).from("/leagues/"+n+"/managers"),u=RequestItemFactory.getInstance().createRequestItemSingle(f,this.getCacheKey(n,t,!1,i),r);return u.predicate=function(n){return n.teamId===t},u},n.prototype.getAllByIdentity=function(n){n===void 0&&(n=!1);var t=(new breeze.EntityQuery).from("/managers/account");return RequestItemFactory.getInstance().createRequestItem(t,CacheKey[CacheKey.UserManagers])},n.prototype.kickManager=function(n,t){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/managers/"+t+"/sack",HttpMethod.Post)},n.prototype.clearCache=function(n,t){CacheHandler.getInstance().removeKey(this.getCacheKey(n,null,!1,!0));CacheHandler.getInstance().removeKey(this.getCacheKey(n,null,!0,!0));CacheHandler.getInstance().removeKey(this.getCacheKey(n,t,!1,!0))},n}(),MenuService=function(){function n(){}return n.prototype.getAll=function(){var n=[],t;return n.push(new MenuHeader(MenuHeaderType.Home,[],Urls.dashboard)),n.push(new MenuHeader(MenuHeaderType.Team,[new MenuItem(MenuItemType.Squad,Urls.squad),new MenuItem(MenuItemType.Lineup,Urls.lineup,{showOnLastDay:!1}),new MenuItem(MenuItemType.Tactics,Urls.tactics,{showOnLastDay:!1}),new MenuItem(MenuItemType.Specialists,Urls.specialists,{showOnLastDay:!1}),new MenuItem(MenuItemType.TransferList,Urls.transferlist,{showOnLastDay:!1,showNoTransfers:!1}),new MenuItem(MenuItemType.Offers,Urls.offers,{showOnLastDay:!1,showNoTransfers:!1})])),n.push(new MenuHeader(MenuHeaderType.TrainingGround,[new MenuItem(MenuItemType.Training,Urls.training,{showOnLastDay:!1}),new MenuItem(MenuItemType.Friendlies,Urls.friendlies,{showOnLastDay:!1}),new MenuItem(MenuItemType.SecretTraining,Urls.secretTraining,{showOnLastDay:!1,showNoSecretTraining:!1}),new MenuItem(MenuItemType.TrainingCamp,Urls.trainingCamp,{showOnLastDay:!1,showNoTrainingCamp:!1})])),n.push(new MenuHeader(MenuHeaderType.Matches,[new MenuItem(MenuItemType.Results,Urls.results,{showInPreperation:!1}),new MenuItem(MenuItemType.LeagueTable,Urls.leagueTable,{hideInKnockoutLeague:!0}),new MenuItem(MenuItemType.ManagerList,Urls.leagueTableManagerList,{showOnlyInKnockoutLeague:!0}),new MenuItem(MenuItemType.Fixtures,Urls.fixtures,{showOnLastDay:!1}),new MenuItem(MenuItemType.MatchCalendar,Urls.matchCalendar),new MenuItem(MenuItemType.Cup,Urls.cup,{showNoCup:!1}),new MenuItem(MenuItemType.LeagueStatistics,Urls.statistics,{showInPreperation:!1}),new MenuItem(MenuItemType.NewsPaper,Urls.newsPaper,{hideInKnockoutLeague:!0,hideInTournamentLeague:!0})])),n.push(new MenuHeader(MenuHeaderType.Club,[new MenuItem(MenuItemType.Stadium,Urls.stadium),new MenuItem(MenuItemType.Sponsors,Urls.sponsors,{showOnLastDay:!1}),new MenuItem(MenuItemType.Board,Urls.board,{hideInKnockoutLeague:!0,hideInTournamentLeague:!0}),new MenuItem(MenuItemType.BusinessClub,Urls.businessClub,{showNoTeam:!0})])),t=new MenuHeader(MenuHeaderType.Staff,[new MenuItem(MenuItemType.Scout,Urls.scout,{showOnLastDay:!1,showNoTransfers:!1}),new MenuItem(MenuItemType.Spy,Urls.spy,{showOnLastDay:!1}),new MenuItem(MenuItemType.Doctor,Urls.doctor,{showOnLastDay:!1,showToLegacyUser:!0}),new MenuItem(MenuItemType.Lawyer,Urls.lawyer,{showOnLastDay:!1,showToLegacyUser:!0})]),t=this.filterStaffMenuHeader(t),n.push(t),n.push(new MenuHeader(MenuHeaderType.Community,[new MenuItem(MenuItemType.Ranking,Urls.ranking,{showNoTeam:!0}),new MenuItem(MenuItemType.Forums,Urls.getForumUrl(appViewModel.sessionSettings.worldNr),{showNoTeam:!0,openInNewTab:!0}),new MenuItem(MenuItemType.LeagueOverview,Urls.leagueTypes,{showNoTeam:!0}),new MenuItem(MenuItemType.ActiveLeagues,Urls.activeLeagues),new MenuItem(MenuItemType.SimulationStatus,Urls.simulationStatus,{showNoTeam:!0})])),n},n.prototype.filterStaffMenuHeader=function(n){if(!appViewModel.userPartial())return n;var t=Helper.calculateDaysSinceTimestamp(appViewModel.userPartial().signUpTimestamp),i=LeanplumHelper.getInstance().getVariables("Settings","ScoutAfterAmountOfSignupDays",0);return t<i&&(n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.menuItemType!==MenuItemType.Scout}).toArray()),n},n}(),NotificationService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/webnotifications");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.remove=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("/leagues/"+n+"/teams/"+t+"/notifications/"+i,HttpMethod.Delete)},n}(),MessagesService=function(){function n(){}return n.prototype.getByConversationId=function(n){var t=(new breeze.EntityQuery).from("/conversations/"+n+"/messages");return RequestItemFactory.getInstance().createRequestItem(t,!0)},n.prototype.post=function(n,t){var i={body:t};return RequestItemFactory.getInstance().createRequestItem("/conversations/"+n+"/messages",HttpMethod.Post,i)},n}(),RssFeedsService=function(){function n(){}return n.prototype.getAll=function(){var n=(new breeze.EntityQuery).from("rssfeed");return RequestItemFactory.getInstance().createRequestItemSingle(n,!0)},n}(),SmileysService=function(){function n(){}return n.prototype.getSmileys=function(n){var t=(new breeze.EntityQuery).from("smileys/"+n);return RequestItemFactory.getInstance().createRequestItem(t)},n}(),SponsorsService=function(){function n(){}return n.prototype.getByTeamId=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/sponsors");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getOffers=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/sponsors/offers");return RequestItemFactory.getInstance().createRequestItem(i,!1)},n.prototype.setSponsor=function(n,t,i,r){var u={sponsorId:r,sponsorSide:i};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/sponsors",HttpMethod.Post,u)},n}(),StadiumService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/stadium");return RequestItemFactory.getInstance().createRequestItemSingle(i,CacheKey[CacheKey.Stadium]+"_"+n)},n}(),CountdownTimerService=function(){function n(){}return n.prototype.getAll=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/timers"),u=i?CacheKey[CacheKey.CountdownTimers]:null;return RequestItemFactory.getInstance().createRequestItem(r,u,!0)},n}(),TeamTacticService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i){return n?CacheKey[CacheKey.TeamTactic]+"_"+t+"_"+i:null},n.prototype.getTeamTacticByTeamId=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/teamtactics");return RequestItemFactory.getInstance().createRequestItemSingle(r,this.getCacheKey(i,n,t))},n.prototype.saveTacticSettings=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y={attack:i,defense:r,midField:u,style:f,overallMatchTactics:e,marking:o,mentality:s,offSideTrap:h,pressing:c,tempo:l,formation:a,formationDetail:v};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/teamtactics",HttpMethod.Put,y)},n}(),ActionRewardsService=function(){function n(){}return n.prototype.getCacheKey=function(n){return n?CacheKey[CacheKey.ActionRewards]:null},n.prototype.get=function(n){n===void 0&&(n=!1);var i=(new breeze.EntityQuery).from("actionrewards"),t=RequestItemFactory.getInstance().createRequestItem(i,this.getCacheKey(n),!0);return t.requestQuery.is503Valid=!0,t},n}(),UserRewardsService=function(){function n(){this.cacheKey=CacheKey[CacheKey.UserRewards]}return n.prototype.getByIdentity=function(){var n=(new breeze.EntityQuery).from("/user/userrewards");return RequestItemFactory.getInstance().createRequestItem(n,this.cacheKey,!0)},n}(),InjuriesService=function(){function n(){}return n.prototype.getAll=function(){var n=(new breeze.EntityQuery).from("/injuries");return RequestItemFactory.getInstance().createRequestItem(n,CacheKey[CacheKey.Injuries])},n}(),FoulsService=function(){function n(){}return n.prototype.getAll=function(){var n=(new breeze.EntityQuery).from("/fouls");return RequestItemFactory.getInstance().createRequestItem(n,CacheKey[CacheKey.Fouls])},n}(),LeagueStandingsService=function(){function n(){}return n.prototype.getCacheKey=function(n,t){return n?CacheKey[CacheKey.LeagueStandings]+"_"+t.toString():null},n.prototype.getAll=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagues/"+n+"/standings");return RequestItemFactory.getInstance().createRequestItem(i,this.getCacheKey(t,n))},n.prototype.getAllFilteredByTeamId=function(n,t,i){i===void 0&&(i=!1);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/standings"),r=RequestItemFactory.getInstance().createRequestItemSingle(u,this.getCacheKey(i,n));return r.predicate=function(n){return n.teamId===t},r},n}(),NewspaperArticlesService=function(){function n(){}return n.prototype.getByWeekNr=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/newspaperarticles/"+t),u=i?CacheKey[CacheKey.NewsPaperArticles]+"_"+n+"_"+t:null;return RequestItemFactory.getInstance().createRequestItem(r,u,!0)},n}(),EntryRequestsService=function(){function n(){}return n.prototype.getCacheKey=function(n,t){return n?CacheKey[CacheKey.EntryRequests]+"_"+t:null},n.prototype.getByLeague=function(n,t){t===void 0&&(t=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/entryrequests"),i=RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(t,n),!0);return i.cacheDurationInMinutes=5,i},n.prototype.getByIdentity=function(){var n=(new breeze.EntityQuery).from("user/entryrequests/");return RequestItemFactory.getInstance().createRequestItem(n,!0)},n.prototype.post=function(n){var t={leagueId:n};return RequestItemFactory.getInstance().createRequestItemSingle("user/entryrequests",HttpMethod.Post,t)},n.prototype.accept=function(n){return RequestItemFactory.getInstance().createRequestItemSingle("user/entryrequests/"+n+"/accept",HttpMethod.Put)},n.prototype.reject=function(n){return RequestItemFactory.getInstance().createRequestItemSingle("user/entryrequests/"+n+"/reject",HttpMethod.Put)},n}(),CrewsService=function(){function n(){}return n.prototype.getById=function(n,t){t===void 0&&(t=!1);var r=(new breeze.EntityQuery).from("/crews/"+n),u=t?CacheKey[CacheKey.Crew]+"_"+n:null,i=RequestItemFactory.getInstance().createRequestItemSingle(r,u);return i.cacheDurationInMinutes=10,i},n.prototype.getForUser=function(n){n===void 0&&(n=!1);var i=(new breeze.EntityQuery).from("/user/crew"),r=n?CacheKey[CacheKey.Crew]:null,t=RequestItemFactory.getInstance().createRequestItemSingle(i,r);return t.cacheDurationInMinutes=10,t},n.prototype.getSuggested=function(){var n=(new breeze.EntityQuery).from("/crews/suggested");return RequestItemFactory.getInstance().createRequestItem(n)},n.prototype.filter=function(n){var t=(new breeze.EntityQuery).from("/crews/filter?query="+n);return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.createNewCrew=function(n,t,i,r,u,f){var e={name:n,tag:t,motto:i,biography:r,recruitmentStatus:u,productId:f};return RequestItemFactory.getInstance().createRequestItemSingle("/crews",HttpMethod.Post,e)},n.prototype.updateCrewImage=function(n,t,i){var u="/crews/"+n+"/image",r=new FormData;return r.append("type",i),r.append("image",t,"avatar"),RequestItemFactory.getInstance().createRequestItemSingle(u,HttpMethod.Post,r)},n.prototype.updateCrew=function(n,t,i,r,u,f,e){var o="/crews/"+n,s={name:f,motto:t,biography:i,recruitmentStatus:r,tag:u,intro:e};return RequestItemFactory.getInstance().createRequestItemSingle(o,HttpMethod.Put,s)},n}(),NotificationType,CrewRequestPartialV1Dot1,WebApiV1Dot1,LoggedInViewModel;(function(n){var t=function(){function n(){}return n.prototype.getAllPendingCrewRequestsForCrewId=function(n,t){t===void 0&&(t=!1);var r=(new breeze.EntityQuery).from("crews/"+n+"/requests"),u=t?CacheKey[CacheKey.CrewRequestsForCrew]:null,i=RequestItemFactory.getInstance().createRequestItemForVersion("v1.1",r,u);return t&&(i.cacheDurationInMinutes=5),i},n}();n.CrewRequestsService=t})(WebApiV1Dot1||(WebApiV1Dot1={}));var CrewInvitesService=function(){function n(){}return n.prototype.getByCrewId=function(n){var t=(new breeze.EntityQuery).from("crews/"+n+"/invites");return RequestItemFactory.getInstance().createRequestItem(t)},n.prototype.getForUser=function(n){n===void 0&&(n=!1);var i=(new breeze.EntityQuery).from("user/crews/invites"),r=n?CacheKey[CacheKey.CrewInvitesForUser]:null,t=RequestItemFactory.getInstance().createRequestItem(i,r,!0);return t.cacheDurationInMinutes=3,t},n.prototype.inviteToCrew=function(n,t){var i="crews/"+n+"/invites",r={userId:t};return RequestItemFactory.getInstance().createRequestItemSingle(i,HttpMethod.Post,r)},n.prototype.changeInvitationStatus=function(n,t,i){var r="crews/"+n+"/invites/"+t,u={status:i};return RequestItemFactory.getInstance().createRequestItemSingle(r,HttpMethod.Put,u)},n}(),IdleService=function(){function n(){this._isCurrentlyIdle=!1;this._idleTimer=null;this.activityAfterIdling=ko.observable(!1);document.addEventListener("mousemove",this.active.bind(this));document.addEventListener("mouseenter",this.active.bind(this));document.addEventListener("scroll",this.active.bind(this));document.addEventListener("keydown",this.active.bind(this));document.addEventListener("click",this.active.bind(this));document.addEventListener("dblclick",this.active.bind(this))}return n.prototype.setTimeouts=function(n,t){this._idleTimeout=n;this._idleRefreshTime=t;this.startTimer()},n.prototype.startTimer=function(){var n=this;this._idleTimer=window.setTimeout(function(){n._isCurrentlyIdle=!0},this._idleTimeout)},n.prototype.active=function(){var n=this;this._isCurrentlyIdle&&!this.activityAfterIdling()&&(this.activityAfterIdling(!0),setTimeout(function(){n.activityAfterIdling(!1)},this._idleRefreshTime));clearTimeout(this._idleTimer);this.startTimer();this._isCurrentlyIdle=!1},n}(),SurfacingStatesService=function(){function n(){}return n.prototype.getCacheKey=function(n){return n?CacheKey[CacheKey.SurfacingStates]:null},n.prototype.getByIdentity=function(n){n===void 0&&(n=!1);var t=(new breeze.EntityQuery).from("user/surfacingstates");return RequestItemFactory.getInstance().createRequestItem(t,this.getCacheKey(n),!0)},n.prototype.create=function(n){var t={surfacingType:n};return RequestItemFactory.getInstance().createRequestItemSingle("user/surfacingstate/create",HttpMethod.Post,t)},n.prototype.complete=function(n){var t={id:n};return RequestItemFactory.getInstance().createRequestItemSingle("user/surfacingstate/complete",HttpMethod.Put,t)},n.prototype.skip=function(n){var t={surfacingType:n};return RequestItemFactory.getInstance().createRequestItemSingle("user/surfacingstate/skip",HttpMethod.Put,t)},n}(),TeamTrainingService=function(){function n(){}return n.getCacheKey=function(n,t,i,r){return n?CacheKey[CacheKey.TeamTrainings]+"_"+t.toString()+"_"+i.toString()+"_"+r.toString():null},n.prototype.secret=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/teamtrainings",HttpMethod.Post,{type:TeamTrainingType.Secret,productId:i})},n.prototype.camp=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/teamtrainings",HttpMethod.Post,{type:TeamTrainingType.Camp,productId:i})},n.prototype.getSecretByTeam=function(n,t,i){return i===void 0&&(i=!1),this.getByTeam(n,t,TeamTrainingType.Secret,i)},n.prototype.getCampByTeam=function(n,t,i){return i===void 0&&(i=!1),this.getByTeam(n,t,TeamTrainingType.Camp,i)},n.prototype.getOngoingSecret=function(n,t){var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teamtrainings"),i=RequestItemFactory.getInstance().createRequestItem(r,!0);return i.predicate=function(n){return n.type===TeamTrainingType.Secret&&n.week===t},i},n.prototype.getByTeam=function(t,i,r,u){var e=(new breeze.EntityQuery).from("/leagues/"+t+"/teams/"+i+"/teamtrainings"),f=RequestItemFactory.getInstance().createRequestItem(e,n.getCacheKey(u,t,i,r),!0);return f.predicate=function(n){return n.type===r},f.orderBy=function(n){return n.week},f},n.prototype.getCampHistoryCacheKey=function(n,t,i){return n?CacheKey[CacheKey.TeamTrainingsCampHistory]+"_"+t.toString()+"_"+i.toString():null},n.prototype.getCampHistory=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/teamtrainings/camphistory").orderBy("Week");return RequestItemFactory.getInstance().createRequestItem(r,this.getCampHistoryCacheKey(i,n,t),!0)},n}(),WebApiV1Dot1;(function(n){var t=function(){function n(n){var t=this;n===void 0&&(n=null);this.isDoneLoading=Q.defer();n||(n=Q.resolve(!0));Q.all([LeanplumHelper.getInstance().isInitialized(),n]).then(function(){t._newBCShopEnabled=LeanplumHelper.getInstance().getVariables("Settings","NewBCShopEnabled",!1);t._categories=t.getOrderedEnabledCategories();t._oldProductVariables=LeanplumHelper.getInstance().getVariables("BossCoinPack")}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleError(n)}).fin(function(){t.isDoneLoading.resolve(!0)}).done()}return n.prototype.getByIdentity=function(n){var i=this;n===void 0&&(n=!1);var r=(new breeze.EntityQuery).from("products/web/"),u=n?CacheKey[CacheKey.Products]:null,t=RequestItemFactory.getInstance().createRequestItemForVersion("v1.1",r,u);return t.predicate=function(n){return i.leanplumProductsPredicate(n)},n&&(t.cacheDurationInMinutes=5),t},n.prototype.getFacebookProducts=function(n,t){var r=this;t===void 0&&(t=!1);var u=(new breeze.EntityQuery).from("products/facebook/"+n),f=t?CacheKey[CacheKey.Products]:null,i=RequestItemFactory.getInstance().createRequestItemForVersion("v1.1",u,f);return i.predicate=function(n){return r.leanplumProductsPredicate(n)},t&&(i.cacheDurationInMinutes=5),i},n.prototype.getOrderedEnabledCategories=function(){var n=LeanplumHelper.getInstance().getVariables("ShopCategories");return n||(n=this.getDefaultCategories()),Enumerable.from(n).where(function(n){return n.key in ProductCategory&&n.value.hasOwnProperty("Enabled")&&n.value.Enabled}).orderBy(function(n){return n.value.Priority}).toArray()},n.prototype.leanplumProductsPredicate=function(n){var t=this;return!this._newBCShopEnabled||!this._categories?this.leanplumProductsPredicateOld(n):(this._categories.forEach(function(i){if(!t.isProductUpdated(n)&&n.isVisibleInStore){var r=t.getLeanplumProductFromCategory(i,n.productPaymentMethodId);r&&r.hasOwnProperty("Enabled")&&r.Enabled&&t.updateProduct(n,i.key,i.value,r)}}),!this.isProductUpdated(n))?!1:!0},n.prototype.isProductUpdated=function(n){return!!n.categoryName},n.prototype.getLeanplumProductFromCategory=function(n,t){return appViewModel.isFacebookCanvas()?!n.value.hasOwnProperty("ProductsFacebook")||!n.value.ProductsFacebook.hasOwnProperty(t.toString())?null:n.value.ProductsFacebook[t]:!n.value.hasOwnProperty("ProductsWeb")||!n.value.ProductsWeb.hasOwnProperty(t.toString())?null:n.value.ProductsWeb[t]},n.prototype.updateProduct=function(n,t,i,r){n.categoryName=t;n.priority=r.hasOwnProperty("Priority")?r.Priority:0;n.size=t===ProductCategory.BCDeals?ProductSize.Small:r.hasOwnProperty("Size")&&r.Size===ProductSize.Large?r.Size:ProductSize.Medium;n.infoText=r.hasOwnProperty("InfoText")?r.InfoText:"";n.color=t===ProductCategory.BCDeals?n.amountPrevious>0?i.DiscountColor:ProductColor.Blue:r.Color;Enumerable.from(ProductColor).any(function(t){return t.value===n.color})||(n.color=ProductColor.Blue);r.hasOwnProperty("Image")&&(n.image=r.Image)},n.prototype.leanplumProductsPredicateOld=function(n){if(!this._oldProductVariables||!this._oldProductVariables.hasOwnProperty(n.productPaymentMethodId))return!0;var t=!!this._oldProductVariables[n.productPaymentMethodId];return n.isVisibleInStore=t,!0},n.prototype.getDefaultCategories=function(){var i=this.getDefaultProductPaymentMethodIds(),t=[],n;return i.forEach(function(n){t[n]={Enabled:!0,Priority:1,Size:ProductSize.Small,Color:ProductColor.Blue}}),n={Enabled:!0,Priority:2},appViewModel.isFacebookCanvas()?n.ProductsFacebook=t:n.ProductsWeb=t,[new KeyValuePair(ProductCategory.Free,{Enabled:!0,Priority:1}),new KeyValuePair(ProductCategory.BCDeals,n)]},n.prototype.getDefaultProductPaymentMethodIds=function(){if(appViewModel.isFacebookCanvas())return appViewModel.sessionSettings.worldNr===WorldNr.OFM||appViewModel.sessionSettings.worldNr===WorldNr.Dev?[6151,6154,6155,6156,6157,6158]:[6106,6106,6107,6108,6109,6010];var n=[6087,6088,6089,6090,6091,6092,6141,6142,6143,6144,6145,6146];return appViewModel.sessionSettings.worldNr===WorldNr.OFM||appViewModel.sessionSettings.worldNr===WorldNr.Dev?n.concat([6096,6103,6123,6124,6127,6129,6131,6133,6135,6160]):n.concat([6149,6150,6151,6152]),n},n}();n.ProductService=t})(WebApiV1Dot1||(WebApiV1Dot1={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamFinancePartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TeamFinance),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamTacticPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TeamTactic),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MenuItemPartial=function(n){function t(t){var i=n.call(this,t.menuItemType,t.url,t.options())||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t.prototype.setIsRedirecting=function(){return appViewModel&&appViewModel.isRedirecting(!0),!0},t.prototype.isEvent=function(){var n=this;return!appViewModel.webAndEventNotificationsPartial()||!appViewModel.webAndEventNotificationsPartial().getItems()?!1:Enumerable.from(appViewModel.webAndEventNotificationsPartial().getItems()).any(function(t){return t.todoNotificationType===TodoNotificationType.EventNotification&&t.getEventUrl()===n.url})},t}(MenuItem),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MenuHeaderPartial=function(n){function t(t){var i=n.call(this,t.menuHeaderType,t.menuItems)||this;return Helper.copyProperties(t,i),i.menuItems&&i.menuItemsPartial(new MenuItemsPartial(i.menuItems)),i}return __extends(t,n),t}(MenuHeader),MenuPartial=function(){function n(n,t,i,r,u){var f=this;this.menuHeadersPartial=ko.observable(new MenuHeadersPartial([]));this.isInitialized=ko.observable(!1);this.hasHighlightedMenu=ko.computed(function(){return Enumerable.from(f.menuHeadersPartial().getItems()).any(function(n){return n.isHighlighted})});this.onConditionChanged=ko.computed(function(){if(appViewModel&&f.isInitialized()){var n=f._menuService.getAll();if(SessionManager.hasTeam()||n.forEach(function(n){n.menuItems=appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().isInTutorialMode()?[]:Enumerable.from(n.menuItems).where(function(n){return n.options().showNoTeam}).toArray()}),appViewModel.leaguePartial()&&appViewModel.leaguePartial().isLastDay&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showOnLastDay}).toArray()}),appViewModel.leaguePartial()&&appViewModel.leaguePartial().isInPreparation&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showInPreperation}).toArray()}),appViewModel.leaguePartial()&&appViewModel.leaguePartial().totalCupRounds===0&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showNoCup}).toArray()}),appViewModel.leaguePartial()&&!appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showNoTransfers}).toArray()}),appViewModel.leaguePartial()&&!appViewModel.leaguePartial().settingsPartial().areTrainingCampsAllowed&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showNoTrainingCamp}).toArray()}),appViewModel.leaguePartial()&&!appViewModel.leaguePartial().settingsPartial().areSecretTrainingsAllowed&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return n.options().showNoSecretTraining}).toArray()}),appViewModel.leaguePartial()&&appViewModel.leaguePartial().isKnockoutLeague()&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return!n.options().hideInKnockoutLeague}).toArray()}),appViewModel.leaguePartial()&&appViewModel.leaguePartial().isTournamentLeague()&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return!n.options().hideInTournamentLeague}).toArray()}),appViewModel.leaguePartial()&&!appViewModel.leaguePartial().isKnockoutLeague()&&n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(function(n){return!n.options().showOnlyInKnockoutLeague}).toArray()}),f.hideUnsurfacedMenuItems(n),n=Enumerable.from(n).where(function(n){return n.menuItems.length>0||n.menuHeaderType===MenuHeaderType.Home}).toArray(),appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().isInTutorialMode()&&!SessionManager.hasTeam()&&window.location.href.indexOf(Urls.friends)===-1&&(n=Enumerable.from(n).where(function(n){return n.menuHeaderType!==MenuHeaderType.Home}).toArray()),appViewModel.tutorialPartial())switch(appViewModel.tutorialPartial().tutorialStep()){case TutorialStep.MenuTactics:window.location.href.indexOf(Urls.tactics)<=0&&f.highlightMenuItem(n,MenuItemType.Tactics);break;case TutorialStep.MenuFriendlies:window.location.href.indexOf(Urls.friendlies)<=0&&f.highlightMenuItem(n,MenuItemType.Friendlies);break;case TutorialStep.MenuTraining:window.location.href.indexOf(Urls.training)<=0&&f.highlightMenuItem(n,MenuItemType.Training);break;case TutorialStep.TrainingGoHome:window.location.href.indexOf(Urls.dashboard)<=0&&(Enumerable.from(n).firstOrDefault(function(n){return n.menuHeaderType===MenuHeaderType.Home}).isHighlighted=!0)}f.addTranslations(n);f.menuHeadersPartial().setItemsFromModels(n)}});this._menuService=n;this._menuTranslations=t;this._tutorialTranslations=i;this._surfacingStates=r;this._user=u;this.isInitialized(!0)}return n.prototype.hideUnsurfacedMenuItems=function(n){var t=new UserPartial(this._user),i=Enumerable.from(this._surfacingStates).where(function(n){return n.surfacedTimestamp!==undefined}).select(function(n){return n.type}),r=function(n){return n.options().showWhenSurfaced===SurfacingType.Default||n.options().showToLegacyUser&&t.isLegacyUser()||i.contains(n.options().showWhenSurfaced)};n.forEach(function(n){n.menuItems=Enumerable.from(n.menuItems).where(r).toArray()})},n.prototype.addTranslations=function(n){var t=this,i=Enumerable.from(this._tutorialTranslations).firstOrDefault(function(n){return n.key==="tut_openmenucatpointertext"}),r=Enumerable.from(this._tutorialTranslations).firstOrDefault(function(n){return n.key==="tut_openmenuitempointertext"}),u=Enumerable.from(this._tutorialTranslations).firstOrDefault(function(n){return n.key==="tut_liscontinuetohomepointertext"});n.forEach(function(n){var f=Enumerable.from(t._menuTranslations).firstOrDefault(function(t){return t.key==="men_cat"+MenuHeaderType[n.menuHeaderType].toLowerCase()});f&&(n.title=f.value);i&&(n.tutorialText=i.value);n.menuHeaderType===MenuHeaderType.Home&&u&&(n.tutorialText=u.value);n.menuItems.forEach(function(n){var i=Enumerable.from(t._menuTranslations).firstOrDefault(function(t){return t.key==="men_item"+MenuItemType[n.menuItemType].toLowerCase()});i&&(n.title=i.value);r&&(n.tutorialText=r.value)})})},n.prototype.isMenuItemTypeVisible=function(n){return Enumerable.from(this.menuHeadersPartial().getItems()).any(function(t){return Enumerable.from(t.menuItems).any(function(t){return t.menuItemType===n})})},n.prototype.highlightMenuItem=function(n,t){var i=Enumerable.from(n).firstOrDefault(function(n){return Enumerable.from(n.menuItems).any(function(n){return n.menuItemType===t})}),r;i&&(i.isHighlighted=!0,r=Enumerable.from(i.menuItems).firstOrDefault(function(n){return n.menuItemType===t}),r&&(r.isHighlighted=!0))},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MenuItemsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new MenuItemPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MenuHeadersPartial=function(n){function t(t){var i=n.call(this)||this;return i.hasHighlightedMenu=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.isHighlighted})}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new MenuHeaderPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),RssFeedItemPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(RssFeedItem),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),RssFeedItemsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new RssFeedItemPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),RssFeedPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.rssFeedItems&&(i.rssFeedItemsPartial=new RssFeedItemsPartial(i.rssFeedItems)),i}return __extends(t,n),t}(RssFeed),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ToastsPartial=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProductPartial=function(n){function t(t){var i=n.call(this)||this,r;return i.countdownTimer=ko.observable(),i.label=ProductLabel.None,i.imageUrl="",i.isLoadingPaymentEnvironment=ko.observable(!1),i.isEnlargedProduct=ko.observable(!1),Helper.copyProperties(t,i),i.label=t.amountPrevious>0?ProductLabel.Sale:t.categoryName===ProductCategory.BCDeals?ProductLabel.None:ProductLabel.New,i.imageUrl=i.getImageUrl(),(i.restrictionType===RestrictionType.EndTime||i.restrictionType===RestrictionType.TimeAfterSignup)&&(r=new CountdownTimer,i.restrictionType===RestrictionType.TimeAfterSignup&&(i.restrictionValue=appViewModel.userPartial().signUpTimestamp+i.restrictionValue*60),r.finishedTimestamp=i.restrictionValue,i.countdownTimer(new CountdownTimerPartial(r)),i.restrictionValue-appViewModel.sessionSettings.timestamp<=0&&(i.isVisibleInStore=!1)),i.restrictionType===RestrictionType.MaxAmount&&i.restrictionValue<=0&&(i.isVisibleInStore=!1),i.discount=ko.computed(function(){return i.amountPrevious===0?null:Math.floor((i.amount-i.amountPrevious)/i.amountPrevious*100)}),i}return __extends(t,n),t.prototype.isPromotion=function(){return(this.restrictionType!==RestrictionType.None||this.discount()>0)&&this.isVisibleInStore},t.prototype.getImageUrl=function(){switch(this.image){case"store_icon_small":return"/Images/views/store/bc_200.png";case"store_icon_medium":return"/Images/views/store/bc_525.png";case"store_icon_large":return"/Images/views/store/bc_1125.png";case"store_icon_extralarge":return"/Images/views/store/bc_2350.png";case"store_icon_mega":return"/Images/views/store/bc_6250.png";case"store_icon_boss":return"/Images/views/store/bc_16000.png";case"store_icon_mobile":return"/Images/views/store/store_icon_mobile.png";case"store_icon_ivr":return"/Images/views/store/store_icon_paymobile.png";default:return this.image}},t}(Product),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProductsPartial=function(n){function t(i){var r=n.call(this)||this,u;return r.shopDefaultTileColor=ko.observable(t.ShopColor.Blue),r.shopShowAdFreeText=ko.observable(!0),r.shopSpecialOfferColor=ko.observable(t.ShopColor.Green),r.shopLargeTileColor=ko.observable(t.ShopColor.Blue),r.shopLargePackId=ko.observable(0),r.customShopImages=ko.observable(),r.getActiveItems=ko.computed(function(){return Enumerable.from(r.getItems()).where(function(n){return n.isVisibleInStore&&(n.countdownTimer()&&n.countdownTimer().timerState()!==TimerState.Finished||!n.countdownTimer())}).toArray()}),r.hasAnySaleProduct=ko.computed(function(){return Enumerable.from(r.getActiveItems()).any(function(n){return n.label===ProductLabel.Sale})}),r.addItemsFromModels(i,ProductPartial),r.sortingEnabled(!0),u=LeanplumHelper.getInstance().getVariables("Settings"),u&&(r.shopDefaultTileColor(parseInt(u.ShopDefaultTileColor)),r.shopShowAdFreeText(u.ShopShowAdFreeText),r.shopSpecialOfferColor(parseInt(u.ShopSpecialOfferColor)),r.shopLargeTileColor(parseInt(u.ShopLargeTileColor)),r.shopLargePackId(parseInt(u.ShopLargePackId)),r.customShopImages(u.CustomShopImages)),r}return __extends(t,n),t.prototype.hasProductPromotion=function(){return Enumerable.from(this.getActiveItems()).any(function(n){return n.isPromotion()})},t.prototype.orderProductsByIsEnlargedAndThenAmount=function(){this.sortItems(function(n){return!n.isEnlargedProduct()},[function(n){return n.isMobile},function(n){return n.amount}],SortOrder.Ascending)},t.prototype.isAnyProductLoadingPaymentEnvironment=function(){return Enumerable.from(this.getItems()).any(function(n){return n.isLoadingPaymentEnvironment()})},t.prototype.getTileColorForProduct=function(n){if(!n)return"";var i="";return n.isPromotion()||n.isEnlargedProduct()?n.isEnlargedProduct()?i=t.ShopColor[this.shopLargeTileColor()]:n.isPromotion()&&(i=t.ShopColor[this.shopSpecialOfferColor()]):i=t.ShopColor[this.shopDefaultTileColor()],i.toLowerCase()+"-tile"},t.prototype.getImageForProduct=function(n){if(!n||!this.customShopImages())return"";var t=this.customShopImages()[n.image];return t!==n.image&&t?t:"/Images/views/store/"+n.image+".png"},t}(PartialArrayViewModel);(function(n){var t;(function(n){n[n.Blue=0]="Blue";n[n.Orange=1]="Orange";n[n.Purple=2]="Purple";n[n.Green=3]="Green"})(t=n.ShopColor||(n.ShopColor={}))})(ProductsPartial||(ProductsPartial={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ShopItemPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(ShopItem),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ShopItemsPartial=function(n){function t(t){var i=n.call(this)||this;return i.addItemsFromModels(t,ShopItemPartial),i}return __extends(t,n),t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BossCoinToast=function(n){function t(t){var i=n.call(this,ToastTemplate.BossCoinToast)||this;return i.claimTimer=ko.observable(),i.counter=ko.observable(),i.isLoading=ko.observable(!0),i.shouldShowClaimView=ko.computed(function(){return i.counter()?i.counter().value()>0:!1}),i.shouldRedirectToShop=ko.observable(LeanplumHelper.getInstance().getVariables("Settings","NewBCShopDailyRewardEnabled",!1)&&LeanplumHelper.getInstance().getVariables("Settings","NewBCShopEnabled",!1)),i.claimTimer(new CountdownTimerPartial(t.countdownTimer)),i.counter(new Counter(t.unclaimedCoins)),i.isLoading(!1),i}return __extends(t,n),t.prototype.goToShop=function(){appViewModel.bossCoinWalletPartial()!=null&&(appViewModel.bossCoinWalletPartial().openBosscoinShopModal(),this.hide())},t.prototype.claim=function(){var n=this;appViewModel.bossCoinWalletPartial()!=null&&(appViewModel.bossCoinWalletPartial().claimBossCoins(),this.counter().countToValue(0,1e3).then(function(){setTimeout(function(){n.hide()},2e3)}).done())},t}(BaseToast),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),FeedbackToast=function(n){function t(t,i,r,u,f){i===void 0&&(i="");r===void 0&&(r=[]);u===void 0&&(u=PlayerWorldStarLevel.None);f===void 0&&(f=PlayerRarity.Default);var e=n.call(this,ToastTemplate.FeedbackToast)||this;return e.feedbackType=ko.observable(),e.imageUrl=ko.observable(),e.stringVariables=Array(),e.playerWorldStarLevel=ko.observable(PlayerWorldStarLevel.None),e.playerRarity=ko.observable(PlayerRarity.Default),e.feedbackType(t),e.imageUrl(i),e.stringVariables=r,e.playerWorldStarLevel(u),e.playerRarity(f),e.show(),e}return __extends(t,n),t.prototype.getWorldStarClassName=function(){switch(this.playerWorldStarLevel()){case PlayerWorldStarLevel.WorldStar1:return"world-star-1";case PlayerWorldStarLevel.WorldStar2:return"world-star-2";default:return"no-world-star"}},t}(BaseToast);(function(n){var t;(function(n){n[n.PlayerToTransferlist=0]="PlayerToTransferlist";n[n.PlayerBought=1]="PlayerBought";n[n.PlayerTrained=2]="PlayerTrained";n[n.Stadium=3]="Stadium";n[n.EntryRequestAccepted=4]="EntryRequestAccepted";n[n.EntryRequestRejected=5]="EntryRequestRejected";n[n.EntryRequestsAccepted=6]="EntryRequestsAccepted";n[n.EntryRequestsRejected=7]="EntryRequestsRejected";n[n.SeasonContinued=8]="SeasonContinued";n[n.SeasonContinuedLastWeek=9]="SeasonContinuedLastWeek";n[n.ManagerKicked=10]="ManagerKicked";n[n.SquadNumberAssigned=11]="SquadNumberAssigned";n[n.PlayerSoldThroughQuickSell=12]="PlayerSoldThroughQuickSell"})(t=n.Type||(n.Type={}))})(FeedbackToast||(FeedbackToast={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),GameSettingPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(GameSetting),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),GameSettingsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.getGameSetting=function(n,t){return Enumerable.from(this.getItems()).firstOrDefault(function(i){return i.category===n&&i.name===t})},t.prototype.getGameSettings=function(n,t){return Enumerable.from(this.getItems()).where(function(i){return i.category===n&&i.name===t}).toArray()},t.prototype.getValue=function(n,t,i){i===void 0&&(i=0);var r=this.getGameSetting(n,t);return r==null?i:r.value},t.prototype.getTimerId=function(n){var t=this.getGameSetting(GameVarCategory.Timer,n);return t?t.id:0},t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new GameSettingPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BossCoinProductPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(BossCoinProduct),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BossCoinProductsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.getBossCoinProduct=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.name===n})},t.prototype.getBossCoinProducts=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.name===n}).toArray()},t.prototype.getBossCoinProductById=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.id===n})},t.prototype.getBossCoinProductByIncrement=function(n,t){return Enumerable.from(this.getItems()).firstOrDefault(function(i){return i.name===n&&i.increment===t})},t.prototype.getValue=function(n){var t=this.getBossCoinProduct(n);return t==null?0:t.value},t.prototype.getValueByIncrement=function(n,t){var i=this.getBossCoinProductByIncrement(n,t);return i==null?0:i.value},t.prototype.getValueByName=function(n){var t=Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.name===n});return t?t.value:null},t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new BossCoinProductPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),ClubFundsWalletPartial=function(){function n(n,t,i){var r=this;this._financeModal=ko.observable();this.clubFundsProgress=new ProgressHelper(0,{animationDuration:500});this._teamFinancesService=n;this._stadiumService=t;this._teamPartial=i;this.savings=ko.computed(function(){return!r._teamPartial()||!r._teamPartial().financePartial()?0:r._teamPartial().financePartial().savings}).extend({rateLimit:500});this.updateProgress(!1)}return n.prototype.calculateClubFundsShortageForPrice=function(n){return!this._teamPartial()||!this._teamPartial().financePartial()?0:Math.max(n-this._teamPartial().financePartial().balance,0)},n.prototype.updateProgress=function(n){if((n===void 0&&(n=!0),this._teamPartial())&&this._teamPartial().financePartial()){var t=this._teamPartial().financePartial().balance;if(!n){this.clubFundsProgress.animatedProgress(t);return}this.clubFundsProgress.updateProgress(t)}},n.prototype.calculateClubFundsRemainderForPrice=function(n){return!this._teamPartial()||!this._teamPartial().financePartial()?0:Math.min(this._teamPartial().financePartial().balance,n)},n.prototype.calculateBossCoinConversionCount=function(n,t){var i=this.calculateClubFundsShortageForPrice(n);return i<=0||!t?0:Math.ceil(i/t.value)},n.prototype.showFinanceModal=function(){this._financeModal()||this._financeModal(new FinanceModal(this._teamFinancesService,this._teamPartial));this._financeModal().show()},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BossCoinWalletPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return u.bossCoinProgress=new ProgressHelper(0),u.hasClaimableDailyRewardInShop=ko.observable(!1),u._bossCoinsService=i,u._teamFinancesService=r,Helper.copyProperties(t,u),u.bossCoinProgress.updateProgress(t.amount),u.hasClaimableDailyRewardInShop(u.unclaimedCoins>0&&LeanplumHelper.getInstance().getVariables("Settings","NewBCShopDailyRewardEnabled",!1)&&LeanplumHelper.getInstance().getVariables("Settings","NewBCShopEnabled",!1)),u}return __extends(t,n),t.prototype.canPayBossCoins=function(n){return this.amount>=n},t.prototype.updateWallet=function(n){Helper.copyProperties(n,this);this.bossCoinProgress.updateProgress(n.amount);this.hasClaimableDailyRewardInShop(this.unclaimedCoins>0&&LeanplumHelper.getInstance().getVariables("Settings","NewBCShopDailyRewardEnabled",!1)&&LeanplumHelper.getInstance().getVariables("Settings","NewBCShopEnabled",!1))},t.prototype.claimBossCoins=function(){var n=this.unclaimedCoins;WebApi.getInstance().execute(this._bossCoinsService.claim()).then(function(){LeanplumHelper.getInstance().trackEventWithValue(LeanplumTrackingService.Event.BCClaim,n,{BCClaimSource:"DailyReward"});appViewModel.refreshBossCoinsWallet().done();appViewModel.refreshTimers()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n);appViewModel.refreshTimers()}).done()},t.prototype.openBosscoinShopModal=function(){var n=LeanplumHelper.getInstance().reloadSession(),t=LeanplumHelper.getInstance().getVariables("Settings","NewBCShopEnabled",!1);return t?new StoreModal(n,new WebApiV1Dot1.ProductService(n),new PaymentFactory(new OrdersService,new PayByMeService,new CentiliService,new FacebookService)).show():new BosscoinShopModal(n,new WebApiV1Dot1.ProductService(n),new PaymentFactory(new OrdersService,new PayByMeService,new CentiliService,new FacebookService)).show()},t.prototype.confirmBossCoinPayment=function(n,t,i,r,u,f,e,o,s,h){var l=this,c;return r===void 0&&(r=0),u===void 0&&(u=!1),f===void 0&&(f=!0),e===void 0&&(e=!0),o===void 0&&(o=""),s===void 0&&(s={}),h===void 0&&(h=!0),c=Q.defer(),this.canPayBossCoins(t)?t>0?(u&&o&&h&&LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(o,t,s),new ConfirmPaymentModal(n,r,t,i,f,e).show().then(function(){c.resolve(!0)}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("BossCoinWalletPartial.confirmBossCoinPayment.deferred: ConfirmPaymentModal rejected.");c.reject(n)}).done()):c.resolve(!0):new NotEnoughBossCoinsModal(t,u,o,s).show().then(function(){l.openBosscoinShopModal().then(function(){c.resolve(!0)}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("User did not have enough bosscoins but cancelled the payment for extra coins.");c.reject(n)}).done()}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("BossCoinWalletPartial.confirmBossCoinPayment.deferred: NotEnoughBossCoinsModal rejected.");c.reject(n)}).done(),c.promise},t.prototype.convertBossCoinsToClubFunds=function(n,t){var r=this,i;return t===void 0&&(t={}),i=Q.defer(),n.clubFundsToConvert>0?this.canPayBossCoins(n.totalBossCoinCost)?WebApi.getInstance().execute(this._teamFinancesService.buyClubFunds(SessionManager.getLeagueId(),SessionManager.getTeamId(),n.clubFundsToConvert,n.conversionRateBossCoinProductPartial.id)).then(function(){LeanplumHelper.getInstance().trackBossCoinSpentEvent(n.conversionRateBossCoinProductPartial.name,n.conversionBossCoinCost,t);i.resolve(!0)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not convert clubfunds to bosscoins due to an error");i.reject(t)}).done():new NotEnoughBossCoinsModal(n.totalBossCoinCost,!0,n.conversionRateBossCoinProductPartial.name,t).show().then(function(){r.openBosscoinShopModal().then(function(){i.resolve(!0)}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("User did not have enough bosscoins but cancelled the payment for extra coins.");i.reject(n)}).done()}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("BossCoinWalletPartial.convertBossCoinsToClubFunds.deferredConversion: NotEnoughBossCoinsModal rejected.");i.reject(n)}).done():i.resolve(!0),i.promise},t}(BossCoinWallet),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LanguagePartial=function(n){function t(t){var i=n.call(this)||this;return i.flagCode="en-GB",i.googlePlayStoreImageUrl="",i.appStoreImageUrl="",Helper.copyProperties(t,i),i.flagCode=i.cultureCode.toLowerCase().substr(0,2)===i.code.toLowerCase()?i.cultureCode.substr(i.cultureCode.length-2,2).toLowerCase():i.code.toLowerCase(),i.googlePlayStoreImageUrl="/Images/shared/playstore/"+i.googlePlayButtonCode+"_badge_web_generic.png",i.appStoreImageUrl="/Images/shared/appstore/Download_on_the_App_Store_Badge_"+i.appStoreButtonCode+"_135x40.svg",i}return __extends(t,n),t.prototype.select=function(n){WebApiConfig.getInstance().cultureCode=this.cultureCode;CacheHandler.getInstance().removeKeysStartingWith(CacheKey.Texts);n?window.location.href=n:window.location.reload()},t}(Language),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),NationalityPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Nationality),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),NotificationPartial=function(n){function t(t){var i=n.call(this)||this,r;return i.iconType="",i.isLoading=ko.observable(!1),i.todoNotificationType=TodoNotificationType.WebNotification,Helper.copyProperties(t,i),r=NotificationGroupType[i.group],i.iconType="icon-notification-"+(r?r.toLowerCase():"account"),i}return __extends(t,n),t}(WebApiV1.Notification),NotificationGroupType;(function(n){n[n.Default=0]="Default";n[n.Lineup=1]="Lineup";n[n.Offer=2]="Offer";n[n.Scout=3]="Scout";n[n.Sponsor=4]="Sponsor";n[n.ShirtSponsor=5]="ShirtSponsor";n[n.Spy=6]="Spy";n[n.Stadium=7]="Stadium";n[n.Tactic=8]="Tactic";n[n.Training=9]="Training";n[n.Doctor=10]="Doctor";n[n.Lawyer=11]="Lawyer";n[n.Specialists=12]="Specialists";n[n.Staff=13]="Staff";n[n.OfferAccepted=14]="OfferAccepted";n[n.OfferRejected=15]="OfferRejected";n[n.Transfer=16]="Transfer";n[n.TrainingCamp=17]="TrainingCamp";n[n.Moderator=18]="Moderator";n[n.FinancialDirector=19]="FinancialDirector";n[n.OfferWithdrawn=20]="OfferWithdrawn";n[n.Friendlies=21]="Friendlies";n[n.Account=22]="Account"})(NotificationGroupType||(NotificationGroupType={})),function(n){n[n.Default=0]="Default";n[n.LineupEmptySpots=1]="LineupEmptySpots";n[n.OfferReceived=2]="OfferReceived";n[n.SponsorEmptySpots=4]="SponsorEmptySpots";n[n.StadiumUpgradeAvailable=7]="StadiumUpgradeAvailable";n[n.TacticEmpty=8]="TacticEmpty";n[n.TrainingEmptySpots=10]="TrainingEmptySpots";n[n.DoctorPlayerInjured=12]="DoctorPlayerInjured";n[n.LawyerPlayerSuspended=13]="LawyerPlayerSuspended";n[n.SpecialistsEmptySpots=14]="SpecialistsEmptySpots";n[n.CounterOfferReceived=16]="CounterOfferReceived";n[n.PlayerSold=17]="PlayerSold";n[n.OfferSellRejected=18]="OfferSellRejected";n[n.OfferSellAccepted=19]="OfferSellAccepted";n[n.OfferBuyRejected=20]="OfferBuyRejected";n[n.OfferBuyAccepted=21]="OfferBuyAccepted";n[n.TrainingCampAgainst=22]="TrainingCampAgainst";n[n.ModeratorSettings=23]="ModeratorSettings";n[n.OfferSellWithdrawn=25]="OfferSellWithdrawn";n[n.OfferBuyWithdrawn=26]="OfferBuyWithdrawn";n[n.AccountNotActivated=27]="AccountNotActivated";n[n.OfferBuyCounterAccepted=29]="OfferBuyCounterAccepted";n[n.RequestAccessToLeague=30]="RequestAccessToLeague";n[n.OnboardingTraining=31]="OnboardingTraining";n[n.OnboardingSquad=32]="OnboardingSquad"}(NotificationType||(NotificationType={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),NotificationsPartial=function(n){function t(t,i){var r=n.call(this,3)||this;return r._notificationService=t,r.setItemsFromModels(i),r}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new NotificationPartial(n))});this.setItems(t)},t.prototype.redirectNotification=function(n){n&&(Enumerable.from([NotificationGroupType.Offer,NotificationGroupType.Transfer]).contains(n.group)?this.redirectAndRemoveNotification(n):this.redirect(n))},t.prototype.removeNotification=function(n){n&&(this.removeItemByFunction(function(t){return t.id===n.id}),WebApi.getInstance().execute(this._notificationService.remove(SessionManager.getLeagueId(),SessionManager.getTeamId(),n.id)).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done())},t.prototype.redirectAndRemoveNotification=function(n){var t=this;n.isLoading(!0);WebApi.getInstance().execute(this._notificationService.remove(SessionManager.getLeagueId(),SessionManager.getTeamId(),n.id)).then(function(){t.redirect(n);t.removeItemByFunction(function(t){return t.id===n.id})}).fail(function(t){n.isLoading(!1);ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t)}).done()},t.prototype.redirect=function(n){var t;switch(n.group){case NotificationGroupType.Lineup:t=Urls.lineup;break;case NotificationGroupType.Offer:t=Urls.offers+"/"+n.objectId;break;case NotificationGroupType.Scout:t=Urls.scout;break;case NotificationGroupType.Sponsor:case NotificationGroupType.ShirtSponsor:t=Urls.sponsors;break;case NotificationGroupType.Spy:t=Urls.spy;break;case NotificationGroupType.Stadium:t=Urls.stadium;break;case NotificationGroupType.Tactic:t=Urls.tactics;break;case NotificationGroupType.Training:t=Urls.training;break;case NotificationGroupType.Doctor:t=Urls.doctor;break;case NotificationGroupType.Lawyer:t=Urls.lawyer;break;case NotificationGroupType.Specialists:t=Urls.specialists;break;case NotificationGroupType.Transfer:t=Urls.transferlistHistory;break;case NotificationGroupType.TrainingCamp:t=Urls.trainingCamp;break;case NotificationGroupType.Friendlies:t=Urls.friendlies;break;case NotificationGroupType.Moderator:t=n.notificationType===NotificationType.RequestAccessToLeague?Urls.requests:Urls.moderatorTools}t!==undefined&&window.location.href.indexOf(t)===-1&&(window.location.href=t)},t}(PagingViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ManagerPartial=function(n){function t(t){var i=n.call(this)||this;return i.isCpu=!0,i.avatarType=AvatarType.Player,i.masterAccountName="",i.isSacking=ko.observable(!1),Helper.copyProperties(t,i),i.masterAccountName=i.masterAccount===""?i.name:i.masterAccount,i.isCpu=i.id===0,i.isCpu&&(i.avatarType=AvatarType.Cpu),i.team&&(i.teamPartial=new TeamPartial(i.team)),i.mayBeKicked=ko.computed(function(){if(!appViewModel||!appViewModel.gameSettingsPartial())return!1;var n=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Manager,"NotSackableDays");return i.lastLoginTimestamp<Helper.unixTimeStamp()-86400*n}),i}return __extends(t,n),t.prototype.getPartnerNrImage=function(){return Helper.getPlatformImage(this.lastLoginPlatform)},t.prototype.getCrewTagClassName=function(){return this.isCpu?"":this.crewId==0?"crew-tag-image-division-placeholder":"crew-tag-image-division-"+this.crewRankingDivisionSorting},t.prototype.navigateTo=function(){location.href=Helper.replaceText(Urls.profile,[new KeyValuePair("userId",this.masterAccountId.toString())])},t}(Manager),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MatchPartial=function(n){function t(t){var i=n.call(this)||this;return i.opponentTeamId=ko.observable(),i.opponentTeamPartial=ko.observable(),i.opponentManagerPartial=ko.observable(),i.isSimulating=ko.observable(!1),i.simulationMinute=ko.observable(0),i._isInitialized=ko.observable(!1),i.pauseSimulationHalfInterval=ko.observable(!1),i.isPlayed=ko.computed(function(){return!i._isInitialized()||!appViewModel||!appViewModel.leaguePartial()?!1:i.weekNr<=appViewModel.leaguePartial().weekNr}),i.hasHomeCamp=ko.computed(function(){return!i.teamTrainingsPartial()||!i.teamTrainingsPartial().getItems()?!1:i.teamTrainingsPartial().hasCamp(i.homeTeamPartial().id)}),i.hasAwayCamp=ko.computed(function(){return!i.teamTrainingsPartial()||!i.teamTrainingsPartial().getItems()?!1:i.teamTrainingsPartial().hasCamp(i.awayTeamPartial().id)}),Helper.copyProperties(t,i),i.matchData&&i.matchDataPartial(new MatchDataPartial(i.matchData)),i.homeTeam&&i.homeTeamPartial(new TeamPartial(i.homeTeam)),i.awayTeam&&i.awayTeamPartial(new TeamPartial(i.awayTeam)),i.homeManager?i.homeManagerPartial(new ManagerPartial(i.homeManager)):i.homeManagerPartial(new ManagerPartial(new Manager)),i.awayManager?i.awayManagerPartial(new ManagerPartial(i.awayManager)):i.awayManagerPartial(new ManagerPartial(new Manager)),i.matchEvents&&i.matchEventsPartial(new MatchEventsPartial(i.matchEvents)),i.referee&&i.refereePartial(new RefereePartial(i.referee)),i.friendlyRewards&&i.friendlyRewardsPartial(new FriendlyRewardsPartial(i.friendlyRewards)),i.opponentTeamId(i.getOpponentTeamId(SessionManager.getTeamId())),i.teamTrainings&&i.teamTrainingsPartial(new TeamTrainingsPartial(i.teamTrainings)),i.opponentTeamPartial(i.getOpponentTeam(SessionManager.getTeamId())),i.opponentManagerPartial(i.getOpponentManager(SessionManager.getTeamId())),i.cupRound&&i.cupRoundPartial(new CupRoundPartial(i.cupRound)),i._isInitialized(!0),i}return __extends(t,n),t.prototype.getOpponentTeamId=function(n){return this.homeTeamId===n?this.awayTeamId:this.homeTeamId},t.prototype.getOpponentTeam=function(n){return this.homeTeamId===n?this.awayTeamPartial():this.homeTeamPartial()},t.prototype.getSessionManagerTeamSide=function(){return SessionManager.getTeamId()===this.homeTeamId?TeamSide.Home:TeamSide.Away},t.prototype.getOpponentManager=function(n){return this.homeTeamId===n?this.awayManagerPartial():this.homeManagerPartial()},t.prototype.isHomeTeam=function(n){return this.homeTeamId===n},t.prototype.getMatchResult=function(n){var t=this.getWinnerTeamId();return t===-1?MatchResult.Drew:t===n?MatchResult.Won:MatchResult.Lost},t.prototype.getWinnerTeamId=function(){return this.homeGoals>this.awayGoals?this.homeTeamId:this.awayGoals>this.homeGoals?this.awayTeamId:-1},t.prototype.isEliminatedFromCup=function(n){return this.matchType!==MatchType.Cup||this.legType===MatchLegType.FirstLeg||!this.isPlayed()?!1:n!==this.winnerTeamId},t.prototype.simulate=function(){var n=this,t=Q.defer();return this.isSimulating(!0),this.startHalfInterval(this.getEndTimeForMatchPhase(MatchPhase.FirstHalf)).then(function(){return n.startBreakTimeout(1e3)}).then(function(){return n.startHalfInterval(n.getEndTimeForMatchPhase(MatchPhase.SecondHalf))}).then(function(){return n.startBreakTimeout(1e3)}).done(function(){t.resolve();n.isSimulating(!1)}),t.promise},t.prototype.startBreakTimeout=function(n){var t=Q.defer();return setTimeout(function(){t.resolve()},n),t.promise},t.prototype.startHalfInterval=function(n,t){var i=this,r,u;return t===void 0&&(t=50),r=Q.defer(),u=setInterval(function(){if(!i.pauseSimulationHalfInterval()){if(i.simulationMinute()>=n){clearInterval(u);r.resolve();return}i.simulationMinute(i.simulationMinute()+1)}},t),r.promise},t.prototype.pauseSimulationHalf=function(n){var i=this,t;return n===void 0&&(n=1e3),t=Q.defer(),this.pauseSimulationHalfInterval(!0),setTimeout(function(){i.pauseSimulationHalfInterval(!1);t.resolve()},n),t.promise},t.prototype.getEndTimeForMatchPhase=function(n){switch(n){case MatchPhase.FirstHalf:return 45;case MatchPhase.SecondHalf:return 90;case MatchPhase.ExtraTimeFirstHalf:return 105;case MatchPhase.ExtraTimeSecondHalf:return 120}},t.prototype.getStartTimeForMatchPhase=function(n){switch(n){case MatchPhase.FirstHalf:return 0;case MatchPhase.SecondHalf:return 45;case MatchPhase.ExtraTimeFirstHalf:return 90;case MatchPhase.ExtraTimeSecondHalf:return 105;case MatchPhase.Penalties:return 120}},t.prototype.isCupMatch=function(){return this.matchType===MatchType.Cup},t}(Match),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),UserPartial=function(n){function t(t){var i=n.call(this)||this,r;return i.showActivateAccountNotification=ko.observable(!1),i.showUnconfirmedEmailNotification=ko.observable(!1),Helper.copyProperties(t,i),i.teamSlots&&Object.keys(i.teamSlots).length>0&&i.teamSlotsPartial(new TeamSlotsPartial(i.teamSlots,i.signUpTimestamp)),i.masterAccount=i.masterAccount?i.masterAccount:i.name,i.isNewUser=i.loginCount<=1,r=$.cookie(CookieHelper.CookieKeys.unconfirmedActivationEmail),r&&i.showUnconfirmedEmailNotification(!0),r||i.isActivated()||i.showActivateAccountNotification(!0),i.isInSessionLeague=ko.computed(function(){return appViewModel.leaguePartial()?i.teamSlotsPartial()?Enumerable.from(i.teamSlotsPartial().getItems()).any(function(n){return n.leaguePartial()&&n.leaguePartial().id===appViewModel.leaguePartial().id}):!1:!1}),i.canBeInvited=ko.computed(function(){return!appViewModel.leaguePartial()||!appViewModel.userPartial()?!1:appViewModel.leaguePartial().isClosed()&&!appViewModel.userPartial().isUser(appViewModel.leaguePartial().moderator)?!1:appViewModel.leaguePartial().vacancies===0?!1:i.isInSessionLeague()?!1:!0}),i.isLegacyUser=ko.computed(function(){return Enumerable.from([Platform.LegacyWeb,Platform.LegacyIphone,Platform.LegacyAndroid,Platform.LegacyIpad,Platform.LegacyFacebook,Platform.LegacyVKontakte]).contains(i.partnerNr)}),i}return __extends(t,n),t.prototype.isActivated=function(){return!this.activationCode},t.prototype.hasMultipleSlots=function(){return Enumerable.from(this.teamSlotsPartial().getItems()).where(function(n){return Boolean(n.managerPartial())}).count()>1},t.prototype.canHaveMultipleSlots=function(){return this.hasMultipleSlots()||Enumerable.from(this.teamSlotsPartial().getItems()).count(function(n){return n.daysUntilUnlockable===0})>1},t.prototype.getPartnerNrImage=function(){return Helper.getPlatformImage(this.partnerNr)},t.prototype.navigateTo=function(){window.location.href=Helper.replaceText(Urls.profile,[new KeyValuePair("userId",this.id.toString())])},t.prototype.navigateToSlots=function(){window.location.href=Helper.replaceText(Urls.profileSlots,[new KeyValuePair("userId",this.id.toString())])},t.prototype.areAdsEnabledForUser=function(){var n=LeanplumHelper.getInstance().getVariables("Settings","AdWaitingHours",72);return this.hasAds&&Helper.getHoursSinceTimestamp(this.signUpTimestamp)>n},t.prototype.isUser=function(n){return n===this.login||n===this.login+"S1"||n===this.login+"S2"||n===this.login+"S3"},t}(User),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),UsersPartial=function(n){function t(t){var i=n.call(this)||this;return i.canInviteAtLeastOneFriend=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.canBeInvited()})}),i.setItemsFromModels(t),i.sortingEnabled(!0),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new UserPartial(n))});this.setItems(t)},t.prototype.getById=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.id===n})},t.prototype.orderUsersByGlobalRankingPosition=function(n){n===void 0&&(n=null);var t=0;Enumerable.from(this.getItems()).any()&&(t=Enumerable.from(this.getItems()).max(function(n){return n.rank}));this.sortItems(function(n){return n.rank>0?n.rank:t+1},null,n)},t.prototype.orderUsersByName=function(){this.sortItems(function(n){return n.name.toLowerCase()})},t.prototype.orderUsersByCountryCode=function(){this.sortItems(function(n){return n.countryCode})},t.prototype.orderUsersByTotalManagerPoints=function(){this.sortItems(function(n){return n.points})},t.prototype.orderUsersByLastLogin=function(){this.sortItems(function(n){return n.lastLoginTimestamp})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamRoundPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.cupRound&&i.cupRoundPartial(new CupRoundPartial(i.cupRound)),i.match&&i.matchPartial(new MatchPartial(i.match)),i.isPlayed=ko.computed(function(){return appViewModel.leaguePartial()?appViewModel.leaguePartial().weekNr>i.weekNr:!1}),i.simulationForecastTimestamp=ko.computed(function(){return appViewModel.calculateSimulationForecastTimestamp(i.weekNr)}),i.simulationState=ko.computed(function(){return appViewModel.calculateSimulationState(i.weekNr)}),i.isCurrentRound=ko.computed(function(){return!appViewModel||!appViewModel.leaguePartial()?!1:i.weekNr===appViewModel.leaguePartial().nextPositiveWeekNr}),i.isLastDay=ko.computed(function(){return!appViewModel||!appViewModel.leaguePartial()?!1:i.weekNr>appViewModel.leaguePartial().weeks}),i}return __extends(t,n),t.prototype.navigate=function(){(this.matchPartial()||this.cupRoundPartial())&&(window.location.href=this.matchPartial()?Helper.replaceText(Urls.matches,[{key:"weekNr",value:this.weekNr.toString()},{key:"matchId",value:this.matchPartial().matchId.toString()}]):Urls.fixtures)},t}(TeamRound),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamPartial=function(n){function t(t,i,r){var u=n.call(this)||this,e,f,o;return u._interestMultiplier=.02,u.isSessionTeam=ko.observable(!1),u.imageLarge="",u.boardMood=ko.observable(BoardMood.Satisfied),u.hasOngoingSpyInstruction=ko.computed(function(){return!u.spyInstructionPartial()||!u.spyInstructionPartial().countdownTimerPartial()?!1:u.spyInstructionPartial().countdownTimerPartial().timerState()!==TimerState.Claimed}),u.onTrainingCamp=ko.computed(function(){return!u.teamTrainingsPartial()||!appViewModel||!appViewModel.leaguePartial()?!1:Enumerable.from(u.teamTrainingsPartial().getItems()).any(function(n){return n.type===TeamTrainingType.Camp&&n.week===appViewModel.leaguePartial().weekNr})}),u.onSecretTraining=ko.computed(function(){return!u.teamTrainingsPartial()||!appViewModel||!appViewModel.leaguePartial()?!1:Enumerable.from(u.teamTrainingsPartial().getItems()).any(function(n){return n.type===TeamTrainingType.Secret&&n.week===appViewModel.leaguePartial().weekNr})}),Helper.copyProperties(t,u),u.manager&&u.managerPartial(new ManagerPartial(u.manager)),u.tactic&&u.tacticPartial(new TeamTacticPartial(u.tactic)),u.finance&&u.financePartial(new TeamFinancePartial(u.finance)),u.leagueStanding&&u.leagueStandingPartial(new LeagueStandingPartial(u.leagueStanding)),u.league&&u.leaguePartial(new LeaguePartial(u.league)),u.spyInstruction&&u.spyInstructionPartial(new SpyInstructionPartial(u.spyInstruction)),e=LeanplumHelper.getInstance().getVariables("Settings","AssetsTeamsEnabled",!0),u.assets&&e&&(f=Enumerable.from(u.assets).firstOrDefault(function(n){return n.type===AssetType.NormalCrest}),f!=null?u.imageLarge=f.path:(o=(u.id-1)%24+1,u.imageLarge=Helper.replaceText(teamLogoFallbackNormalUrl,[{key:"teamId",value:o.toString()}]))),u.players&&u.playersPartial(new PlayersPartial(u.players,i,r)),u.stadium&&u.stadiumPartial(new StadiumPartial(u.stadium,null,null)),u.leagueType&&u.leagueTypePartial(new LeagueTypePartial(u.leagueType)),u.teamTrainings&&u.teamTrainingsPartial(new TeamTrainingsPartial(u.teamTrainings)),u.teamStatistic&&u.teamStatisticPartial(new TeamStatisticPartial(u.teamStatistic)),u.isSessionTeam(u.id===SessionManager.getTeamId()),u.boardMood(u.getBoardMood(u.ranking,u.goal)),u}return __extends(t,n),t.prototype.getBoardMood=function(n,t){return appViewModel.leaguePartial()?appViewModel.leaguePartial().isInPreparation?BoardMood.Satisfied:n===0?BoardMood.Hopeful:n<t||n===1?BoardMood.Happy:n===t?BoardMood.Satisfied:BoardMood.Angry:BoardMood.Satisfied},t.prototype.navigateTo=function(){window.location.href=Urls.squad+"/"+this.leagueId+"/"+this.id},t.prototype.navigateToBaseTeam=function(){window.location.href=Urls.leagueTypesTeam+"/"+this.leagueTypeId+"/"+this.id},t.prototype.navigateToChooseTeam=function(){window.location.href=Urls.chooseTeamForLeagueType+"/"+this.leagueTypeId},t.prototype.getPositionDifference=function(){return this.goal-this.ranking},t.prototype.getPositionDifferenceString=function(){var n=this.getPositionDifference();return n>0?"+ "+n:n<0?"- "+-n:"0"},t}(Team),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AssetPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Asset),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AssetsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new AssetPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CountdownTimersPartial=function(n){function t(t,i){var r=n.call(this,5)||this;return r.countdownTimerNextRoundPartial=ko.observable(),r.activeTimers=ko.observable(),r.isRefreshingWallet=ko.observable(!1),r.countdownTimerNextRoundPartial(new CountdownTimerNextMatchPartial(t)),r.setItemsFromModels(i),r.onTimerUpdate=ko.computed(function(){r.activeTimers(Enumerable.from(r.getItems()).where(function(n){return n.isActive()||n.isClaimable()}).toArray());var n=Enumerable.from(r.getItems()).except(r.activeTimers()).toArray();n.forEach(function(n){r.removeItem(n);n.type!==CountdownTimerType.BcBonusCounting||r.isRefreshingWallet()||(r.isRefreshingWallet(!0),appViewModel.refreshBossCoinsWallet().then(function(n){var t,i;if(n.unclaimedCoins>0){for(t=new BossCoinToast(n);Enumerable.from(appViewModel.toastsPartial().getItems()).any(function(n){return n instanceof BossCoinToast});)i=Enumerable.from(appViewModel.toastsPartial().getItems()).first(function(n){return n instanceof BossCoinToast}),appViewModel.toastsPartial().removeItem(i);appViewModel.toastsPartial().addItem(t);t.open()}r.addItem(new CountdownTimerPartial(n.countdownTimer))}).fail(function(){}).done(function(){r.isRefreshingWallet(!1)}))})}),r.hasClaimableTimers=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isClaimable()})}),r}return __extends(t,n),t.prototype.refreshTimers=function(n){this.setItemsFromModels(n)},t.prototype.setItemsFromModels=function(n){var t=[];Enumerable.from(n).where(function(n){return n.type!==CountdownTimerType.NextMatch}).orderBy(function(n){return n.finishedTimestamp}).forEach(function(n){n.isClaimed||t.push(new CountdownTimerPartial(n))});this.setItems(t)},t}(PagingViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueTypePartial=function(n){function t(t){var i=n.call(this)||this,f,r,u;return i.imageLarge="",i.imageSmall="",Helper.copyProperties(t,i),f=LeanplumHelper.getInstance().getVariables("Settings","AssetsLeagueTypesEnabled",!0),i.assets&&f&&(r=Enumerable.from(i.assets).firstOrDefault(function(n){return n.type===AssetType.NormalLeague}),r!=null&&(i.imageLarge=r.path),u=Enumerable.from(i.assets).firstOrDefault(function(n){return n.type===AssetType.SmallLeague}),u!=null&&(i.imageSmall=u.path),i.assetsPartial(new AssetsPartial(i.assets))),i.historyItems&&i.historyItemsPartial(new HistoryItemsPartial(i.historyItems)),i.winnersLeagueQualification&&i.winnersLeagueQualificationPartial(new WinnersLeagueQualificationPartial(i.winnersLeagueQualification)),i}return __extends(t,n),t.prototype.navigateToActiveLeague=function(n){window.location.href=Urls.activeLeaguesLeague+"/"+n+"/"+this.id},t.prototype.navigateToBaseLeague=function(){window.location.href=Urls.leagueTypesLeague+"/"+this.id},t.prototype.navigateToChooseTeam=function(){window.location.href=Urls.chooseTeamForLeagueType+"/"+this.id},t.prototype.isLeagueTypeCompleted=function(){return this.historyItemsPartial()?this.historyItemsPartial().hasBeenChampion()||this.historyItemsPartial().hasWonCup()||this.historyItemsPartial().hasReachedGoal():!1},t.prototype.isTournamentLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Tournament},t.prototype.isKnockoutLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Knockout},t.prototype.isPoulesLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Poules},t.prototype.leagueTypeHasPoulesSchedule=function(){return this.isPoulesLeagueType()||this.isTournamentLeagueType()},t.prototype.getAmountOfPouleMatches=function(){switch(this.leagueScheduleType){case LeagueScheduleType.Tournament:return this.weeks-this.totalCupWeeks;case LeagueScheduleType.Poules:return this.weeks;default:return 0}},t}(LeagueType),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),HistoryItemPartial=function(n){function t(t){var i=n.call(this)||this;return i.wonLeague=ko.observable(),i.wonCup=ko.observable(),i.reachedGoal=ko.observable(),Helper.copyProperties(t,i),i.wonLeague(i.ranking===1),i.wonCup(i.cupWon),i.reachedGoal(i.ranking<=i.goal),i}return __extends(t,n),t}(HistoryItem),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeaguePartial=function(n){function t(t){var i=n.call(this)||this;return i.displayName="",i.preparationDaysLeft=0,i.nextPositiveWeekNr=1,i.isLastDay=!1,i.isInPreparation=!0,i.hasCup=!1,i.vacancies=0,i.isSessionLeague=ko.observable(!1),i.friendPartials=ko.observableArray(),i.invitePartials=ko.observableArray(),i.isClosed=ko.computed(function(){if(!i.settingsPartial())return!0;var n=i.settingsPartial().getSetting(LeagueSettingType.Closed);return n&&n.value===1}),i.boostTimersAllowed=ko.computed(function(){return i.settingsPartial()?i.settingsPartial().boostTimersAllowed:!0}),i.agentContactPerson=ko.computed(function(){return i.hasFriendModerator()?Enumerable.from(i.friendPartials()).first(function(n){return i.isModerator(n.login)}):i.friendPartials().length>0?Enumerable.from(i.friendPartials()).orderByDescending(function(n){return n.lastLoginTimestamp}).first():i.hasInviterModerator()?Enumerable.from(i.invitePartials()).first(function(n){return i.isModerator(n.inviterLogin)}).inviterPartial():i.invitePartials().length>0?Enumerable.from(i.invitePartials()).orderByDescending(function(n){return n.timeStamp}).first().inviterPartial():null}),Helper.copyProperties(t,i),i.isLastDay=i.weekNr===i.weeks,i.isInPreparation=i.weekNr<=0,i.hasCup=i.totalCupRounds>0,i.name.length>0?i.displayName=i.name:i.leagueType&&(i.displayName=i.leagueType.name),i.weekNr<=0&&(i.preparationDaysLeft=i.weekNr*-1+1),i.weekNr+1>1&&(i.nextPositiveWeekNr=i.weekNr+1),i.isSessionLeague(i.id===SessionManager.getLeagueId()),i.leagueType&&i.leagueTypePartial(new LeagueTypePartial(i.leagueType)),i.vacancies=i.teamCount-i.managers,i.settings&&i.settingsPartial(new LeagueSettingsPartial(i.settings)),i}return __extends(t,n),t.prototype.navigateTo=function(){window.location.href=Urls.leagueTable+"/"+this.id},t.prototype.navigateToChooseTeam=function(){window.location.href=Helper.replaceText(Urls.chooseTeamForLeague,[{key:"leagueId",value:this.id.toString()}])},t.prototype.isModerator=function(n){var t=n.toUpperCase(),i=this.moderator.toUpperCase();return t===i||t+"S1"===i||t+"S2"===i||t+"S3"===i},t.prototype.getServerNr=function(){return Helper.getWorldNr()===0?this.id<5e5?0:Math.floor(this.id/1e6)+1:Math.floor(this.id/1e6)},t.prototype.isTournamentLeague=function(){return this.leagueScheduleType===LeagueScheduleType.Tournament},t.prototype.isVipLeague=function(){return this.mode===LeagueMode.VipLeague},t.prototype.isKnockoutLeague=function(){return this.leagueScheduleType===LeagueScheduleType.Knockout},t.prototype.isPoulesLeague=function(){return this.leagueScheduleType===LeagueScheduleType.Poules},t.prototype.leagueIsKnockoutPhase=function(){return this.leaguePhase===LeaguePhase.KnockoutPhase||this.isKnockoutLeague()},t.prototype.leagueIsPoulesPhase=function(){return this.leaguePhase===LeaguePhase.PoulesPhase},t.prototype.leagueHasKnockoutPhase=function(){return this.isKnockoutLeague()||this.isTournamentLeague()},t.prototype.leagueHasPoulesSchedule=function(){return this.isPoulesLeague()||this.isTournamentLeague()},t.prototype.isJoinable=function(n){var i=this,t;return this.mode===LeagueMode.Battle||this.mode===LeagueMode.WinnersLeague||this.isVipLeague()?!1:(t=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.ChooseTeam,"CannotJoinLeagueAfterWeekPercentage").value,this.weekNr>=t/100*this.weeks)?!1:this.vacancies===0?!1:!Enumerable.from(n.teamSlots).any(function(n){return n.league&&n.league.id===i.id})},t.prototype.canJoinLeagueAfterDays=function(){var n=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.ChooseTeam,"CannotJoinLeagueAfterWeekPercentage").value;return!(this.weekNr>=n/100*this.weeks)},t.prototype.hasFriendModerator=function(){var n=this;return Enumerable.from(this.friendPartials()).any(function(t){return n.isModerator(t.login)})},t.prototype.hasInviterModerator=function(){var n=this;return Enumerable.from(this.invitePartials()).any(function(t){return n.isModerator(t.inviterLogin)})},t.prototype.getMostRecentFriendTimestamp=function(){return this.friendPartials().length===0?0:Enumerable.from(this.friendPartials()).max(function(n){return n.lastLoginTimestamp})},t.prototype.getMostRecentInviteTimestamp=function(){return this.invitePartials().length===0?0:Enumerable.from(this.invitePartials()).max(function(n){return n.timeStamp})},t.prototype.getBaseLeagueTheme=function(){return this.leagueTypePartial()?this.leagueTypePartial().baseLeagueThemeType:BaseLeagueThemeType.Default},t}(League),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueSettingPartial=function(n){function t(t){var i=n.call(this)||this;return i.checkboxDisabledObservable=ko.observable(!1),Helper.copyProperties(t,i),i.valueObservable=ko.observable(i.value),i.valueObservable.subscribe(function(n){i.value=Number(n)}),i}return __extends(t,n),t.prototype.isClosed=function(){return this.type===LeagueSettingType.Closed&&this.value===1},t.prototype.boolValue=function(){return this.value>0},t}(LeagueSetting),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueSettingsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i.areTransfersEnabled=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.Transfers&&n.boolValue()}),i.isBossCoinCompletionAllowed=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.BossCoinTransfers&&n.boolValue()}),i.areTrainingCampsAllowed=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.IsTrainingCampAllowed&&n.boolValue()}),i.areSecretTrainingsAllowed=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.IsSecretTrainingAllowed&&n.boolValue()}),i.discontinue=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.Discontinue&&n.boolValue()}),i.boostTimersAllowed=Enumerable.from(i.getItems()).any(function(n){return n.type===LeagueSettingType.BoostTimers&&n.boolValue()}),i}return __extends(t,n),t.prototype.getSetting=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.type===n})},t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new LeagueSettingPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TimerState;(function(n){n[n.None=0]="None";n[n.InProgress=1]="InProgress";n[n.Finished=2]="Finished";n[n.Claimed=3]="Claimed";n[n.ResultShown=4]="ResultShown"})(TimerState||(TimerState={}));var CountdownTimerPartial=function(n){function t(t){var i=n.call(this)||this;return i.isNextMatchInfoBalloonVisible=ko.observable(!1),i.claimed=ko.observable(),i.animatingCountdown=ko.observable(!1),i.fastAnimationCountdownStepTimeout=80,i._animationLength=2e3,i.secondsRemaining=ko.observable(0),i._timerTypesToRemoveWhenExpired=[CountdownTimerType.TemporaryOfferCounting,CountdownTimerType.ScoutDeadlineCounting,CountdownTimerType.BcBonusCounting],Helper.copyProperties(t,i),i.claimed(i.isClaimed),i.timerUrl=i.getTimerUrl(),i.calculateSecondsRemaining=ko.computed(function(){if(!appViewModel){i.secondsRemaining(0);return}if(!i.animatingCountdown()){var n=Math.ceil(i.finishedTimestamp-appViewModel.now().getTime()/1e3);i.secondsRemaining(n>0?n:0)}}),i.hoursRemaining=ko.computed(function(){return Math.ceil(i.secondsRemaining()/3600)}),i.minutesRemaining=ko.computed(function(){return i.secondsRemaining()/60}),i.timerState=ko.computed(function(){return i.claimed()?TimerState.Claimed:i.secondsRemaining()<=0?TimerState.Finished:TimerState.InProgress}),i.isClaimable=ko.computed(function(){return!Enumerable.from(i._timerTypesToRemoveWhenExpired).contains(i.type)&&i.timerState()===TimerState.Finished}),i.isActive=ko.computed(function(){return!Enumerable.from(i._timerTypesToRemoveWhenExpired).contains(i.type)||i.timerState()===TimerState.InProgress}),i}return __extends(t,n),t.prototype.getTimerUrl=function(){switch(this.type){case CountdownTimerType.ForwardTraining:case CountdownTimerType.MidfielderTraining:case CountdownTimerType.DefenderTraining:case CountdownTimerType.GoalKeeperTraining:return Urls.training;case CountdownTimerType.StadiumCapacityExpanding:case CountdownTimerType.StadiumPitchExpanding:case CountdownTimerType.StadiumTrainingExpanding:return Urls.stadium;case CountdownTimerType.SpySpying:return Urls.spy;case CountdownTimerType.ScoutDeadlineCounting:case CountdownTimerType.Scout:return Urls.scout;case CountdownTimerType.DoctorTreating:return Urls.doctor;case CountdownTimerType.LawyerAppealing:return Urls.lawyer;case CountdownTimerType.TemporaryOfferCounting:return Urls.transferlist;case CountdownTimerType.BcBonusCounting:return"";default:return""}},t.prototype.getBosscoinProductForCurrentIncrement=function(n){var t=this,i=appViewModel.bossCoinProductsPartial().getBossCoinProducts(n);return Enumerable.from(i).orderByDescending(function(n){return n.increment}).firstOrDefault(function(n){return n.increment<=t.hoursRemaining()})},t.prototype.updateFinishedTimestamp=function(n,t){return t?this.animateFinishedTimestampToNewTimestamp(n):(this.finishedTimestamp=n,Q.resolve(null))},t.prototype.reduceFinishedTimestamp=function(n,t){t===void 0&&(t=!1);var i=this.finishedTimestamp-n;return this.updateFinishedTimestamp(i,t)},t.prototype.increaseFinishedTimestamp=function(n,t){t===void 0&&(t=!1);var i=this.finishedTimestamp+n;return this.updateFinishedTimestamp(i,t)},t.prototype.animateFinishedTimestampToNewTimestamp=function(n){var t=this,r=Q.defer();this.animatingCountdown(!0);var u=this.finishedTimestamp-n,f=this._animationLength/this.fastAnimationCountdownStepTimeout,i=u/f,e=setInterval(function(){var u=Math.ceil(t.finishedTimestamp-appViewModel.now().getTime()/1e3);if(t.finishedTimestamp<=n||u<=0){clearInterval(e);t.animatingCountdown(!1);r.resolve();return}n<t.finishedTimestamp?(u=u-i,t.finishedTimestamp=t.finishedTimestamp-i):(u=u+i,t.finishedTimestamp=t.finishedTimestamp+i);t.secondsRemaining(u)},this.fastAnimationCountdownStepTimeout);return r.promise},t}(CountdownTimer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AchievementProgressPartial=function(n){function t(t,i){var r=n.call(this)||this;return r.isClaiming=ko.observable(!1),r.isClaimed=ko.observable(!1),r.progressPercentage=0,r._achievementsService=i,r.update(t),r}return __extends(t,n),t.prototype.update=function(n){Helper.copyProperties(n,this);this.isClaimed(this.claimed);this.progressPercentage=Math.min(100,this.amount/this.threshold*100)},t.prototype.claim=function(){var n=this;this.isClaiming(!0);WebApi.getInstance().execute(this._achievementsService.claim(this.userAchievementId)).then(function(t){LeanplumHelper.getInstance().trackEventWithValue(LeanplumTrackingService.Event.BCClaim,n.reward,{BCClaimSource:"Achievement",AchievementId:n.achievementId});CacheHandler.getInstance().removeKey(CacheKey[CacheKey.Achievements]);CacheHandler.getInstance().removeKey(CacheKey[CacheKey.AchievementCount]);n.update(t);appViewModel.achievementProgressesPartial().refreshAchievementProgress(t);appViewModel.refreshBossCoinsWallet().done()}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){n.isClaiming(!1)}).done()},t}(AchievementProgress),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AchievementProgressesPartial=function(n){function t(t,i){var r=n.call(this)||this;return r.completedAchievements=ko.computed(function(){return Enumerable.from(r.getItems()).where(function(n){return n.completed}).toArray()}),r.hasUnclaimedAchievements=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.completed&&!n.isClaimed()})}),r.lastAchievement=ko.computed(function(){return Enumerable.from(r.completedAchievements()).orderBy(function(n){return n.awardedAtTimestamp}).lastOrDefault()}),r.setItemsFromModels(t,i),r}return __extends(t,n),t.prototype.setItemsFromModels=function(n,t){var i=[];n.forEach(function(n){i.push(new AchievementProgressPartial(n,t))});this.setItems(i)},t.prototype.refreshAchievementProgress=function(n){Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.achievementId===n.achievementId}).update(n)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SponsorPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Sponsor),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ConversationPartial=function(n){function t(t){var i=n.call(this)||this;return i.unreadMessagesCount=ko.observable(0),Helper.copyProperties(t,i),i.unreadMessagesCount(i.unreadMessages),i.messages&&i.messagesPartial(new MessagesPartial(i.messages)),i.participants&&i.usersPartial(new UsersPartial(i.participants)),i}return __extends(t,n),t.prototype.theOtherUserPartial=function(){return Enumerable.from(this.usersPartial().getItems()).firstOrDefault(function(n){return n.id!==SessionManager.getInstance().session.userId})},t}(Conversation),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ConversationsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new ConversationPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SmileyPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Smiley),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SmileysPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new SmileyPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MessagePartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t.prototype.received=function(){return this.senderId!==SessionManager.getInstance().session.userId},t}(Message),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MessagesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new MessagePartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SponsorsPartial=function(n){function t(t){var i=n.call(this)||this;return t?(i.setItemsFromModels(t),i):i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new SponsorPartial(n))});this.setItems(t)},t.prototype.getTotalRevenue=function(){return Enumerable.from(this.getItems()).sum(function(n){return n.sponsorRevenueForTeam})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),HistoryItemsPartial=function(n){function t(t){t===void 0&&(t=null);var i=n.call(this)||this;return i.hasBeenChampion=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.wonLeague()})}),i.hasReachedGoal=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.reachedGoal()})}),i.hasWonCup=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.wonCup()})}),i.unclaimedRewards=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.claimed===!1&&n.reward>0}).toArray()}),i.sortedByTimestamp=ko.computed(function(){return Enumerable.from(i.getItems()).orderByDescending(function(n){return n.timestamp}).toArray()}),i.sortingEnabled(!0),t&&i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.wonCupsForLeagueType=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.leagueTypeId===n}).count(function(n){return n.wonCup()})},t.prototype.reachedGoalsForLeagueType=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.leagueTypeId===n}).count(function(n){return n.reachedGoal()})},t.prototype.wonLeaguesForLeagueType=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.leagueTypeId===n}).count(function(n){return n.wonLeague()})},t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new HistoryItemPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),InvitePartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.league&&i.leaguePartial(new LeaguePartial(i.league)),i.inviter&&i.inviterPartial(new WebApiV1Dot1.UserPartial(i.inviter)),i}return __extends(t,n),t.prototype.equalsParameters=function(n,t){return this.leagueId===n&&this.inviterLogin===t},t.prototype.canJoinLeague=function(n){return this.leaguePartial()&&this.leaguePartial().isJoinable(n)},t}(Invite),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),InvitesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new InvitePartial(n))});this.setItems(t)},t.prototype.filterWithJoinableLeagues=function(n){return this.getItems().filter(function(t){return t.canJoinLeague(n)})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),InviteRewardPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.invitee&&i.inviteePartial(new UserPartial(i.invitee)),i.inviter&&i.inviterPartial(new UserPartial(i.inviter)),i}return __extends(t,n),t}(InviteReward),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),InviteRewardsPartial=function(n){function t(t){var i=n.call(this)||this;return i.unclaimedRewards=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.status===RewardStatus.Unclaimed}).toArray()}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new InviteRewardPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),EntryRequestPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.user&&i.userPartial(new UserPartial(i.user)),i}return __extends(t,n),t}(EntryRequest),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),EntryRequestsPartial=function(n){function t(t){var i=n.call(this)||this;return i.sortingEnabled(!0),i.sortOrder=SortOrder.Ascending,i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new EntryRequestPartial(n))});this.setItems(t)},t.prototype.hasToRequestAccess=function(){return Enumerable.from(this.getItems()).any(function(n){return n&&n.status!==EntryRequestStatus.Rejected})},t.prototype.orderByUserPoints=function(){this.sortItems(function(n){return n.userPartial().points})},t.prototype.orderByUserName=function(){this.sortItems(function(n){return n.userPartial().name})},t.prototype.orderByUserCountry=function(){this.sortItems(function(n){return n.userPartial().countryCode})},t.prototype.orderByRequestDate=function(){this.sortItems(function(n){return n.timeStamp})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CrewPartial=function(n){function t(t){var i=n.call(this)||this,r,u;return i.maxUsersInCrewGameVariable=ko.observable(0),i.joinCrewIsLoading=ko.observable(!1),i.joinCrewIsSuccessful=ko.observable(!1),i.acceptInviteIsLoading=ko.observable(!1),i.acceptInviteIsSuccessful=ko.observable(!1),Helper.copyProperties(t,i),appViewModel.gameSettingsPartial()&&(r=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.Crews,"MaxUsersInCrew")),u=24,r&&(u=r.value),i.maxUsersInCrewGameVariable(u),i.crewMembers&&i.crewMembersPartial(new CrewMembersPartial(i.crewMembers)),i.crewRanking&&i.crewRankingPartial(new CrewRankingPartial(i.crewRanking)),i.crewRequests&&i.crewRequestsPartial(new CrewRequestsPartial(i.crewRequests)),i.crewInvites&&i.crewInvitesPartial(new CrewInvitesPartial(i.crewInvites)),i.crewBattles&&i.crewBattlesPartial(new CrewBattlesPartial(i.crewBattles,t.id)),i.crewBattleRequests&&i.crewBattleRequestsPartial(new CrewBattleRequestsPartial(i.crewBattleRequests)),i.crewBattleHistories&&i.crewBattleHistoriesPartial(new CrewBattleHistoriesPartial(i.crewBattleHistories,t.id)),i}return __extends(t,n),t.prototype.getCrewCountryCode=function(){return!this.crewMembersPartial()||!this.crewMembersPartial().count()||!this.crewMembersPartial().getCrewOwner()?null:this.crewMembersPartial().getCrewOwner().countryCode},t.prototype.getCrewManagerName=function(){return!this.crewMembersPartial().count()||!this.crewMembersPartial().getCrewOwner()?null:this.crewMembersPartial().getCrewOwner().userName},t.prototype.isCrewOfSessionUser=function(){return this.crewMembersPartial()?Enumerable.from(this.crewMembersPartial().getItems()).any(function(n){return n.userId===SessionManager.getInstance().session.userId}):!1},t.prototype.isUserMemberOfCrew=function(n){return this.crewMembersPartial()?Enumerable.from(this.crewMembersPartial().getItems()).any(function(t){return t.userId===n}):!1},t.prototype.isCrewFull=function(){if(!this.crewMembersPartial())return!1;var n=24;return this.maxUsersInCrewGameVariable()&&(n=this.maxUsersInCrewGameVariable()),this.crewMembersPartial().count()===n},t.prototype.navigateToCrew=function(){location.href=Helper.replaceText(Urls.crewProfile,[new KeyValuePair("crewId",this.id.toString())])},t}(Crew),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CrewInvitePartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(CrewInvite),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CrewInvitesPartial=function(n){function t(t){var i=n.call(this)||this;return t?(i.setItemsFromModels(t),i):i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new CrewInvitePartial(n))});this.setItems(t)},t.prototype.hasPendingInvites=function(){return Enumerable.from(this.getItems()).any(function(n){return n.status===CrewInviteStatus.Pending})},t.prototype.getPendingInviteForCrewId=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.crewId===n&&t.status===CrewInviteStatus.Pending})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CrewRequestPartial=function(n){function t(i){var r=n.call(this)||this;return r.visibleEditRequestInfoView=ko.observable(t.EditRequestInfoView.None),r.isAcceptRequestLoading=ko.observable(!1),r.isDeclineRequestLoading=ko.observable(!1),Helper.copyProperties(i,r),r.user&&r.userPartial(new UserPartial(r.user)),r.member&&r.crewMemberPartial(new CrewMemberPartial(r.member)),r}return __extends(t,n),t.prototype.toggleVisibleEditRequestInfoView=function(n){if(n===this.visibleEditRequestInfoView())return this.visibleEditRequestInfoView(t.EditRequestInfoView.None),!1;this.visibleEditRequestInfoView(n)},t}(CrewRequest);(function(n){var t;(function(n){n[n.None=0]="None";n[n.DeclineRequest=1]="DeclineRequest";n[n.AcceptRequest=2]="AcceptRequest"})(t=n.EditRequestInfoView||(n.EditRequestInfoView={}))})(CrewRequestPartial||(CrewRequestPartial={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),CrewRequestsPartial=function(n){function t(t){var i=n.call(this)||this;return t?(i.sortingEnabled(!0),i.setItemsFromModels(t),i):i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new CrewRequestPartial(n))});this.setItems(t)},t.prototype.getPendingCrewRequests=function(){return Enumerable.from(this.getItems()).where(function(n){return n.status===CrewRequestStatus.Pending}).toArray()},t.prototype.getPendingCount=function(){return Enumerable.from(this.getItems()).count(function(n){return n.status===CrewRequestStatus.Pending})},t.prototype.hasPendingRequestForCrewId=function(n){return Enumerable.from(this.getItems()).any(function(t){return t.crewId===n&&t.status===CrewRequestStatus.Pending})},t.prototype.hasAcceptedCrewRequests=function(){return Enumerable.from(this.getItems()).any(function(n){return n.status===CrewRequestStatus.Accepted})},t.prototype.orderByLogin=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().login})},t.prototype.orderByRank=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().rank})},t.prototype.orderByManagerPoints=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().points})},t.prototype.orderByNationality=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().countryCode})},t.prototype.orderByLastLogin=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().lastLoginTimestamp})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),WebApiV1Dot1;(function(n){var t=function(t){function i(i){var r=t.call(this)||this;return r.visibleEditRequestInfoView=ko.observable(CrewRequestPartialV1Dot1.EditRequestInfoView.None),r.isAcceptRequestLoading=ko.observable(!1),r.isDeclineRequestLoading=ko.observable(!1),Helper.copyProperties(i,r),r.user&&r.userPartial(new n.UserPartial(r.user)),r.member&&r.crewMemberPartial(new CrewMemberPartial(r.member)),r}return __extends(i,t),i.prototype.toggleVisibleEditRequestInfoView=function(n){if(n===this.visibleEditRequestInfoView())return this.visibleEditRequestInfoView(CrewRequestPartialV1Dot1.EditRequestInfoView.None),!1;this.visibleEditRequestInfoView(n)},i}(n.CrewRequest);n.CrewRequestPartial=t})(WebApiV1Dot1||(WebApiV1Dot1={})),function(n){var t;(function(n){n[n.None=0]="None";n[n.DeclineRequest=1]="DeclineRequest";n[n.AcceptRequest=2]="AcceptRequest"})(t=n.EditRequestInfoView||(n.EditRequestInfoView={}))}(CrewRequestPartialV1Dot1||(CrewRequestPartialV1Dot1={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){var i=t.call(this)||this;return i.setItemsFromModels(n),i.sortingEnabled(!0),i}return __extends(i,t),i.prototype.setItemsFromModels=function(t){var i=[];t.forEach(function(t){i.push(new n.CrewRequestPartial(t))});this.setItems(i)},i.prototype.getPendingCrewRequests=function(){return Enumerable.from(this.getItems()).where(function(n){return n.status===CrewRequestStatus.Pending}).toArray()},i.prototype.getPendingCount=function(){return Enumerable.from(this.getItems()).count(function(n){return n.status===CrewRequestStatus.Pending})},i.prototype.hasPendingRequestForCrewId=function(n){return Enumerable.from(this.getItems()).any(function(t){return t.crewId===n&&t.status===CrewRequestStatus.Pending})},i.prototype.hasAcceptedCrewRequests=function(){return Enumerable.from(this.getItems()).any(function(n){return n.status===CrewRequestStatus.Accepted})},i.prototype.orderByLogin=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().login})},i.prototype.orderByNationality=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().countryCode})},i.prototype.orderByLastLogin=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().lastLoginTimestamp})},i.prototype.orderByRank=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().statsPartial()&&n.userPartial().statsPartial().rank})},i.prototype.orderByBattleForm=function(){this.sortItems(function(n){return n.userPartial()&&n.userPartial().statsPartial()&&n.userPartial().statsPartial().battleForm})},i}(PartialArrayViewModel);n.CrewRequestsPartial=t}(WebApiV1Dot1||(WebApiV1Dot1={}));var SurfacingPartial=function(){function n(n,t,i,r,u){var f=this;this.surfacingStatesPartial=ko.observable();this._shouldSurface=ko.observable(!1);this._surfacingStatesLoaded=ko.observable(!1);this._notificationsPartial=ko.observable();this._notificationsPartialProcessed=ko.observable(!1);this._surfacingTexts=ko.observable();this._userPartial=ko.observable();this._userPartialProcessed=ko.observable(!1);this._invitesPartial=ko.observable();this._invitesPartialProcessed=ko.observable(!1);this._determinedIfCareerSurfacingIsComplete=ko.observable(!1);this._leaguePartial=ko.observable();this._leaguePartialProcessed=ko.observable(!1);this._careerCentreSurfaceCookieHelper=new CareerCentreSurfaceCookieHelper;this._matchesPartial=ko.observable();this._matchesPartialProcessed=ko.observable();this._teamsPartial=ko.observable();this._surfacingTypesByPriority=[SurfacingType.Career,SurfacingType.SquadSellPlayer,SurfacingType.Apps,SurfacingType.Doctor,SurfacingType.Lawyer,SurfacingType.TrainingCampCupFinal,SurfacingType.TrainingCampCupSemis,SurfacingType.TrainingCampFirst,SurfacingType.TrainingCampInFirstThirdOfSeason,SurfacingType.TrainingCampInSecondThirdOfSeason,SurfacingType.Scout,SurfacingType.Spy,SurfacingType.BusinessClub,SurfacingType.Forums,SurfacingType.ChooseTeamOnLastDay];this._surfacingContainers=[];this._secondsInOneDay=86400;this._timeStampNow=parseInt(Date.now().toString().substring(0,10));this._onNotificationsPartialLoaded=ko.computed(function(){var n,t,i,r,u;if(f._shouldSurface()&&f._surfacingStatesLoaded()&&f._notificationsPartial()&&f._userPartial()&&f._surfacingTexts()&&!f._notificationsPartialProcessed()){if(f._notificationsPartial().getItems().length===0){f._notificationsPartialProcessed(!0);return}n=[];f._userPartial().isLegacyUser()||(t=Enumerable.from(f._notificationsPartial().getItems()).where(function(n){return n.todoNotificationType==TodoNotificationType.WebNotification}),i=Enumerable.from(f.surfacingStatesPartial().getItems()),t.any(function(n){return n.group===NotificationGroupType.Lawyer})&&(r=i.firstOrDefault(function(n){return n.type===SurfacingType.Lawyer}),n.push(f.addSurfacingType(r,SurfacingType.Lawyer,DudeType.Lawyer))),t.any(function(n){return n.group===NotificationGroupType.Doctor})&&(u=i.firstOrDefault(function(n){return n.type===SurfacingType.Doctor}),n.push(f.addSurfacingType(u,SurfacingType.Doctor,DudeType.Doctor))));Q.all(n).spread(function(){f._notificationsPartialProcessed(!0)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()}});this._onUserPartialLoaded=ko.computed(function(){var n,t,i,r,u,e,o,s,h,c,l;f._shouldSurface()&&f._surfacingStatesLoaded()&&f._userPartial()&&f._surfacingTexts()&&appViewModel&&appViewModel.gameSettingsPartial()&&appViewModel.bossCoinWalletPartial()&&!f._userPartialProcessed()&&(n=[],t=Enumerable.from(f.surfacingStatesPartial().getItems()),f._userPartial().isLegacyUser()||(i=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"ScoutDays"),f.isDaysAfterSignUpDate(i)&&appViewModel.menuPartial().isMenuItemTypeVisible(MenuItemType.Scout)&&(r=t.firstOrDefault(function(n){return n.type===SurfacingType.Scout}),n.push(f.addSurfacingType(r,SurfacingType.Scout,DudeType.Scout))),u=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"ForumsDays"),f.isDaysAfterSignUpDate(u)&&(e=t.firstOrDefault(function(n){return n.type===SurfacingType.Forums}),n.push(f.addSurfacingType(e,SurfacingType.Forums,DudeType.Assistant))),o=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"AppsDays"),f.isDaysAfterSignUpDate(o)&&(s=t.firstOrDefault(function(n){return n.type===SurfacingType.Apps}),n.push(f.addSurfacingType(s,SurfacingType.Apps,DudeType.Assistant,new AppSurfacingModal)))),h=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"BusinessClubDays"),c=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"BusinessClubCoins"),f.isDaysAfterSignUpDate(h)&&appViewModel.bossCoinWalletPartial().amount<c&&(l=t.firstOrDefault(function(n){return n.type===SurfacingType.BusinessClub}),n.push(f.addSurfacingType(l,SurfacingType.BusinessClub,DudeType.Assistant))),Q.all(n).spread(function(){f._userPartialProcessed(!0)}).done())});this._determineIfCareerSurfacingIsComplete=ko.computed(function(){if(f._surfacingStatesLoaded()&&f._userPartial()&&appViewModel.userPartialV1Dot1()&&!f._determinedIfCareerSurfacingIsComplete()){var n=f._userPartial().isLegacyUser()||f.isSurfacingTypeAlreadyCompleted(SurfacingType.Career)||appViewModel.hasInvites()||f._userPartial().canHaveMultipleSlots();f.showCareerCentreInMenu(n);n&&f._invitesPartialProcessed(!0);f._determinedIfCareerSurfacingIsComplete(!0)}});this._onInviteAndUserPartialLoaded=ko.computed(function(){var n,t;f._shouldSurface()&&f._surfacingStatesLoaded()&&f._surfacingTexts()&&f._invitesPartial()&&!f._invitesPartialProcessed()&&f._determinedIfCareerSurfacingIsComplete()&&(n=Enumerable.from(f.surfacingStatesPartial().getItems()),f._userPartial().canHaveMultipleSlots()&&appViewModel.userPartialV1Dot1()&&!appViewModel.userPartialV1Dot1().teamSlotsPartial().areAllUnlockedSlotsOccupied||f._invitesPartial()&&f._invitesPartial().getItems().length>0?(t=n.firstOrDefault(function(n){return n.type===SurfacingType.Career}),f.addSurfacingType(t,SurfacingType.Career,DudeType.Agent).then(function(){f._invitesPartialProcessed(!0)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()):f._invitesPartialProcessed(!0))});this._onUserAndLeaguePartialLoaded=ko.computed(function(){var n,i,r,u,e,t;f._shouldSurface()&&f._userPartialProcessed()&&f._leaguePartial()&&(f._userPartial().isLegacyUser()?f._leaguePartialProcessed(!0):(n=Enumerable.from(f.surfacingStatesPartial().getItems()),i=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"SellPlayerDays"),f.isDaysAfterSignUpDate(i)&&f._leaguePartial().settingsPartial()&&f._leaguePartial().settingsPartial().areTransfersEnabled&&(r=n.firstOrDefault(function(n){return n.type===SurfacingType.SquadSellPlayer}),f.addSurfacingType(r,SurfacingType.SquadSellPlayer,DudeType.Assistant)),u=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"SpyDays"),f._leaguePartial().weekNr>=0&&f.isDaysAfterSignUpDate(u)?(e=n.firstOrDefault(function(n){return n.type===SurfacingType.Spy}),f.addSurfacingType(e,SurfacingType.Spy,DudeType.Analyst).then(function(){f._leaguePartialProcessed(!0)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()):f._leaguePartialProcessed(!0)),!$.cookie("surfacing_agent")&&f._leaguePartial().isLastDay&&f._leaguePartial().mode!==LeagueMode.Battle&&appViewModel.userPartialV1Dot1()&&Enumerable.from(appViewModel.userPartialV1Dot1().teamSlotsPartial().getItems()).any(function(n){return n.daysUntilUnlockable<=0&&n.leaguePartial()&&n.leaguePartial().id<=0&&!n.isOccupiedForCrewBattle()})&&(t=new SurfacingState,t.type=SurfacingType.ChooseTeamOnLastDay,f.surfacingStatesPartial().addItem(new SurfacingStatePartial(t)),f._surfacingContainers.push(new SurfacingContainer(new SurfacingPopover(SurfacingType.ChooseTeamOnLastDay,DudeType.Agent,Helper.replaceText(Enumerable.from(f._agentTexts).where(function(n){return n.key==="age_agentlastdaycloudtextwebosc"}).select(function(n){return n.value}).firstOrDefault(),[{key:"clubname",value:appViewModel.teamPartial().name}]),Enumerable.from(f._agentTexts).where(function(n){return n.key==="age_agentlastdaybuttonwebosc"}).select(function(n){return n.value}).firstOrDefault()),null))))});this._onMatchesLeagueAndTeamsPartialLoaded=ko.computed(function(){var n,t,i;if(f._shouldSurface()&&f._surfacingStatesLoaded()&&f._matchesPartial()&&f._leaguePartial()&&f._teamsPartial()&&f._surfacingTexts()&&!f._matchesPartialProcessed()){if(n=Enumerable.from(f._matchesPartial().getItems()).where(function(n){return n.weekNr===f._leaguePartial().nextPositiveWeekNr&&(n.homeTeamId===SessionManager.getTeamId()||n.awayTeamId===SessionManager.getTeamId())}).firstOrDefault(),f._leaguePartial().weekNr<0||!n||!f._leaguePartial().settingsPartial().areTrainingCampsAllowed||f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampCupFinal)&&f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampCupSemis)&&f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampFirst)&&f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampInFirstThirdOfSeason)&&f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampInSecondThirdOfSeason)){f._matchesPartialProcessed(!0);return}if(t=f._matchesPartial().getItems(),f._teamsPartial().areAllGoalsEqual()&&n.weekNr<Math.ceil(t.length/3)){f.skipSurfacingType(SurfacingType.TrainingCampFirst);f._matchesPartialProcessed(!0);return}if(f.isSurfacingTypeAlreadyCompleted(SurfacingType.TrainingCampFirst)){if(i=Enumerable.from(f.surfacingStatesPartial().getItems()).single(function(n){return n.type===SurfacingType.TrainingCampFirst}).surfacedTimestamp,i>f._timeStampNow-f._secondsInOneDay){f._matchesPartialProcessed(!0);return}n.matchType===MatchType.Cup?f.trainingCampSurfacingForCupRounds(n.weekNr):f.trainingCampSurfacingForLeagueMatches(n)}else f.trainingCampFirstSurfacing(t)}});this.showCareerCentreInMenu=ko.observable(!1);this.isSurfacingReady=ko.computed(function(){return f._surfacingStatesLoaded()&&f._notificationsPartialProcessed()&&f._userPartial()!==null&&f._surfacingTexts()!=null&&f._invitesPartialProcessed()&&f._matchesPartialProcessed()&&f._userPartialProcessed()&&f._leaguePartialProcessed()});this._surfacingStateService=n;this._leagueStandingsService=t;this._cupRoundsService=i;this._teamTrainingService=r;this._textsService=u}return n.prototype.hasVisibleSurfacingContainer=function(){return Enumerable.from(this._surfacingContainers).any(function(n){return n.isVisible()})},n.prototype.trainingCampFirstSurfacing=function(n){var t=this.selectBestOpponent(n);t&&t.weekNr===this._leaguePartial().weekNr+1?this.selectTrainingCampSurfacingType(SurfacingType.TrainingCampFirst,t.weekNr):this._matchesPartialProcessed(!0)},n.prototype.trainingCampSurfacingForCupRounds=function(n){var t=this;WebApi.getInstance().execute(this._cupRoundsService.getByLeague(SessionManager.getLeagueId(),!0)).then(function(i){var r=Enumerable.from(i);r.any(function(t){return t.weekNr===n&&(t.cupRoundName===CupRoundName.Final||t.type===CupRoundType.Final)})?t.selectTrainingCampSurfacingType(SurfacingType.TrainingCampCupFinal,n):r.any(function(t){return t.weekNr===n&&(t.cupRoundName===CupRoundName.SemiFinal||t.type===CupRoundType.SemiFinal)})?t.selectTrainingCampSurfacingType(SurfacingType.TrainingCampCupSemis,n):t._matchesPartialProcessed(!0)}).done()},n.prototype.trainingCampSurfacingForLeagueMatches=function(n){var t=this;WebApi.getInstance().execute(this._leagueStandingsService.getAll(SessionManager.getLeagueId(),!0)).then(function(i){var u=Math.ceil(t._matchesPartial().getItems().length/3),f,r;t._leaguePartial().weekNr>0&&n.weekNr<u?(f=n.homeTeamId===SessionManager.getTeamId()?n.awayTeamId:n.homeTeamId,r=Enumerable.from(t._teamsPartial().getItems()),r.single(function(n){return n.id===f}).goal<=r.single(function(n){return n.id===SessionManager.getTeamId()}).goal?t.selectTrainingCampSurfacingType(SurfacingType.TrainingCampInFirstThirdOfSeason,n.weekNr):t._matchesPartialProcessed(!0)):n.weekNr>=u&&t.isWithinSurfacingPointsDifference(n,i,t._matchesPartial().getItems())?t.selectTrainingCampSurfacingType(SurfacingType.TrainingCampInSecondThirdOfSeason,n.weekNr):t._matchesPartialProcessed(!0)}).done()},n.prototype.selectTrainingCampSurfacingType=function(n,t){var i=this;WebApi.getInstance().execute(this._teamTrainingService.getCampByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId(),!0)).then(function(r){if(!(r.length>=appViewModel.gameSettingsPartial().getValue(GameVarCategory.TeamTraining,"CampAmount"))&&!Enumerable.from(r).any(function(n){return n.week+1===t||n.week+1===t+1})){var u=Enumerable.from(i.surfacingStatesPartial().getItems()).firstOrDefault(function(t){return t.type===n});i.addSurfacingType(u,n,DudeType.Assistant).then(function(){i._matchesPartialProcessed(!0)}).fail(function(n){i._matchesPartialProcessed(!0);ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()}}).done()},n.prototype.selectBestOpponent=function(n){var t=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"TrainingCampEarlyInSeasonMatches"),r,i;return(t=Math.min(t,n.length),t===0)?null:(r=Enumerable.from(this._teamsPartial().getItems()),i=Enumerable.from(n).where(function(n){return n.homeTeamId===SessionManager.getTeamId()&&n.matchType!==MatchType.Cup}).take(t),i.any())?i.orderBy(function(n){return r.single(function(t){return t.id===n.awayTeamId}).goal}).first():null},n.prototype.startSurfacing=function(){this._shouldSurface(!0);this.setTranslations()},n.prototype.addSurfacingType=function(n,t,i,r){var f=this,u;return r===void 0&&(r=null),u=Q.defer(),n?(this.addSurfacingContainer(n,t,i,r),u.resolve(!0)):WebApi.getInstance().execute(this._surfacingStateService.create(t)).then(function(n){CacheHandler.getInstance().removeKey(CacheKey[CacheKey.SurfacingStates]);f.surfacingStatesPartial().addItem(new SurfacingStatePartial(n));f.addSurfacingContainer(n,t,i,r);u.resolve(!0)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(),u.promise},n.prototype.addSurfacingContainer=function(n,t,i,r){if(!n.surfacedTimestamp){var u=this.getTranslationText(t,"cloudtext"),f=this.getTranslationText(t,"continue"),e=new SurfacingContainer(new SurfacingPopover(t,i,u,f),r);this._surfacingContainers.push(e)}},n.prototype.getTranslationText=function(n,t){var i="sur_"+SurfacingType[n].toLowerCase()+t;return Enumerable.from(this._surfacingTexts()).where(function(n){return n.key===i}).select(function(n){return n.value}).firstOrDefault()},n.prototype.setSurfacingStates=function(n){this.surfacingStatesPartial(new SurfacingStatesPartial(n));this._surfacingStatesLoaded(!0)},n.prototype.setNotifications=function(n){this._notificationsPartial(n)},n.prototype.setUserPartial=function(n){this._userPartial(n)},n.prototype.setInvitesPartial=function(n){this._invitesPartial(n)},n.prototype.setMatchesPartial=function(n){this._matchesPartial(new MatchesPartial(n))},n.prototype.setTeamsPartial=function(n){this._teamsPartial(new TeamsPartial(n))},n.prototype.setLeaguePartial=function(n){this._leaguePartial(n)},n.prototype.setTranslations=function(){var t=this,n=new WebApiBatch;n.add(this._textsService.getByCategory("web_surfacing")).then(function(n){t._surfacingTexts(n)}).done();n.add(this._textsService.getByCategory("fea_agent")).then(function(n){t._agentTexts=n}).done();n.execute().done()},n.prototype.getSurfaceableNotificationGroupTypes=function(){var n=[];return this.surfacingStatesPartial().getItems().forEach(function(t){switch(t.type){case SurfacingType.Doctor:n.push(NotificationGroupType.Doctor);break;case SurfacingType.Lawyer:n.push(NotificationGroupType.Lawyer)}}),n},n.prototype.showSurfacingModal=function(){var t=this,r=Enumerable.from(this.surfacingStatesPartial().getItems()).where(function(n){return!n.surfacedTimestamp}),u=Enumerable.from(this._surfacingTypesByPriority).intersect(r.select(function(n){return n.type})).intersect(Enumerable.from(this._surfacingContainers).select(function(n){return n.surfacingPopover.surfacingType})).firstOrDefault(),i=r.singleOrDefault(function(n){return n.type===u}),n;if(i){if(n=Enumerable.from(this._surfacingContainers).first(function(n){return n.surfacingPopover.surfacingType===i.type}),n.hasBeenShown())return;n.hasBeenShown(!0);n.show().then(function(){var r=n.surfacingPopover;switch(r.surfacingType){case SurfacingType.SquadSellPlayer:t.setSurfacingCookie(r.surfacingType);t.handleCompletedSurfacing(r.surfacingType);break;default:t.completeSurfacing(r.surfacingType,i.id).then(function(n){n&&t.handleCompletedSurfacing(r.surfacingType)}).done()}}).fail(function(){}).done()}},n.prototype.setSurfacingCookie=function(n){var t=new Date,i;t.setHours(t.getHours()+48);i="Surfacing_"+n+SessionManager.getLeagueId()+SessionManager.getTeamId();$.cookie(i,!0,{path:"/",expires:t})},n.prototype.completeSurfacing=function(n,t){t===void 0&&(t=0);var i=Q.defer();return n===SurfacingType.ChooseTeamOnLastDay&&($.cookie("surfacing_agent","true",{expires:9999,path:"/"}),i.resolve(!0)),t===0&&(t=Enumerable.from(this.surfacingStatesPartial().getItems()).firstOrDefault(function(t){return!t.surfacedTimestamp&&t.type===n}).id),t===0&&i.resolve(!1),WebApi.getInstance().execute(this._surfacingStateService.complete(t)).then(function(){if(CacheHandler.getInstance().removeKey(CacheKey[CacheKey.SurfacingStates]),n===SurfacingType.SquadSellPlayer){var t="Surfacing_"+n+SessionManager.getLeagueId()+SessionManager.getTeamId();Helper.removeCookie(t)}i.resolve(!0)}).fail(function(){i.resolve(!1)}).done(),i.promise},n.prototype.skipSurfacingType=function(n){if(!this._userPartial().isLegacyUser()&&!this.isSurfacingTypeAlreadyCompleted(n)){var t=Enumerable.from(this.surfacingStatesPartial().getItems()).singleOrDefault(function(t){return t.type===n});t?WebApi.getInstance().execute(this._surfacingStateService.complete(t.id)).then(function(){CacheHandler.getInstance().removeKey(CacheKey[CacheKey.SurfacingStates])}).done():WebApi.getInstance().execute(this._surfacingStateService.skip(n)).then(function(){CacheHandler.getInstance().removeKey(CacheKey[CacheKey.SurfacingStates])}).done()}},n.prototype.isSurfacingTypeAlreadyCompleted=function(n){return Enumerable.from(this.surfacingStatesPartial().getItems()).any(function(t){return t.type===n&&t.surfacedTimestamp>0})},n.prototype.handleCompletedSurfacing=function(n){switch(n){case SurfacingType.Doctor:window.location.href=Urls.doctor;break;case SurfacingType.Lawyer:window.location.href=Urls.lawyer;break;case SurfacingType.Scout:window.location.href=Urls.scout;break;case SurfacingType.Career:this._careerCentreSurfaceCookieHelper.setUserId(this._userPartial().id);window.location.href=Urls.career;break;case SurfacingType.ChooseTeamOnLastDay:var t=Enumerable.from(this._userPartial().teamSlotsPartial().getItems()).firstOrDefault(function(n){return n.daysUntilUnlockable<=0&&!n.hasLeague}),i=this._userPartial().teamSlotsPartial().getItems().indexOf(t);SessionManager.modifyOrCreateSession(this._userPartial().id,this._userPartial().login,0,0,i);appViewModel.redirect(RedirectionFlow.AccountSelect);break;case SurfacingType.Spy:window.location.href=Urls.spy;break;case SurfacingType.BusinessClub:window.location.href=Urls.businessClub;break;case SurfacingType.TrainingCampCupFinal:case SurfacingType.TrainingCampCupSemis:case SurfacingType.TrainingCampFirst:case SurfacingType.TrainingCampInFirstThirdOfSeason:case SurfacingType.TrainingCampInSecondThirdOfSeason:window.location.href=Urls.trainingCamp;break;case SurfacingType.SquadSellPlayer:window.location.href=Urls.squad}},n.prototype.isWithinSurfacingPointsDifference=function(n,t,i){var e=this,r=Enumerable.from(t);if(r.orderByDescending(function(n){return n.points}).first().teamId===SessionManager.getTeamId())return!1;var o=r.first(function(t){return t.teamId===n.homeTeamId}).points,s=r.first(function(t){return t.teamId===n.awayTeamId}).points,h=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Surfacing,"TrainingCampSecondThirdPointsDifference"),u=Math.abs(o-s);if(u<=h){var f=Enumerable.from(i).where(function(n){return n.matchType!==MatchType.Cup}),c=f.count(),l=f.count(function(n){return n.weekNr<e._leaguePartial().nextPositiveWeekNr});return u<(c-l)*3}return!1},n.prototype.isDaysAfterSignUpDate=function(n){return n>0&&this._userPartial().signUpTimestamp<this._timeStampNow-n*this._secondsInOneDay},n.prototype.getLeanplumFeatureName=function(n){switch(n){case SurfacingType.Doctor:return LeanplumHelper.SurfacingViewType.Doctor;case SurfacingType.Lawyer:return LeanplumHelper.SurfacingViewType.Lawyer;case SurfacingType.Scout:return LeanplumHelper.SurfacingViewType.Scout;case SurfacingType.Career:return LeanplumHelper.SurfacingViewType.Career;case SurfacingType.Spy:return LeanplumHelper.SurfacingViewType.Spy;case SurfacingType.BusinessClub:return LeanplumHelper.SurfacingViewType.BusinessClub;case SurfacingType.Forums:return LeanplumHelper.SurfacingViewType.Forums;case SurfacingType.TrainingCampFirst:return LeanplumHelper.SurfacingViewType.TrainingCampFirst;case SurfacingType.TrainingCampInFirstThirdOfSeason:return LeanplumHelper.SurfacingViewType.TrainingCampFirstThirdOfSeason;case SurfacingType.TrainingCampInSecondThirdOfSeason:return LeanplumHelper.SurfacingViewType.TrainingCampSecondThirdOfSeason;case SurfacingType.TrainingCampCupSemis:return LeanplumHelper.SurfacingViewType.TrainingCampCupSemiFinal;case SurfacingType.TrainingCampCupFinal:return LeanplumHelper.SurfacingViewType.TrainingCampCupFinal;case SurfacingType.SquadSellPlayer:return LeanplumHelper.SurfacingViewType.SquadSellPlayer;case SurfacingType.Apps:return LeanplumHelper.SurfacingViewType.Apps;case SurfacingType.ChooseTeamOnLastDay:return LeanplumHelper.SurfacingViewType.ChooseTeamOnLastDay;case SurfacingType.Default:default:return LeanplumHelper.SurfacingViewType.Default}},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SurfacingStatePartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(SurfacingState),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SurfacingStatesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n&&n.forEach(function(n){t.push(new SurfacingStatePartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MatchesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){n&&(this.poules=Enumerable.from(n).where(function(n){return!!n.homeTeam}).select(function(n){return n.homeTeam.poule}).distinct().orderBy(function(n){return n}).toArray());var t=[];n.forEach(function(n){t.push(new MatchPartial(n))});this.setItems(t)},t.prototype.getMatchesForPoule=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.homeTeam.poule===n}).toArray()},t.prototype.addCupRounds=function(n){var t=Enumerable.from(n);Enumerable.from(this.getItems()).forEach(function(n){var i=t.firstOrDefault(function(t){return n.weekNr===t.weekNr});i&&(n.cupRound=i,n.cupRoundPartial(new CupRoundPartial(i)))})},t.prototype.getMatchOtherLeg=function(n){var i=Enumerable.from(this.getItems()),t=i.firstOrDefault(function(t){return t.weekNr===n.weekNr&&t.leagueId===n.leagueId&&t.matchId===n.matchId});return!t||!t.cupRoundPartial()?null:i.firstOrDefault(function(n){return n.cupRoundPartial()&&n.cupRoundPartial().roundNr===t.cupRoundPartial().roundNr&&n.leagueId===t.leagueId&&n.matchId===t.matchId&&n.legType!==MatchLegType.None&&n.legType!==t.legType})},t.prototype.getScoreAggregate=function(n,t){var i=this.getMatchOtherLeg(n);return!i&&t?null:{homeGoals:n.homeGoals+(i?i.awayGoals:0),awayGoals:n.awayGoals+(i?i.homeGoals:0)}},t.prototype.getMatchForWeekNr=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.weekNr===n})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamsPartial=function(n){function t(t){var i=n.call(this)||this;return i.sessionTeam=ko.computed(function(){return Enumerable.from(i.getItems()).firstOrDefault(function(n){return n.isSessionTeam()})}),i.sortingEnabled(!0),i.setItemsFromModels(t),i.teamPoules=Enumerable.from(i.getItems()).where(function(n){return!!n.poule}).select(function(n){return n.poule}).distinct().orderBy(function(n){return n}).toArray(),i.hasPoules=i.teamPoules&&i.teamPoules.length>0,i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new TeamPartial(n))});this.setItems(t)},t.prototype.getOrderedBySpy=function(){return Enumerable.from(this.getItems()).orderByDescending(function(n){return n.spyInstructionPartial()!==undefined&&n.spyInstructionPartial()!==null}).thenByDescending(function(n){return n.onSecretTraining()===!1}).toArray()},t.prototype.getByPoule=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.poule==n}).toArray()},t.prototype.orderByTeamTaken=function(n){this.sortItems(function(n){return n.manager!=null},[function(n){return n.goal},function(n){return n.name}],n)},t.prototype.orderByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderByCity=function(){this.sortItems(function(n){return n.city})},t.prototype.orderByGoal=function(n){this.sortItems(function(n){return n.goal},[function(n){return n.name}],n)},t.prototype.orderByBudget=function(){this.sortItems(function(n){return n.budget})},t.prototype.orderByStadiumCapacity=function(){this.sortItems(function(n){return n.stadiumCapacity})},t.prototype.orderBySquadValue=function(){this.sortItems(function(n){return n.playersPartial().totalValue()})},t.prototype.areAllGoalsEqual=function(){var n=Enumerable.from(this.getItems()),t=n.first().goal;return n.all(function(n){return n.goal===t})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),MatchDataPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i.homeFormationModel&&i.homeFormationPartial(new FormationPartial(i.homeFormationModel)),i.awayFormationModel&&i.awayFormationPartial(new FormationPartial(i.awayFormationModel)),i.manOfTheMatchPlayer&&i.manOfTheMatchPlayerPartial(new PlayerPartial(i.manOfTheMatchPlayer)),i}return __extends(t,n),t}(MatchData),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),FacebookShareModal=function(n){function t(){var t=n.call(this,{template:ModalTemplate.FacebookShare,container:ModalContainer.Generic,modalSize:ModalSize.Normal,showCloseButton:!0})||this;return t.shareType=ko.observable(),t.isSharing=ko.observable(!1),t}return __extends(t,n),t.prototype.showFacebookPopup=function(t){this.shareType(t);n.prototype.show.call(this)},t.prototype.share=function(){var t=this;if(appViewModel.facebookPartial()){var n=[new KeyValuePair("managername",appViewModel.userPartial().name),new KeyValuePair("clubname",appViewModel.teamPartial().name)],i=Helper.replaceText($("#facebookshare-image-container").data("name"),n),r=Helper.replaceText($("#facebookshare-image-container").data("caption"),n),u=Helper.replaceText($("#facebookshare-image-container").data("description"),n);appViewModel.facebookPartial().share(i,r,u,"",this.shareType()).then(function(){t.hide()}).fail(function(){}).done()}},t}(BaseModal);(function(n){var t;(function(n){n[n.Signed=0]="Signed";n[n.Champion=1]="Champion";n[n.CupWon=2]="CupWon";n[n.GoalAchieved=3]="GoalAchieved"})(t=n.ShareType||(n.ShareType={}))})(FacebookShareModal||(FacebookShareModal={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AchievementModal=function(n){function t(t,i,r,u){var f=n.call(this,{template:ModalTemplate.Achievement,showCloseButton:!1,container:ModalContainer.Achievement})||this;return f.achievementsSelectablePartial=new SingleSelectableViewModel,f._avatar="",f._achievementsFallbackImage="/Images/views/achievements/icons/achievement_0.png",f.achievementsSelectablePartial.setItems(t.getItems()),f.totalAchievements=i,f._avatar=u,f.laurelPartial=new LaurelPartial(r-f.achievementsSelectablePartial.getItems().length),f.laurelPartial.avatarUrl(f.getAvatarUrl()),f.mobileLaurelPartial=new LaurelPartial(r-f.achievementsSelectablePartial.getItems().length),f.setAchievementIconInMobileLaurel(),f.hideEventFunction=function(n){f.achievementsSelectablePartial.isIncrementIndexDisabled()?f._achievementQueueProcessedDeferred.resolve(!0):(n.stopPropagation(),n.preventDefault(),f.showNextAchievement())},f.shownEventFunction=function(){f.laurelPartial.addLeaf();f.mobileLaurelPartial.addLeaf()},f}return __extends(t,n),t.prototype.show=function(){return this._achievementQueueProcessedDeferred=Q.defer(),n.prototype.show.call(this),this._achievementQueueProcessedDeferred.promise},t.prototype.share=function(){if(appViewModel.facebookPartial()&&appViewModel.userPartial()&&this.achievementsSelectablePartial.getSelectedItem()){var n=this.achievementsSelectablePartial.getSelectedItem().name,t=$("#achievement-modal-content").data("caption"),i=Helper.replaceText($("#achievement-modal-content").data("description"),[new KeyValuePair("managername",appViewModel.userPartial().name),new KeyValuePair("achievement",this.achievementsSelectablePartial.getSelectedItem().name)]),r=Helper.getAchievementUrl(this.achievementsSelectablePartial.getSelectedItem().achievementId);Helper.getImageOrFallback(r,window.location.protocol+"//"+window.location.host+this._achievementsFallbackImage).then(function(r){appViewModel.facebookPartial().share(n,t,i,r).fail(function(){}).done()}).done()}},t.prototype.claim=function(){this.achievementsSelectablePartial&&this.achievementsSelectablePartial.getSelectedItem().claim();this.hide()},t.prototype.showNextAchievement=function(){var n=this;$("#achievement-modal-content").fadeOut("fast",function(){n.achievementsSelectablePartial.incrementIndex();n.setAchievementIconInMobileLaurel();$("#achievement-modal-content").fadeIn("fast",function(){n.laurelPartial.addLeaf();n.mobileLaurelPartial.addLeaf()})})},t.prototype.setAchievementIconInMobileLaurel=function(){var t=this,n;if(this.achievementsSelectablePartial){n=Helper.getAchievementUrl(this.achievementsSelectablePartial.getSelectedItem().achievementId);Helper.getImageOrFallback(n,this._achievementsFallbackImage).then(function(n){t.mobileLaurelPartial.avatarUrl(n)}).done();return}this.mobileLaurelPartial.avatarUrl(this.getAvatarUrl())},t.prototype.getAvatarUrl=function(){return Helper.getAvatarUrl(this._avatar,AvatarType.Player)},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PmModal=function(n){function t(t,i,r,u){var f=n.call(this,{template:ModalTemplate.Pm,container:ModalContainer.Custom,showCloseButton:!0})||this;return f.conversationsPartial=ko.observable(),f.selectedConversationPartial=ko.observable(null),f.smileysPartial=ko.observable(),f.message=ko.observable(""),f.managerName=ko.observable(""),f.showSmileyPicker=ko.observable(!1),f.showMessageView=ko.observable(!1),f.isSending=ko.observable(!1),f.isStarting=ko.observable(!1),f.isRemoving=ko.observable(!1),f._smileyCategoryNr=1,f._loopStarted=!1,f._refreshConversationsOnUnread=!1,f.totalUnreadCount=ko.observable(0),f.updateUnreadCount=ko.computed(function(){f.conversationsPartial()&&f.totalUnreadCount(Enumerable.from(f.conversationsPartial().getItems()).sum(function(n){return n.unreadMessagesCount()}))}),f.isAccountActivated=ko.computed(function(){return!appViewModel||!appViewModel.userPartial()?!1:appViewModel.userPartial().activationCode===""}),f.selectedConversationId=ko.computed(function(){return f.selectedConversationPartial()?f.selectedConversationPartial().id:0}),f.isSendDisabled=ko.computed(function(){return f.selectedConversationPartial()?!f.isAccountActivated()||f.selectedConversationPartial().isReadOnly:!0}),f._conversationsService=t,f._messagesService=i,f._smileysService=r,f.totalUnreadCount(u),f}return __extends(t,n),t.prototype.show=function(t){t===void 0&&(t="");this.conversationsPartial()?this.refreshConversations(!0,t):this.firstTimeInit(t);this._refreshConversationsOnUnread=!0;this.startConversationLoop();n.prototype.show.call(this)},t.prototype.firstTimeInit=function(n){var i=this,t,r,u;n===void 0&&(n="");t=new WebApiBatch;r=this._smileysService.getSmileys(this._smileyCategoryNr);t.add(r);u=this._conversationsService.getAllByIdentity();t.add(u);Q.all([r.deferred.promise,u.deferred.promise]).spread(function(t,r){i.smileysPartial(new SmileysPartial(t));i.setConversation(r,!0,n)}).done();this.hideEventFunction=function(){i._refreshConversationsOnUnread=!1};t.execute()},t.prototype.setMessagesAsReadForActiveConversation=function(){if(this.selectedConversationPartial()&&this.isVisible()){var n=this._conversationsService.setMessagesRead(this.selectedConversationPartial().id);WebApi.getInstance().execute(n).done()}},t.prototype.startConversationLoop=function(){var n=this;this._loopStarted||(this._loopStarted=!0,window.setInterval(function(){n.refreshUnreadCount()},1e4))},t.prototype.sendMessageViaShortkey=function(n,t){return t.ctrlKey&&(t.keyCode===10||t.keyCode===13)&&this.sendMessage(),!0},t.prototype.closeSmileyPicker=function(){return this.showSmileyPicker(!1),!0},t.prototype.refreshUnreadCount=function(){var n=this,t=new WebApiBatch,i=this._conversationsService.getUnreadCountByIdentity();t.add(i).then(function(t){n.totalUnreadCount(t);t>0&&n._refreshConversationsOnUnread&&n.refreshConversations(!1)});t.execute().done()},t.prototype.refreshConversations=function(n,t){var u=this,i,r;t===void 0&&(t="");i=new WebApiBatch;r=this._conversationsService.getAllByIdentity();i.add(r).then(function(i){u.setConversation(i,n,t)}).done();i.execute().done()},t.prototype.setConversation=function(n,t,i){var u=this,r,f,e;if(i===void 0&&(i=""),this.conversationsPartial(new ConversationsPartial(n)),n.length>0){if(r=this.selectedConversationPartial()===null?n[0]:this.selectedConversationPartial(),i.length>0&&(r=Enumerable.from(n).firstOrDefault(function(n){return n.participants&&n.participants.length===1&&Enumerable.from(n.participants).any(function(n){return n.login===i})}),!r)){this.managerName(i);this.startConversation(i);return}f=new WebApiBatch;e=this._messagesService.getByConversationId(r.id);f.add(e).then(function(n){Enumerable.from(n).forEach(function(n){return n.body=TextHelper.parsePm(n.body,u.smileysPartial())});r.messages=n;var i=new ConversationPartial(r);u.selectedConversationPartial(i);u.setMessagesAsReadForActiveConversation();t&&u.scrollToBottom()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();f.execute().done()}else i.length>0&&(this.managerName(i),this.startConversation(i))},t.prototype.setSelectedConversation=function(n){if(this.selectedConversationId()>0&&this.selectedConversationId()===n.id){this.showMessageView(!0);return}this.resetPmState();this.selectedConversationPartial(n);this.refreshConversations(!0);this.showMessageView(!0)},t.prototype.removeConversation=function(n,t){var i=this;this.selectedConversationPartial()===null||this.selectedConversationPartial()===undefined||this.isRemoving()||(this.isRemoving(!0),new ConfirmModal(n,t).show().then(function(){WebApi.getInstance().execute(i._conversationsService.remove(i.selectedConversationPartial().id)).then(function(){i.selectedConversationPartial(null);i.showMessageView(!1)}).fail(function(n){WebapiHelper.handleAndAlertError(n);i.isRemoving(!1)}).fin(function(){i.resetPmState();i.refreshConversations(!0);i.isRemoving(!1)}).done()}).fail(function(){i.isRemoving(!1)}).done())},t.prototype.sendMessage=function(){var n=this,t;this.selectedConversationPartial()===null||this.selectedConversationPartial()===undefined||this.isSending()||(this.isSending(!0),t=this._messagesService.post(this.selectedConversationPartial().id,TextHelper.replaceSmileyText(this.message(),this.smileysPartial())),WebApi.getInstance().execute(t).then(function(){n.refreshConversations(!0)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isSending(!1)}).fin(function(){n.resetPmState();n.isSending(!1)}).done())},t.prototype.startConversation=function(n){var t=this;n!==""&&(this.isStarting(!0),WebApi.getInstance().execute(this._conversationsService.startConversation([n])).then(function(n){t.showMessageView(!0);t.selectedConversationPartial(new ConversationPartial(n))}).fail(function(n){WebapiHelper.handleAndAlertError(n);t.isStarting(!1)}).fin(function(){t.managerName("");t.resetPmState();t.refreshConversations(!0);t.isStarting(!1)}).done())},t.prototype.appendSmiley=function(n){var t=$("#pm-modal-message-input").get(0),r;if(t){var u=t.selectionStart,i=t.value,f=i.substring(0,u),e=i.substring(u,i.length);this.message(f+n+e);r=(f+n).length;t.focus();t.setSelectionRange(r,r)}},t.prototype.toggleSmileyPicker=function(){this.showSmileyPicker(!this.showSmileyPicker())},t.prototype.resetPmState=function(){this.message("");this.showSmileyPicker(!1)},t.prototype.clearSelectedConversation=function(){this.selectedConversationPartial(null);this.showMessageView(!1)},t.prototype.scrollToBottom=function(){var n=$("#pm-modal-conversation");n.animate({scrollTop:n[0].scrollHeight},"slow")},t.prototype.showActivateAccountModal=function(){appViewModel&&appViewModel.showActivateAccountModal()},t}(BaseModal),BaseVideoIncentiveMethod=function(){function n(){this.incentiveSystem=ko.observable();this.videoIncentiveMethodStatusAnnouncer=new ko.subscribable;this.videoIncentiveStatusAnnouncer=new ko.subscribable;this.isActive=ko.observable(!1);this.isMarkedUnavailable=ko.observable(!1)}return n.prototype.fireIncentiveVideoStatusEvent=function(n){this.videoIncentiveStatusAnnouncer.notifySubscribers(n)},n.prototype.fireMethodStatusEvent=function(n){this.videoIncentiveMethodStatusAnnouncer.notifySubscribers(n)},n.prototype.personalizedAdsEnabled=function(){if(appViewModel.userPartialV1Dot1()&&appViewModel.userPartialV1Dot1().gdprSettingsPartial()){var n=appViewModel.userPartialV1Dot1().gdprSettingsPartial().getMostRecentChangedSettingForSettingType(GdprSettingType.PersonalisedAds);return n?n.permission:!1}return!1},n}(),VideoIncentiveMethod;(function(n){var t,i,r;(function(n){n[n.VideosAvailable=0]="VideosAvailable";n[n.VideosUnavailable=1]="VideosUnavailable";n[n.AdBlockerDetected=2]="AdBlockerDetected";n[n.MethodClosing=3]="MethodClosing";n[n.MethodInitialized=4]="MethodInitialized";n[n.ScreenSizeNotSupported=5]="ScreenSizeNotSupported"})(t=n.IncentiveMethodStatus||(n.IncentiveMethodStatus={})),function(n){n[n.VideoStarted=0]="VideoStarted";n[n.VideoWatched=1]="VideoWatched";n[n.VideoInterrupted=2]="VideoInterrupted"}(i=n.IncentiveVideoStatus||(n.IncentiveVideoStatus={})),function(n){n[n.CountdownTimerReduction=0]="CountdownTimerReduction";n[n.Bosscoins=1]="Bosscoins"}(r=n.IncentiveMethodPurpose||(n.IncentiveMethodPurpose={}))})(VideoIncentiveMethod||(VideoIncentiveMethod={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),IronRVInstance=null,IronSourceVideoIncentiveMethod=function(n){function t(){var t=n.call(this)||this;return t.incentiveSystem(IncentiveSystem.SuperSonicAds),t}return __extends(t,n),t.prototype.initialiseVideoIncentiveMethod=function(){if(appViewModel.sessionSettings.screenSize()<=ScreenSize.Xs){this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.ScreenSizeNotSupported);var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Screen size is not supported by ironsource");return Q.reject(n)}return IronRVInstance?(IronRVInstance.isReady()?this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosAvailable):this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable),this.addIronsourceEventListeners(),Q.resolve(!0)):(IronRVInstance=IronRV.getInstance({applicationKey:ironSourceAppKey,applicationUserId:appViewModel.userPartialV1Dot1().id.toString()}),this.addIronsourceEventListeners(),Q.resolve(!0))},t.prototype.addIronsourceEventListeners=function(){var n=this;IronRVInstance.addListener(IronRV.EVENTS.READY,function(){n.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosAvailable)});IronRVInstance.addListener(IronRV.EVENTS.OPEN,function(){});IronRVInstance.addListener(IronRV.EVENTS.CLOSE,function(){n.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.MethodClosing)});IronRVInstance.addListener(IronRV.EVENTS.NO_CAMPAIGNS,function(){n.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable)});IronRVInstance.addListener(IronRV.EVENTS.COMPLETION,function(){n.fireIncentiveVideoStatusEvent(VideoIncentiveMethod.IncentiveVideoStatus.VideoWatched)})},t.prototype.activateVideoIncentiveMethod=function(){try{this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.MethodInitialized);IronRVInstance.show()}catch(t){this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable);var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Ironsource videos unavailable");return Q.reject(n)}return Q.resolve(!0)},t.prototype.checkForAvailableVideos=function(){return Q.resolve(!0)},t.prototype.destroy=function(){},t}(BaseVideoIncentiveMethod),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ApplixirVideoIncentiveMethod=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.zoneId=t,f.devId=i,f.gameId=r,f.incentiveSystem(IncentiveSystem.AppLixir),f._watchVideoPlacementType=u,f}return __extends(t,n),t.prototype.initZ2Options=function(n){var t=this,i=function(r){if(r.data=="sys-closing")window.removeEventListener("message",i,!1);else if(r.data=="z2-ready"){var f={zoneId:t.zoneId,devId:t.devId,gameId:t.gameId,fallback:1,custom1:n,custom2:t._watchVideoPlacementType,vtos:2,htos:3,dMode:1,nopers:!t.personalizedAdsEnabled()},u=r.source;u.postMessage("loadOptions="+JSON.stringify(f),"https://"+u.location.host,null);return}};window.addEventListener("message",i.bind(this))},t.prototype.initOptions=function(n){var t={zoneId:this.zoneId,devId:this.devId,gameId:this.gameId,adStatusCb:this.applixirAdStatusCallback.bind(this),fallback:1,custom1:n,custom2:this._watchVideoPlacementType,dMode:1,verbosity:5,nopers:!this.personalizedAdsEnabled()};appViewModel.isFacebookCanvas()&&(t.prebid=!0,t.pb_sec="Facebook",t.pb_key="Online Soccer Manager");this._applixirOptions=t},t.prototype.initialiseVideoIncentiveMethod=function(){var n=appViewModel.userPartialV1Dot1().id;return appViewModel.isFacebookCanvas()&&this.initZ2Options(n),this.initOptions(n),Q.resolve(!0)},t.prototype.activateVideoIncentiveMethod=function(){try{invokeApplixirVideoUnit(this._applixirOptions)}catch(t){this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable);var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Could not activate applixir.");return Q.reject(n)}return Q.resolve(!0)},t.prototype.checkForAvailableVideos=function(){return this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosAvailable),Q.resolve(!0)},t.prototype.applixirAdStatusCallback=function(n){switch(n){case"ad-watched":case"fb-watched":this.fireIncentiveVideoStatusEvent(VideoIncentiveMethod.IncentiveVideoStatus.VideoWatched);break;case"ad-started":case"fb-started":this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.MethodInitialized);this.fireIncentiveVideoStatusEvent(VideoIncentiveMethod.IncentiveVideoStatus.VideoStarted);break;case"ad-interrupted":this.fireIncentiveVideoStatusEvent(VideoIncentiveMethod.IncentiveVideoStatus.VideoInterrupted);break;case"sys-closing":this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.MethodClosing);break;case"ad-blocker":this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.AdBlockerDetected);case"network-error":case"cors-error":case"no-zoneId":case"ads-unavailable":this.fireMethodStatusEvent(VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable)}return},t.prototype.destroy=function(){},t}(BaseVideoIncentiveMethod),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),WatchVideosModal=function(n){function t(t,i,r,u,f,e){var o=n.call(this,{template:ModalTemplate.WatchVideos,showCloseButton:!1,container:ModalContainer.Custom,hideOnBackdropClick:!1})||this;return o.videoIncentivesProviderList=ko.observableArray(),o.availableVideoIncentiveMethodList=ko.observableArray(),o.amountOfVideosWatchedThisDisplay=ko.observable(0),o._watchVideoPlacementType=ko.observable(WatchVideoPlacementType.None),o.videoWatchedRewardAnnouncer=new ko.subscribable,o.videoQuantityPerModalDisplay=1,o.hideEventDeferred=Q.defer(),o._koIncentiveMethodSubscriptions=[],o._lastKnowIncentiveMethodStatus=ko.observable(),o.activeVideoSystem=ko.computed(function(){if(o.availableVideoIncentiveMethodList())return Enumerable.from(o.availableVideoIncentiveMethodList()).firstOrDefault(function(n){return n.isActive()})}),o._incentiveProviderCountriesService=t,o._incentiveProviderService=i,o._watchVideosService=r,o._watchVideoPlacementType(f),o._watchVideoRewardData=e,o._actionRewardsService=u,o.shownEventFunction=function(){var n=Boolean($.cookie(CookieHelper.CookieKeys.isVideoRewardsApiDown));if(n){o.showNoMoreVideosAlert();o.hide();return}o.initializeVideoSystemList()},o.hideEventFunction=function(){o.hideEventDeferred.resolve()},o}return __extends(t,n),t.prototype.show=function(){return appViewModel.adBlockerDetectedObservable()?(this.showAdBlockerDetectedAlert(),Q.reject()):(n.prototype.show.call(this),this.hideEventDeferred.promise)},t.prototype.initializeVideoSystemList=function(){var n=this,t=new WebApiBatch,u=appViewModel.isFacebookCanvas()?Platform.FacebookCanvas:Platform.WebDesktop,f=this._incentiveProviderCountriesService.getAllActiveForCountry(u),i,r;t.add(f).done();i=this._incentiveProviderService.getAllActive(u);t.add(i).done();r=this._actionRewardsService.get(!1);t.add(r);Q.all([f.deferred.promise,i.deferred.promise,r.deferred.promise]).spread(function(t,i,r){if(!r||!r.length){n.handleNoActionRewards();return}var u=Enumerable.from(t).where(function(n){return n.incentiveType===IncentiveType.Video}).select(function(n){return n.incentiveSystem}).toArray();Enumerable.from(u).any()||(u=Enumerable.from(i).select(function(n){return n.incentiveSystem}).toArray());u&&u.length||(n.showNoMoreVideosAlert(),n.hide());n.videoIncentivesProviderList(u);n.initSubscriptions();n.initVideoOffers()}).fail(function(){n.closeModal();n.showNoMoreVideosAlert()}).done();t.execute()},t.prototype.handleNoActionRewards=function(){CacheHandler.getInstance().removeKey(CacheKey[CacheKey.ActionRewards]);var n=moment(new Date).add(5,"m").toDate();$.cookie(CookieHelper.CookieKeys.isVideoRewardsApiDown,!0,{expires:n,path:"/",domain:appViewModel.getDomain()});this.showNoMoreVideosAlert();this.hide()},t.prototype.initSubscriptions=function(){var n=this;this._videoIncentivesProviderListSubscription=this.videoIncentivesProviderList.subscribe(function(t){Enumerable.from(t).any()||n.closeModal()});this._availableVideoIncentiveMethodListSubscription=this.availableVideoIncentiveMethodList.subscribe(function(){if(!Enumerable.from(n.availableVideoIncentiveMethodList()).any(function(n){return n.isActive()})){if(n.amountOfVideosWatchedThisDisplay()>=n.videoQuantityPerModalDisplay){n.closeModal();return}n.activateFirstAvailableVideoOffer()}})},t.prototype.activateFirstAvailableVideoOffer=function(){var n=this,i=this.availableVideoIncentiveMethodList(),t;i&&(Enumerable.from(i).any(function(n){return n.isActive()})||this.amountOfVideosWatchedThisDisplay()>=this.videoQuantityPerModalDisplay||(t=Enumerable.from(i).firstOrDefault(function(n){return!n.isMarkedUnavailable()}),t)&&t.checkForAvailableVideos().then(function(){var i=n._watchVideoRewardData,r=n._watchVideosService.startVideo(i.placement,i.capVariation);WebApi.getInstance().execute(r).then(function(i){if(i.isCapReached){n.closeModal();n.showCapReachedAlert(i.timestampUntilUnreached);return}t.activateVideoIncentiveMethod().fail(function(){}).done()}).fail(function(){n.closeModal();n.showNoMoreVideosAlert()}).done()}).fail(function(){}).done())},t.prototype.closeModal=function(){this._videoIncentivesProviderListSubscription&&this._videoIncentivesProviderListSubscription.dispose();this._availableVideoIncentiveMethodListSubscription&&this._availableVideoIncentiveMethodListSubscription.dispose();this._koIncentiveMethodSubscriptions&&this._koIncentiveMethodSubscriptions.forEach(function(n){n.dispose()});this.availableVideoIncentiveMethodList()&&this.availableVideoIncentiveMethodList().forEach(function(n){n.destroy()});this.availableVideoIncentiveMethodList(null);this.videoIncentivesProviderList(null);this.hide()},t.prototype.initVideoOffers=function(){var n=this,t=this.videoIncentivesProviderList().slice();t.forEach(function(t){var i=VideoIncentiveFactory.createVideoIncentiveMethod(t,n._watchVideoPlacementType()),r,u;if(!i){n.videoIncentivesProviderList.remove(t);return}r=i.videoIncentiveMethodStatusAnnouncer.subscribe(function(r){n._lastKnowIncentiveMethodStatus(r);(r===VideoIncentiveMethod.IncentiveMethodStatus.MethodClosing||r===VideoIncentiveMethod.IncentiveMethodStatus.VideosUnavailable||r===VideoIncentiveMethod.IncentiveMethodStatus.ScreenSizeNotSupported)&&(i.isMarkedUnavailable(!0),n.videoIncentivesProviderList.remove(t),i.isActive(!1),n.availableVideoIncentiveMethodList.notifySubscribers());r===VideoIncentiveMethod.IncentiveMethodStatus.ScreenSizeNotSupported&&n.showScreenSizeNotSupportedAlert();r===VideoIncentiveMethod.IncentiveMethodStatus.MethodInitialized&&(i.isActive(!0),n.availableVideoIncentiveMethodList.notifySubscribers());r!==VideoIncentiveMethod.IncentiveMethodStatus.VideosAvailable||Enumerable.from(n.availableVideoIncentiveMethodList()).any(function(n){return n.incentiveSystem===i.incentiveSystem})||n.availableVideoIncentiveMethodList.push(i)});u=i.videoIncentiveStatusAnnouncer.subscribe(function(t){if(t===VideoIncentiveMethod.IncentiveVideoStatus.VideoWatched){n.amountOfVideosWatchedThisDisplay(n.amountOfVideosWatchedThisDisplay()+1);var i=n.onVideoWatched();i.fin(function(){n.videoWatchedRewardAnnouncer.notifySubscribers(i)})}});n._koIncentiveMethodSubscriptions.push(r,u);i.initialiseVideoIncentiveMethod().then(function(){i.checkForAvailableVideos()}).fail(function(){}).done()})},t.prototype.onVideoWatched=function(){var n=this,t=Q.defer(),i=this._watchVideoRewardData,r=this._watchVideosService.videoWatched(i.placement,i.rewardVariation,i.capVariation);return WebApi.getInstance().execute(r).then(function(i){var r,u;switch(n._watchVideoPlacementType()){case WatchVideoPlacementType.Spy:r=n._watchVideoRewardData;u=n._watchVideosService.spyTimerWatchVideo(r.leagueId,r.teamId,r.subjectId,i.id);break;case WatchVideoPlacementType.Training:r=n._watchVideoRewardData;u=n._watchVideosService.trainingSessionWatchVideo(r.leagueId,r.teamId,r.subjectId,i.id);break;case WatchVideoPlacementType.Scout:r=n._watchVideoRewardData;u=n._watchVideosService.scoutTimerConsumeWatchVideoReward(r.leagueId,r.teamId,i.id);break;case WatchVideoPlacementType.Shop:case WatchVideoPlacementType.Header:case WatchVideoPlacementType.Transfers:case WatchVideoPlacementType.BusinessClub:u=n._watchVideosService.bossCoinWalletWatchVideo(i.id)}WebApi.getInstance().execute(u).then(function(n){t.resolve(n)}).fail(function(){t.reject(null)}).done()}).fail(function(){t.reject(null)}).done(),t.promise},t.prototype.showNoMoreVideosAlert=function(){var n=$("#watchvideo-alert-translations").data("nomorevideostitle"),t=$("#watchvideo-alert-translations").data("nomorevideoscontent");new AlertModal(n,t).show()},t.prototype.showCapReachedAlert=function(n){var i=$("#watchvideo-alert-translations").data("capreachedtitle"),t=$("#watchvideo-alert-translations").data("capreachedcontent"),r=new Date(n*1e3),u=moment(r).fromNow(!0);t=Helper.replaceText(t,[{key:"timestamp",value:u}]);new AlertModal(i,t).show()},t.prototype.showScreenSizeNotSupportedAlert=function(){var n=$("#watchvideo-alert-translations").data("screensizenotsupportedtitle"),t=$("#watchvideo-alert-translations").data("screensizenotsupportedcontent");new AlertModal(n,t).show()},t.prototype.showAdBlockerDetectedAlert=function(){var n=$("#watchvideo-alert-translations").data("adblockerdetectedtitle"),t=$("#watchvideo-alert-translations").data("adblockerdetectedcontent2")+"<br /><br />"+$("#watchvideo-alert-translations").data("adblockerdetectedcontent3");new AlertModal(n,t).show()},t.MaxAmountOfVideosPerInterval=3,t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),StaffModal=function(n){function t(t,i,r){i===void 0&&(i=DudeType.Assistant);r===void 0&&(r=[]);var u=n.call(this,{template:t,showCloseButton:!1,container:ModalContainer.Tutorial,hideOnBackdropClick:!1})||this;return u.isClaiming=ko.observable(!1),u.dudeType=ko.observable(DudeType.Assistant),u.stringVariables=[],u.dudeType(i),u.stringVariables=r,u}return __extends(t,n),t.prototype.continueAction=function(){this.showDeferred.resolve(!0);this.hide()},t.prototype.show=function(){return this.showDeferred=Q.defer(),n.prototype.show.call(this),this.showDeferred.promise},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TutorialModal=function(n){function t(t,i,r){t===void 0&&(t=DudeType.Assistant);i===void 0&&(i=[]);r===void 0&&(r=null);var u=n.call(this,ModalTemplate.Tutorial,t,i)||this;return u.rewardPartial=ko.observable(),u.isBranchFlow=ko.observable(!1),u.isBranchFlow(BranchHelper.loadLinkData()!==null),r&&u.rewardPartial(new RewardPartial(r)),u}return __extends(t,n),t.prototype.claimAction=function(){var n=this;this.isClaiming(!0);appViewModel&&appViewModel.tutorialPartial()?appViewModel.tutorialPartial().claimTutorialReward(this.rewardPartial().id).then(function(){appViewModel.refreshBossCoinsWallet().done();n.showDeferred.resolve(!0);n.hide()}).fail(function(t){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t);n.showDeferred.resolve(!1);n.isClaiming(!1);n.hide()}).done():this.isClaiming(!1)},t}(StaffModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),StaffSurfacingModal=function(n){function t(t,i,r){i===void 0&&(i=DudeType.Assistant);r===void 0&&(r=[]);var u=n.call(this,ModalTemplate.Surfacing,i,r)||this;return u.surfacingFollowUp=ko.observable(),u.surfacingFollowUp(t),u}return __extends(t,n),t}(StaffModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TutorialRewardModal=function(n){function t(t){var i=n.call(this,{template:ModalTemplate.TutorialReward,showCloseButton:!1,container:ModalContainer.Tutorial,hideOnBackdropClick:!1})||this;return i.isClaiming=ko.observable(!1),i.reward=t,i}return __extends(t,n),t.prototype.show=function(){return this._showDeferred=Q.defer(),n.prototype.show.call(this),this._showDeferred.promise},t.prototype.claim=function(){var n=this;this.isClaiming(!0);appViewModel.tutorialPartial().claimTutorialReward(this.reward.id).then(function(t){appViewModel.refreshBossCoinsWallet().done();n._showDeferred.resolve(t);n.hide()}).fail(function(t){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t);n.isClaiming(!1);n.hide()}).done()},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),appViewModel;LoggedInViewModel=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei){var oi=n.call(this,t,ht,ot,vt,at,i,kt,dt,u,fi)||this,si;return oi.userPartial=ko.observable(),oi.teamPartial=ko.observable(),oi.leaguePartial=ko.observable(),oi.achievementProgressesPartial=ko.observable(),oi.pmModal=ko.observable(),oi.countdownTimersPartial=ko.observable(),oi.nextRoundCountdownTimerPartial=ko.observable(),oi.inviteRewardsPartial=ko.observable(),oi.inviteeRewardPartial=ko.observable(),oi.toastsPartial=ko.observable(new ToastsPartial),oi.clubFundsWalletPartial=ko.observable(),oi.menuPartial=ko.observable(),oi.crewPartial=ko.observable(),oi.surfacingPartial=ko.observable(),oi._now=ko.observable(new Date),oi.now=ko.computed(function(){return oi._now()}),oi.hasEntryRequests=ko.computed(function(){return oi.entryRequestsPartial()&&oi.entryRequestsPartial().getItems().length>0&&oi.leaguePartial()&&oi.userPartial()?!0:!1}),oi.showFriendsNotification=ko.computed(function(){return oi.inviteRewardsPartial()&&oi.inviteRewardsPartial().unclaimedRewards().length>0||oi.inviteeRewardPartial()!==undefined&&oi.inviteeRewardPartial()!==null&&oi.inviteeRewardPartial().status===RewardStatus.Unclaimed||oi.hasInvites()||oi.hasEntryRequests()}),oi.showPmNotification=ko.computed(function(){return oi.pmModal()&&oi.pmModal().totalUnreadCount()>0}),oi.showAchievementsNotification=ko.computed(function(){return oi.achievementProgressesPartial()&&oi.achievementProgressesPartial().hasUnclaimedAchievements()}),oi.showNotification=ko.computed(function(){return oi.showPmNotification()||oi.showAchievementsNotification()||oi.showFriendsNotification()}),oi.showCrewNotification=ko.computed(function(){return oi.crewInvitesPartial()&&oi.crewInvitesPartial().hasPendingInvites()||oi.crewRequestsForCrewPartial()&&oi.crewRequestsForCrewPartial().getPendingCount()>0&&oi.crewPartial().recruitmentStatus!==CrewRecruitmentStatus.InviteOnly}),oi.isLeagueModerator=ko.computed(function(){return!oi.leaguePartial()||!oi.userPartial()?!1:oi.leaguePartial().isModerator(oi.userPartial().login)}),oi._onNotificationsAndSurfacingLoaded=ko.computed(function(){oi.surfacingPartial()&&oi.surfacingPartial().surfacingStatesPartial()&&oi.webAndEventNotificationsPartial()&&oi.surfacingPartial().setNotifications(oi.webAndEventNotificationsPartial())}),oi._notificationService=r,oi._bossCoinsService=f,oi._teamsService=e,oi._achievementsService=o,oi._gameSettingsService=s,oi._bossCoinProductsService=h,oi._teamFinancesService=ft,oi._historyService=et,oi._leaguesService=c,oi._conversationsService=l,oi._messagesService=it,oi._usersService=a,oi._sponsorsService=v,oi._stadiumService=y,oi._countdownTimerService=p,oi._leagueTypesService=w,oi._menuService=nt,oi._textsService=tt,oi._matchesService=b,oi._managersService=k,oi._serverService=g,oi._smileysService=rt,oi._rewardsService=ot,oi._invitesService=st,oi._entryRequestsService=ct,oi._leagueSettingsService=lt,oi._crewsService=yt,oi._surfacingStatesService=pt,oi._productService=ni,oi._crewRequestsService=ti,oi._crewInvitesService=ii,oi._usersV1Dot1Service=ri,oi._eventNotificationsService=ui,oi._userRewardsService=ei,oi.surfacingPartial(new SurfacingPartial(pt,wt,d,bt,tt)),oi._clockInterval=window.setInterval(function(){var n=oi._now?oi.now():new Date;oi._now(new Date(n.getTime()+1e3))},1e3),gt.setTimeouts(oi.sessionSettings.idleTimeout,oi.sessionSettings.idleRefreshAfterTimeout),si=[Urls.crewChat,Urls.crewInvites,Urls.crewLandingPage,Urls.crewMembers,Urls.crewProfile,Urls.crewRanking,Urls.crewBiography,Urls.businessClub,Urls.ranking,Urls.leagueTypes,Urls.simulationStatus,Urls.career],gt.activityAfterIdling.subscribe(function(n){var t=Enumerable.from(si).any(function(n){return window.location.href.indexOf(n)>-1});n||t||oi.redirect(RedirectionFlow.Reset)}),oi}return __extends(t,n),t.create=function(n){var u=new TextsService,i=new RewardsService,r=new InvitesService,f=new GameSettingsService,e=new AccountService,o=new BossCoinsService;return new t(new TutorialProgressesService,new AuthService(new InviteHandlerService(n,i,new LeaguesService)),new NotificationService,new LanguageService,new BossCoinsService,new TeamsService,new AchievementsService,f,new BossCoinProductsService,new LeaguesService,new ConversationsService,n,new SponsorsService,new StadiumService,new CountdownTimerService,new LeagueTypesService,new MatchesService,new ManagersService,new CupRoundsService,new ServerService,new MenuService,u,new MessagesService,new SmileysService,new TeamTacticService,new TeamFinancesService,new HistoryService,i,r,new RedirectionService(r,n,o,new SurfacingStatesService),new EntryRequestsService,new LeagueSettingsService,e,new AdsService,new CrewsService,new SurfacingStatesService,new LeagueStandingsService,new TeamTrainingService,new FacebookService,new CookieService,new IdleService,new WebApiV1Dot1.ProductService,new WebApiV1Dot1.CrewRequestsService,new CrewInvitesService,new WebApiV1Dot1.UsersService,new EventNotificationsService,new ActionRewardsService,new UserRewardsService)},t.prototype.init=function(){var t=this,r=n.prototype.init.call(this),i=Q.defer();return r.then(function(){var n=LeanplumHelper.getInstance().initialize();SessionManager.getInstance().ensureSession(t._usersService).then(function(){var u=new WebApiBatch,o=t._crewsService.getForUser(!0),e,f,s;u.add(o);e=t._crewInvitesService.getForUser(!0);u.add(e);SessionManager.getLeagueId()===0?(f=t._usersService.getAccountByIdentity(SessionManager.getInstance().session.serverDownForCurrentSlotIndex?!1:!0),u.add(f).done(),Q.allSettled([o.deferred.promise,f.deferred.promise,e.deferred.promise]).spread(function(i,r,u){i.state==="fulfilled"&&i.value&&t.crewPartial(new CrewPartial(i.value));u.state==="fulfilled"&&t.crewInvitesPartial(new CrewInvitesPartial(u.value));r.state==="fulfilled"&&n.fail(function(){}).fin(function(){t.initData(r.value,null)}).done()}).fail(function(){}).done()):(f=t._usersService.getAccountByIdentity(!0),u.add(f).done(),s=t._leaguesService.getBySession(!0),u.add(s).done(),Q.allSettled([o.deferred.promise,f.deferred.promise,s.deferred.promise,e.deferred.promise]).spread(function(i,r,u,f){i.state==="fulfilled"&&i.value&&t.crewPartial(new CrewPartial(i.value));f.state==="fulfilled"&&t.crewInvitesPartial(new CrewInvitesPartial(f.value));r.state==="fulfilled"&&u.state==="fulfilled"&&n.fail(function(){}).fin(function(){t.userAndLeagueLoadedDeferred.resolve(null);t.initData(r.value,u.value)}).done()}).fail(function(){}).done());Q.all([u.execute(),r]).then(function(){i.resolve()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Could not ensure session");t.redirect(RedirectionFlow.Reset);i.reject(n)}).done()}),i.promise},t.prototype.initData=function(n,t){var r=this,i=new WebApiBatch,u;this.initGeneralData(i);this.initUserData(i,n);t&&SessionManager.getTeamId()!==0&&this.initLeagueAndTeamData(i,t);u=i.execute();u.fin(function(){r.initNoneBatchData().fin(function(){r.appViewModelDataLoadedDeferred.resolve()})}).done()},t.prototype.initGeneralData=function(n){var t=this;n.add(this._gameSettingsService.getAll(!0)).then(function(n){t.gameSettingsPartial(new GameSettingsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();n.add(this.actionRewardsService.get(!0)).then(function(n){t.actionRewardsPartial(new ActionRewardsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();n.add(this._bossCoinProductsService.getAll(!0)).then(function(n){t.bossCoinProductsPartial(new BossCoinProductsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.initNoneBatchData=function(){var i=this,n=Q.defer(),r=$.cookie(CookieHelper.CookieKeys.shouldUpdateGdprDataStorageSetting),t;return r&&WebApi.getInstance().execute(this._usersV1Dot1Service.updateGdprSetting(GdprSettingType.DataStorage,!0)).then(function(){$.removeCookie(CookieHelper.CookieKeys.shouldUpdateGdprDataStorageSetting,{path:"/"})}).fail(function(){}).done(),t=this._userRewardsService.getByIdentity(),WebApi.getInstance().execute(t).then(function(n){i.userRewardsPartial(new UserRewardsPartial(n))}).fail(function(){}).done(function(){n.resolve()}),n.promise},t.prototype.initUserData=function(n,t){var i=this,r,u,f,h,e,o,c,s;this.userPartial(new UserPartial(t));this.surfacingPartial().setUserPartial(this.userPartial());n.add(this._bossCoinsService.getByIdentity()).then(function(n){if(n){if(i.bossCoinWalletPartial(new BossCoinWalletPartial(n,i._bossCoinsService,i._teamFinancesService)),i.bossCoinWalletPartial().unclaimedCoins>0){var t=new BossCoinToast(i.bossCoinWalletPartial());appViewModel.toastsPartial().addItem(t);t.open()}i.bossCoinWalletPartial().bossCoinProgress.stopAnimating()}}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();n.add(this._conversationsService.getUnreadCountByIdentity()).then(function(n){i.pmModal(new PmModal(i._conversationsService,i._messagesService,i._smileysService,n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();n.add(this._invitesService.getByIdentity(!0)).then(function(n){i.invitesPartial(new InvitesPartial(n));appViewModel.surfacingPartial().setInvitesPartial(i.invitesPartial())}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();this.crewPartial()&&n.add(this._crewRequestsService.getAllPendingCrewRequestsForCrewId(this.crewPartial().id,!0)).then(function(n){i.crewRequestsForCrewPartial(new WebApiV1Dot1.CrewRequestsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)});n.add(this._rewardsService.getByIdentityFilteredByType(RewardType.Inviter,!0,!0)).then(function(n){i.inviteRewardsPartial(new InviteRewardsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();n.add(this._rewardsService.getSingleByIdentityFilteredByType(RewardType.Signup,!1,!0)).then(function(n){n&&i.inviteeRewardPartial(new InviteRewardPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();r=this._surfacingStatesService.getByIdentity(!0);n.add(r).then(function(n){i.surfacingPartial().setSurfacingStates(n)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();u=this._textsService.getByCategory("web_menu");n.add(u).done();f=this._textsService.getByCategory("web_tutorial");n.add(f).done();h=this.isFacebookCanvas()?this._productService.getFacebookProducts(t.countryCode,!0):this._productService.getByIdentity(!0);n.add(h).then(function(n){i.productsPartial(new ProductsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();e=this._usersV1Dot1Service.getUserById(this.userPartial().id,!0,"Gdpr,TeamSlots");n.add(e).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();o=this.adsService.getByIdentity(t.id,WebApiConfig.getInstance().cultureCode,!0);n.add(o).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();c=window.location.href.toLowerCase().indexOf(Urls.career.toLowerCase())===-1;s=this._achievementsService.getByIdentity(c);n.add(s);Q.allSettled([e.deferred.promise,o.deferred.promise,s.deferred.promise]).spread(function(n,r,u){if((u.state==="fulfilled"&&(i.achievementProgressesPartial(new AchievementProgressesPartial(u.value,i._achievementsService)),i.laurelPartial(new LaurelPartial(i.achievementProgressesPartial().completedAchievements().length,LaurelDisplayType.Avatar,Helper.getAvatarUrl(t.picture,AvatarType.Player)))),n.state==="fulfilled")&&(i.userPartialV1Dot1(new WebApiV1Dot1.UserPartial(n.value)),i.userPartialV1Dot1().gdprSettingsPartial())){var f=i.userPartialV1Dot1().gdprSettingsPartial().getMostRecentChangedSettingForSettingType(GdprSettingType.PersonalisedAds);f&&$.cookie(CookieHelper.CookieKeys.personalizedAdsEnabled,f.permission,{path:"/"});window.location.href.toLowerCase().indexOf(Urls.career.toLowerCase()||Urls.businessClub.toLowerCase())===-1&&(!f&&i.userPartialV1Dot1().areAdsEnabledForUser()?new AdSettingModal(i._usersV1Dot1Service).show().done(function(){i.processQueuedAchievements(i.userPartial())}):i.processQueuedAchievements(i.userPartial()));r.state==="fulfilled"&&i.userPartialV1Dot1().areAdsEnabledForUser()?i.adsPartial(new AdsPartial(r.value,f?f.permission:!1)):i.adsPartial(new AdsPartial([]))}}).fin(function(){i.userLoadedDeferred.resolve(null)}).done();Q.all([u.deferred.promise,f.deferred.promise,r.deferred.promise]).spread(function(n,r,u){i.menuPartial(new MenuPartial(i._menuService,n,r,u,t))}).done()},t.prototype.processQueuedAchievements=function(n){var i=this,r=Q.defer(),t;(window.location.href.indexOf(Urls.error)!==-1||appViewModel&&appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().isInTutorialMode()&&appViewModel.tutorialPartial().tutorialStep()!==TutorialStep.Reward)&&r.resolve([]);t=Enumerable.from(this.achievementProgressesPartial().getItems()).where(function(n){return!n.isClaimed()&&n.completed}).toArray();this.onSpecificModalsProcessedDeferred.promise.then(function(){t.length>0&&i.showAchievementQueueModal(t,n.picture,Enumerable.from(i.achievementProgressesPartial().getItems()).count(function(n){return n.completed})).done()}).done();this.specificModalsProcessing()||this.onSpecificModalsProcessedDeferred.resolve(!0)},t.prototype.initLeagueAndTeamData=function(n,t){var i=this,h=this._leagueSettingsService.getByLeagueId(t.id,t.seasonNr,!0),u,r,f,e,o,s;n.add(h).then(function(n){t.settings=n}).fail(function(){appViewModel.redirect(RedirectionFlow.Reset)}).done();u=this._leagueTypesService.getById(t.leagueTypeId,!0);n.add(u).done();Q.all([h.deferred.promise,u.deferred.promise]).spread(function(n,r){t.settings=n;t.leagueType=r;i.leaguePartial(new LeaguePartial(t));i.surfacingPartial().setLeaguePartial(i.leaguePartial());i.isLeagueModerator()&&WebApi.getInstance().execute(i._entryRequestsService.getByLeague(SessionManager.getLeagueId(),!0)).then(function(n){i.entryRequestsPartial(new EntryRequestsPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();r=this._teamsService.getByLeague(t.id,!0);n.add(r).fail(function(){return i.redirect(RedirectionFlow.Reset)}).done();f=this._teamFinancesService.getBalanceAndSavingsByTeam(t.id,SessionManager.getTeamId());n.add(f).fail(function(){return i.redirect(RedirectionFlow.Reset)}).done();Q.all([r.deferred.promise,f.deferred.promise]).spread(function(n,t){i.surfacingPartial().setTeamsPartial(n);var r=Enumerable.from(n).single(function(n){return n.id===SessionManager.getTeamId()});r.finance=t;i.teamPartial(new TeamPartial(r));i.clubFundsWalletPartial(new ClubFundsWalletPartial(i._teamFinancesService,i._stadiumService,i.teamPartial))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();e=this._managersService.getByLeagueWithoutPoints(SessionManager.getLeagueId(),!0);n.add(e).done();o=this._matchesService.getByTeamLeagueAndCup(t.id,SessionManager.getTeamId(),!0);n.add(o).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();s=this._countdownTimerService.getAll(t.id,SessionManager.getTeamId(),!0);n.add(s).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();Q.all([s.deferred.promise,r.deferred.promise,e.deferred.promise,o.deferred.promise]).spread(function(n,r,u,f){var e,o,s,h;i.surfacingPartial().setMatchesPartial(f);e=new LeaguePartial(t);o=Enumerable.from(f).firstOrDefault(function(n){return n.weekNr===t.weekNr&&(n.homeTeamId===SessionManager.getTeamId()||n.awayTeamId===SessionManager.getTeamId())});o&&i.lastMatchPartial(new MatchPartial(o));e.isLastDay?i.setCountdownTimersPartial(null,n,e):(s=Enumerable.from(f).where(function(n){return(n.weekNr===e.nextPositiveWeekNr||n.weekNr===e.nextPositiveWeekNr+1)&&(n.homeTeamId===SessionManager.getTeamId()||n.awayTeamId===SessionManager.getTeamId())}).orderBy(function(n){return n.weekNr}).firstOrDefault(),s&&(h=MatchFactory.createMatchForTeam(SessionManager.getLeagueId(),SessionManager.getTeamId(),[s],r,u),i.setCountdownTimersPartial(h,n,e),i.nextMatchPartial(new MatchPartial(h))))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(function(){i.userAndLeagueAndTeamDataLoadedDeferred.resolve(null)});this.createNotificationsBatch(n)},t.prototype.setCountdownTimersPartial=function(n,t,i){var u=Enumerable.from(t).firstOrDefault(function(n){return n.type===CountdownTimerType.NextMatch}),f=Enumerable.from(t).firstOrDefault(function(n){return n.type===CountdownTimerType.NextRound}),r;f&&i&&!i.isInPreparation?this.nextRoundCountdownTimerPartial(new CountdownTimerPartial(f)):u&&this.nextRoundCountdownTimerPartial(new CountdownTimerPartial(u));r=new CountdownTimerNextMatch;r.countdownTimer=u;r.match=n;this.countdownTimersPartial(new CountdownTimersPartial(r,t))},t.prototype.exchangeBossCoinsToClubFundsWhenNeeded=function(n,t,i,r,u,f,e){var l,c;r===void 0&&(r=0);u===void 0&&(u=!0);f===void 0&&(f="");e===void 0&&(e={});var o=Q.defer(),s=this.clubFundsWalletPartial().calculateBossCoinConversionCount(t,i),h=s+r;return s>0?appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&!appViewModel.leaguePartial().settingsPartial().isBossCoinCompletionAllowed?(new NotEnoughClubFundsModal(0,0,!1).show(),l=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("LoggedInViewModel.exchangeBossCoinsToClubFundsWhenNeeded.deferred: Boss Coin completion turned off when trying to exchange BC to CF."),o.reject(l)):(c=this.clubFundsWalletPartial().calculateClubFundsShortageForPrice(t),u?(LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(i.name,h,e),new NotEnoughClubFundsModal(this.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(t),h).show().then(function(){o.resolve(new BossCoinConversion(s,h,c,i,n))}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("LoggedInViewModel.exchangeBossCoinsToClubFundsWhenNeeded.deferred: NotEnoughClubFundsModal rejected.");o.reject(n)}).done()):o.resolve(new BossCoinConversion(s,h,c,i,n))):o.resolve(new BossCoinConversion),o.promise},t.prototype.showAchievementQueueModal=function(n,t,i){var u=this,r=Q.defer();return layoutInitialisedDeferred.promise.then(function(){var f=new AchievementProgressesPartial(n,u._achievementsService),e=ko.observable(u.achievementProgressesPartial().count()),o=new AchievementModal(f,e,i,t);o.show().then(function(){return r.resolve(!0)}).fail(function(){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("AchievementModal show failed");r.reject(n)}).done()}).done(),r.promise},t.prototype.executePaidAction=function(n){n.then(function(n){n&&(appViewModel.refreshBossCoinsWallet().done(),appViewModel.refreshClubFundsWallet())}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done()},t.prototype.refreshTimers=function(){var n=this;SessionManager.getLeagueId()!==0&&SessionManager.getTeamId()!==0&&(CacheHandler.getInstance().removeKeysStartingWith(CacheKey.CountdownTimers),WebApi.getInstance().execute(this._countdownTimerService.getAll(SessionManager.getLeagueId(),SessionManager.getTeamId(),!0)).then(function(t){n.countdownTimersPartial().refreshTimers(t)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done())},t.prototype.refreshNotifications=function(){var n=new WebApiBatch;this.createNotificationsBatch(n);n.execute()},t.prototype.createNotificationsBatch=function(n){var t=this,r=this._eventNotificationsService.getAll(!0),i;n.add(r);i=this._notificationService.getByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId());n.add(i);Q.allSettled([r.deferred.promise,i.deferred.promise]).spread(function(n,i){t.webAndEventNotificationsPartial(new WebAndEventNotificationsPagingPartial(t._notificationService,i.value,n.value));t.isShopEventActive(t.webAndEventNotificationsPartial().hasActiveEvent(EventNotificationType.Shop))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.refreshEntryRequests=function(){var n=this;CacheHandler.getInstance().removeKeysStartingWith(CacheKey.EntryRequests);WebApi.getInstance().execute(this._entryRequestsService.getByLeague(SessionManager.getLeagueId(),!0)).then(function(t){n.entryRequestsPartial(new EntryRequestsPartial(t))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.refreshBossCoinsWallet=function(){var n=this;return CacheHandler.getInstance().removeKey(CacheKey[CacheKey.BossCoinWallet]),WebApi.getInstance().execute(this._bossCoinsService.getByIdentity()).then(function(t){return t&&(n.bossCoinWalletPartial().updateWallet(t),LeanplumHelper.getInstance().setUserAttributes({BCAmount:n.bossCoinWalletPartial().amount})),t})},t.prototype.refreshClubFundsWallet=function(){var n=this;return SessionManager.getLeagueId()===0&&SessionManager.getTeamId()===0?null:WebApi.getInstance().execute(this._teamFinancesService.getBalanceAndSavingsByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId())).then(function(t){n.teamPartial().finance=t;n.teamPartial().financePartial(new TeamFinancePartial(t));n.clubFundsWalletPartial().updateProgress();var i=t.balance+t.savings,r={};return r["CFAmountS"+SessionManager.getInstance().session.slotIndex]=i?i:null,LeanplumHelper.getInstance().setUserAttributes(r),t})},t.prototype.calculateSimulationForecastTimestamp=function(n){if(!this.leaguePartial())return 0;var t=n-this.leaguePartial().weekNr-1;return Helper.addDaysToTimeStamp(this.leaguePartial().simulationForecastTimestamp,t)},t.prototype.calculateSimulationState=function(n){if(!this.leaguePartial())return MatchSimulationState.Upcoming;if(n<=this.leaguePartial().weekNr)return MatchSimulationState.Finished;if(n===this.leaguePartial().weekNr+1){var t=Math.ceil(this.calculateSimulationForecastTimestamp(n)-appViewModel.now().getTime()/1e3);if(t<-1800)return MatchSimulationState.Delayed;if(t<0)return MatchSimulationState.InProgress;if(t<1800)return MatchSimulationState.Soon}return MatchSimulationState.Upcoming},t.prototype.showActivateAccountModal=function(n,t){n===void 0&&(n="");t===void 0&&(t="");this.activateAccountModal||(this.activateAccountModal=new ActivateAccountModal(this.accountService,this.redirectionService,t,n));$(".modal").modal("hide");this.activateAccountModal.show()},t.prototype.showPmModal=function(n){n===void 0&&(n="");this.pmModal().show(n)},t.prototype.daysUntilCrewsIsUnlocked=function(){if(!this.gameSettingsPartial()||!this.userPartial()||this.crewPartial()&&this.crewPartial().id>0)return 0;var t=Helper.calculateDaysSinceTimestamp(this.userPartial().signUpTimestamp,!0),n=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.TeamSlotUnlock,"UnlockCrews");return n===null||n===undefined?0:this.showCrewNotification()?0:n.value>t?n.value-t:0},t.prototype.setPopover=function(n){return this.currentPopover(n),n.show()},t.prototype.goToCrews=function(){if(!(this.daysUntilCrewsIsUnlocked()>0)){if(this.crewPartial()&&this.crewPartial().id){window.location.href=Helper.replaceText(Urls.crewProfile,[new KeyValuePair("crewId","")]);return}window.location.href=Urls.crewLandingPage}},t.prototype.switchSlot=function(n,t,i,r,u){var e=this,f,o;if(t===void 0&&(t=SwitchSlotFlow.Normal),i===void 0&&(i=!1),appViewModel.userPartialV1Dot1()&&appViewModel.userPartialV1Dot1().teamSlotsPartial()){if(i){window.location.href=Urls.crewBattle;return}(f=appViewModel.userPartialV1Dot1().teamSlotsPartial().getByIndex(n),f&&!f.isUnavailable)&&($.removeCookie("agent_choices_shown",{path:"/"}),f.league&&f.league.id!==0&&SessionManager.getLeagueId()===f.league.id&&SessionManager.getInstance().session.slotIndex===n?WebApi.getInstance().execute(this._leaguesService.getByLeagueId(f.league.id)).then(function(i){var o,s,h;if(i.seasonNr===f.leaguePartial().seasonNr&&i.weekNr===f.leaguePartial().weekNr){e.redirectToSlot(t,r,u);return}if(i.seasonNr!==f.leaguePartial().seasonNr){WebApiConfig.getInstance().removeAccessToken();CacheHandler.getInstance().removeKey(CacheKey[CacheKey.UserWithTeamSlots]);o=new WebApiBatch;s=e._usersService.getAccountByIdentity(!1);o.add(s);h=e._usersV1Dot1Service.getByIdentity();o.add(h);Q.all([s,h]).spread(function(i,o){e.userPartial(new UserPartial(i));e.userPartialV1Dot1(new WebApiV1Dot1.UserPartial(o));f=e.userPartialV1Dot1().teamSlotsPartial().getByIndex(n);e.switchSlotAndLoadData(n,f,t,r,u)}).fail(function(){}).done();o.execute();return}e.switchSlotAndLoadData(n,f,t,r,u)}).fail(function(){CacheHandler.getInstance().removeKey(CacheKey[CacheKey.UserWithTeamSlots]);SessionManager.getInstance().resetLeagueAndTeam();e.redirectToSlot(t,r,u)}).done():(o=LeagueMode.Normal,t===SwitchSlotFlow.CreateCrewLeague&&(o=LeagueMode.Crew),$.cookie(CookieHelper.CookieKeys.createLeagueMode,o,{path:"/"}),f.emptyTeamSlotLayout()===TeamSlotLayout.VipLeague&&(t=SwitchSlotFlow.VipLeagueTicket),this.switchSlotAndLoadData(n,f,t,r,u)))}},t.prototype.switchSlotAndLoadData=function(n,t,i,r,u){var l=this,o;appViewModel.clearAccountSlotCache();appViewModel.lastMatchPartial(null);var s=t.leaguePartial()&&t.leaguePartial().leagueTypePartial()?t.leaguePartial().leagueTypePartial().id:0,h=t.leaguePartial()&&t.leaguePartial().leagueTypePartial()?t.leaguePartial().leagueTypePartial().name:"",c=t.teamPartial()?t.teamPartial().name:"",f=t.leaguePartial()&&t.leaguePartial().leagueTypePartial()?t.leaguePartial().leagueTypePartial().baseLeagueThemeType:BaseLeagueThemeType.Default,e=t.leaguePartial()&&t.leaguePartial()?t.leaguePartial().mode:LeagueMode.Normal;if(t.daysUntilUnlockable>0&&!(t.leaguePartial()&&t.teamPartial())){if(!appViewModel.hasInvites()){new BaseAlertModal(ModalTemplate.AccountSlotLocked).show().done();return}SessionManager.modifyOrCreateSession(this.userPartialV1Dot1().id,this.userPartialV1Dot1().login,0,0,n,null,s,h,c,f,e)}else t.leaguePartial()&&t.teamPartial()?SessionManager.modifyOrCreateSession(this.userPartialV1Dot1().id,this.userPartialV1Dot1().login,t.leaguePartial().id,t.teamPartial().id,n,null,s,h,c,f,e):SessionManager.modifyOrCreateSession(this.userPartialV1Dot1().id,this.userPartialV1Dot1().login,0,0,n,null,0,"","",f,e);o=new PreLoaderModal;o.show();o.loadData().fail(function(){}).fin(function(){l.redirectToSlot(i,r,u)}).done()},t.prototype.redirectToSlot=function(n,t,i){if(n===void 0&&(n=SwitchSlotFlow.CreateCrewLeague),i&&(!t||t&&t.id===0))window.location.href=Urls.chooseLeague;else if(n===SwitchSlotFlow.CreateCrewLeague&&(!t||t&&t.id===0))appViewModel.redirect(RedirectionFlow.CreateCrewLeague);else if(n===SwitchSlotFlow.JoinCrewLeague&&t&&t.id>0)t.navigateToChooseTeam();else{if(n===SwitchSlotFlow.WinnersLeagueTicket||n===SwitchSlotFlow.VipLeagueTicket){window.location.href=Urls.chooseLeague+"#other-tickets";return}appViewModel.redirect(RedirectionFlow.AccountSelect)}},t.prototype.syncServerTime=function(n){this._now(new Date(n))},t.prototype.logout=function(){this.authService.logout();window.location.href=Urls.logout},t}(AppViewModel);$(function(){Q.onerror=function(n){n&&n.error!=null&&n.reason!=null?ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleUnhandledRejection(n):ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}});var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),IncentiveProviderCountryPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(IncentiveProviderCountry),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),IncentiveProviderCountriesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new IncentiveProviderCountryPartial(n))});this.setItems(t)},t.prototype.getIncentiveProviderCountryPartialForSpotByWeight=function(n){var i,t;if(this.getItems().length===0)return null;if(i=Enumerable.from(this.getItems()).where(function(t){return t.spot===n}).toArray(),i.length<=1)return Enumerable.from(i).firstOrDefault();var r=Enumerable.from(i),f=r.sum(function(n){return n.weight}),e=Math.random()*f,u=0;for(t=0;t<=r.count();t++)if(u+=r.elementAt(t).weight,e<=u)return r.elementAt(t);return null},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),IncentiveProviderPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(IncentiveProvider),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),IncentiveProvidersPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new IncentiveProviderPartial(n))});this.setItems(t)},t.prototype.getIncentiveProviderForSpot=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.defaultSpot===n})},t}(PartialArrayViewModel),IncentiveProviderService=function(){function n(){}return n.prototype.getAllActive=function(n){var t=(new breeze.EntityQuery).from("incentiveprovider/"+n);return RequestItemFactory.getInstance().createRequestItem(t,!0)},n}(),IncentiveProviderCountriesService=function(){function n(){}return n.prototype.getAllActiveForCountry=function(n){var t=(new breeze.EntityQuery).from("incentiveprovidercountry/"+n);return RequestItemFactory.getInstance().createRequestItem(t,!0)},n}()