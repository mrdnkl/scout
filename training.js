var TrainingSessionService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i){return i?CacheKey[CacheKey.TrainingSessionsOngoing]+"_"+n.toString()+"_"+t.toString():null},n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/trainingsessions");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getOngoing=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/trainingsessions/ongoing");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,t,i),!0)},n.prototype.start=function(n,t,i,r,u){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions",HttpMethod.Post,{playerId:i,trainer:r,timerGameSettingId:u})},n.prototype.boost=function(n,t,i,r){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions/"+i+"/boost",HttpMethod.Put,{productId:r})},n.prototype.claim=function(n,t,i){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions/"+i+"/claim",HttpMethod.Put)},n}(),TrainingForecastsService=function(){function n(){}return n.prototype.getForPlayer=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+t+"/player/"+n+"/trainingforecast");return RequestItemFactory.getInstance().createRequestItemSingle(i)},n.prototype.getForTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/trainingforecasts");return RequestItemFactory.getInstance().createRequestItem(i)},n}(),PlayersService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getSuspendedPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/suspended");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getInjuredPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/injured");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getBasePlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagueTypes/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getTopscorersByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/topscorers/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getAssistsByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/assists/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.sell=function(n,t,i,r){var u={playerId:i,price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/sell",HttpMethod.Put,u)},n.prototype.lineup=function(n,t,i,r){var u={lineup:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/lineup",HttpMethod.Put,u)},n.prototype.clearlineup=function(n,t){return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/players/clearlineup",HttpMethod.Put)},n.prototype.getPlayersForMatch=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/matches/"+t+"/"+i+"/players");return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.assignSquadNumber=function(n,t,i,r){var u={squadNumber:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/assignsquadnumber",HttpMethod.Put,u)},n.prototype.getBestPerformingPlayers=function(n){var t=(new breeze.EntityQuery).from("leagues/"+n+"/players/bestperformingplayers");return RequestItemFactory.getInstance().createRequestItem(t)},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainPlayerModal=function(n){function t(t,i,r,u){r===void 0&&(r=!0);u===void 0&&(u=!0);var f=n.call(this,{template:ModalTemplate.TrainPlayer,showCloseButton:r,hideOnBackdropClick:u})||this;return f.highlightedPlayerPartial=ko.observable(),f.playersPartial=t,f.highlightedPlayerPartial(i),f.shownEventFunction=function(){f.highlightedPlayerPartial()&&f.scrollToHighlightedPlayerPlayer()},f.hideEventFunction=function(){if(f._playerSelectedDeferred.promise.isPending()){var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("TrainPlayerModal.hideEventFunction._playerSelectedDeferred: Hiding TrainPlayer modal.");f._playerSelectedDeferred.reject(n)}},f}return __extends(t,n),t.prototype.setPlayer=function(n,t,i){var r=this;n.isInjured()||(n.isInLineup()?new ConfirmModal(Helper.replaceText(t,[new KeyValuePair("Player",n.name)]),Helper.replaceText(i,[new KeyValuePair("Player",n.name)])).show().then(function(){r.setPlayerConfirmed(n)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done():this.setPlayerConfirmed(n))},t.prototype.setPlayerConfirmed=function(n){n.isAvailable&&(this._playerSelectedDeferred.resolve(n),this.hide())},t.prototype.show=function(){return this._playerSelectedDeferred=Q.defer(),n.prototype.show.call(this),appViewModel&&appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingOpenModal&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingSelectPlayer),this._playerSelectedDeferred.promise},t.prototype.scrollToHighlightedPlayerPlayer=function(){var t=$("#modal-dialog-trainplayer .tutorial-forced-child"),n=$("#modal-dialog-trainplayer .modal-body");t&&n&&t.offset()&&n.offset()&&n.animate({scrollTop:t.offset().top-n.offset().top},500)},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),HireTrainerModal=function(n){function t(){return n.call(this,{template:ModalTemplate.HireTrainer})||this}return __extends(t,n),t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProgressPartial=function(n){function t(t){var i=n.call(this)||this;return i.isAnimating=ko.observable(!1),i.progressPercentage=ko.observable(),i.animatedProgressIncrease=ko.observable(0),i.totalPercentage=ko.computed(function(){return i.progressPercentage()+i.progressForecast}),i.forecastPercentage=ko.observable(),Helper.copyProperties(t,i),i.progressPercentage(i.progress),i.forecastPercentage(i.totalPercentage()>100?100-i.progress:i.progressForecast),i}return __extends(t,n),t.prototype.animate=function(){var n=this,i=Q.defer(),t,r;return this.isAnimating(!0),t=0,r=setInterval(function(){n.progressPercentage(n.progressPercentage()+1);n.forecastPercentage()>0&&n.forecastPercentage(n.forecastPercentage()-1);n.animatedProgressIncrease(n.animatedProgressIncrease()+1);n.progressPercentage()>=100&&(n.progressPercentage(0),n.level++);t++;t>=n.totalProgressIncrease&&(clearInterval(r),setTimeout(function(){i.resolve(!0);n.isAnimating(!1)},1e3))},10),i.promise},t}(Progress),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPartial=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this,h,c,s,l,a;return o.isAttacker=!1,o.isMidfielder=!1,o.isDefender=!1,o.isGoalKeeper=!1,o.isAvailable=ko.observable(!1),o.isInjured=ko.observable(!1),o.isSuspended=ko.observable(!1),o.lineupNr=ko.observable(0),o.isInLeague=!1,o.isSessionPlayer=!1,o.statMain=0,o.imageLarge=ko.observable(),o.daysUnavailable=ko.observable(0),o.quickSellSellPrice=ko.observable(0),o.isOnTransferList=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.transferPlayerPartial()?!0:!1}),o.isInNegotiation=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.offersPartial()?o.offersPartial().getItems().length>0:!1}),o.isInTraining=ko.computed(function(){return o.trainingSessionsPartial()?o.trainingSessionsPartial().currentTrainingSession()!==null&&!o.trainingSessionsPartial().currentTrainingSession().countdownTimerPartial().claimed():!1}),o.isInSelection=ko.computed(function(){return o.lineupNr()>0}),o.isInLineup=ko.computed(function(){return o.lineupNr()>0&&o.lineupNr()<=11}),o.isOnBench=ko.computed(function(){return o.isInSelection()&&!o.isInLineup()}),o.squadNumberObservable=ko.observable(),o.squadNumbersEnabled=LeanplumHelper.getInstance().getVariables("Settings","SquadNumbersEnabled",!1),o.nameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.name:o.squadNumberObservable()+". "+o.name}),o.fullNameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.fullName:o.squadNumberObservable()+". "+o.fullName}),o.squadOrLineupNumber=ko.pureComputed(function(){var n=o.squadNumbersEnabled?o.squadNumberObservable():o.lineupNr();return n===0?"":""+n}),o.nameWithSquadNumberForMatch=ko.pureComputed(function(){return o.playerGradePartial()&&o.playerGradePartial().squadNumber!==0?o.playerGradePartial().squadNumber+". "+o.name:o.name}),Helper.copyProperties(t,o),o.daysUnavailable(o.unavailable),i&&(o._playersService=i),r&&(o._offersService=r),o.nationality&&o.nationalityPartial(new NationalityPartial(o.nationality)),o.team&&o.teamPartial(new TeamPartial(o.team)),h=LeanplumHelper.getInstance().getVariables("Settings","AssetsPlayersEnabled",!0),o.assets&&h&&o.assetsPartial(new AssetsPartial(o.assets)),o.foul&&o.foulPartial(new FoulPartial(o.foul)),o.injury&&o.injuryPartial(new InjuryPartial(o.injury)),o.doctorTreatment&&o.doctorTreatmentPartial(new DoctorTreatmentPartial(o.doctorTreatment)),o.doctorTreatments&&o.doctorTreatmentsPartial(new DoctorTreatmentsPartial(o.doctorTreatments)),o.trainingSessions&&o.trainingSessionsPartial(new TrainingSessionsPartial(o.trainingSessions,u,e)),o.transferPlayer&&o.transferPlayerPartial(new TransferPlayerPartial(o.transferPlayer,f)),o.playerGrade&&o.playerGradePartial(new PlayerGradePartial(o.playerGrade)),o.playerGrades&&o.playerGradesPartial(new PlayerGradesPartial(o.playerGrades)),o.training&&o.trainingForecastPartial(new TrainingForecastPartial(o.training)),o.offers&&o.offersPartial(new OffersPartial(o.offers)),o.isAttacker=o.position===PlayerPosition.A,o.isMidfielder=o.position===PlayerPosition.M,o.isDefender=o.position===PlayerPosition.D,o.isGoalKeeper=o.position===PlayerPosition.G,o.isAvailable(o.status===PlayerStatus.Available),o.isInjured(o.status===PlayerStatus.Injured),o.isSuspended(o.status===PlayerStatus.Suspended),o.lineupNr(o.lineup),o.isInLeague=o.leagueId===SessionManager.getLeagueId(),o.isSessionPlayer=o.isInLeague&&o.teamId===SessionManager.getTeamId(),o.statMain=o.isAttacker?o.statAtt:o.isMidfielder?o.statOvr:o.statDef,o.assets&&h&&(c=Enumerable.from(o.assets).firstOrDefault(function(n){return n.type===AssetType.NormalPassport}),c!=null&&o.imageLarge(c.path)),s=new Progress,s.level=o.statMain,s.progress=o.trainingProgress,s.progressForecast=o.training?o.trainingForecastPartial().forecast:0,o.trainingProgressPartial(new ProgressPartial(s)),o.isSessionPlayer&&appViewModel&&appViewModel.gameSettingsPartial()&&(l=appViewModel.gameSettingsPartial().getGameSettings(GameVarCategory.Transfer,"QuickSellPricePercentage"),a=Enumerable.from(l).firstOrDefault(function(n){return n.variation===0&&n.increment===0}),o.quickSellSellPrice(o.value*(a.value/100))),o.squadNumberObservable(o.squadNumber),o}return __extends(t,n),t.prototype.setLineup=function(n){this.lineupNr(n)},t.prototype.sell=function(n){var i=this,t=Q.defer(),r;return this._playersService?(WebApi.getInstance().execute(this._playersService.sell(this.leagueId,this.teamId,this.id,n)).then(function(n){i.transferPlayer=n;i.transferPlayerPartial(new TransferPlayerPartial(n,new TransferPlayerService));t.resolve(n);i.addFeedbackToast()}).fail(function(n){WebapiHelper.handleAndAlertError(n);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"PlayerPartial.sell.sellDeferred: Error selling player.");t.reject(i)}).done(),t.promise):(r=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("PlayerPartial.sell.sellDeferred: No playersService when trying to sell a player."),t.reject(r),t.promise)},t.prototype.offer=function(n){if(this._offersService){var t=this._offersService.post(this.leagueId,SessionManager.getTeamId(),this.id,n);return t.deferred.promise.then(function(){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).done(),WebApi.getInstance().execute(t)}},t.prototype.willImproveByTraining=function(){return this.trainingForecastPartial()?this.trainingProgress+this.trainingForecastPartial().forecast>=100:!1},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.transferPlayerPartial()&&this.transferPlayerPartial().playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerToTransferlist,this.transferPlayerPartial().playerPartial().imageLarge(),[{key:"playername",value:this.transferPlayerPartial().playerPartial().name}],this.getPlayerWorldStarLevel(),this.rarity))},t.prototype.getPlayerWorldStarLevel=function(){var t=this,i=LeanplumHelper.getInstance().getVariables("WorldStar"),n=Enumerable.from(i).where(function(n){return t.statMain>=n.value}).firstOrDefault();if(!n)return PlayerWorldStarLevel.None;switch(n.key){case"MinRatingLevel1":return PlayerWorldStarLevel.WorldStar1;case"MinRatingLevel2":return PlayerWorldStarLevel.WorldStar2}},t.prototype.isWorldStar=function(){return this.getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1},t.prototype.isLegend=function(){return this.rarity==PlayerRarity.Legend},t.prototype.isInForm=function(){return this.rarity==PlayerRarity.InForm},t.prototype.getWorldStarClassName=function(){var n=this.getPlayerWorldStarLevel();switch(n){case PlayerWorldStarLevel.WorldStar1:return"world-star-1";case PlayerWorldStarLevel.WorldStar2:return"world-star-2";default:return"no-world-star"}},t.prototype.assignSquadNumber=function(n){var t=this,i=Q.defer();if(this._playersService)return WebApi.getInstance().execute(this._playersService.assignSquadNumber(this.leagueId,this.teamId,this.id,n)).then(function(n){t.squadNumber=n.squadNumber;t.squadNumberObservable(n.squadNumber);n.squadNumber&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.SquadNumberAssigned,t.imageLarge(),[{key:"SquadNumber",value:String(n.squadNumber)}],t.getPlayerWorldStarLevel(),t.rarity));i.resolve(n)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not assign squad number");i.reject(t)}).done(),i.promise},t}(Player),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingForecastPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TrainingForecast),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayersPartial=function(n){function t(t,i,r,u,f){f===void 0&&(f=!1);var e=n.call(this)||this;return e.totalValue=ko.computed(function(){return Enumerable.from(e.getItems()).sum(function(n){return n.value})}),e.attackers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isAttacker}).toArray()}),e.midfielders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isMidfielder}).toArray()}),e.defenders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isDefender}).toArray()}),e.goalkeepers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isGoalKeeper}).toArray()}),e.injured=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isInjured()}).toArray()}),e.suspended=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isSuspended()}).toArray()}),e.currentLineupAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isInLineup()})}),e.currentBenchAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isOnBench()})}),e.isLineupComplete=ko.computed(function(){return e.currentLineupAmount()==11}),e.isBenchComplete=ko.computed(function(){return e.currentBenchAmount()==7}),e._playersService=i,e._offersService=r,f&&(e.sortingEnabled(!0),e.sortOrder=SortOrder.Descending),e.setItemsFromModels(t,i,r,u),e}return __extends(t,n),t.prototype.isLineEligibleForTransfer=function(n){switch(n){case PlayerPosition.A:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.A}).count()>3;case PlayerPosition.D:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.D}).count()>4;case PlayerPosition.M:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.M}).count()>4;case PlayerPosition.G:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.G}).count()>2;default:return!1}},t.prototype.getPlayersEligibleToBePutOnTransferlist=function(){var n=this;return Enumerable.from(this.getItems()).where(function(t){return!t.isOnTransferList()&&n.isLineEligibleForTransfer(t.position)}).toArray()},t.prototype.getReserves=function(){return this.getItems().filter(function(n){return!n.isInSelection()})},t.prototype.getNotInLineup=function(){return this.getItems().filter(function(n){return!n.isInLineup()})},t.prototype.getPlayerBySquadNumber=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.squadNumberObservable()===n})},t.prototype.getByStaffMemberType=function(n){return n===StaffMemberType.AttackerCoach?this.attackers():n===StaffMemberType.MidfielderCoach?this.midfielders():n===StaffMemberType.DefenderCoach?this.defenders():n===StaffMemberType.GoalkeeperCoach?this.goalkeepers():[]},t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.statDef})},t.prototype.orderPlayersByGoals=function(){this.sortItems(function(n){return n.goals})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.statMain})},t.prototype.orderPlayersByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByNationality=function(){this.sortItems(function(n){return n.nationality.code})},t.prototype.orderPlayersByFitness=function(){this.sortItems(function(n){return n.fitness})},t.prototype.orderPlayersByMorale=function(){this.sortItems(function(n){return n.morale})},t.prototype.orderPlayersByLineup=function(){this.sortItems(function(n){return n.lineup})},t.prototype.orderPlayersByAverage=function(){this.sortItems(function(n){return n.averagePlayerGrade})},t.prototype.orderPlayersByGradeForWeek=function(n){this.sortItems(function(t){return t.playerGradesPartial().getGradeForWeek(n)})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.position})},t.prototype.orderPlayersBySuspension=function(){this.sortItems(function(n){return n.isSuspended})},t.prototype.getTopscorers=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.goals},!0)).skip(n).take(t).toArray()},t.prototype.getAssists=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.assists},!0)).skip(n).take(t).toArray()},t.prototype.getPlayers=function(n,t){return Enumerable.from(this.getItems()).skip(n).take(t).toArray()},t.prototype.getOrderedByPlayerGradeLineup=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerGradePartial()!==null&&n.playerGradePartial()!==undefined}).orderBy(function(n){return n.playerGradePartial().lineup}).toArray()},t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new PlayerPartial(n,t,i,null,r))});this.setItems(u)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSessionPartial=function(n){function t(t,i,r){var u=n.call(this)||this,f,e;return u.isFinished=ko.observable(!1),u.isBoosting=ko.observable(!1),u.isClaiming=ko.observable(!1),u.isWatchingVideo=ko.observable(!1),u.watchVideoRewardVariationPartial=ko.observable(),u.watchVideoCapRewardVariation=ko.observable(),u._bosscoinProductName="TrainingBoostCost",u.currentBoostCost=ko.computed(function(){if(!u.countdownTimerPartial()||!appViewModel.bossCoinProductsPartial()||u.countdownTimerPartial().isClaimable())return 0;var n=u.countdownTimerPartial().getBosscoinProductForCurrentIncrement(u._bosscoinProductName);return n?n.value:0}),u._trainingSessionService=i,u._watchVideosService=r,f=appViewModel.actionRewardsPartial().getVideoActionRewardVariationForId(WatchVideoPlacementType.Training),e=appViewModel.actionRewardsPartial().getVideoActionCapRewardVariationForId(WatchVideoPlacementType.Training),u.watchVideoRewardVariationPartial(f),u.watchVideoCapRewardVariation(e),u.setItem(t),u}return __extends(t,n),t.prototype.setItem=function(n){Helper.copyProperties(n,this);this.player?(this.playerPartial(new PlayerPartial(this.player)),this.playerPartial().trainingProgressPartial().totalProgressIncrease=this.progressImprovement):this.playerPartial(null);this.countdownTimer!==undefined&&this.countdownTimer?this.countdownTimerPartial(new CountdownTimerPartial(this.countdownTimer)):this.countdownTimerPartial(null)},t.prototype.boost=function(){var t=this,n,u;if(appViewModel&&appViewModel.leaguePartial()&&appViewModel.leaguePartial().boostTimersAllowed()){if(this.isBoosting(!0),n=this.countdownTimerPartial().getBosscoinProductForCurrentIncrement(this._bosscoinProductName),n==null){this.isBoosting(!1);return}var f=this.countdownTimerPartial().minutesRemaining(),i={TimeLeft:f,TrainingCoach:this.getLeanplumCoachName(),Increment:n.increment},r=this.currentBoostCost();LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(n.name,r,i);appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingConfirmBoost);u=appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().isInTutorialMode();appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.BoostTraining,r,this.playerPartial().name,0,!u,!u,!0,n.name,i).then(function(){WebApi.getInstance().execute(t._trainingSessionService.boost(SessionManager.getLeagueId(),SessionManager.getTeamId(),t.id,n.id)).then(function(u){LeanplumHelper.getInstance().trackBossCoinSpentEvent(n.name,r,i);appViewModel.refreshBossCoinsWallet().done();t.showResult(u)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){t.isBoosting(!1)}).done()}).fail(function(n){appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingConfirmBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingBoost);WebapiHelper.handleAndAlertError(n);t.isBoosting(!1)}).done()}},t.prototype.getLeanplumCoachName=function(){switch(this.trainer){case PlayerPosition.A:return"Attacker";case PlayerPosition.M:return"Midfielder";case PlayerPosition.D:return"Defender";case PlayerPosition.G:return"Goalkeeper";default:return""}},t.prototype.boostTrainingSessionWithVideo=function(){var t=this,i,n;this.isWatchingVideo(!0);i={leagueId:SessionManager.getLeagueId(),teamId:SessionManager.getTeamId(),subjectId:this.id,placement:WatchVideoPlacementType.Training,rewardVariation:this.watchVideoRewardVariationPartial()?this.watchVideoRewardVariationPartial().variation:0,capVariation:this.watchVideoCapRewardVariation()?this.watchVideoCapRewardVariation():0};n=new WatchVideosModal(new IncentiveProviderCountriesService,new IncentiveProviderService,new WatchVideosService,new ActionRewardsService,WatchVideoPlacementType.Training,i);n.show().fail(function(){}).fin(function(){t.isWatchingVideo(!1)}).done();n.videoWatchedRewardAnnouncer.subscribe(function(i){i.then(function(){n.hideEventDeferred.promise.then(function(){t.watchVideoRewardVariationPartial().animateTimestampReduction(t.countdownTimerPartial()).then(function(){appViewModel.refreshTimers()})})}).fail(function(){}).done()})},t.prototype.claim=function(){var n=this;this.isClaiming(!0);WebApi.getInstance().execute(this._trainingSessionService.claim(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(t){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.CompleteTimer,{CompleteTimer:"Training",TrainingCoach:n.getLeanplumCoachName()});n.showResult(t)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){n.isClaiming(!1)}).done()},t.prototype.showResult=function(n){var t=this;this.playerPartial().trainingProgressPartial().totalProgressIncrease=n.player.trainingProgress-this.playerPartial().trainingProgress;this.playerPartial().trainingProgressPartial().totalProgressIncrease<=0&&(this.addFeedbackToast(this.playerPartial()),this.playerPartial().trainingProgressPartial().totalProgressIncrease+=100);n.countdownTimer=null;this.countdownTimerPartial(null);this.playerPartial().trainingProgressPartial().animate().then(function(){t.setItem(n);t.isFinished(!0);appViewModel.refreshTimers();appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingConfirmBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOutro)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.addFeedbackToast=function(n){appViewModel&&appViewModel.toastsPartial&&n&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerTrained,n.imageLarge(),[{key:"playername",value:n.name},{key:"qualitylevel",value:(n.statMain+1).toString()}],n.getPlayerWorldStarLevel(),n.rarity))},t}(TrainingSession),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSessionsPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return u.currentTrainingSession=ko.observable(),u.isFinished=ko.computed(function(){return u.currentTrainingSession()===undefined||u.currentTrainingSession()===null?!1:u.currentTrainingSession().isFinished()}),u.getInProgress=ko.computed(function(){return Enumerable.from(u.getItems()).where(function(n){return n.countdownTimerPartial()&&n.countdownTimerPartial().timerState()===TimerState.InProgress}).toArray()}),u.playerPartialsInProgress=ko.computed(function(){return Enumerable.from(u.getInProgress()).select(function(n){return n.playerPartial()}).toArray()}),u.amountInProgress=ko.computed(function(){return u.getInProgress().length}),u.amountOfFreeTrainers=ko.computed(function(){return 4-u.amountInProgress()}),u.amountFinished=ko.computed(function(){return Enumerable.from(u.getItems()).count(function(n){return n.countdownTimerPartial()&&n.countdownTimerPartial().timerState()===TimerState.Finished})}),u.getFirstFinishingTrainingSession=ko.computed(function(){return Enumerable.from(u.getItems()).orderBy(function(n){return n.countdownTimer!=null&&n.countdownTimer.finishedTimestamp}).firstOrDefault()}),u.setItemsFromModels(t,i,r),u.currentTrainingSession(Enumerable.from(u.getItems()).firstOrDefault(function(n){return!n.countdownTimerPartial().claimed()})),u}return __extends(t,n),t.prototype.getByStaffMemberType=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.staffMember==n}).toArray()},t.prototype.setItemsFromModels=function(n,t,i){var r=[];n.forEach(function(n){r.push(new TrainingSessionPartial(n,t,i))});this.setItems(r)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSlotPartial=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.isStarting=ko.observable(!1),f.isInitialized=ko.observable(!1),f.playerToTrainInTutorialPartial=ko.observable(),f.updatePlayer=ko.computed(function(){if(f.isInitialized()&&f.trainingSessionsPartial()!==null&&f.trainingSessionsPartial().currentTrainingSession()!==null&&f.trainingSessionsPartial().currentTrainingSession().isFinished()){var n=new PlayerPartial(f.trainingSessionsPartial().currentTrainingSession().playerPartial());f.playersPartial().removeItemByFunction(function(t){return t.id===n.id});f.playersPartial().addItem(n);f.playersPartial().sortItems(function(n){return n.statMain},null,SortOrder.Descending)}}),f.trainingCost=ko.computed(function(){if(appViewModel.teamPartial()===undefined||appViewModel.teamPartial()===null||appViewModel.gameSettingsPartial()===undefined||appViewModel.gameSettingsPartial()===null)return 0;var n=appViewModel.gameSettingsPartial().getValue(GameVarCategory.ClubFundsPrice,"Trainer"),t=appViewModel.teamPartial().budget;return Math.ceil(t*(n/100))}),f._trainingSessionService=i,f._trainingForecastsService=r,f._watchVideosService=u,Helper.copyProperties(t,f),f.players&&(f.playersPartial(new PlayersPartial(f.players,null,null,null,!0)),f.playersPartial().orderPlayersByMain()),f.trainingSessions&&f.trainingSessionsPartial(new TrainingSessionsPartial(f.trainingSessions,f._trainingSessionService,f._watchVideosService)),f.isInitialized(!0),f}return __extends(t,n),t.prototype.selectPlayer=function(){var t=this,n,i;this.isStarting(!0);this.clear();n=appViewModel.tutorialPartial()&&(appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingSelectPlayer||appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingOpenModal);i=new TrainPlayerModal(this.playersPartial,this.playerToTrainInTutorialPartial(),!n,!n);i.show().then(function(n){t.startTraining(n)}).fail(function(){t.isStarting(!1);n&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOpenModal)}).done()},t.prototype.startTraining=function(n){var i=this,r=appViewModel.bossCoinProductsPartial().getBossCoinProduct("BossCoinConversionRateTraining"),t,u;if(r==null){this.isStarting(!1);return}t=this.trainingCost();u=appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(t);appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.StartTraining,t,r,0,!0,n.name,this.getLeanplumContext()).then(function(r){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(r,i.getLeanplumContext()).then(function(){appViewModel.executePaidAction(i.executeTraining(n.id,t,u))})}).fail(function(n){WebapiHelper.handleAndAlertError(n);i.isStarting(!1)}).done()},t.prototype.getLeanplumContext=function(){var n="";switch(this.position){case PlayerPosition.A:n="Attacker";break;case PlayerPosition.M:n="Midfielder";break;case PlayerPosition.D:n="Defender";break;case PlayerPosition.G:n="Goalkeeper"}return{TrainingCoach:n}},t.prototype.executeTraining=function(n,t,i){var r=this,f=appViewModel.gameSettingsPartial()?appViewModel.gameSettingsPartial().getTimerId("TrainingSession"):0,u=Q.defer();return WebApi.getInstance().execute(this._trainingSessionService.start(SessionManager.getLeagueId(),SessionManager.getTeamId(),n,this.position,f)).then(function(n){LeanplumHelper.getInstance().trackClubFundsSpentEvent(LeanplumHelper.ClubFundsProductType.Training,i,t,r.getLeanplumContext());var f=new TrainingSessionPartial(n,r._trainingSessionService,r._watchVideosService);r.trainingSessionsPartial().addItem(f);r.trainingSessionsPartial().currentTrainingSession(f);u.resolve(!0);appViewModel.refreshTimers();appViewModel.refreshNotifications();appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingSelectPlayer&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingClaimBossCoins)}).fail(function(n){var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"could not start training session");u.reject(t)}).fin(function(){r.isStarting(!1)}).done(),u.promise},t.prototype.clear=function(){},t}(TrainingSlot),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSlotsPartial=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.setItemsFromModels(t,i,r,u),f}return __extends(t,n),t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new TrainingSlotPartial(n,t,i,r))});this.setItems(u)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingView=function(n){function t(t,i,r,u){var f=n.call(this,LeanplumTrackingService.State.Training)||this,e,o,s;return f.trainingSlotsPartial=ko.observable(),f._isInitialized=ko.observable(!1),f._shouldScrollToBalloonOnStepChanged=ko.observable(!0),f._playerToTrainInTutorialPartial=ko.observable(),f._playersPartial=ko.observable(),f.watchVideoRewardVariationPartial=ko.observable(),f.watchVideoCapRewardVariation=ko.observable(),f.onTutorialPartialInitialized=ko.computed(function(){if(appViewModel&&appViewModel.tutorialPartial()&&f._isInitialized()&&appViewModel.tutorialPartial().isInTutorialMode()){if(f._playerToTrainInTutorialPartial(f.getPlayerToTrainInTutorial(f._playersPartial())),f._playerToTrainInTutorialPartial()){var n=Enumerable.from(f.trainingSlotsPartial().getItems()).firstOrDefault(function(n){return n.position===f._playerToTrainInTutorialPartial().position});n.playerToTrainInTutorialPartial(f._playerToTrainInTutorialPartial())}appViewModel.tutorialPartial().hideLoadingOverlay()}}),f.onTutorialStepChanged=ko.computed(function(){if(appViewModel&&appViewModel.tutorialPartial()&&appViewModel.bossCoinProductsPartial()&&f._isInitialized())if(appViewModel.tutorialPartial().tutorialStep()<TutorialStep.TrainingIntro)appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingIntro);else if(appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingIntro)new TutorialModal(DudeType.Trainer).show().then(function(){appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOpenModal)}).done(),appViewModel.tutorialPartial().hideLoadingOverlay();else if(appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingOpenModal&&f.trainingSlotsPartial()){if(f._shouldScrollToBalloonOnStepChanged()){f._shouldScrollToBalloonOnStepChanged(!1);var n=$(".training-slot .tutorial-pointer-container");n&&n.offset()&&$("html, body").animate({scrollTop:n.offset().top-$("#header").height()-$("#subheader").height()-10},500)}}else appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingClaimBossCoins?appViewModel.tutorialPartial().getReward().then(function(n){new TutorialModal(DudeType.Trainer,[new KeyValuePair("playername",f._playerToTrainInTutorialPartial()?f._playerToTrainInTutorialPartial().name:"")],n).show().then(function(){appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingBoost)}).done()}).done():appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingOutro&&new TutorialModal(DudeType.Trainer,[new KeyValuePair("playername",f._playerToTrainInTutorialPartial()?f._playerToTrainInTutorialPartial().name:"")]).show().then(function(){appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingGoHome)}).done()}).extend({rateLimit:100}),e=new WebApiBatch,o=t.getOngoing(SessionManager.getLeagueId(),SessionManager.getTeamId()),e.add(o),s=i.getByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId()),e.add(s),Q.all([o.deferred.promise,s.deferred.promise]).spread(function(n,i){var e=[];e.push(f.createTrainingSlot(n,i,StaffMemberType.AttackerCoach,PlayerPosition.A));e.push(f.createTrainingSlot(n,i,StaffMemberType.MidfielderCoach,PlayerPosition.M));e.push(f.createTrainingSlot(n,i,StaffMemberType.DefenderCoach,PlayerPosition.D));e.push(f.createTrainingSlot(n,i,StaffMemberType.GoalkeeperCoach,PlayerPosition.G));f.trainingSlotsPartial(new TrainingSlotsPartial(e,t,r,u));f._playersPartial(new PlayersPartial(i));appViewModel&&appViewModel.tutorialPartial()&&(appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingConfirmBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingBoost),appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingSelectPlayer&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOpenModal));f._isInitialized(!0)}),e.execute(),f}return __extends(t,n),t.prototype.createTrainingSlot=function(n,t,i,r){var u=new TrainingSlot;return u.trainingSessions=Enumerable.from(n).where(function(n){return n.staffMember===i}).toArray(),u.players=Enumerable.from(t).where(function(n){return n.position===r}).toArray(),u.position=r,u},t.prototype.getPlayerToTrainInTutorial=function(n){var t=n.getNotInLineup(),i;return(t.length===0&&(t=n.getItems()),i=Enumerable.from(t).where(function(n){return n.willImproveByTraining()}).orderBy(function(n){return n.age}).firstOrDefault(),i)?i:Enumerable.from(t).orderBy(function(n){return n.age}).firstOrDefault()},t.prototype.openHelpTextModal=function(){new HelpTextModal(ModalTemplate.TrainingHelpText,HelpTextModal.Type.Training).show()},t}(BaseView);window.onload=function(){initLayout().done(function(){$("#cached-html-wrapper-training").load("/Cached/TrainingPartial?v="+buildReleaseVersion,null,function(){ko.bindContentViewModel(new TrainingView(new TrainingSessionService,new PlayersService,new TrainingForecastsService,new WatchVideosService))})})}