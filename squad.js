var PlayersService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getSuspendedPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/suspended");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getInjuredPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/injured");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getBasePlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagueTypes/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getTopscorersByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/topscorers/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getAssistsByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/assists/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.sell=function(n,t,i,r){var u={playerId:i,price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/sell",HttpMethod.Put,u)},n.prototype.lineup=function(n,t,i,r){var u={lineup:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/lineup",HttpMethod.Put,u)},n.prototype.clearlineup=function(n,t){return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/players/clearlineup",HttpMethod.Put)},n.prototype.getPlayersForMatch=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/matches/"+t+"/"+i+"/players");return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.assignSquadNumber=function(n,t,i,r){var u={squadNumber:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/assignsquadnumber",HttpMethod.Put,u)},n.prototype.getBestPerformingPlayers=function(n){var t=(new breeze.EntityQuery).from("leagues/"+n+"/players/bestperformingplayers");return RequestItemFactory.getInstance().createRequestItem(t)},n}(),TeamsService=function(){function n(){}return n.prototype.getCacheKey=function(n,t){return n?CacheKey[CacheKey.Teams]+"_"+t:null},n.prototype.getByLeague=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams");return RequestItemFactory.getInstance().createRequestItem(i,this.getCacheKey(t,n))},n.prototype.getByLeagueFilteredByTeamId=function(n,t,i){i===void 0&&(i=!1);var u=(new breeze.EntityQuery).from("/leagues/"+n+"/teams"),r=RequestItemFactory.getInstance().createRequestItemSingle(u,this.getCacheKey(i,n));return r.predicate=function(n){return n.id===t},r},n.prototype.getTeamsStatistics=function(n){var t=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/statistics");return RequestItemFactory.getInstance().createRequestItem(t,!1)},n.prototype.getAvailable=function(n){var t=(new breeze.EntityQuery).from("leaguetypes/"+n+"/availableteams");return RequestItemFactory.getInstance().createRequestItem(t,!0)},n.prototype.signContractForSlot=function(n,t,i){var r="leagues/"+n+"/teams/"+t+"/signcontract/"+i;return RequestItemFactory.getInstance().createRequestItemSingle(r,HttpMethod.Put)},n.prototype.signContractForVipLeague=function(n,t,i,r){var u="leagues/"+n+"/teams/"+t+"/signcontract/"+i+"/consumereward",f={rewardId:r};return RequestItemFactory.getInstance().createRequestItemSingle(u,HttpMethod.Put,f)},n}(),ManagersService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i,r){return(i===void 0&&(i=!0),r===void 0&&(r=!0),!r)?null:t?CacheKey[CacheKey.Managers]+"_"+n.toString()+"_"+t.toString():i?CacheKey[CacheKey.Managers]+"_"+n.toString():CacheKey[CacheKey.ManagersFetchedWithoutPoints]+"_"+n.toString()},n.prototype.getByLeagueWithPoints=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/managers");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,null,!0,t),i)},n.prototype.getByLeagueWithoutPoints=function(n,t,i){t===void 0&&(t=!1);i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/managerswithoutpoints");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,null,!1,t),i)},n.prototype.getByLeagueAndTeamId=function(n,t,i,r){i===void 0&&(i=!1);r===void 0&&(r=!1);var f=(new breeze.EntityQuery).from("/leagues/"+n+"/managers"),u=RequestItemFactory.getInstance().createRequestItemSingle(f,this.getCacheKey(n,t,!1,i),r);return u.predicate=function(n){return n.teamId===t},u},n.prototype.getAllByIdentity=function(n){n===void 0&&(n=!1);var t=(new breeze.EntityQuery).from("/managers/account");return RequestItemFactory.getInstance().createRequestItem(t,CacheKey[CacheKey.UserManagers])},n.prototype.kickManager=function(n,t){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/managers/"+t+"/sack",HttpMethod.Post)},n.prototype.clearCache=function(n,t){CacheHandler.getInstance().removeKey(this.getCacheKey(n,null,!1,!0));CacheHandler.getInstance().removeKey(this.getCacheKey(n,null,!0,!0));CacheHandler.getInstance().removeKey(this.getCacheKey(n,t,!1,!0))},n}(),OffersService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/offers");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.post=function(n,t,i,r){var u={playerId:i,price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers",HttpMethod.Post,u)},n.prototype.counter=function(n,t,i,r){var u={price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/counter",HttpMethod.Post,u)},n.prototype.accept=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/accept",HttpMethod.Put)},n.prototype.reject=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/reject",HttpMethod.Put)},n.prototype.withdraw=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i,HttpMethod.Delete)},n}(),TrainingSessionService=function(){function n(){}return n.prototype.getCacheKey=function(n,t,i){return i?CacheKey[CacheKey.TrainingSessionsOngoing]+"_"+n.toString()+"_"+t.toString():null},n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/trainingsessions");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getOngoing=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/trainingsessions/ongoing");return RequestItemFactory.getInstance().createRequestItem(r,this.getCacheKey(n,t,i),!0)},n.prototype.start=function(n,t,i,r,u){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions",HttpMethod.Post,{playerId:i,trainer:r,timerGameSettingId:u})},n.prototype.boost=function(n,t,i,r){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions/"+i+"/boost",HttpMethod.Put,{productId:r})},n.prototype.claim=function(n,t,i){return CacheHandler.getInstance().removeKeysStartingWith(CacheKey.TrainingSessionsOngoing),RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/trainingsessions/"+i+"/claim",HttpMethod.Put)},n}(),TransferPlayerService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getByTransferPlayerType=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers/"+i);return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.boostScout=function(n,t,i,r,u,f){var e={productId:i,maxPriceGameSettingId:u,minPriceGameSettingId:f,timerGameSettingId:r};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/boostscout",HttpMethod.Put,e)},n.prototype.claim=function(n,t,i,r,u){var f={timerGameSettingId:i,maxPriceGameSettingId:r,minPriceGameSettingId:u};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/claimscout",HttpMethod.Put,f)},n.prototype.buy=function(n,t,i,r){var u={productId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/buy",HttpMethod.Put,u)},n.prototype.validateTransfer=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/validatetransfer",HttpMethod.Post)},n.prototype.deleteById=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i,HttpMethod.Delete)},n}(),DoctorTreatmentService=function(){function n(){}return n.prototype.getForTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/doctortreatments");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.startDoctorTreatment=function(n,t,i,r){var u={playerId:i,timerGameSettingId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/doctortreatments",HttpMethod.Post,u)},n.prototype.boostDoctorTreatment=function(n,t,i,r){var u={productId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/doctortreatments/"+i+"/boost",HttpMethod.Put,u)},n.prototype.claimDoctorTreatment=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/doctortreatments/"+i+"/claim",HttpMethod.Put)},n}(),TransfersService=function(){function n(){}return n.prototype.getAllTransfers=function(n,t,i){var r=(new breeze.EntityQuery).from("/leagues/"+n+"/transfers?limit="+i+"&offset="+t);return RequestItemFactory.getInstance().createRequestItem(r,!0)},n.prototype.getAllTransfersForWeek=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/transfers/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getAllTransfersForTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/team/"+t+"/transfers");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.quickSell=function(n,t,i,r,u){var f="/leagues/"+n+"/teams/"+t+"/players/"+i+"/quicksell";return RequestItemFactory.getInstance().createRequestItemSingle(f,HttpMethod.Post,{productId:r,pricePercentageGameVariableId:u})},n}(),PlayerGradesService=function(){function n(){}return n.prototype.getByTeamId=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/playergrades/");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getByWeekAndTeamId=function(n,t,i){var r=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+i+"/playergrades/"+t);return RequestItemFactory.getInstance().createRequestItem(r)},n}(),BaseTeamsService=function(){function n(){}return n.prototype.getByLeagueType=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/leagueTypes/"+n+"/teams"),r=t?CacheKey[CacheKey.BaseTeams]+"_"+n:null;return RequestItemFactory.getInstance().createRequestItem(i,r)},n.prototype.getTeamFromLeague=function(n,t,i){i===void 0&&(i=!1);var r=(new breeze.EntityQuery).from("/leagueTypes/"+n+"/teams/"+t),u=i?CacheKey[CacheKey.BaseTeams]+"_"+n+"_"+t:null;return RequestItemFactory.getInstance().createRequestItemSingle(r,i)},n.prototype.filter=function(n){var t=(new breeze.EntityQuery).from("/baseTeams/filter?query="+encodeURIComponent(n));return RequestItemFactory.getInstance().createRequestItem(t,!0)},n.prototype.getLockedSquadNumbers=function(n,t){t===void 0&&(t=!1);var i=(new breeze.EntityQuery).from("/baseteams/"+n+"/lockedsquadnumbers"),r=t?CacheKey[CacheKey.LockedSquadNumbers]+"_"+n:null;return RequestItemFactory.getInstance().createRequestItem(i,r,!0)},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BidPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Bid),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BidsPartial=function(n){function t(t){var i=n.call(this)||this;return i.lastBid=ko.computed(function(){return Enumerable.from(i.getItems()).orderByDescending(function(n){return n.createdAt}).firstOrDefault()}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new BidPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),OfferPartial=function(n){function t(t){var i=n.call(this)||this;return i.notYourTeamPartial=ko.computed(function(){return i.owningTeamId===SessionManager.getInstance().session.teamId?i.biddingTeamPartial():i.owningTeamPartial()}),i.isLatestBidByOwner=ko.computed(function(){return i.bidsPartial()?i.bidsPartial().lastBid().sentBy===BidSentBy.Owner:!1}),i.isIncomingOffer=ko.computed(function(){return i.bidsPartial()?i.owningTeamId===SessionManager.getTeamId():!1}),i.requiresAction=ko.computed(function(){return i.isLatestBidByOwner()&&!i.isIncomingOffer()||!i.isLatestBidByOwner()&&i.isIncomingOffer()}),Helper.copyProperties(t,i),i.player&&i.playerPartial(new PlayerPartial(i.player)),i.bids&&i.bidsPartial(new BidsPartial(i.bids)),i.biddingTeam&&i.biddingTeamPartial(new TeamPartial(i.biddingTeam)),i.owningTeam&&i.owningTeamPartial(new TeamPartial(i.owningTeam)),i}return __extends(t,n),t}(Offer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),OffersPartial=function(n){function t(t){var i=n.call(this)||this;return i.offersWithRequiredAction=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.requiresAction()}).toArray()}),i.owningOffersWithRequiredAction=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.owningTeamId===SessionManager.getTeamId()&&!n.isLatestBidByOwner()}).toArray()}),i.hasOffersBelongingToCurrentSessionTeam=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.owningTeamId===SessionManager.getTeamId()||n.biddingTeamId===SessionManager.getTeamId()})}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new OfferPartial(n))});this.setItems(t)},t.prototype.getLatestOfferForPlayer=function(n){if(this.getItems())return Enumerable.from(this.getItems()).orderByDescending(function(n){return n.createdAt}).firstOrDefault(function(t){return t.playerId===n})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerModal=function(n){function t(t,i){var r=n.call(this,{template:i,screenModeXs:ScreenMode.Normal,showCloseButton:!0,container:ModalContainer.Generic})||this;return r.player=t,r}return __extends(t,n),t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerInNegotiationModal=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.prototype.redirectToOffers=function(n){n&&(window.location.href=Urls.offers+"/"+n.id)},t}(PlayerModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPriceModal=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.viewType=ko.observable(PlayerPriceViewType.Stats),r.price=ko.observable(),r.minPricePercentage=.75,r.maxPricePercentage=2.5,r.minPrice=ko.computed(function(){return r.price()*r.minPricePercentage}),r.maxPrice=ko.computed(function(){return r.price()*r.maxPricePercentage}),r.price(t.value),r}return __extends(t,n),t.prototype.setPrice=function(){var n=this.price();this.price(this.player.value);this.viewType(PlayerPriceViewType.SetPrice);this.price(n)},t.prototype.showStats=function(){this.viewType(PlayerPriceViewType.Stats)},t}(PlayerModal),PlayerPriceViewType,SquadView;(function(n){n[n.Stats=0]="Stats";n[n.SetPrice=1]="SetPrice"})(PlayerPriceViewType||(PlayerPriceViewType={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SellPlayerModal=function(n){function t(t,i,r,u,f){var e,o,s;return u===void 0&&(u=!0),f===void 0&&(f=!1),e=n.call(this,t,ModalTemplate.SellPlayer)||this,e.isSelling=ko.observable(!1),e.shouldAnimateQuickSellRow=ko.observable(!1),e.quickSellBosscoinProduct=ko.observable(),e.quickSellDeferred=Q.defer(),e.areTransfersEnabled=ko.observable(),e._transfersService=i,e._showSurfacing=f,e.areTransfersEnabled(u),o=LeanplumHelper.getInstance().getVariables("Settings","QuicksellAfterAmountOfSignupDays",0),s=Helper.calculateDaysSinceTimestamp(r),s<o&&(isQuickSellEnabled=!1),e.areTransfersEnabled()&&isQuickSellEnabled&&(e.options().centerContentsMobile=!1,e.options.valueHasMutated()),e.shownEventFunction=function(){e.shouldAnimateQuickSellRow(!0)},e.quickSellBosscoinProduct(Enumerable.from(appViewModel.bossCoinProductsPartial().getItems()).firstOrDefault(function(n){return n.name==="QuickSellFee"})),e}return __extends(t,n),t.prototype.show=function(){n.prototype.show.call(this);this._showSurfacing&&new StaffSurfacingModal(SurfacingFollowUp.SquadSellPlayerProfile,DudeType.Assistant).show().done()},t.prototype.sell=function(){var n=this;this.isSelling()||(this.isSelling(!0),this.player.sell(this.price()).fail(function(){}).fin(function(){appViewModel.surfacingPartial().skipSurfacingType(SurfacingType.SquadSellPlayer);n.hide();n.isSelling(!1)}).done())},t.prototype.quickSell=function(){var n=this;this.player&&this.quickSellBosscoinProduct().value!==undefined&&this.player.isSessionPlayer&&appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.QuickSell,this.quickSellBosscoinProduct().value,this.player.fullName,this.player.quickSellSellPrice()).then(function(){WebApi.getInstance().execute(n._transfersService.quickSell(n.player.leagueId,n.player.teamId,n.player.id,n.quickSellBosscoinProduct().id,0)).then(function(t){appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerSoldThroughQuickSell,n.player.imageLarge(),[{key:"PlayerName",value:n.player.name},{key:"ForeignClub",value:t.destinationTeam.name}],n.player.getPlayerWorldStarLevel(),n.player.rarity));n.quickSellDeferred.resolve(!0);appViewModel.refreshBossCoinsWallet();appViewModel.refreshClubFundsWallet()}).fail(function(t){WebapiHelper.handleAndAlertError(t);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(t,"could not quicksell player because of an error");n.quickSellDeferred.reject(i);n.hide()}).done()}).fail(function(){var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Bosscoin payment for quicksell was not confirmed.");n.quickSellDeferred.reject(t)}).done()},t}(PlayerPriceModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),OfferPlayerModal=function(n){function t(t,i,r){var u=n.call(this,t,ModalTemplate.OfferPlayer)||this;return u.isBusy=ko.observable(!1),u.postOfferDeferred=Q.defer(),u._offersService=i,u._existingOffer=r,u}return __extends(t,n),t.prototype.offer=function(){var n=this,t;this.isBusy(!0);t=this._existingOffer?this._offersService.counter(this.player.leagueId,SessionManager.getInstance().session.teamId,this._existingOffer.id,this.price()):this._offersService.post(this.player.leagueId,SessionManager.getInstance().session.teamId,this.player.id,this.price());WebApi.getInstance().execute(t).then(function(t){n._existingOffer?(n._existingOffer.bidsPartial(new BidsPartial(t.bids)),n.hide(),n.isBusy(!1)):(LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer),window.location.href=Urls.offers+"/"+t.id);n.postOfferDeferred.resolve()}).fail(function(t){var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(t,"counter/post offer call failed.");n.postOfferDeferred.reject(i);WebapiHelper.handleAndAlertError(t);n.isBusy(!1)}).done()},t}(PlayerPriceModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerModal=function(n){function t(t,i,r){r===void 0&&(r=null);var u=n.call(this,{template:i,showCloseButton:!0,container:ModalContainer.Generic,screenModeXs:ScreenMode.Normal})||this;return u.player=ko.observable(),u._playerParent=ko.observable(),u.player(t),u._playerParent(r),u.player().isTransferred.subscribe(function(n){n&&u.hide()}),u}return __extends(t,n),t.prototype.removeFromTransferlist=function(){var n=this;this.player().removeFromTransferlist().then(function(t){t&&(n._playerParent()&&(n._playerParent().transferPlayer=null,n._playerParent().transferPlayerPartial(null)),n.hide())}).done()},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferDomesticPlayerModal=function(n){function t(i,r,u){var f=n.call(this,i.playerPartial(),ModalTemplate.BuyDomesticPlayer)||this;return f.transferPlayerPartial=ko.observable(),f._isHiddenDeferred=Q.defer(),f.currentOfferPartial=ko.observable(),f.visibleBottomView=ko.observable(t.BottomViewType.Stats),f.isLoadingBuyAction=ko.observable(!1),f.playerTransferStatusHasBeenChanged=ko.observable(!1),f.minOfferPrice=ko.computed(function(){return!f.transferPlayerPartial()||!f.transferPlayerPartial().playerPartial()?f.price():Math.round(f.transferPlayerPartial().playerPartial().value*f.minPricePercentage)}),f.offerPrice=ko.computed(function(){return!f.transferPlayerPartial()||!f.transferPlayerPartial().playerPartial()||!f.currentOfferPartial()||!f.currentOfferPartial().bidsPartial()||!f.currentOfferPartial().bidsPartial().lastBid()?f.price():f.currentOfferPartial().bidsPartial().lastBid().price}),f.transferPlayerSliderState=ko.computed(function(){return!f.transferPlayerPartial()||f.price()===f.transferPlayerPartial().price?t.TransferPlayerSliderState.SameAsOriginalPrice:f.currentOfferPartial()&&f.currentOfferPartial().bidsPartial()&&f.currentOfferPartial().bidsPartial().lastBid()?f.price()===f.currentOfferPartial().bidsPartial().lastBid().price?f.currentOfferPartial().isLatestBidByOwner()?t.TransferPlayerSliderState.SameAsAlreadyOutstandingCounterOffer:t.TransferPlayerSliderState.SameAsAlreadyOutstandingOffer:f.price()>f.currentOfferPartial().bidsPartial().lastBid().price?t.TransferPlayerSliderState.HigherThanAlreadyOutstandingOffer:t.TransferPlayerSliderState.LowerThanAlreadyOutstandingOffer:f.price()!==f.transferPlayerPartial().price?t.TransferPlayerSliderState.DifferentThanOriginalPrice:void 0}),f.transferPlayerPartial(i),f._offerService=r,f.price(i.price),u&&f.currentOfferPartial(u),f.hiddenEventFunction=function(){if(f.playerTransferStatusHasBeenChanged())f._isHiddenDeferred.resolve();else{var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Player transfer status has not been changed, no update needed");f._isHiddenDeferred.reject(n)}},f.isLoadingBuyAction.subscribe(function(n){n&&f.playerTransferStatusHasBeenChanged(!0)}),f}return __extends(t,n),t.prototype.determineBuyActionForTransferPlayer=function(){if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.DifferentThanOriginalPrice){this.sendOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.HigherThanAlreadyOutstandingOffer||this.transferPlayerSliderState()===t.TransferPlayerSliderState.LowerThanAlreadyOutstandingOffer){window.location.href=Urls.offers;return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsAlreadyOutstandingCounterOffer){this.acceptCounterOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsAlreadyOutstandingOffer){this.withdrawOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsOriginalPrice){this.buyPlayer();return}},t.prototype.show=function(){return n.prototype.show.call(this),this._isHiddenDeferred.promise},t.prototype.sendOffer=function(){var n=this,t;this.isLoadingBuyAction(!0);t=this._offerService.post(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.transferPlayerPartial().playerPartial().id,this.price());WebApi.getInstance().execute(t).then(function(t){n.currentOfferPartial(new OfferPartial(t));LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done(function(){n.isLoadingBuyAction(!1)})},t.prototype.withdrawOffer=function(){var n=this,t;this.isLoadingBuyAction(!0);t=this._offerService.withdraw(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.currentOfferPartial().id);WebApi.getInstance().execute(t).then(function(){n.currentOfferPartial(null)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done(function(){n.isLoadingBuyAction(!1)})},t.prototype.isOutstandingOfferBelowTransferPrice=function(){return!this.currentOfferPartial()||!this.currentOfferPartial().bidsPartial()||!this.currentOfferPartial().bidsPartial().lastBid()?!1:this.currentOfferPartial().bidsPartial().lastBid().price<this.transferPlayerPartial().price},t.prototype.buyPlayer=function(){this.transferPlayerPartial()&&this.transferPlayerPartial().buy()},t.prototype.acceptCounterOffer=function(){var n=this;if(this.currentOfferPartial()&&this.currentOfferPartial().bidsPartial()){this.isLoadingBuyAction(!0);var i=this._offerService.accept(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.currentOfferPartial().id),t=this.currentOfferPartial().bidsPartial().lastBid().price,r=appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(t);WebApi.getInstance().execute(i).then(function(){if(n.currentOfferPartial().isIncomingOffer()){var i=SessionManager.getInstance().session?"S"+SessionManager.getInstance().session.slotIndex:"";LeanplumHelper.getInstance().trackEventWithValue(LeanplumTrackingService.Event.CFClaim,t,{CFClaimSource:"PlayerOffer",Teamslot:i,PlayerName:n.currentOfferPartial().playerPartial()?n.currentOfferPartial().playerPartial().name:""})}else LeanplumHelper.getInstance().trackClubFundsSpentEvent(LeanplumHelper.ClubFundsProductType.OfferPlayer,r,t,{PlayerSource:"Offers",PlayerName:n.currentOfferPartial().playerPartial()?n.currentOfferPartial().playerPartial().name:""});n.hide();n.transferPlayerPartial().addFeedbackToast();setTimeout(function(){window.location.href=Urls.squad},1e3)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done()}},t}(PlayerPriceModal);(function(n){var t,i;(function(n){n[n.Stats=0]="Stats";n[n.BuyPlayer=1]="BuyPlayer"})(t=n.BottomViewType||(n.BottomViewType={})),function(n){n[n.HigherThanAlreadyOutstandingOffer=0]="HigherThanAlreadyOutstandingOffer";n[n.LowerThanAlreadyOutstandingOffer=1]="LowerThanAlreadyOutstandingOffer";n[n.SameAsAlreadyOutstandingOffer=2]="SameAsAlreadyOutstandingOffer";n[n.SameAsAlreadyOutstandingCounterOffer=3]="SameAsAlreadyOutstandingCounterOffer";n[n.DifferentThanOriginalPrice=4]="DifferentThanOriginalPrice";n[n.SameAsOriginalPrice=5]="SameAsOriginalPrice"}(i=n.TransferPlayerSliderState||(n.TransferPlayerSliderState={}))})(TransferDomesticPlayerModal||(TransferDomesticPlayerModal={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProgressPartial=function(n){function t(t){var i=n.call(this)||this;return i.isAnimating=ko.observable(!1),i.progressPercentage=ko.observable(),i.animatedProgressIncrease=ko.observable(0),i.totalPercentage=ko.computed(function(){return i.progressPercentage()+i.progressForecast}),i.forecastPercentage=ko.observable(),Helper.copyProperties(t,i),i.progressPercentage(i.progress),i.forecastPercentage(i.totalPercentage()>100?100-i.progress:i.progressForecast),i}return __extends(t,n),t.prototype.animate=function(){var n=this,i=Q.defer(),t,r;return this.isAnimating(!0),t=0,r=setInterval(function(){n.progressPercentage(n.progressPercentage()+1);n.forecastPercentage()>0&&n.forecastPercentage(n.forecastPercentage()-1);n.animatedProgressIncrease(n.animatedProgressIncrease()+1);n.progressPercentage()>=100&&(n.progressPercentage(0),n.level++);t++;t>=n.totalProgressIncrease&&(clearInterval(r),setTimeout(function(){i.resolve(!0);n.isAnimating(!1)},1e3))},10),i.promise},t}(Progress),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPartial=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this,h,c,s,l,a;return o.isAttacker=!1,o.isMidfielder=!1,o.isDefender=!1,o.isGoalKeeper=!1,o.isAvailable=ko.observable(!1),o.isInjured=ko.observable(!1),o.isSuspended=ko.observable(!1),o.lineupNr=ko.observable(0),o.isInLeague=!1,o.isSessionPlayer=!1,o.statMain=0,o.imageLarge=ko.observable(),o.daysUnavailable=ko.observable(0),o.quickSellSellPrice=ko.observable(0),o.isOnTransferList=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.transferPlayerPartial()?!0:!1}),o.isInNegotiation=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.offersPartial()?o.offersPartial().getItems().length>0:!1}),o.isInTraining=ko.computed(function(){return o.trainingSessionsPartial()?o.trainingSessionsPartial().currentTrainingSession()!==null&&!o.trainingSessionsPartial().currentTrainingSession().countdownTimerPartial().claimed():!1}),o.isInSelection=ko.computed(function(){return o.lineupNr()>0}),o.isInLineup=ko.computed(function(){return o.lineupNr()>0&&o.lineupNr()<=11}),o.isOnBench=ko.computed(function(){return o.isInSelection()&&!o.isInLineup()}),o.squadNumberObservable=ko.observable(),o.squadNumbersEnabled=LeanplumHelper.getInstance().getVariables("Settings","SquadNumbersEnabled",!1),o.nameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.name:o.squadNumberObservable()+". "+o.name}),o.fullNameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.fullName:o.squadNumberObservable()+". "+o.fullName}),o.squadOrLineupNumber=ko.pureComputed(function(){var n=o.squadNumbersEnabled?o.squadNumberObservable():o.lineupNr();return n===0?"":""+n}),o.nameWithSquadNumberForMatch=ko.pureComputed(function(){return o.playerGradePartial()&&o.playerGradePartial().squadNumber!==0?o.playerGradePartial().squadNumber+". "+o.name:o.name}),Helper.copyProperties(t,o),o.daysUnavailable(o.unavailable),i&&(o._playersService=i),r&&(o._offersService=r),o.nationality&&o.nationalityPartial(new NationalityPartial(o.nationality)),o.team&&o.teamPartial(new TeamPartial(o.team)),h=LeanplumHelper.getInstance().getVariables("Settings","AssetsPlayersEnabled",!0),o.assets&&h&&o.assetsPartial(new AssetsPartial(o.assets)),o.foul&&o.foulPartial(new FoulPartial(o.foul)),o.injury&&o.injuryPartial(new InjuryPartial(o.injury)),o.doctorTreatment&&o.doctorTreatmentPartial(new DoctorTreatmentPartial(o.doctorTreatment)),o.doctorTreatments&&o.doctorTreatmentsPartial(new DoctorTreatmentsPartial(o.doctorTreatments)),o.trainingSessions&&o.trainingSessionsPartial(new TrainingSessionsPartial(o.trainingSessions,u,e)),o.transferPlayer&&o.transferPlayerPartial(new TransferPlayerPartial(o.transferPlayer,f)),o.playerGrade&&o.playerGradePartial(new PlayerGradePartial(o.playerGrade)),o.playerGrades&&o.playerGradesPartial(new PlayerGradesPartial(o.playerGrades)),o.training&&o.trainingForecastPartial(new TrainingForecastPartial(o.training)),o.offers&&o.offersPartial(new OffersPartial(o.offers)),o.isAttacker=o.position===PlayerPosition.A,o.isMidfielder=o.position===PlayerPosition.M,o.isDefender=o.position===PlayerPosition.D,o.isGoalKeeper=o.position===PlayerPosition.G,o.isAvailable(o.status===PlayerStatus.Available),o.isInjured(o.status===PlayerStatus.Injured),o.isSuspended(o.status===PlayerStatus.Suspended),o.lineupNr(o.lineup),o.isInLeague=o.leagueId===SessionManager.getLeagueId(),o.isSessionPlayer=o.isInLeague&&o.teamId===SessionManager.getTeamId(),o.statMain=o.isAttacker?o.statAtt:o.isMidfielder?o.statOvr:o.statDef,o.assets&&h&&(c=Enumerable.from(o.assets).firstOrDefault(function(n){return n.type===AssetType.NormalPassport}),c!=null&&o.imageLarge(c.path)),s=new Progress,s.level=o.statMain,s.progress=o.trainingProgress,s.progressForecast=o.training?o.trainingForecastPartial().forecast:0,o.trainingProgressPartial(new ProgressPartial(s)),o.isSessionPlayer&&appViewModel&&appViewModel.gameSettingsPartial()&&(l=appViewModel.gameSettingsPartial().getGameSettings(GameVarCategory.Transfer,"QuickSellPricePercentage"),a=Enumerable.from(l).firstOrDefault(function(n){return n.variation===0&&n.increment===0}),o.quickSellSellPrice(o.value*(a.value/100))),o.squadNumberObservable(o.squadNumber),o}return __extends(t,n),t.prototype.setLineup=function(n){this.lineupNr(n)},t.prototype.sell=function(n){var i=this,t=Q.defer(),r;return this._playersService?(WebApi.getInstance().execute(this._playersService.sell(this.leagueId,this.teamId,this.id,n)).then(function(n){i.transferPlayer=n;i.transferPlayerPartial(new TransferPlayerPartial(n,new TransferPlayerService));t.resolve(n);i.addFeedbackToast()}).fail(function(n){WebapiHelper.handleAndAlertError(n);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"PlayerPartial.sell.sellDeferred: Error selling player.");t.reject(i)}).done(),t.promise):(r=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("PlayerPartial.sell.sellDeferred: No playersService when trying to sell a player."),t.reject(r),t.promise)},t.prototype.offer=function(n){if(this._offersService){var t=this._offersService.post(this.leagueId,SessionManager.getTeamId(),this.id,n);return t.deferred.promise.then(function(){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).done(),WebApi.getInstance().execute(t)}},t.prototype.willImproveByTraining=function(){return this.trainingForecastPartial()?this.trainingProgress+this.trainingForecastPartial().forecast>=100:!1},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.transferPlayerPartial()&&this.transferPlayerPartial().playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerToTransferlist,this.transferPlayerPartial().playerPartial().imageLarge(),[{key:"playername",value:this.transferPlayerPartial().playerPartial().name}],this.getPlayerWorldStarLevel(),this.rarity))},t.prototype.getPlayerWorldStarLevel=function(){var t=this,i=LeanplumHelper.getInstance().getVariables("WorldStar"),n=Enumerable.from(i).where(function(n){return t.statMain>=n.value}).firstOrDefault();if(!n)return PlayerWorldStarLevel.None;switch(n.key){case"MinRatingLevel1":return PlayerWorldStarLevel.WorldStar1;case"MinRatingLevel2":return PlayerWorldStarLevel.WorldStar2}},t.prototype.isWorldStar=function(){return this.getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1},t.prototype.isLegend=function(){return this.rarity==PlayerRarity.Legend},t.prototype.isInForm=function(){return this.rarity==PlayerRarity.InForm},t.prototype.getWorldStarClassName=function(){var n=this.getPlayerWorldStarLevel();switch(n){case PlayerWorldStarLevel.WorldStar1:return"world-star-1";case PlayerWorldStarLevel.WorldStar2:return"world-star-2";default:return"no-world-star"}},t.prototype.assignSquadNumber=function(n){var t=this,i=Q.defer();if(this._playersService)return WebApi.getInstance().execute(this._playersService.assignSquadNumber(this.leagueId,this.teamId,this.id,n)).then(function(n){t.squadNumber=n.squadNumber;t.squadNumberObservable(n.squadNumber);n.squadNumber&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.SquadNumberAssigned,t.imageLarge(),[{key:"SquadNumber",value:String(n.squadNumber)}],t.getPlayerWorldStarLevel(),t.rarity));i.resolve(n)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not assign squad number");i.reject(t)}).done(),i.promise},t}(Player),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingForecastPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TrainingForecast),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamPartial=function(n){function t(t,i,r){var u=n.call(this)||this,e,f,o;return u._interestMultiplier=.02,u.isSessionTeam=ko.observable(!1),u.imageLarge="",u.boardMood=ko.observable(BoardMood.Satisfied),u.hasOngoingSpyInstruction=ko.computed(function(){return!u.spyInstructionPartial()||!u.spyInstructionPartial().countdownTimerPartial()?!1:u.spyInstructionPartial().countdownTimerPartial().timerState()!==TimerState.Claimed}),u.onTrainingCamp=ko.computed(function(){return!u.teamTrainingsPartial()||!appViewModel||!appViewModel.leaguePartial()?!1:Enumerable.from(u.teamTrainingsPartial().getItems()).any(function(n){return n.type===TeamTrainingType.Camp&&n.week===appViewModel.leaguePartial().weekNr})}),u.onSecretTraining=ko.computed(function(){return!u.teamTrainingsPartial()||!appViewModel||!appViewModel.leaguePartial()?!1:Enumerable.from(u.teamTrainingsPartial().getItems()).any(function(n){return n.type===TeamTrainingType.Secret&&n.week===appViewModel.leaguePartial().weekNr})}),Helper.copyProperties(t,u),u.manager&&u.managerPartial(new ManagerPartial(u.manager)),u.tactic&&u.tacticPartial(new TeamTacticPartial(u.tactic)),u.finance&&u.financePartial(new TeamFinancePartial(u.finance)),u.leagueStanding&&u.leagueStandingPartial(new LeagueStandingPartial(u.leagueStanding)),u.league&&u.leaguePartial(new LeaguePartial(u.league)),u.spyInstruction&&u.spyInstructionPartial(new SpyInstructionPartial(u.spyInstruction)),e=LeanplumHelper.getInstance().getVariables("Settings","AssetsTeamsEnabled",!0),u.assets&&e&&(f=Enumerable.from(u.assets).firstOrDefault(function(n){return n.type===AssetType.NormalCrest}),f!=null?u.imageLarge=f.path:(o=(u.id-1)%24+1,u.imageLarge=Helper.replaceText(teamLogoFallbackNormalUrl,[{key:"teamId",value:o.toString()}]))),u.players&&u.playersPartial(new PlayersPartial(u.players,i,r)),u.stadium&&u.stadiumPartial(new StadiumPartial(u.stadium,null,null)),u.leagueType&&u.leagueTypePartial(new LeagueTypePartial(u.leagueType)),u.teamTrainings&&u.teamTrainingsPartial(new TeamTrainingsPartial(u.teamTrainings)),u.teamStatistic&&u.teamStatisticPartial(new TeamStatisticPartial(u.teamStatistic)),u.isSessionTeam(u.id===SessionManager.getTeamId()),u.boardMood(u.getBoardMood(u.ranking,u.goal)),u}return __extends(t,n),t.prototype.getBoardMood=function(n,t){return appViewModel.leaguePartial()?appViewModel.leaguePartial().isInPreparation?BoardMood.Satisfied:n===0?BoardMood.Hopeful:n<t||n===1?BoardMood.Happy:n===t?BoardMood.Satisfied:BoardMood.Angry:BoardMood.Satisfied},t.prototype.navigateTo=function(){window.location.href=Urls.squad+"/"+this.leagueId+"/"+this.id},t.prototype.navigateToBaseTeam=function(){window.location.href=Urls.leagueTypesTeam+"/"+this.leagueTypeId+"/"+this.id},t.prototype.navigateToChooseTeam=function(){window.location.href=Urls.chooseTeamForLeagueType+"/"+this.leagueTypeId},t.prototype.getPositionDifference=function(){return this.goal-this.ranking},t.prototype.getPositionDifferenceString=function(){var n=this.getPositionDifference();return n>0?"+ "+n:n<0?"- "+-n:"0"},t}(Team),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ManagerPartial=function(n){function t(t){var i=n.call(this)||this;return i.isCpu=!0,i.avatarType=AvatarType.Player,i.masterAccountName="",i.isSacking=ko.observable(!1),Helper.copyProperties(t,i),i.masterAccountName=i.masterAccount===""?i.name:i.masterAccount,i.isCpu=i.id===0,i.isCpu&&(i.avatarType=AvatarType.Cpu),i.team&&(i.teamPartial=new TeamPartial(i.team)),i.mayBeKicked=ko.computed(function(){if(!appViewModel||!appViewModel.gameSettingsPartial())return!1;var n=appViewModel.gameSettingsPartial().getValue(GameVarCategory.Manager,"NotSackableDays");return i.lastLoginTimestamp<Helper.unixTimeStamp()-86400*n}),i}return __extends(t,n),t.prototype.getPartnerNrImage=function(){return Helper.getPlatformImage(this.lastLoginPlatform)},t.prototype.getCrewTagClassName=function(){return this.isCpu?"":this.crewId==0?"crew-tag-image-division-placeholder":"crew-tag-image-division-"+this.crewRankingDivisionSorting},t.prototype.navigateTo=function(){location.href=Helper.replaceText(Urls.profile,[new KeyValuePair("userId",this.masterAccountId.toString())])},t}(Manager),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueStandingPartial=function(n){function t(t){var i=n.call(this)||this;return i.played=0,i.goalDifference=0,i.lastPerformance=-1,i.lastThreePerformance=null,i.sortIndex=0,Helper.copyProperties(t,i),i.team&&i.teamPartial(new TeamPartial(i.team)),i.manager&&i.managerPartial(new ManagerPartial(i.manager)),i.played=i.won+i.lost+i.drew,i.goalDifference=i.goalsFor-i.goalsAgainst,i.performance&&(i.lastPerformance=i.performance[i.performance.length-1],i.lastThreePerformance=Enumerable.from(i.performance).takeFromLast(3).toArray()),i}return __extends(t,n),t.prototype.navigateTo=function(n){n&&this.managerPartial()?this.managerPartial().navigateTo():this.teamPartial()&&this.teamPartial().navigateTo()},t}(LeagueStanding),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),AssetPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Asset),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSessionPartial=function(n){function t(t,i,r){var u=n.call(this)||this,f,e;return u.isFinished=ko.observable(!1),u.isBoosting=ko.observable(!1),u.isClaiming=ko.observable(!1),u.isWatchingVideo=ko.observable(!1),u.watchVideoRewardVariationPartial=ko.observable(),u.watchVideoCapRewardVariation=ko.observable(),u._bosscoinProductName="TrainingBoostCost",u.currentBoostCost=ko.computed(function(){if(!u.countdownTimerPartial()||!appViewModel.bossCoinProductsPartial()||u.countdownTimerPartial().isClaimable())return 0;var n=u.countdownTimerPartial().getBosscoinProductForCurrentIncrement(u._bosscoinProductName);return n?n.value:0}),u._trainingSessionService=i,u._watchVideosService=r,f=appViewModel.actionRewardsPartial().getVideoActionRewardVariationForId(WatchVideoPlacementType.Training),e=appViewModel.actionRewardsPartial().getVideoActionCapRewardVariationForId(WatchVideoPlacementType.Training),u.watchVideoRewardVariationPartial(f),u.watchVideoCapRewardVariation(e),u.setItem(t),u}return __extends(t,n),t.prototype.setItem=function(n){Helper.copyProperties(n,this);this.player?(this.playerPartial(new PlayerPartial(this.player)),this.playerPartial().trainingProgressPartial().totalProgressIncrease=this.progressImprovement):this.playerPartial(null);this.countdownTimer!==undefined&&this.countdownTimer?this.countdownTimerPartial(new CountdownTimerPartial(this.countdownTimer)):this.countdownTimerPartial(null)},t.prototype.boost=function(){var t=this,n,u;if(appViewModel&&appViewModel.leaguePartial()&&appViewModel.leaguePartial().boostTimersAllowed()){if(this.isBoosting(!0),n=this.countdownTimerPartial().getBosscoinProductForCurrentIncrement(this._bosscoinProductName),n==null){this.isBoosting(!1);return}var f=this.countdownTimerPartial().minutesRemaining(),i={TimeLeft:f,TrainingCoach:this.getLeanplumCoachName(),Increment:n.increment},r=this.currentBoostCost();LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(n.name,r,i);appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingConfirmBoost);u=appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().isInTutorialMode();appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.BoostTraining,r,this.playerPartial().name,0,!u,!u,!0,n.name,i).then(function(){WebApi.getInstance().execute(t._trainingSessionService.boost(SessionManager.getLeagueId(),SessionManager.getTeamId(),t.id,n.id)).then(function(u){LeanplumHelper.getInstance().trackBossCoinSpentEvent(n.name,r,i);appViewModel.refreshBossCoinsWallet().done();t.showResult(u)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){t.isBoosting(!1)}).done()}).fail(function(n){appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingConfirmBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingBoost);WebapiHelper.handleAndAlertError(n);t.isBoosting(!1)}).done()}},t.prototype.getLeanplumCoachName=function(){switch(this.trainer){case PlayerPosition.A:return"Attacker";case PlayerPosition.M:return"Midfielder";case PlayerPosition.D:return"Defender";case PlayerPosition.G:return"Goalkeeper";default:return""}},t.prototype.boostTrainingSessionWithVideo=function(){var t=this,i,n;this.isWatchingVideo(!0);i={leagueId:SessionManager.getLeagueId(),teamId:SessionManager.getTeamId(),subjectId:this.id,placement:WatchVideoPlacementType.Training,rewardVariation:this.watchVideoRewardVariationPartial()?this.watchVideoRewardVariationPartial().variation:0,capVariation:this.watchVideoCapRewardVariation()?this.watchVideoCapRewardVariation():0};n=new WatchVideosModal(new IncentiveProviderCountriesService,new IncentiveProviderService,new WatchVideosService,new ActionRewardsService,WatchVideoPlacementType.Training,i);n.show().fail(function(){}).fin(function(){t.isWatchingVideo(!1)}).done();n.videoWatchedRewardAnnouncer.subscribe(function(i){i.then(function(){n.hideEventDeferred.promise.then(function(){t.watchVideoRewardVariationPartial().animateTimestampReduction(t.countdownTimerPartial()).then(function(){appViewModel.refreshTimers()})})}).fail(function(){}).done()})},t.prototype.claim=function(){var n=this;this.isClaiming(!0);WebApi.getInstance().execute(this._trainingSessionService.claim(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(t){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.CompleteTimer,{CompleteTimer:"Training",TrainingCoach:n.getLeanplumCoachName()});n.showResult(t)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){n.isClaiming(!1)}).done()},t.prototype.showResult=function(n){var t=this;this.playerPartial().trainingProgressPartial().totalProgressIncrease=n.player.trainingProgress-this.playerPartial().trainingProgress;this.playerPartial().trainingProgressPartial().totalProgressIncrease<=0&&(this.addFeedbackToast(this.playerPartial()),this.playerPartial().trainingProgressPartial().totalProgressIncrease+=100);n.countdownTimer=null;this.countdownTimerPartial(null);this.playerPartial().trainingProgressPartial().animate().then(function(){t.setItem(n);t.isFinished(!0);appViewModel.refreshTimers();appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingConfirmBoost&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOutro)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.addFeedbackToast=function(n){appViewModel&&appViewModel.toastsPartial&&n&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerTrained,n.imageLarge(),[{key:"playername",value:n.name},{key:"qualitylevel",value:(n.statMain+1).toString()}],n.getPlayerWorldStarLevel(),n.rarity))},t}(TrainingSession),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSlotPartial=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.isStarting=ko.observable(!1),f.isInitialized=ko.observable(!1),f.playerToTrainInTutorialPartial=ko.observable(),f.updatePlayer=ko.computed(function(){if(f.isInitialized()&&f.trainingSessionsPartial()!==null&&f.trainingSessionsPartial().currentTrainingSession()!==null&&f.trainingSessionsPartial().currentTrainingSession().isFinished()){var n=new PlayerPartial(f.trainingSessionsPartial().currentTrainingSession().playerPartial());f.playersPartial().removeItemByFunction(function(t){return t.id===n.id});f.playersPartial().addItem(n);f.playersPartial().sortItems(function(n){return n.statMain},null,SortOrder.Descending)}}),f.trainingCost=ko.computed(function(){if(appViewModel.teamPartial()===undefined||appViewModel.teamPartial()===null||appViewModel.gameSettingsPartial()===undefined||appViewModel.gameSettingsPartial()===null)return 0;var n=appViewModel.gameSettingsPartial().getValue(GameVarCategory.ClubFundsPrice,"Trainer"),t=appViewModel.teamPartial().budget;return Math.ceil(t*(n/100))}),f._trainingSessionService=i,f._trainingForecastsService=r,f._watchVideosService=u,Helper.copyProperties(t,f),f.players&&(f.playersPartial(new PlayersPartial(f.players,null,null,null,!0)),f.playersPartial().orderPlayersByMain()),f.trainingSessions&&f.trainingSessionsPartial(new TrainingSessionsPartial(f.trainingSessions,f._trainingSessionService,f._watchVideosService)),f.isInitialized(!0),f}return __extends(t,n),t.prototype.selectPlayer=function(){var t=this,n,i;this.isStarting(!0);this.clear();n=appViewModel.tutorialPartial()&&(appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingSelectPlayer||appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingOpenModal);i=new TrainPlayerModal(this.playersPartial,this.playerToTrainInTutorialPartial(),!n,!n);i.show().then(function(n){t.startTraining(n)}).fail(function(){t.isStarting(!1);n&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingOpenModal)}).done()},t.prototype.startTraining=function(n){var i=this,r=appViewModel.bossCoinProductsPartial().getBossCoinProduct("BossCoinConversionRateTraining"),t,u;if(r==null){this.isStarting(!1);return}t=this.trainingCost();u=appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(t);appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.StartTraining,t,r,0,!0,n.name,this.getLeanplumContext()).then(function(r){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(r,i.getLeanplumContext()).then(function(){appViewModel.executePaidAction(i.executeTraining(n.id,t,u))})}).fail(function(n){WebapiHelper.handleAndAlertError(n);i.isStarting(!1)}).done()},t.prototype.getLeanplumContext=function(){var n="";switch(this.position){case PlayerPosition.A:n="Attacker";break;case PlayerPosition.M:n="Midfielder";break;case PlayerPosition.D:n="Defender";break;case PlayerPosition.G:n="Goalkeeper"}return{TrainingCoach:n}},t.prototype.executeTraining=function(n,t,i){var r=this,f=appViewModel.gameSettingsPartial()?appViewModel.gameSettingsPartial().getTimerId("TrainingSession"):0,u=Q.defer();return WebApi.getInstance().execute(this._trainingSessionService.start(SessionManager.getLeagueId(),SessionManager.getTeamId(),n,this.position,f)).then(function(n){LeanplumHelper.getInstance().trackClubFundsSpentEvent(LeanplumHelper.ClubFundsProductType.Training,i,t,r.getLeanplumContext());var f=new TrainingSessionPartial(n,r._trainingSessionService,r._watchVideosService);r.trainingSessionsPartial().addItem(f);r.trainingSessionsPartial().currentTrainingSession(f);u.resolve(!0);appViewModel.refreshTimers();appViewModel.refreshNotifications();appViewModel.tutorialPartial()&&appViewModel.tutorialPartial().tutorialStep()===TutorialStep.TrainingSelectPlayer&&appViewModel.tutorialPartial().updateTutorialStep(TutorialStep.TrainingClaimBossCoins)}).fail(function(n){var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"could not start training session");u.reject(t)}).fin(function(){r.isStarting(!1)}).done(),u.promise},t.prototype.clear=function(){},t}(TrainingSlot),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerPartial=function(n){function t(t,i){var r=n.call(this)||this;return r._bossCoinConversionProductName="",r._bossCoinFeeProductName="",r.isBossCoinCompletionAllowed=ko.observable(!1),r.isRemoving=ko.observable(!1),r.isTransferred=ko.observable(!1),r.isBuying=ko.observable(!1),r.isOnList=!1,r._isInitialized=ko.observable(!1),r.bossCoinConversionCost=ko.computed(function(){if(!appViewModel.clubFundsWalletPartial()||!appViewModel.bossCoinProductsPartial()||!r._isInitialized())return 0;var n=appViewModel.bossCoinProductsPartial().getBossCoinProduct(r._bossCoinConversionProductName);return n?appViewModel.clubFundsWalletPartial().calculateBossCoinConversionCount(r.price,n):0}),r.bossCoinTransferFeeCost=ko.computed(function(){return!appViewModel.bossCoinProductsPartial()||!r._isInitialized()?0:appViewModel.bossCoinProductsPartial().getValue(r._bossCoinFeeProductName)}),r.clubFundsCost=ko.computed(function(){return!appViewModel.clubFundsWalletPartial()||!r._isInitialized()?0:appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(r.price)}),r.bossCoinCost=ko.computed(function(){return r.bossCoinTransferFeeCost()+r.bossCoinConversionCost()}),Helper.copyProperties(t,r),r._transferPlayerService=i,r.team&&r.teamPartial(new TeamPartial(r.team)),t.type===TransferPlayerType.Scout?(r._bossCoinFeeProductName="ScoutFee",r._bossCoinConversionProductName="BossCoinConversionRateScout"):t.player.rarity==PlayerRarity.Legend&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignLegendTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):t.player.rarity==PlayerRarity.InForm&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignInFormTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):(r._bossCoinFeeProductName="TransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"),r.countdownTimer&&(r.countdownTimerPartial(new CountdownTimerPartial(r.countdownTimer)),r.isOnList=r.countdownTimer.finishedTimestamp>Helper.unixTimeStamp()),r.player&&(r.team&&(r.player.team=r.team),r.playerPartial(new PlayerPartial(r.player))),appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&r.isBossCoinCompletionAllowed(appViewModel.leaguePartial().settingsPartial().isBossCoinCompletionAllowed),r._isInitialized(!0),r}return __extends(t,n),t.prototype.buy=function(){this.isBossCoinCompletionAllowed()?this.buyWithBossCoinCompletion():this.buyWithoutBossCoinCompletion()},t.prototype.buyWithBossCoinCompletion=function(){var n=this,t,i,r;this.isBuying()||(t=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinConversionProductName),t)&&(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),i=this.price,r=this.clubFundsCost(),WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.TransferPlayer,i,t,n.bossCoinTransferFeeCost(),!1,n.player.name).then(function(u){var f=n.bossCoinCost()>n.bossCoinTransferFeeCost();f&&LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(t.name,n.bossCoinConversionCost());appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinCost(),n.playerPartial().name,r,f,!0,!0,n._bossCoinFeeProductName,{},!1).then(function(){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(u).then(function(){appViewModel.executePaidAction(n.transferPlayer(i,r));n.isBuying(!1)})}).fail(function(t){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done())},t.prototype.buyWithoutBossCoinCompletion=function(){var n=this;this.isBuying()||(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),this._isInitialized&&appViewModel.clubFundsWalletPartial()&&appViewModel.clubFundsWalletPartial().calculateClubFundsShortageForPrice(this.price)===0?WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){var t=n.clubFundsCost();appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinTransferFeeCost(),n.playerPartial().name,t,!1,!0,!0,n._bossCoinFeeProductName).then(function(){appViewModel.executePaidAction(n.transferPlayer(t,t));n.isBuying(!1)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done():(new NotEnoughClubFundsModal(this.price,this.bossCoinTransferFeeCost(),!1).show(),this.isBuying(!1)))},t.prototype.transferPlayer=function(n,t){var i=Q.defer(),r=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinFeeProductName),u;return r==null?(u=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("TransferPlayerPartial.transferPlayer.deferred: No Boss Coin product partial when transfering a player."),i.reject(u),i.promise):(this.executeTransfer(r,n,t).then(function(n){i.resolve(n)}),i.promise)},t.prototype.executeTransfer=function(n,t,i){var r=this,u=Q.defer(),f=this.bossCoinTransferFeeCost();return WebApi.getInstance().execute(this._transferPlayerService.buy(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id,n.id)).then(function(){r.addFeedbackToast();r.isTransferred(!0);LeanplumHelper.getInstance().trackBossCoinSpentEvent(r._bossCoinFeeProductName,f);var n;switch(r.type){case TransferPlayerType.Scout:n=LeanplumHelper.ClubFundsProductType.ScoutPlayer;break;case TransferPlayerType.SpecialOffer:n=LeanplumHelper.ClubFundsProductType.SpecialOfferPlayer;break;case TransferPlayerType.Transferlist:default:n=LeanplumHelper.ClubFundsProductType.TransferPlayer}LeanplumHelper.getInstance().trackClubFundsSpentEvent(n,i,t,{PlayerName:r.playerPartial()?r.playerPartial().name:""});u.resolve(!0)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"failed to buy player");u.reject(t)}).done(),u.promise},t.prototype.removeFromTransferlist=function(){var t=this,n=Q.defer();return this.isRemoving(!0),WebApi.getInstance().execute(this._transferPlayerService.deleteById(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){t.isTransferred(!0);n.resolve(!0)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.resolve(!1)}).fin(function(){t.isRemoving(!1)}).done(),n.promise},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerBought,this.playerPartial().imageLarge(),[{key:"playername",value:this.playerPartial().name}],this.playerPartial().getPlayerWorldStarLevel(),this.playerPartial().rarity))},t}(TransferPlayer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),DoctorTreatmentPartial=function(n){function t(t){var i=n.call(this)||this;return i.boostBosscoinProductName="DoctorTreatmentBoostCost",i.boostCost=ko.computed(function(){if(!i.countdownTimerPartial()||!appViewModel.bossCoinProductsPartial()||i.countdownTimerPartial().isClaimable())return 0;var n=i.countdownTimerPartial().getBosscoinProductForCurrentIncrement(i.boostBosscoinProductName);return n?n.value:0}),Helper.copyProperties(t,i),i.countdownTimer&&i.countdownTimerPartial(new CountdownTimerPartial(i.countdownTimer)),i}return __extends(t,n),t}(DoctorTreatment),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return Helper.copyProperties(t,u),u.player&&u.playerPartial(new PlayerPartial(u.player,i,r)),u.destinationTeam&&u.destinationTeamPartial(new TeamPartial(u.destinationTeam)),u.sourceTeam&&u.sourceTeamPartial(new TeamPartial(u.sourceTeam)),u}return __extends(t,n),t}(Transfer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerGradePartial=function(n){function t(t){var i=n.call(this)||this;return i.isInLineup=ko.observable(!1),Helper.copyProperties(t,i),i.isInLineup(i.lineup>0&&i.lineup<=11),i}return __extends(t,n),t}(PlayerGrade),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayersPartial=function(n){function t(t,i,r,u,f){f===void 0&&(f=!1);var e=n.call(this)||this;return e.totalValue=ko.computed(function(){return Enumerable.from(e.getItems()).sum(function(n){return n.value})}),e.attackers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isAttacker}).toArray()}),e.midfielders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isMidfielder}).toArray()}),e.defenders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isDefender}).toArray()}),e.goalkeepers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isGoalKeeper}).toArray()}),e.injured=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isInjured()}).toArray()}),e.suspended=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isSuspended()}).toArray()}),e.currentLineupAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isInLineup()})}),e.currentBenchAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isOnBench()})}),e.isLineupComplete=ko.computed(function(){return e.currentLineupAmount()==11}),e.isBenchComplete=ko.computed(function(){return e.currentBenchAmount()==7}),e._playersService=i,e._offersService=r,f&&(e.sortingEnabled(!0),e.sortOrder=SortOrder.Descending),e.setItemsFromModels(t,i,r,u),e}return __extends(t,n),t.prototype.isLineEligibleForTransfer=function(n){switch(n){case PlayerPosition.A:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.A}).count()>3;case PlayerPosition.D:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.D}).count()>4;case PlayerPosition.M:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.M}).count()>4;case PlayerPosition.G:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.G}).count()>2;default:return!1}},t.prototype.getPlayersEligibleToBePutOnTransferlist=function(){var n=this;return Enumerable.from(this.getItems()).where(function(t){return!t.isOnTransferList()&&n.isLineEligibleForTransfer(t.position)}).toArray()},t.prototype.getReserves=function(){return this.getItems().filter(function(n){return!n.isInSelection()})},t.prototype.getNotInLineup=function(){return this.getItems().filter(function(n){return!n.isInLineup()})},t.prototype.getPlayerBySquadNumber=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.squadNumberObservable()===n})},t.prototype.getByStaffMemberType=function(n){return n===StaffMemberType.AttackerCoach?this.attackers():n===StaffMemberType.MidfielderCoach?this.midfielders():n===StaffMemberType.DefenderCoach?this.defenders():n===StaffMemberType.GoalkeeperCoach?this.goalkeepers():[]},t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.statDef})},t.prototype.orderPlayersByGoals=function(){this.sortItems(function(n){return n.goals})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.statMain})},t.prototype.orderPlayersByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByNationality=function(){this.sortItems(function(n){return n.nationality.code})},t.prototype.orderPlayersByFitness=function(){this.sortItems(function(n){return n.fitness})},t.prototype.orderPlayersByMorale=function(){this.sortItems(function(n){return n.morale})},t.prototype.orderPlayersByLineup=function(){this.sortItems(function(n){return n.lineup})},t.prototype.orderPlayersByAverage=function(){this.sortItems(function(n){return n.averagePlayerGrade})},t.prototype.orderPlayersByGradeForWeek=function(n){this.sortItems(function(t){return t.playerGradesPartial().getGradeForWeek(n)})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.position})},t.prototype.orderPlayersBySuspension=function(){this.sortItems(function(n){return n.isSuspended})},t.prototype.getTopscorers=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.goals},!0)).skip(n).take(t).toArray()},t.prototype.getAssists=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.assists},!0)).skip(n).take(t).toArray()},t.prototype.getPlayers=function(n,t){return Enumerable.from(this.getItems()).skip(n).take(t).toArray()},t.prototype.getOrderedByPlayerGradeLineup=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerGradePartial()!==null&&n.playerGradePartial()!==undefined}).orderBy(function(n){return n.playerGradePartial().lineup}).toArray()},t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new PlayerPartial(n,t,i,null,r))});this.setItems(u)},t}(PartialArrayViewModel),PlayersGroupablePartial=function(){function n(n,t,i,r){var u=this,e,f;this.sortedPlayersListByLine=ko.observableArray();this.sortedPlayers=ko.observable();this.sortPlayersByLine=ko.observable(!0);this.getPlayers=ko.computed(function(){return u.sortPlayersByLine()?u.sortedPlayersListByLine():[{position:PlayerPosition.None,players:u.sortedPlayers()}]});e=Enumerable.from(n).groupBy(function(n){return n.position},function(n){return n},function(n,u){var f=new PlayersPartial(u.toArray(),t,i,r,!0);return f.orderPlayersByValue(),{position:n,players:f}});this.sortedPlayersListByLine(Enumerable.from(e).orderBy(function(n){return n.position}).toArray());f=new PlayersPartial(n,t,i,r,!0);f.orderPlayersByValue();this.sortedPlayers(f)}return n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSessionsPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return u.currentTrainingSession=ko.observable(),u.isFinished=ko.computed(function(){return u.currentTrainingSession()===undefined||u.currentTrainingSession()===null?!1:u.currentTrainingSession().isFinished()}),u.getInProgress=ko.computed(function(){return Enumerable.from(u.getItems()).where(function(n){return n.countdownTimerPartial()&&n.countdownTimerPartial().timerState()===TimerState.InProgress}).toArray()}),u.playerPartialsInProgress=ko.computed(function(){return Enumerable.from(u.getInProgress()).select(function(n){return n.playerPartial()}).toArray()}),u.amountInProgress=ko.computed(function(){return u.getInProgress().length}),u.amountOfFreeTrainers=ko.computed(function(){return 4-u.amountInProgress()}),u.amountFinished=ko.computed(function(){return Enumerable.from(u.getItems()).count(function(n){return n.countdownTimerPartial()&&n.countdownTimerPartial().timerState()===TimerState.Finished})}),u.getFirstFinishingTrainingSession=ko.computed(function(){return Enumerable.from(u.getItems()).orderBy(function(n){return n.countdownTimer!=null&&n.countdownTimer.finishedTimestamp}).firstOrDefault()}),u.setItemsFromModels(t,i,r),u.currentTrainingSession(Enumerable.from(u.getItems()).firstOrDefault(function(n){return!n.countdownTimerPartial().claimed()})),u}return __extends(t,n),t.prototype.getByStaffMemberType=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.staffMember==n}).toArray()},t.prototype.setItemsFromModels=function(n,t,i){var r=[];n.forEach(function(n){r.push(new TrainingSessionPartial(n,t,i))});this.setItems(r)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingSlotsPartial=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.setItemsFromModels(t,i,r,u),f}return __extends(t,n),t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new TrainingSlotPartial(n,t,i,r))});this.setItems(u)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayersPartial=function(n){function t(t,i){var r=n.call(this)||this;return r.countdownTimerPartial=ko.observable(),r.playerHasBeenTransferred=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isTransferred()})}),r.hasScoutResults=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isOnList})}),r._transferPlayerService=i,r.sortingEnabled(!0),r.sortOrder=SortOrder.Descending,r.setItemsFromModels(t,i),r}return __extends(t,n),t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.player.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.player.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.player.statDef})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.player.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.player.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.playerPartial().statMain})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.playerPartial().position})},t.prototype.getByPlayerId=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.player.id===n})},t.prototype.setItemsFromModels=function(n,t){var i=this,r=[];n.forEach(function(n){!i.countdownTimerPartial()&&n.countdownTimer&&i.countdownTimerPartial(new CountdownTimerPartial(n.countdownTimer));r.push(new TransferPlayerPartial(n,t))});this.setItems(r);this.orderPlayersByPrice()},t.prototype.getAbleToBuy=function(n,t){return Enumerable.from(this.getExcludedOwningTeam(n)).where(function(n){return n.price<=t}).toArray()},t.prototype.getExcludedOwningTeam=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.playerPartial().teamId!==n}).toArray()},t.prototype.getWorldStar=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1}).toArray()},t.prototype.getLegends=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isLegend()}).toArray()},t.prototype.containsWorldStar=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1})},t.prototype.getInForms=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isInForm()}).toArray()},t.prototype.containsInForm=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isInForm()})},t.prototype.containsLegend=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isLegend()})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),DoctorTreatmentsPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new DoctorTreatmentPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransfersPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return u.getLatest=ko.computed(function(){return Enumerable.from(u.getItems()).orderByDescending(function(n){return n.timestamp}).firstOrDefault()}),u.sortingEnabled(!0),u.setItemsFromModels(t,i,r),u}return __extends(t,n),t.prototype.orderByPlayerName=function(){this.sortItems(function(n){return n.player.name})},t.prototype.orderBySourceTeamName=function(){this.sortItems(function(n){return n.sourceTeam.name})},t.prototype.orderByDestinationTeamName=function(){this.sortItems(function(n){return n.destinationTeam.name})},t.prototype.orderByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderByWeek=function(){this.sortItems(function(n){return n.weekNr})},t.prototype.orderByDate=function(){this.sortItems(function(n){return n.timestamp})},t.prototype.orderByPosition=function(){this.sortItems(function(n){return n.player.position})},t.prototype.setItemsFromModels=function(n,t,i){var r=[];n.forEach(function(n){r.push(new TransferPartial(n,t,i))});this.setItems(r);this.sortOrder=SortOrder.Descending;this.orderByDate()},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerGradesPartial=function(n){function t(t){var i=n.call(this)||this;return i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new PlayerGradePartial(n))});this.setItems(t)},t.prototype.getGradeForWeek=function(n){var t=Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.weekNr===n});return t===null||t===undefined?0:t.grade},t.prototype.getAverage=function(){return Enumerable.from(this.getItems()).average(function(n){return n.grade})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TeamsPartial=function(n){function t(t){var i=n.call(this)||this;return i.sessionTeam=ko.computed(function(){return Enumerable.from(i.getItems()).firstOrDefault(function(n){return n.isSessionTeam()})}),i.sortingEnabled(!0),i.setItemsFromModels(t),i.teamPoules=Enumerable.from(i.getItems()).where(function(n){return!!n.poule}).select(function(n){return n.poule}).distinct().orderBy(function(n){return n}).toArray(),i.hasPoules=i.teamPoules&&i.teamPoules.length>0,i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new TeamPartial(n))});this.setItems(t)},t.prototype.getOrderedBySpy=function(){return Enumerable.from(this.getItems()).orderByDescending(function(n){return n.spyInstructionPartial()!==undefined&&n.spyInstructionPartial()!==null}).thenByDescending(function(n){return n.onSecretTraining()===!1}).toArray()},t.prototype.getByPoule=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.poule==n}).toArray()},t.prototype.orderByTeamTaken=function(n){this.sortItems(function(n){return n.manager!=null},[function(n){return n.goal},function(n){return n.name}],n)},t.prototype.orderByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderByCity=function(){this.sortItems(function(n){return n.city})},t.prototype.orderByGoal=function(n){this.sortItems(function(n){return n.goal},[function(n){return n.name}],n)},t.prototype.orderByBudget=function(){this.sortItems(function(n){return n.budget})},t.prototype.orderByStadiumCapacity=function(){this.sortItems(function(n){return n.stadiumCapacity})},t.prototype.orderBySquadValue=function(){this.sortItems(function(n){return n.playersPartial().totalValue()})},t.prototype.areAllGoalsEqual=function(){var n=Enumerable.from(this.getItems()),t=n.first().goal;return n.all(function(n){return n.goal===t})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LockedSquadNumberPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(LockedSquadNumber),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LockedSquadNumbersPartial=function(n){function t(t){var i=n.call(this)||this;return t?(i.setItemsFromModels(t),i):i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){n==null?t.push(null):t.push(new LockedSquadNumberPartial(n))});this.setItems(t)},t.prototype.isLocked=function(n){return Enumerable.from(this.getItems()).any(function(t){return t.squadNumber===n})},t.prototype.getLockedReason=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.squadNumber===n},null)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SquadNumbersModal=function(n){function t(i,r,u,f){var e=n.call(this,{template:ModalTemplate.SquadNumbers,modalSize:ModalSize.Wide,showCloseButton:!0})||this;return e.playerPartial=i,e.teamPartial=r,e.lockedSquadNumbersPartial=u,e._updatePlayerSubscription=f,e._squadNumberRangeMin=1,e._squadNumberRangeMax=99,e.selectedSquadNumber=ko.observable(0),e.isProcessingSquadNumber=ko.observable(!1),e.squadNumberChangeState=ko.pureComputed(function(){return 0===e.selectedSquadNumber()||e.lockedSquadNumbersPartial.isLocked(e.selectedSquadNumber())||e.isCurrentPlayerSquadNumber(e.selectedSquadNumber())?t.ChangeState.None:t.ChangeState.Set}),e.shownEventFunction=function(){Enumerable.from($('#modal-dialog-squadnumbers [data-toggle="tooltip"]')).forEach(function(n){$(n).on("show.bs.tooltip",function(){window.setTimeout(function(){$(n).tooltip("hide")},2500)}).tooltip({container:".squadnumber-item",trigger:"click",animation:!0})});e.shownEventFunction=null},e.selectedSquadNumber(e.playerPartial.squadNumberObservable()),e.squadNumberRange=Enumerable.range(e._squadNumberRangeMin,e._squadNumberRangeMax).toArray(),e}return __extends(t,n),t.prototype.setSelectSquadNumber=function(n){this.lockedSquadNumbersPartial.isLocked(n)||this.isCurrentPlayerSquadNumber(n)||this.selectedSquadNumber(n)},t.prototype.isCurrentPlayerSquadNumber=function(n){return n===this.playerPartial.squadNumberObservable()},t.prototype.changeSquadNumber=function(){var n=this;if(this.squadNumberChangeState()!==t.ChangeState.None){this.isProcessingSquadNumber(!0);var i=Enumerable.from(this.teamPartial.playersPartial().getItems()).firstOrDefault(function(t){return t.squadNumberObservable()===n.selectedSquadNumber()}),r=Enumerable.from(this.teamPartial.playersPartial().getItems()).firstOrDefault(function(t){return t.id===n.playerPartial.id}),u=!i?Q.resolve(null):i.assignSquadNumber(0);u.then(function(t){t&&(i.squadNumber=0,i.squadNumberObservable(0),n._updatePlayerSubscription.notifySubscribers(t));r.assignSquadNumber(n.selectedSquadNumber()).then(function(t){n.playerPartial.squadNumberObservable(t.squadNumber);n.playerPartial.squadNumber=t.squadNumber}).fail(function(){}).done()}).fail(function(){}).done(function(){n.isProcessingSquadNumber(!1);n.hide()})}},t}(BaseModal);(function(n){var t;(function(n){n[n.Set=0]="Set";n[n.None=1]="None"})(t=n.ChangeState||(n.ChangeState={}))})(SquadNumbersModal||(SquadNumbersModal={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();SquadView=function(n){function t(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k=n.call(this)||this,d;return k.teamPartial=ko.observable(),k.teamsPartial=ko.observable(),k.leaguePartial=ko.observable(),k.playersGroupablePartial=ko.observable(),k.transfersPartial=ko.observable(),k._offersPartial=ko.observable(),k.isDataLoadedDeferred=Q.defer(),k.isSessionTeam=ko.observable(!1),k._isSessionLeague=ko.observable(!1),k.isGroupFilterVisible=ko.observable(!0),k._leagueId=ko.observable(),k._teamId=ko.observable(),k._isInitialized=ko.observable(!1),k._shouldSurfaceSellPlayer=ko.observable(!1),k.playerRatingsLoaded=ko.observable(!1),k.currentTab=ko.observable(t.Tab.List),k.areTransfersEnabled=ko.computed(function(){return!k.leaguePartial()||!k.leaguePartial().settingsPartial()?!1:k.leaguePartial().settingsPartial().areTransfersEnabled}),k.surface=ko.computed(function(){appViewModel&&appViewModel.surfacingPartial()&&k._shouldSurfaceSellPlayer()&&k.isSessionTeam()&&new StaffSurfacingModal(SurfacingFollowUp.SquadSellPlayer,DudeType.Assistant).show().then(function(){appViewModel.surfacingPartial().completeSurfacing(SurfacingType.SquadSellPlayer)}).done()}),k._lockedSquadNumbersPartial=ko.observable(),k._updatePlayerSubscription=new ko.subscribable,k.squadNumbersEnabled=LeanplumHelper.getInstance().getVariables("Settings","SquadNumbersEnabled",!0),k.teamAverage=ko.computed(function(){return!k.playersGroupablePartial()||!k.playerRatingsLoaded()?0:Enumerable.from(k.playersGroupablePartial().sortedPlayers().getItems()).where(function(n){return n.playerGradesPartial().getAverage()>0}).average(function(n){return n.playerGradesPartial().getAverage()})}),k._playersService=i,k._teamsService=r,k._managersService=u,k._leagueStandingsService=f,k._transferPlayersService=s,k._trainingSessionService=o,k._doctorTreatmentService=h,k._transfersService=c,k._offersService=e,k._playerGradesService=l,k._baseTeamsService=p,k._leaguesService=a,k._leagueSettingsService=v,k._updatePlayerSubscription.subscribe(function(n){var t=[Enumerable.from(k.playersGroupablePartial().getPlayers()).selectMany(function(n){return n.players.getItems()}).firstOrDefault(function(t){return t.id===n.id}),Enumerable.from(k.teamPartial().playersPartial().getItems()).firstOrDefault(function(t){return t.id===n.id})];Enumerable.from(t).forEach(function(t){t&&(t.squadNumberObservable(n.squadNumber),t.squadNumber=n.squadNumber)})}),d=k._leagueId.subscribe(function(){WebApi.getInstance().execute(k._leaguesService.getByLeagueId(k._leagueId())).then(function(n){WebApi.getInstance().execute(k._leagueSettingsService.getByLeagueId(n.id,n.seasonNr,!0)).then(function(t){n.settings=t;k.leaguePartial(new LeaguePartial(n));k.getTeamData()}).done()}).done();d.dispose()}),b?(k._leagueId(b),k._teamId(w),k._isSessionLeague(k._leagueId()===SessionManager.getLeagueId()),k.isSessionTeam(k._isSessionLeague()&&k._teamId()===SessionManager.getTeamId())):SessionManager.getInstance().ensureSession(y).then(function(){k._leagueId(SessionManager.getLeagueId());w?k._teamId(w):k._teamId(SessionManager.getTeamId());k._isSessionLeague(!0);k.isSessionTeam(k._isSessionLeague()&&k._teamId()===SessionManager.getTeamId())}).fail(function(){appViewModel.redirect(RedirectionFlow.AccountSelect)}).done(),k}return __extends(t,n),t.prototype.getTeamData=function(){var n=this,t=new WebApiBatch,r=this._teamsService.getByLeague(this._leagueId(),!0),i;t.add(r);i=this._managersService.getByLeagueWithPoints(this._leagueId(),!0,!0);t.add(i);Q.all([r.deferred.promise,i.deferred.promise]).spread(function(t,i){t.forEach(function(n){n.manager=Enumerable.from(i).firstOrDefault(function(t){return t.teamId===n.id})});n.teamsPartial(new TeamsPartial(t));n.refreshData(n._teamId())}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).fin(function(){n._isInitialized(!0)}).done();t.execute();this._shouldSurfaceSellPlayer($.cookie("Surfacing_"+SurfacingType.SquadSellPlayer+this._leagueId()+this._teamId()))},t.prototype.switchTabs=function(n){switch(n){case"#squad":this.currentTab(t.Tab.List);break;case"#team-transfers":this.currentTab(t.Tab.Transfers);break;case"#team-playergrades":this.currentTab(t.Tab.Ratings);break;default:this.currentTab(t.Tab.List)}this.loadData()},t.prototype.loadData=function(){switch(this.currentTab()){case t.Tab.List:this.loadSquadList();LeanplumHelper.getInstance().pageOpened(LeanplumTrackingService.State.Squad,{isOwnSquad:this.isSessionTeam()});break;case t.Tab.Transfers:this.loadTransferTab();break;case t.Tab.Ratings:this.loadPlayerRatings()}this.loadTransfers()},t.prototype.loadSquadList=function(){var n=this,r,u,i,o,s,h,c;if(this.playersGroupablePartial())return Q.resolve(!0);var f=Q.defer(),t=new WebApiBatch,e=this._playersService.getByTeam(this._leagueId(),this.teamPartial().id);return t.add(e),r=this._leagueStandingsService.getAllFilteredByTeamId(this._leagueId(),this.teamPartial().id,!0),t.add(r),u=this._transferPlayersService.getByTransferPlayerType(this._leagueId(),this.teamPartial().id,TransferPlayerType.Transferlist),t.add(u),i=this._offersService.getByTeam(this._leagueId(),SessionManager.getTeamId()),this._isSessionLeague()?t.add(i):i.deferred.resolve(null),this.isSessionTeam()?(o=this._trainingSessionService.getOngoing(this._leagueId(),this.teamPartial().id),t.add(o),s=this._doctorTreatmentService.getForTeam(this._leagueId(),this.teamPartial().id),t.add(s),h=void 0,this.squadNumbersEnabled&&(c=this._baseTeamsService.getLockedSquadNumbers(this.teamPartial().baseTeamId,!0),h=c.deferred.promise,t.add(c)),Q.all([e.deferred.promise,r.deferred.promise,o.deferred.promise,u.deferred.promise,s.deferred.promise,h,i.deferred.promise]).spread(function(t,i,r,u,f,e,o){o&&n._offersPartial(new OffersPartial(o));n._lockedSquadNumbersPartial(new LockedSquadNumbersPartial(e));n.enrichPlayers(t,o,r,u,f);n.setData(t,n.teamPartial(),n.teamPartial().manager,i,n._playersService,n._offersService,n._transferPlayersService);n.scrollToCurrentWeek()}).fin(function(){f.resolve(!0);n.isDataLoadedDeferred.resolve(!0)}).done()):Q.all([e.deferred.promise,r.deferred.promise,u.deferred.promise,i.deferred.promise]).spread(function(t,i,r,u){u&&n._offersPartial(new OffersPartial(u));n.enrichPlayers(t,null,null,r);n.setData(t,n.teamPartial(),n.teamPartial().manager,i,n._playersService,n._offersService,n._transferPlayersService);n.scrollToCurrentWeek()}).fail(function(){}).fin(function(){f.resolve(!0);n.isDataLoadedDeferred.resolve(!0)}).done(),t.execute().done(),f.promise},t.prototype.loadTransferTab=function(){var n=this,t,i,r;if(this.teamPartial()&&this.teamPartial().players&&this.teamPartial().leagueStanding){this.setData(this.teamPartial().players,this.teamPartial(),this.teamPartial().manager,this.teamPartial().leagueStanding,this._playersService,this._offersService,this._transferPlayersService);return}t=new WebApiBatch;i=this._playersService.getByTeam(this._leagueId(),this.teamPartial().id);t.add(i);r=this._leagueStandingsService.getAllFilteredByTeamId(this._leagueId(),this.teamPartial().id,!0);t.add(r);Q.all([i.deferred.promise,r.deferred.promise]).spread(function(t,i){n.setData(t,n.teamPartial(),n.teamPartial().manager,i,n._playersService,n._offersService,n._transferPlayersService)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done();t.execute()},t.prototype.loadPlayerRatings=function(){var n=this;this.playerRatingsLoaded()||this.loadSquadList().then(function(){WebApi.getInstance().execute(n._playerGradesService.getByTeamId(n._leagueId(),n.teamPartial().id)).then(function(t){n.teamPartial().players.forEach(function(n){n.playerGrades=Enumerable.from(t).where(function(t){return t.playerId===n.id}).toArray()});n.setData(n.teamPartial().players,n.teamPartial(),null,null,n._playersService,n._offersService,n._transferPlayersService);n.playerRatingsLoaded(!0);n.scrollToCurrentWeek()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleError(n)}).done()}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done()},t.prototype.loadTransfers=function(){var n=this;this.transfersPartial()||WebApi.getInstance().execute(this._transfersService.getAllTransfersForTeam(this._leagueId(),this.teamPartial().id)).then(function(t){n.transfersPartial(new TransfersPartial(t,n._playersService,n._offersService))}).done()},t.prototype.refreshData=function(n){this.teamPartial()&&this.teamPartial().id===n||(this.isSessionTeam(this._isSessionLeague()&&n===SessionManager.getTeamId()),this.teamPartial(Enumerable.from(this.teamsPartial().getItems()).firstOrDefault(function(t){return t.id===n})),this.playersGroupablePartial(null),this.transfersPartial(null),this.playerRatingsLoaded(!1),this.scrollToCurrentWeek(),this.loadData())},t.prototype.enrichPlayers=function(n,t,i,r,u){n.forEach(function(n){Enumerable.from(t).any(function(t){return t.playerId===n.id})&&(n.offers=Enumerable.from(t).where(function(t){return t.player.id===n.id}).toArray());i&&(n.trainingSessions=Enumerable.from(i).where(function(t){return t.playerId===n.id}).toArray());r&&(n.transferPlayer=Enumerable.from(r).firstOrDefault(function(t){return t.player.id===n.id}));u&&(n.doctorTreatments=Enumerable.from(u).where(function(t){return t.playerId===n.id}).toArray())})},t.prototype.setData=function(n,t,i,r,u,f,e){r&&(t.leagueStanding=r);i&&(t.manager=i);n&&(t.players=n);this.teamPartial(new TeamPartial(t,u,f));this.playersGroupablePartial(new PlayersGroupablePartial(n,u,f,e))},t.prototype.showPlayerModal=function(n){var i=this,t,r;this.areTransfersEnabled()&&this._isSessionLeague()?!this.isSessionTeam()&&n.isOnTransferList()?(r=this._offersPartial()?this._offersPartial().getLatestOfferForPlayer(n.id):null,t=new TransferDomesticPlayerModal(n.transferPlayerPartial(),this._offersService,r)):this.isSessionTeam()||n.isInNegotiation()?!this.isSessionTeam()&&n.isInNegotiation()?t=new PlayerInNegotiationModal(n,ModalTemplate.InNegotiation):this.isSessionTeam()&&n.isOnTransferList()?(t=new TransferPlayerModal(n.transferPlayerPartial(),ModalTemplate.CancelTransferPlayer,n),t.player().isTransferred.subscribe(function(n){n&&(i.playerRatingsLoaded(!1),i.playersGroupablePartial(null),i.loadData())})):this.isSessionTeam()&&!n.isOnTransferList()&&(t=new SellPlayerModal(n,this._transfersService,appViewModel.userPartialV1Dot1().signUpTimestamp,this.areTransfersEnabled(),this._shouldSurfaceSellPlayer()),t.player.isOnTransferList.subscribe(function(n){n&&i.refreshPlayerData()}),t.quickSellDeferred.promise.then(function(){i.playerRatingsLoaded(!1);i.playersGroupablePartial(null);i.transfersPartial(null);i.loadPlayerRatings();i.loadTransfers()})):t=new OfferPlayerModal(n,this._offersService,null):t=new PlayerModal(n,ModalTemplate.Player);t&&t.show()},t.prototype.refreshPlayerData=function(){this.playerRatingsLoaded(!1);this.playersGroupablePartial(null);this.loadData()},t.prototype.showTransferHistoryPlayerModal=function(n){if(n.teamId===SessionManager.getTeamId())this.showPlayerModal(n);else{var t=new PlayerModal(n,ModalTemplate.Player);t.show()}},t.prototype.scrollToCurrentWeek=function(){if($(".current-week").length){var n=$(".current-week").offset().left+$(".current-week").width()/2,t=$("#player-grade-table-grades").offset().left+$("#player-grade-table-grades").width()/2;$("#player-grade-table-grades").animate({scrollLeft:$("#player-grade-table-grades").scrollLeft()+n-t})}},t.prototype.openHelpTextModal=function(){new HelpTextModal(ModalTemplate.SquadHelpText,HelpTextModal.Type.Squad).show()},t.prototype.openSquadNumberModal=function(n){new SquadNumbersModal(n,this.teamPartial(),this._lockedSquadNumbersPartial(),this._updatePlayerSubscription).show()},t}(BaseView),function(n){var t;(function(n){n[n.List=0]="List";n[n.Transfers=1]="Transfers";n[n.Ratings=2]="Ratings"})(t=n.Tab||(n.Tab={}))}(SquadView||(SquadView={}));window.onload=function(){initLayout().done(function(){appViewModel.appViewModelDataLoadedDeferred.promise.then(function(){var r=$("#viewdata"),t=$("#viewdata").data("leagueid")!=null?$("#viewdata").data("leagueid"):0,i=$("#viewdata").data("teamid")!=null?$("#viewdata").data("teamid"):0,n=new SquadView(new PlayersService,new TeamsService,new ManagersService,new LeagueStandingsService,new OffersService,new TrainingSessionService,new TransferPlayerService,new DoctorTreatmentService,new TransfersService,new PlayerGradesService,new LeaguesService,new LeagueSettingsService,new UsersService,new BaseTeamsService,i,t);$("#cached-html-wrapper-squad").load("/Cached/SquadPartial?v="+buildReleaseVersion,null,function(){ko.bindContentViewModel(n);n.isDataLoadedDeferred.promise.fin(function(){$("a[data-toggle='tab']").on("shown.bs.tab",function(t){var i=t.target;n.switchTabs($(i).attr("href"))});var t=window.location.hash;t!==""&&$(".nav-tabs a[href="+t+"]").tab("show")})})})})}