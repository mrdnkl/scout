var ScoutInstructionService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/scoutinstructions");return RequestItemFactory.getInstance().createRequestItemSingle(i,!0)},n.prototype.start=function(n,t,i,r,u,f,e,o,s){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/scoutinstructions",HttpMethod.Post,{position:i,age:r,quality:u,style:f,timerGameSettingId:e,nationalityId:o,leagueTypeId:s})},n}(),TransferPlayerService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getByTransferPlayerType=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers/"+i);return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.boostScout=function(n,t,i,r,u,f){var e={productId:i,maxPriceGameSettingId:u,minPriceGameSettingId:f,timerGameSettingId:r};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/boostscout",HttpMethod.Put,e)},n.prototype.claim=function(n,t,i,r,u){var f={timerGameSettingId:i,maxPriceGameSettingId:r,minPriceGameSettingId:u};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/claimscout",HttpMethod.Put,f)},n.prototype.buy=function(n,t,i,r){var u={productId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/buy",HttpMethod.Put,u)},n.prototype.validateTransfer=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/validatetransfer",HttpMethod.Post)},n.prototype.deleteById=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i,HttpMethod.Delete)},n}(),NationalitiesService=function(){function n(){}return n.prototype.getNationalities=function(n){n===void 0&&(n=!0);var t=(new breeze.EntityQuery).from("/nationalities"),i=n?CacheKey[CacheKey.Nationalities]:null;return RequestItemFactory.getInstance().createRequestItem(t,i)},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerModal=function(n){function t(t,i,r){r===void 0&&(r=null);var u=n.call(this,{template:i,showCloseButton:!0,container:ModalContainer.Generic,screenModeXs:ScreenMode.Normal})||this;return u.player=ko.observable(),u._playerParent=ko.observable(),u.player(t),u._playerParent(r),u.player().isTransferred.subscribe(function(n){n&&u.hide()}),u}return __extends(t,n),t.prototype.removeFromTransferlist=function(){var n=this;this.player().removeFromTransferlist().then(function(t){t&&(n._playerParent()&&(n._playerParent().transferPlayer=null,n._playerParent().transferPlayerPartial(null)),n.hide())}).done()},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProgressPartial=function(n){function t(t){var i=n.call(this)||this;return i.isAnimating=ko.observable(!1),i.progressPercentage=ko.observable(),i.animatedProgressIncrease=ko.observable(0),i.totalPercentage=ko.computed(function(){return i.progressPercentage()+i.progressForecast}),i.forecastPercentage=ko.observable(),Helper.copyProperties(t,i),i.progressPercentage(i.progress),i.forecastPercentage(i.totalPercentage()>100?100-i.progress:i.progressForecast),i}return __extends(t,n),t.prototype.animate=function(){var n=this,i=Q.defer(),t,r;return this.isAnimating(!0),t=0,r=setInterval(function(){n.progressPercentage(n.progressPercentage()+1);n.forecastPercentage()>0&&n.forecastPercentage(n.forecastPercentage()-1);n.animatedProgressIncrease(n.animatedProgressIncrease()+1);n.progressPercentage()>=100&&(n.progressPercentage(0),n.level++);t++;t>=n.totalProgressIncrease&&(clearInterval(r),setTimeout(function(){i.resolve(!0);n.isAnimating(!1)},1e3))},10),i.promise},t}(Progress),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPartial=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this,h,c,s,l,a;return o.isAttacker=!1,o.isMidfielder=!1,o.isDefender=!1,o.isGoalKeeper=!1,o.isAvailable=ko.observable(!1),o.isInjured=ko.observable(!1),o.isSuspended=ko.observable(!1),o.lineupNr=ko.observable(0),o.isInLeague=!1,o.isSessionPlayer=!1,o.statMain=0,o.imageLarge=ko.observable(),o.daysUnavailable=ko.observable(0),o.quickSellSellPrice=ko.observable(0),o.isOnTransferList=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.transferPlayerPartial()?!0:!1}),o.isInNegotiation=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.offersPartial()?o.offersPartial().getItems().length>0:!1}),o.isInTraining=ko.computed(function(){return o.trainingSessionsPartial()?o.trainingSessionsPartial().currentTrainingSession()!==null&&!o.trainingSessionsPartial().currentTrainingSession().countdownTimerPartial().claimed():!1}),o.isInSelection=ko.computed(function(){return o.lineupNr()>0}),o.isInLineup=ko.computed(function(){return o.lineupNr()>0&&o.lineupNr()<=11}),o.isOnBench=ko.computed(function(){return o.isInSelection()&&!o.isInLineup()}),o.squadNumberObservable=ko.observable(),o.squadNumbersEnabled=LeanplumHelper.getInstance().getVariables("Settings","SquadNumbersEnabled",!1),o.nameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.name:o.squadNumberObservable()+". "+o.name}),o.fullNameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.fullName:o.squadNumberObservable()+". "+o.fullName}),o.squadOrLineupNumber=ko.pureComputed(function(){var n=o.squadNumbersEnabled?o.squadNumberObservable():o.lineupNr();return n===0?"":""+n}),o.nameWithSquadNumberForMatch=ko.pureComputed(function(){return o.playerGradePartial()&&o.playerGradePartial().squadNumber!==0?o.playerGradePartial().squadNumber+". "+o.name:o.name}),Helper.copyProperties(t,o),o.daysUnavailable(o.unavailable),i&&(o._playersService=i),r&&(o._offersService=r),o.nationality&&o.nationalityPartial(new NationalityPartial(o.nationality)),o.team&&o.teamPartial(new TeamPartial(o.team)),h=LeanplumHelper.getInstance().getVariables("Settings","AssetsPlayersEnabled",!0),o.assets&&h&&o.assetsPartial(new AssetsPartial(o.assets)),o.foul&&o.foulPartial(new FoulPartial(o.foul)),o.injury&&o.injuryPartial(new InjuryPartial(o.injury)),o.doctorTreatment&&o.doctorTreatmentPartial(new DoctorTreatmentPartial(o.doctorTreatment)),o.doctorTreatments&&o.doctorTreatmentsPartial(new DoctorTreatmentsPartial(o.doctorTreatments)),o.trainingSessions&&o.trainingSessionsPartial(new TrainingSessionsPartial(o.trainingSessions,u,e)),o.transferPlayer&&o.transferPlayerPartial(new TransferPlayerPartial(o.transferPlayer,f)),o.playerGrade&&o.playerGradePartial(new PlayerGradePartial(o.playerGrade)),o.playerGrades&&o.playerGradesPartial(new PlayerGradesPartial(o.playerGrades)),o.training&&o.trainingForecastPartial(new TrainingForecastPartial(o.training)),o.offers&&o.offersPartial(new OffersPartial(o.offers)),o.isAttacker=o.position===PlayerPosition.A,o.isMidfielder=o.position===PlayerPosition.M,o.isDefender=o.position===PlayerPosition.D,o.isGoalKeeper=o.position===PlayerPosition.G,o.isAvailable(o.status===PlayerStatus.Available),o.isInjured(o.status===PlayerStatus.Injured),o.isSuspended(o.status===PlayerStatus.Suspended),o.lineupNr(o.lineup),o.isInLeague=o.leagueId===SessionManager.getLeagueId(),o.isSessionPlayer=o.isInLeague&&o.teamId===SessionManager.getTeamId(),o.statMain=o.isAttacker?o.statAtt:o.isMidfielder?o.statOvr:o.statDef,o.assets&&h&&(c=Enumerable.from(o.assets).firstOrDefault(function(n){return n.type===AssetType.NormalPassport}),c!=null&&o.imageLarge(c.path)),s=new Progress,s.level=o.statMain,s.progress=o.trainingProgress,s.progressForecast=o.training?o.trainingForecastPartial().forecast:0,o.trainingProgressPartial(new ProgressPartial(s)),o.isSessionPlayer&&appViewModel&&appViewModel.gameSettingsPartial()&&(l=appViewModel.gameSettingsPartial().getGameSettings(GameVarCategory.Transfer,"QuickSellPricePercentage"),a=Enumerable.from(l).firstOrDefault(function(n){return n.variation===0&&n.increment===0}),o.quickSellSellPrice(o.value*(a.value/100))),o.squadNumberObservable(o.squadNumber),o}return __extends(t,n),t.prototype.setLineup=function(n){this.lineupNr(n)},t.prototype.sell=function(n){var i=this,t=Q.defer(),r;return this._playersService?(WebApi.getInstance().execute(this._playersService.sell(this.leagueId,this.teamId,this.id,n)).then(function(n){i.transferPlayer=n;i.transferPlayerPartial(new TransferPlayerPartial(n,new TransferPlayerService));t.resolve(n);i.addFeedbackToast()}).fail(function(n){WebapiHelper.handleAndAlertError(n);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"PlayerPartial.sell.sellDeferred: Error selling player.");t.reject(i)}).done(),t.promise):(r=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("PlayerPartial.sell.sellDeferred: No playersService when trying to sell a player."),t.reject(r),t.promise)},t.prototype.offer=function(n){if(this._offersService){var t=this._offersService.post(this.leagueId,SessionManager.getTeamId(),this.id,n);return t.deferred.promise.then(function(){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).done(),WebApi.getInstance().execute(t)}},t.prototype.willImproveByTraining=function(){return this.trainingForecastPartial()?this.trainingProgress+this.trainingForecastPartial().forecast>=100:!1},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.transferPlayerPartial()&&this.transferPlayerPartial().playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerToTransferlist,this.transferPlayerPartial().playerPartial().imageLarge(),[{key:"playername",value:this.transferPlayerPartial().playerPartial().name}],this.getPlayerWorldStarLevel(),this.rarity))},t.prototype.getPlayerWorldStarLevel=function(){var t=this,i=LeanplumHelper.getInstance().getVariables("WorldStar"),n=Enumerable.from(i).where(function(n){return t.statMain>=n.value}).firstOrDefault();if(!n)return PlayerWorldStarLevel.None;switch(n.key){case"MinRatingLevel1":return PlayerWorldStarLevel.WorldStar1;case"MinRatingLevel2":return PlayerWorldStarLevel.WorldStar2}},t.prototype.isWorldStar=function(){return this.getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1},t.prototype.isLegend=function(){return this.rarity==PlayerRarity.Legend},t.prototype.isInForm=function(){return this.rarity==PlayerRarity.InForm},t.prototype.getWorldStarClassName=function(){var n=this.getPlayerWorldStarLevel();switch(n){case PlayerWorldStarLevel.WorldStar1:return"world-star-1";case PlayerWorldStarLevel.WorldStar2:return"world-star-2";default:return"no-world-star"}},t.prototype.assignSquadNumber=function(n){var t=this,i=Q.defer();if(this._playersService)return WebApi.getInstance().execute(this._playersService.assignSquadNumber(this.leagueId,this.teamId,this.id,n)).then(function(n){t.squadNumber=n.squadNumber;t.squadNumberObservable(n.squadNumber);n.squadNumber&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.SquadNumberAssigned,t.imageLarge(),[{key:"SquadNumber",value:String(n.squadNumber)}],t.getPlayerWorldStarLevel(),t.rarity));i.resolve(n)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not assign squad number");i.reject(t)}).done(),i.promise},t}(Player),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingForecastPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TrainingForecast),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayersPartial=function(n){function t(t,i,r,u,f){f===void 0&&(f=!1);var e=n.call(this)||this;return e.totalValue=ko.computed(function(){return Enumerable.from(e.getItems()).sum(function(n){return n.value})}),e.attackers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isAttacker}).toArray()}),e.midfielders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isMidfielder}).toArray()}),e.defenders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isDefender}).toArray()}),e.goalkeepers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isGoalKeeper}).toArray()}),e.injured=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isInjured()}).toArray()}),e.suspended=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isSuspended()}).toArray()}),e.currentLineupAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isInLineup()})}),e.currentBenchAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isOnBench()})}),e.isLineupComplete=ko.computed(function(){return e.currentLineupAmount()==11}),e.isBenchComplete=ko.computed(function(){return e.currentBenchAmount()==7}),e._playersService=i,e._offersService=r,f&&(e.sortingEnabled(!0),e.sortOrder=SortOrder.Descending),e.setItemsFromModels(t,i,r,u),e}return __extends(t,n),t.prototype.isLineEligibleForTransfer=function(n){switch(n){case PlayerPosition.A:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.A}).count()>3;case PlayerPosition.D:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.D}).count()>4;case PlayerPosition.M:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.M}).count()>4;case PlayerPosition.G:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.G}).count()>2;default:return!1}},t.prototype.getPlayersEligibleToBePutOnTransferlist=function(){var n=this;return Enumerable.from(this.getItems()).where(function(t){return!t.isOnTransferList()&&n.isLineEligibleForTransfer(t.position)}).toArray()},t.prototype.getReserves=function(){return this.getItems().filter(function(n){return!n.isInSelection()})},t.prototype.getNotInLineup=function(){return this.getItems().filter(function(n){return!n.isInLineup()})},t.prototype.getPlayerBySquadNumber=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.squadNumberObservable()===n})},t.prototype.getByStaffMemberType=function(n){return n===StaffMemberType.AttackerCoach?this.attackers():n===StaffMemberType.MidfielderCoach?this.midfielders():n===StaffMemberType.DefenderCoach?this.defenders():n===StaffMemberType.GoalkeeperCoach?this.goalkeepers():[]},t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.statDef})},t.prototype.orderPlayersByGoals=function(){this.sortItems(function(n){return n.goals})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.statMain})},t.prototype.orderPlayersByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByNationality=function(){this.sortItems(function(n){return n.nationality.code})},t.prototype.orderPlayersByFitness=function(){this.sortItems(function(n){return n.fitness})},t.prototype.orderPlayersByMorale=function(){this.sortItems(function(n){return n.morale})},t.prototype.orderPlayersByLineup=function(){this.sortItems(function(n){return n.lineup})},t.prototype.orderPlayersByAverage=function(){this.sortItems(function(n){return n.averagePlayerGrade})},t.prototype.orderPlayersByGradeForWeek=function(n){this.sortItems(function(t){return t.playerGradesPartial().getGradeForWeek(n)})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.position})},t.prototype.orderPlayersBySuspension=function(){this.sortItems(function(n){return n.isSuspended})},t.prototype.getTopscorers=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.goals},!0)).skip(n).take(t).toArray()},t.prototype.getAssists=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.assists},!0)).skip(n).take(t).toArray()},t.prototype.getPlayers=function(n,t){return Enumerable.from(this.getItems()).skip(n).take(t).toArray()},t.prototype.getOrderedByPlayerGradeLineup=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerGradePartial()!==null&&n.playerGradePartial()!==undefined}).orderBy(function(n){return n.playerGradePartial().lineup}).toArray()},t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new PlayerPartial(n,t,i,null,r))});this.setItems(u)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ScoutInstructionPartial=function(n){function t(t){var i=n.call(this)||this;return i.scoutBoostBosscoinProductName="ScoutBoostCost",i.boostCost=ko.computed(function(){if(!i.countdownTimerPartial()||!appViewModel.bossCoinProductsPartial()||i.countdownTimerPartial().isClaimable())return 0;var n=i.countdownTimerPartial().getBosscoinProductForCurrentIncrement(i.scoutBoostBosscoinProductName);return n?n.value:0}),i.hasRunningScoutInstruction=ko.computed(function(){return i.countdownTimerPartial()?!0:!1}),t&&Helper.copyProperties(t,i),i.countdownTimer&&i.countdownTimerPartial(new CountdownTimerPartial(i.countdownTimer)),i}return __extends(t,n),t.prototype.getVisibleScoutSearchView=function(){return this.position!==PlayerPosition.None&&this.ageCategory!==AgeCategory.NoPreference&&this.quality!==PlayerQualityRange.NoPreference?t.ScoutIsSearchingPossibleViews.AllCriteria:this.position!==PlayerPosition.None&&this.quality!==PlayerQualityRange.NoPreference?t.ScoutIsSearchingPossibleViews.PositionAndQuality:this.ageCategory!==AgeCategory.NoPreference&&this.quality!==PlayerQualityRange.NoPreference?t.ScoutIsSearchingPossibleViews.AgeAndQuality:this.position!==PlayerPosition.None&&this.ageCategory!==AgeCategory.NoPreference?t.ScoutIsSearchingPossibleViews.PositionAndAge:this.position!==PlayerPosition.None?t.ScoutIsSearchingPossibleViews.OnlyPosition:this.ageCategory!==AgeCategory.NoPreference?t.ScoutIsSearchingPossibleViews.OnlyAge:this.quality!==PlayerQualityRange.NoPreference?t.ScoutIsSearchingPossibleViews.OnlyQuality:t.ScoutIsSearchingPossibleViews.NoCriteria},t}(ScoutInstruction);(function(n){var t;(function(n){n[n.NoCriteria=0]="NoCriteria";n[n.OnlyPosition=1]="OnlyPosition";n[n.OnlyAge=2]="OnlyAge";n[n.OnlyQuality=3]="OnlyQuality";n[n.PositionAndAge=4]="PositionAndAge";n[n.AgeAndQuality=5]="AgeAndQuality";n[n.PositionAndQuality=6]="PositionAndQuality";n[n.AllCriteria=7]="AllCriteria"})(t=n.ScoutIsSearchingPossibleViews||(n.ScoutIsSearchingPossibleViews={}))})(ScoutInstructionPartial||(ScoutInstructionPartial={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueTypePartial=function(n){function t(t){var i=n.call(this)||this,f,r,u;return i.imageLarge="",i.imageSmall="",Helper.copyProperties(t,i),f=LeanplumHelper.getInstance().getVariables("Settings","AssetsLeagueTypesEnabled",!0),i.assets&&f&&(r=Enumerable.from(i.assets).firstOrDefault(function(n){return n.type===AssetType.NormalLeague}),r!=null&&(i.imageLarge=r.path),u=Enumerable.from(i.assets).firstOrDefault(function(n){return n.type===AssetType.SmallLeague}),u!=null&&(i.imageSmall=u.path),i.assetsPartial(new AssetsPartial(i.assets))),i.historyItems&&i.historyItemsPartial(new HistoryItemsPartial(i.historyItems)),i.winnersLeagueQualification&&i.winnersLeagueQualificationPartial(new WinnersLeagueQualificationPartial(i.winnersLeagueQualification)),i}return __extends(t,n),t.prototype.navigateToActiveLeague=function(n){window.location.href=Urls.activeLeaguesLeague+"/"+n+"/"+this.id},t.prototype.navigateToBaseLeague=function(){window.location.href=Urls.leagueTypesLeague+"/"+this.id},t.prototype.navigateToChooseTeam=function(){window.location.href=Urls.chooseTeamForLeagueType+"/"+this.id},t.prototype.isLeagueTypeCompleted=function(){return this.historyItemsPartial()?this.historyItemsPartial().hasBeenChampion()||this.historyItemsPartial().hasWonCup()||this.historyItemsPartial().hasReachedGoal():!1},t.prototype.isTournamentLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Tournament},t.prototype.isKnockoutLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Knockout},t.prototype.isPoulesLeagueType=function(){return this.leagueScheduleType===LeagueScheduleType.Poules},t.prototype.leagueTypeHasPoulesSchedule=function(){return this.isPoulesLeagueType()||this.isTournamentLeagueType()},t.prototype.getAmountOfPouleMatches=function(){switch(this.leagueScheduleType){case LeagueScheduleType.Tournament:return this.weeks-this.totalCupWeeks;case LeagueScheduleType.Poules:return this.weeks;default:return 0}},t}(LeagueType),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),LeagueTypesPartial=function(n){function t(t){var i=n.call(this)||this;return i._defaultPopularLeagueTypeIds=[25,8,14,12,11,76,17,19],i.countriesStillToPlayFilterEnabled=ko.observable(!1),i.countriesAlreadyPlayedFilterEnabled=ko.observable(!1),i.cupWonFilterEnabled=ko.observable(!1),i.goalAchievedFilterEnabled=ko.observable(!1),i.championshipWonFilterEnabled=ko.observable(!1),i.isLeagueTypesFilterVisible=ko.observable(!1),i.sortingEnabled(!0),i.sortOrder=SortOrder.Descending,i.setItemsFromModels(t),i._leanplumAgentVariables=LeanplumHelper.getInstance().getVariables("Agent"),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new LeagueTypePartial(n))});this.setItems(t)},t.prototype.filterByCountriesStillToPlay=function(){return this.removeFilter(function(n){return n.historyItems.length},this.countriesAlreadyPlayedFilterEnabled),this.filterItems(function(n){return!n.historyItems.length},this.countriesStillToPlayFilterEnabled),!0},t.prototype.filterByCountriesAlreadyPlayed=function(){return this.removeFilter(function(n){return!n.historyItems.length},this.countriesStillToPlayFilterEnabled),this.filterItems(function(n){return n.historyItems.length},this.countriesAlreadyPlayedFilterEnabled),!0},t.prototype.filterByCupWon=function(){this.filterItems(function(n){return n.historyItemsPartial().hasWonCup()},this.cupWonFilterEnabled)},t.prototype.filterByGoalAchieved=function(){this.filterItems(function(n){return n.historyItemsPartial().hasReachedGoal()},this.goalAchievedFilterEnabled)},t.prototype.filterByHasWonChampionship=function(){this.filterItems(function(n){return n.historyItemsPartial().hasBeenChampion()},this.championshipWonFilterEnabled)},t.prototype.removeFilters=function(){n.prototype.removeFilters.call(this);this.championshipWonFilterEnabled(!1);this.goalAchievedFilterEnabled(!1);this.cupWonFilterEnabled(!1);this.countriesAlreadyPlayedFilterEnabled(!1);this.countriesStillToPlayFilterEnabled(!1)},t.prototype.orderByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderByLeagueCount=function(){this.sortItems(function(n){return n.stats.leagues})},t.prototype.orderByLastUpdate=function(){this.sortItems(function(n){return n.lastUpdate})},t.prototype.orderBySeason=function(){this.sortItems(function(n){return n.season})},t.prototype.orderByHasCup=function(){this.sortItems(function(n){return n.hasCup})},t.prototype.orderByTeamCount=function(){this.sortItems(function(n){return n.teamCount})},t.prototype.orderByThanksTo=function(){this.sortItems(function(n){return n.thanksTo})},t.prototype.getLeagueTypesForContinentGroupedByLeagueGroupType=function(n){var t=Enumerable.from(this.getFilteredItems());return t=n===Continent.World?t.where(function(n){return n.continent!==Continent.None}):t.where(function(t){return t.continent===n}),t=t.orderBy(function(n){return n.type}),t.groupBy(function(n){return n.type},function(n){return n},function(n,t){return{leagueGroupType:n,leagueTypes:t.toArray()}}).toArray()},t.prototype.getLeagueTypeCodeFromLeaguetypeId=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.id===n}).select(function(n){return n.code.toLowerCase()}).firstOrDefault()},t.prototype.getLeagueTypeNameFromLeagueTypeId=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.id===n}).select(function(n){return n.name}).firstOrDefault()},t.prototype.filterById=function(n){var i=this,t=[];return n.forEach(function(n){var r=Enumerable.from(i.getItems()).firstOrDefault(function(t){return t.id===n});r&&t.push(r)}),t},t.prototype.getRecommendedLeagueTypes=function(n){var t=this.filterById(this.getPopularLeagueTypeIds()),i;return n?(i=this.getMajorLeagueTypeForCountryCode(n.countryCode),!i)?t:this.insertLeagueTypeInTopRecommendedLeagueTypes(t,i):t},t.prototype.getMajorLeagueTypeForCountryCode=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.code.toLowerCase()===n.toLowerCase()&&t.type===LeagueGroupType.Major})},t.prototype.insertLeagueTypeInTopRecommendedLeagueTypes=function(n,t){var i=this._leanplumAgentVariables&&this._leanplumAgentVariables.hasOwnProperty("AgentPopularLeaguesPositionOwnCountry")?this._leanplumAgentVariables.AgentPopularLeaguesPositionOwnCountry:3,r=n.indexOf(t);return r>=i&&n.splice(r,1),n.indexOf(t)<=-1&&n.splice(i-1,0,t),n},t.prototype.getPopularLeagueTypeIds=function(){var t=this._defaultPopularLeagueTypeIds,i,n;if(!this._leanplumAgentVariables||this._leanplumAgentVariables&&!this._leanplumAgentVariables.hasOwnProperty("AgentPopularLeagues"))return t;for(i=this._leanplumAgentVariables.AgentPopularLeagues,n=0;n<t.length;n++)i&&i[n+1]&&(t[n]=i[n+1]);return t},t.prototype.getLeagueTypeById=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.id===n})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerPartial=function(n){function t(t,i){var r=n.call(this)||this;return r._bossCoinConversionProductName="",r._bossCoinFeeProductName="",r.isBossCoinCompletionAllowed=ko.observable(!1),r.isRemoving=ko.observable(!1),r.isTransferred=ko.observable(!1),r.isBuying=ko.observable(!1),r.isOnList=!1,r._isInitialized=ko.observable(!1),r.bossCoinConversionCost=ko.computed(function(){if(!appViewModel.clubFundsWalletPartial()||!appViewModel.bossCoinProductsPartial()||!r._isInitialized())return 0;var n=appViewModel.bossCoinProductsPartial().getBossCoinProduct(r._bossCoinConversionProductName);return n?appViewModel.clubFundsWalletPartial().calculateBossCoinConversionCount(r.price,n):0}),r.bossCoinTransferFeeCost=ko.computed(function(){return!appViewModel.bossCoinProductsPartial()||!r._isInitialized()?0:appViewModel.bossCoinProductsPartial().getValue(r._bossCoinFeeProductName)}),r.clubFundsCost=ko.computed(function(){return!appViewModel.clubFundsWalletPartial()||!r._isInitialized()?0:appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(r.price)}),r.bossCoinCost=ko.computed(function(){return r.bossCoinTransferFeeCost()+r.bossCoinConversionCost()}),Helper.copyProperties(t,r),r._transferPlayerService=i,r.team&&r.teamPartial(new TeamPartial(r.team)),t.type===TransferPlayerType.Scout?(r._bossCoinFeeProductName="ScoutFee",r._bossCoinConversionProductName="BossCoinConversionRateScout"):t.player.rarity==PlayerRarity.Legend&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignLegendTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):t.player.rarity==PlayerRarity.InForm&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignInFormTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):(r._bossCoinFeeProductName="TransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"),r.countdownTimer&&(r.countdownTimerPartial(new CountdownTimerPartial(r.countdownTimer)),r.isOnList=r.countdownTimer.finishedTimestamp>Helper.unixTimeStamp()),r.player&&(r.team&&(r.player.team=r.team),r.playerPartial(new PlayerPartial(r.player))),appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&r.isBossCoinCompletionAllowed(appViewModel.leaguePartial().settingsPartial().isBossCoinCompletionAllowed),r._isInitialized(!0),r}return __extends(t,n),t.prototype.buy=function(){this.isBossCoinCompletionAllowed()?this.buyWithBossCoinCompletion():this.buyWithoutBossCoinCompletion()},t.prototype.buyWithBossCoinCompletion=function(){var n=this,t,i,r;this.isBuying()||(t=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinConversionProductName),t)&&(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),i=this.price,r=this.clubFundsCost(),WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.TransferPlayer,i,t,n.bossCoinTransferFeeCost(),!1,n.player.name).then(function(u){var f=n.bossCoinCost()>n.bossCoinTransferFeeCost();f&&LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(t.name,n.bossCoinConversionCost());appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinCost(),n.playerPartial().name,r,f,!0,!0,n._bossCoinFeeProductName,{},!1).then(function(){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(u).then(function(){appViewModel.executePaidAction(n.transferPlayer(i,r));n.isBuying(!1)})}).fail(function(t){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done())},t.prototype.buyWithoutBossCoinCompletion=function(){var n=this;this.isBuying()||(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),this._isInitialized&&appViewModel.clubFundsWalletPartial()&&appViewModel.clubFundsWalletPartial().calculateClubFundsShortageForPrice(this.price)===0?WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){var t=n.clubFundsCost();appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinTransferFeeCost(),n.playerPartial().name,t,!1,!0,!0,n._bossCoinFeeProductName).then(function(){appViewModel.executePaidAction(n.transferPlayer(t,t));n.isBuying(!1)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done():(new NotEnoughClubFundsModal(this.price,this.bossCoinTransferFeeCost(),!1).show(),this.isBuying(!1)))},t.prototype.transferPlayer=function(n,t){var i=Q.defer(),r=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinFeeProductName),u;return r==null?(u=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("TransferPlayerPartial.transferPlayer.deferred: No Boss Coin product partial when transfering a player."),i.reject(u),i.promise):(this.executeTransfer(r,n,t).then(function(n){i.resolve(n)}),i.promise)},t.prototype.executeTransfer=function(n,t,i){var r=this,u=Q.defer(),f=this.bossCoinTransferFeeCost();return WebApi.getInstance().execute(this._transferPlayerService.buy(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id,n.id)).then(function(){r.addFeedbackToast();r.isTransferred(!0);LeanplumHelper.getInstance().trackBossCoinSpentEvent(r._bossCoinFeeProductName,f);var n;switch(r.type){case TransferPlayerType.Scout:n=LeanplumHelper.ClubFundsProductType.ScoutPlayer;break;case TransferPlayerType.SpecialOffer:n=LeanplumHelper.ClubFundsProductType.SpecialOfferPlayer;break;case TransferPlayerType.Transferlist:default:n=LeanplumHelper.ClubFundsProductType.TransferPlayer}LeanplumHelper.getInstance().trackClubFundsSpentEvent(n,i,t,{PlayerName:r.playerPartial()?r.playerPartial().name:""});u.resolve(!0)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"failed to buy player");u.reject(t)}).done(),u.promise},t.prototype.removeFromTransferlist=function(){var t=this,n=Q.defer();return this.isRemoving(!0),WebApi.getInstance().execute(this._transferPlayerService.deleteById(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){t.isTransferred(!0);n.resolve(!0)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.resolve(!1)}).fin(function(){t.isRemoving(!1)}).done(),n.promise},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerBought,this.playerPartial().imageLarge(),[{key:"playername",value:this.playerPartial().name}],this.playerPartial().getPlayerWorldStarLevel(),this.playerPartial().rarity))},t}(TransferPlayer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayersPartial=function(n){function t(t,i){var r=n.call(this)||this;return r.countdownTimerPartial=ko.observable(),r.playerHasBeenTransferred=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isTransferred()})}),r.hasScoutResults=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isOnList})}),r._transferPlayerService=i,r.sortingEnabled(!0),r.sortOrder=SortOrder.Descending,r.setItemsFromModels(t,i),r}return __extends(t,n),t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.player.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.player.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.player.statDef})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.player.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.player.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.playerPartial().statMain})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.playerPartial().position})},t.prototype.getByPlayerId=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.player.id===n})},t.prototype.setItemsFromModels=function(n,t){var i=this,r=[];n.forEach(function(n){!i.countdownTimerPartial()&&n.countdownTimer&&i.countdownTimerPartial(new CountdownTimerPartial(n.countdownTimer));r.push(new TransferPlayerPartial(n,t))});this.setItems(r);this.orderPlayersByPrice()},t.prototype.getAbleToBuy=function(n,t){return Enumerable.from(this.getExcludedOwningTeam(n)).where(function(n){return n.price<=t}).toArray()},t.prototype.getExcludedOwningTeam=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.playerPartial().teamId!==n}).toArray()},t.prototype.getWorldStar=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1}).toArray()},t.prototype.getLegends=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isLegend()}).toArray()},t.prototype.containsWorldStar=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1})},t.prototype.getInForms=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isInForm()}).toArray()},t.prototype.containsInForm=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isInForm()})},t.prototype.containsLegend=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isLegend()})},t}(PartialArrayViewModel),ScoutListGroupablePartial=function(){function n(n,t){var i=this;this.transferPlayers=ko.observableArray();this.sortedTransferPlayersList=ko.computed(function(){if(!i.transferPlayers())return null;var n=Enumerable.from(i.transferPlayers()).groupBy(function(n){return n.countdownTimer.id},function(n){return n},function(n,t){return{countdownTimerId:n,players:new TransferPlayersPartial(t.toArray(),i._transferPlayerService)}});return Enumerable.from(n).orderByDescending(function(n){return n.countdownTimerId}).toArray()});this.hasScoutResults=ko.computed(function(){return i.sortedTransferPlayersList()?Enumerable.from(i.sortedTransferPlayersList()).any(function(n){return n.players.countdownTimerPartial().timerState()===TimerState.InProgress}):!1});this._transferPlayerService=t;this.transferPlayers(n)}return n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ScoutView=function(n){function t(t,i,r,u,f){var e=n.call(this)||this;return e.positionPartial=ko.observable(new SingleSelectableEnumViewModel(PlayerPosition,"position-dropdown")),e.stylePartial=ko.observable(new SingleSelectableEnumViewModel(PlayerStyle,"style-dropdown")),e.qualityPartial=ko.observable(new SingleSelectableEnumViewModel(PlayerQualityRange,"quality-dropdown")),e.agePartial=ko.observable(new SingleSelectableEnumViewModel(AgeCategory,"age-dropdown")),e.nationalitiesPartial=ko.observable(),e.leagueTypesPartial=ko.observable(),e.allLeagueTypesPartial=ko.observable(),e.allNationalitiesPartial=ko.observable(),e.forceFilterView=ko.observable(!1),e.scoutInstructionPartial=ko.observable(),e.scoutListGroupablePartial=ko.observable(),e.isStarting=ko.observable(!1),e.isBoosting=ko.observable(!1),e.isClaiming=ko.observable(!1),e.isLoading=ko.observable(!0),e.watchVideoRewardVariationPartial=ko.observable(),e.watchVideoCapRewardVariation=ko.observable(),e._state=LeanplumTrackingService.State.None,e.isStyleFilterDisabled=ko.computed(function(){var n=!e.positionPartial()||!e.positionPartial().selectedIndex()||e.positionPartial().selectedIndex()===PlayerPosition.G;return n&&e.$styleDropdown&&e.positionPartial()&&(e.stylePartial().selectedIndex(PlayerStyle.NoPreference),e.$styleDropdown.val(PlayerStyle.NoPreference).trigger("change.select2")),n}),e.showFilterView=ko.computed(function(){return e.isLoading()?!1:e.scoutInstructionPartial()&&e.scoutInstructionPartial().hasRunningScoutInstruction()?!1:e.forceFilterView()?!0:e.scoutListGroupablePartial()&&e.scoutListGroupablePartial().hasScoutResults()?!1:!0}),e.showSearchingView=ko.computed(function(){return e.scoutListGroupablePartial()&&e.scoutListGroupablePartial().hasScoutResults()?!1:e.scoutInstructionPartial()&&e.scoutInstructionPartial().hasRunningScoutInstruction()}),e.showResultsView=ko.computed(function(){return e.forceFilterView()?!1:e.scoutListGroupablePartial()&&e.scoutListGroupablePartial().hasScoutResults()}),e.isViewSwitchingAllowed=ko.computed(function(){return e.scoutListGroupablePartial()&&e.scoutListGroupablePartial().hasScoutResults()&&(!e.scoutInstructionPartial()||!e.scoutInstructionPartial().hasRunningScoutInstruction())?!0:!1}),e.searchCost=ko.computed(function(){if(!appViewModel.teamPartial()||!appViewModel.gameSettingsPartial())return 0;var n=appViewModel.gameSettingsPartial().getValue(GameVarCategory.ClubFundsPrice,"Scout"),t=appViewModel.teamPartial().budget;return Math.ceil(t*(n/100))}),e._onTransferredPlayer=ko.computed(function(){e.scoutListGroupablePartial()&&e.scoutListGroupablePartial().sortedTransferPlayersList()&&Enumerable.from(e.scoutListGroupablePartial().sortedTransferPlayersList()).any(function(n){return n.players.playerHasBeenTransferred()})&&(e.refreshScoutList(),appViewModel.refreshTimers())}),e._scoutInstructionService=t,e._transferPlayerService=i,e._nationalitiesService=u,e._leaguetypesService=f,e.toggleFilterElementsRendered(!1),appViewModel.userAndLeagueLoadedDeferred.promise.then(function(){if(!appViewModel.menuPartial().isMenuItemTypeVisible(MenuItemType.Scout)){appViewModel.redirect(RedirectionFlow.AccountState);return}if(appViewModel.actionRewardsPartial()){var n=appViewModel.actionRewardsPartial().getVideoActionRewardVariationForId(WatchVideoPlacementType.Scout),t=appViewModel.actionRewardsPartial().getVideoActionCapRewardVariationForId(WatchVideoPlacementType.Scout);e.watchVideoRewardVariationPartial(n);e.watchVideoCapRewardVariation(t)}WebApi.getInstance().execute(r.getByLeagueId(SessionManager.getLeagueId(),appViewModel.leaguePartial().seasonNr)).done(function(n){var t=new LeagueSettingsPartial(n).areTransfersEnabled;t||appViewModel.redirect(RedirectionFlow.AccountState);e.refreshScoutList()})}),e}return __extends(t,n),t.prototype.toggleFilterElementsRendered=function(n){this.positionPartial().isTranslationElementRendered(n);this.stylePartial().isTranslationElementRendered(n);this.qualityPartial().isTranslationElementRendered(n);this.agePartial().isTranslationElementRendered(n)},t.prototype.initializeScoutFilterDropdowns=function(){var n,t,i,r,u;!this.isLoading()&&$(".position-dropdown, .style-dropdown, .quality-dropdown, .age-dropdown, .nationality-dropdown, .leaguetype-dropdown").is(":visible")&&(this.toggleFilterElementsRendered(!0),n=$(".position-dropdown"),n.select2({placeholder:n.data("selectposition-text"),width:"100%"}),this.$styleDropdown=$(".style-dropdown"),this.$styleDropdown.select2({placeholder:this.$styleDropdown.data("style-text"),width:"100%"}),t=$(".quality-dropdown"),t.select2({placeholder:t.data("quality-text"),width:"100%"}),i=$(".age-dropdown"),i.select2({placeholder:i.data("age-text"),width:"100%"}),r=$(".nationality-dropdown"),r.select2({placeholder:r.data("nationality-text"),width:"100%"}),u=$(".leaguetype-dropdown"),u.select2({placeholder:u.data("leaguetype-text"),width:"100%"}))},t.prototype.refreshScoutList=function(){var n=this,i,r,u;this.isLoading(!0);var f=Q.defer(),t=new WebApiBatch,e=this._scoutInstructionService.getByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId());return t.add(e).done(),i=this._transferPlayerService.getByTransferPlayerType(SessionManager.getLeagueId(),SessionManager.getTeamId(),TransferPlayerType.Scout),t.add(i).done(),r=this._nationalitiesService.getNationalities(),t.add(r).done(),u=this._leaguetypesService.getActive(!0),t.add(u).done(),Q.all([e.deferred.promise,i.deferred.promise,r.deferred.promise,u.deferred.promise]).spread(function(t,i,r,u){var o,e,s;n.scoutInstructionPartial(t?new ScoutInstructionPartial(t):null);n.scoutListGroupablePartial(new ScoutListGroupablePartial(i,n._transferPlayerService));o=Enumerable.from(r).where(function(n){return n.name!==""}).orderBy(function(n){return n.name}).toArray();n.nationalitiesPartial(new SingleSelectablePartialViewmodel(o));e=LeanplumHelper.getInstance().getVariables("Agent","AgentPopularLeagues");e&&u.forEach(function(n){n.recommended=!1;Enumerable.from(e).any(function(t){return t.value===n.id})&&(n.recommended=!0)});s=Enumerable.from(u).where(function(n){return n.isScoutable&&n.name!==""&&n.poolId===appViewModel.leaguePartial().leagueTypePartial().poolId&&n.id!==appViewModel.leaguePartial().leagueTypePartial().id}).orderByDescending(function(n){return n.recommended}).thenBy(function(n){return n.name}).toArray();n.leagueTypesPartial(new SingleSelectablePartialViewmodel(s));n.allLeagueTypesPartial(new LeagueTypesPartial(u));n.allNationalitiesPartial(new LeagueTypesPartial(r));n.isLoading(!1);f.resolve()}).done(),t.execute(),f.promise},t.prototype.searchPlayers=function(){var i=this,t,n,r;if(!this.isStarting()){if(this.isStarting(!0),t=appViewModel.bossCoinProductsPartial().getBossCoinProduct("BossCoinConversionRateScout"),t==null){this.isStarting(!1);return}n=this.searchCost();r=appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(n);appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.SendScout,n,t).then(function(t){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(t).then(function(){appViewModel.executePaidAction(i.executeScoutSearch(n,r));appViewModel.surfacingPartial().skipSurfacingType(SurfacingType.Scout)}).done()}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done(function(){i.isStarting(!1)})}},t.prototype.executeScoutSearch=function(n,t){var i=this,u=appViewModel.gameSettingsPartial()?appViewModel.gameSettingsPartial().getTimerId("ScoutInstructionTimer"):0,r=Q.defer();return WebApi.getInstance().execute(this._scoutInstructionService.start(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.positionPartial().selectedIndex(),this.agePartial().selectedIndex(),this.qualityPartial().selectedIndex(),this.positionPartial().selectedIndex()===PlayerPosition.G?PlayerStyle.NoPreference:this.stylePartial().selectedIndex(),u,this.nationalitiesPartial().selectedValue(),this.leagueTypesPartial().selectedValue())).then(function(u){LeanplumHelper.getInstance().trackClubFundsSpentEvent(LeanplumHelper.ClubFundsProductType.Scout,t,n);i.scoutInstructionPartial(new ScoutInstructionPartial(u));i.forceFilterView(!1);r.resolve(!0);appViewModel.refreshTimers();appViewModel.refreshNotifications()}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not start scout instruction.");r.reject(t)}).fin(function(){i.isStarting(!1)}).done(),r.promise},t.prototype.switchFilterView=function(){this.forceFilterView(!this.forceFilterView())},t.prototype.boostScoutInstructionWithWatchVideo=function(){var n=this,i,t;appViewModel&&appViewModel.leaguePartial()&&appViewModel.leaguePartial().boostTimersAllowed()&&(this.isBoosting()||(this.isBoosting(!0),i={leagueId:SessionManager.getLeagueId(),teamId:SessionManager.getTeamId(),placement:WatchVideoPlacementType.Scout,rewardVariation:this.watchVideoRewardVariationPartial()?this.watchVideoRewardVariationPartial().variation:0,capVariation:this.watchVideoCapRewardVariation()?this.watchVideoCapRewardVariation():0},t=new WatchVideosModal(new IncentiveProviderCountriesService,new IncentiveProviderService,new WatchVideosService,new ActionRewardsService,WatchVideoPlacementType.Scout,i),t.show().fail(function(){}).fin(function(){n.isBoosting(!1)}).done(),t.videoWatchedRewardAnnouncer.subscribe(function(t){t.then(function(){var t=n.scoutInstructionPartial().countdownTimerPartial();n.watchVideoRewardVariationPartial().animateTimestampReduction(t);appViewModel.refreshTimers();appViewModel.refreshNotifications()}).fail(function(){}).done()})))},t.prototype.boostScout=function(){var t=this,n;if(appViewModel&&appViewModel.leaguePartial()&&appViewModel.leaguePartial().boostTimersAllowed()&&!this.isBoosting()){if(this.isBoosting(!0),n=this.scoutInstructionPartial().countdownTimerPartial().getBosscoinProductForCurrentIncrement(this.scoutInstructionPartial().scoutBoostBosscoinProductName),n==null){this.isBoosting(!1);return}var u=this.scoutInstructionPartial().countdownTimerPartial().minutesRemaining(),i={TimeLeft:u,Increment:n.increment},r=this.scoutInstructionPartial().boostCost();LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(n.name,r,i);appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.BoostScout,r,null,0,!1,!0,!0,n.name,i).then(function(){var u=appViewModel.gameSettingsPartial()?appViewModel.gameSettingsPartial().getTimerId("ScoutedPlayerTimer"):0,f=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.Scout,"MinPriceMultiplier").id,e=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.Scout,"MaxPriceMultiplier").id;WebApi.getInstance().execute(t._transferPlayerService.boostScout(SessionManager.getLeagueId(),SessionManager.getTeamId(),n.id,u,e,f)).then(function(u){u.forEach(function(n){t.scoutListGroupablePartial().transferPlayers.push(n)});t.scoutInstructionPartial().countdownTimerPartial(null);t.forceFilterView(!1);LeanplumHelper.getInstance().trackBossCoinSpentEvent(n.name,r,i);appViewModel.refreshBossCoinsWallet().done();appViewModel.refreshTimers();appViewModel.refreshNotifications()}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){t.isBoosting(!1)}).done()}).fail(function(n){WebapiHelper.handleAndAlertError(n);t.isBoosting(!1)}).done()}},t.prototype.claim=function(){var n=this;if(!this.isClaiming()){this.isClaiming(!0);var t=appViewModel.gameSettingsPartial()?appViewModel.gameSettingsPartial().getTimerId("ScoutedPlayerTimer"):0,i=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.Scout,"MinPriceMultiplier").id,r=appViewModel.gameSettingsPartial().getGameSetting(GameVarCategory.Scout,"MaxPriceMultiplier").id;WebApi.getInstance().execute(this._transferPlayerService.claim(SessionManager.getLeagueId(),SessionManager.getTeamId(),t,r,i)).then(function(t){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.CompleteTimer,{CompleteTimer:"Scout"});t.forEach(function(t){n.scoutListGroupablePartial().transferPlayers.push(t)});n.scoutInstructionPartial().countdownTimerPartial(null);n.forceFilterView(!1);appViewModel.refreshTimers();appViewModel.refreshNotifications()}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).fin(function(){n.isClaiming(!1)}).done()}},t.prototype.showBuyPlayerModal=function(n){var t=new TransferPlayerModal(n,ModalTemplate.BuyForeignPlayer);t.show()},t}(BaseView);window.onload=function(){initLayout().done(function(){appViewModel.appViewModelDataLoadedDeferred.promise.then(function(){ko.bindContentViewModel(new ScoutView(new ScoutInstructionService,new TransferPlayerService,new LeagueSettingsService,new NationalitiesService,new LeagueTypesService))})})}
