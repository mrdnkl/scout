var PlayersService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getSuspendedPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/suspended");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getInjuredPlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/players/injured");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getBasePlayers=function(n,t){var i=(new breeze.EntityQuery).from("leagueTypes/"+n+"/teams/"+t+"/players");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getTopscorersByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/topscorers/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getAssistsByLeagueId=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/players/assists/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.sell=function(n,t,i,r){var u={playerId:i,price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/sell",HttpMethod.Put,u)},n.prototype.lineup=function(n,t,i,r){var u={lineup:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/lineup",HttpMethod.Put,u)},n.prototype.clearlineup=function(n,t){return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/players/clearlineup",HttpMethod.Put)},n.prototype.getPlayersForMatch=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/matches/"+t+"/"+i+"/players");return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.assignSquadNumber=function(n,t,i,r){var u={squadNumber:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/players/"+i+"/assignsquadnumber",HttpMethod.Put,u)},n.prototype.getBestPerformingPlayers=function(n){var t=(new breeze.EntityQuery).from("leagues/"+n+"/players/bestperformingplayers");return RequestItemFactory.getInstance().createRequestItem(t)},n}(),OffersService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/teams/"+t+"/offers");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.post=function(n,t,i,r){var u={playerId:i,price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers",HttpMethod.Post,u)},n.prototype.counter=function(n,t,i,r){var u={price:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/counter",HttpMethod.Post,u)},n.prototype.accept=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/accept",HttpMethod.Put)},n.prototype.reject=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i+"/reject",HttpMethod.Put)},n.prototype.withdraw=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/offers/"+i,HttpMethod.Delete)},n}(),TransfersService=function(){function n(){}return n.prototype.getAllTransfers=function(n,t,i){var r=(new breeze.EntityQuery).from("/leagues/"+n+"/transfers?limit="+i+"&offset="+t);return RequestItemFactory.getInstance().createRequestItem(r,!0)},n.prototype.getAllTransfersForWeek=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/transfers/"+t);return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.getAllTransfersForTeam=function(n,t){var i=(new breeze.EntityQuery).from("/leagues/"+n+"/team/"+t+"/transfers");return RequestItemFactory.getInstance().createRequestItem(i,!0)},n.prototype.quickSell=function(n,t,i,r,u){var f="/leagues/"+n+"/teams/"+t+"/players/"+i+"/quicksell";return RequestItemFactory.getInstance().createRequestItemSingle(f,HttpMethod.Post,{productId:r,pricePercentageGameVariableId:u})},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ProgressPartial=function(n){function t(t){var i=n.call(this)||this;return i.isAnimating=ko.observable(!1),i.progressPercentage=ko.observable(),i.animatedProgressIncrease=ko.observable(0),i.totalPercentage=ko.computed(function(){return i.progressPercentage()+i.progressForecast}),i.forecastPercentage=ko.observable(),Helper.copyProperties(t,i),i.progressPercentage(i.progress),i.forecastPercentage(i.totalPercentage()>100?100-i.progress:i.progressForecast),i}return __extends(t,n),t.prototype.animate=function(){var n=this,i=Q.defer(),t,r;return this.isAnimating(!0),t=0,r=setInterval(function(){n.progressPercentage(n.progressPercentage()+1);n.forecastPercentage()>0&&n.forecastPercentage(n.forecastPercentage()-1);n.animatedProgressIncrease(n.animatedProgressIncrease()+1);n.progressPercentage()>=100&&(n.progressPercentage(0),n.level++);t++;t>=n.totalProgressIncrease&&(clearInterval(r),setTimeout(function(){i.resolve(!0);n.isAnimating(!1)},1e3))},10),i.promise},t}(Progress),TransferPlayerService=function(){function n(){}return n.prototype.getByTeam=function(n,t){var i=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers");return RequestItemFactory.getInstance().createRequestItem(i)},n.prototype.getByTransferPlayerType=function(n,t,i){var r=(new breeze.EntityQuery).from("leagues/"+n+"/teams/"+t+"/transferplayers/"+i);return RequestItemFactory.getInstance().createRequestItem(r)},n.prototype.boostScout=function(n,t,i,r,u,f){var e={productId:i,maxPriceGameSettingId:u,minPriceGameSettingId:f,timerGameSettingId:r};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/boostscout",HttpMethod.Put,e)},n.prototype.claim=function(n,t,i,r,u){var f={timerGameSettingId:i,maxPriceGameSettingId:r,minPriceGameSettingId:u};return RequestItemFactory.getInstance().createRequestItem("leagues/"+n+"/teams/"+t+"/claimscout",HttpMethod.Put,f)},n.prototype.buy=function(n,t,i,r){var u={productId:r};return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/buy",HttpMethod.Put,u)},n.prototype.validateTransfer=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i+"/validatetransfer",HttpMethod.Post)},n.prototype.deleteById=function(n,t,i){return RequestItemFactory.getInstance().createRequestItemSingle("leagues/"+n+"/teams/"+t+"/transferplayers/"+i,HttpMethod.Delete)},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerModal=function(n){function t(t,i){var r=n.call(this,{template:i,screenModeXs:ScreenMode.Normal,showCloseButton:!0,container:ModalContainer.Generic})||this;return r.player=t,r}return __extends(t,n),t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerInNegotiationModal=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.prototype.redirectToOffers=function(n){n&&(window.location.href=Urls.offers+"/"+n.id)},t}(PlayerModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPriceModal=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.viewType=ko.observable(PlayerPriceViewType.Stats),r.price=ko.observable(),r.minPricePercentage=.75,r.maxPricePercentage=2.5,r.minPrice=ko.computed(function(){return r.price()*r.minPricePercentage}),r.maxPrice=ko.computed(function(){return r.price()*r.maxPricePercentage}),r.price(t.value),r}return __extends(t,n),t.prototype.setPrice=function(){var n=this.price();this.price(this.player.value);this.viewType(PlayerPriceViewType.SetPrice);this.price(n)},t.prototype.showStats=function(){this.viewType(PlayerPriceViewType.Stats)},t}(PlayerModal),PlayerPriceViewType,TransferDomesticPlayerModal;(function(n){n[n.Stats=0]="Stats";n[n.SetPrice=1]="SetPrice"})(PlayerPriceViewType||(PlayerPriceViewType={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();TransferDomesticPlayerModal=function(n){function t(i,r,u){var f=n.call(this,i.playerPartial(),ModalTemplate.BuyDomesticPlayer)||this;return f.transferPlayerPartial=ko.observable(),f._isHiddenDeferred=Q.defer(),f.currentOfferPartial=ko.observable(),f.visibleBottomView=ko.observable(t.BottomViewType.Stats),f.isLoadingBuyAction=ko.observable(!1),f.playerTransferStatusHasBeenChanged=ko.observable(!1),f.minOfferPrice=ko.computed(function(){return!f.transferPlayerPartial()||!f.transferPlayerPartial().playerPartial()?f.price():Math.round(f.transferPlayerPartial().playerPartial().value*f.minPricePercentage)}),f.offerPrice=ko.computed(function(){return!f.transferPlayerPartial()||!f.transferPlayerPartial().playerPartial()||!f.currentOfferPartial()||!f.currentOfferPartial().bidsPartial()||!f.currentOfferPartial().bidsPartial().lastBid()?f.price():f.currentOfferPartial().bidsPartial().lastBid().price}),f.transferPlayerSliderState=ko.computed(function(){return!f.transferPlayerPartial()||f.price()===f.transferPlayerPartial().price?t.TransferPlayerSliderState.SameAsOriginalPrice:f.currentOfferPartial()&&f.currentOfferPartial().bidsPartial()&&f.currentOfferPartial().bidsPartial().lastBid()?f.price()===f.currentOfferPartial().bidsPartial().lastBid().price?f.currentOfferPartial().isLatestBidByOwner()?t.TransferPlayerSliderState.SameAsAlreadyOutstandingCounterOffer:t.TransferPlayerSliderState.SameAsAlreadyOutstandingOffer:f.price()>f.currentOfferPartial().bidsPartial().lastBid().price?t.TransferPlayerSliderState.HigherThanAlreadyOutstandingOffer:t.TransferPlayerSliderState.LowerThanAlreadyOutstandingOffer:f.price()!==f.transferPlayerPartial().price?t.TransferPlayerSliderState.DifferentThanOriginalPrice:void 0}),f.transferPlayerPartial(i),f._offerService=r,f.price(i.price),u&&f.currentOfferPartial(u),f.hiddenEventFunction=function(){if(f.playerTransferStatusHasBeenChanged())f._isHiddenDeferred.resolve();else{var n=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Player transfer status has not been changed, no update needed");f._isHiddenDeferred.reject(n)}},f.isLoadingBuyAction.subscribe(function(n){n&&f.playerTransferStatusHasBeenChanged(!0)}),f}return __extends(t,n),t.prototype.determineBuyActionForTransferPlayer=function(){if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.DifferentThanOriginalPrice){this.sendOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.HigherThanAlreadyOutstandingOffer||this.transferPlayerSliderState()===t.TransferPlayerSliderState.LowerThanAlreadyOutstandingOffer){window.location.href=Urls.offers;return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsAlreadyOutstandingCounterOffer){this.acceptCounterOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsAlreadyOutstandingOffer){this.withdrawOffer();return}if(this.transferPlayerSliderState()===t.TransferPlayerSliderState.SameAsOriginalPrice){this.buyPlayer();return}},t.prototype.show=function(){return n.prototype.show.call(this),this._isHiddenDeferred.promise},t.prototype.sendOffer=function(){var n=this,t;this.isLoadingBuyAction(!0);t=this._offerService.post(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.transferPlayerPartial().playerPartial().id,this.price());WebApi.getInstance().execute(t).then(function(t){n.currentOfferPartial(new OfferPartial(t));LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done(function(){n.isLoadingBuyAction(!1)})},t.prototype.withdrawOffer=function(){var n=this,t;this.isLoadingBuyAction(!0);t=this._offerService.withdraw(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.currentOfferPartial().id);WebApi.getInstance().execute(t).then(function(){n.currentOfferPartial(null)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done(function(){n.isLoadingBuyAction(!1)})},t.prototype.isOutstandingOfferBelowTransferPrice=function(){return!this.currentOfferPartial()||!this.currentOfferPartial().bidsPartial()||!this.currentOfferPartial().bidsPartial().lastBid()?!1:this.currentOfferPartial().bidsPartial().lastBid().price<this.transferPlayerPartial().price},t.prototype.buyPlayer=function(){this.transferPlayerPartial()&&this.transferPlayerPartial().buy()},t.prototype.acceptCounterOffer=function(){var n=this;if(this.currentOfferPartial()&&this.currentOfferPartial().bidsPartial()){this.isLoadingBuyAction(!0);var i=this._offerService.accept(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.currentOfferPartial().id),t=this.currentOfferPartial().bidsPartial().lastBid().price,r=appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(t);WebApi.getInstance().execute(i).then(function(){if(n.currentOfferPartial().isIncomingOffer()){var i=SessionManager.getInstance().session?"S"+SessionManager.getInstance().session.slotIndex:"";LeanplumHelper.getInstance().trackEventWithValue(LeanplumTrackingService.Event.CFClaim,t,{CFClaimSource:"PlayerOffer",Teamslot:i,PlayerName:n.currentOfferPartial().playerPartial()?n.currentOfferPartial().playerPartial().name:""})}else LeanplumHelper.getInstance().trackClubFundsSpentEvent(LeanplumHelper.ClubFundsProductType.OfferPlayer,r,t,{PlayerSource:"Offers",PlayerName:n.currentOfferPartial().playerPartial()?n.currentOfferPartial().playerPartial().name:""});n.hide();n.transferPlayerPartial().addFeedbackToast();setTimeout(function(){window.location.href=Urls.squad},1e3)}).fail(function(n){WebapiHelper.handleAndAlertError(n)}).done()}},t}(PlayerPriceModal),function(n){var t,i;(function(n){n[n.Stats=0]="Stats";n[n.BuyPlayer=1]="BuyPlayer"})(t=n.BottomViewType||(n.BottomViewType={})),function(n){n[n.HigherThanAlreadyOutstandingOffer=0]="HigherThanAlreadyOutstandingOffer";n[n.LowerThanAlreadyOutstandingOffer=1]="LowerThanAlreadyOutstandingOffer";n[n.SameAsAlreadyOutstandingOffer=2]="SameAsAlreadyOutstandingOffer";n[n.SameAsAlreadyOutstandingCounterOffer=3]="SameAsAlreadyOutstandingCounterOffer";n[n.DifferentThanOriginalPrice=4]="DifferentThanOriginalPrice";n[n.SameAsOriginalPrice=5]="SameAsOriginalPrice"}(i=n.TransferPlayerSliderState||(n.TransferPlayerSliderState={}))}(TransferDomesticPlayerModal||(TransferDomesticPlayerModal={}));var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerModal=function(n){function t(t,i,r){r===void 0&&(r=null);var u=n.call(this,{template:i,showCloseButton:!0,container:ModalContainer.Generic,screenModeXs:ScreenMode.Normal})||this;return u.player=ko.observable(),u._playerParent=ko.observable(),u.player(t),u._playerParent(r),u.player().isTransferred.subscribe(function(n){n&&u.hide()}),u}return __extends(t,n),t.prototype.removeFromTransferlist=function(){var n=this;this.player().removeFromTransferlist().then(function(t){t&&(n._playerParent()&&(n._playerParent().transferPlayer=null,n._playerParent().transferPlayerPartial(null)),n.hide())}).done()},t}(BaseModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),SellPlayerModal=function(n){function t(t,i,r,u,f){var e,o,s;return u===void 0&&(u=!0),f===void 0&&(f=!1),e=n.call(this,t,ModalTemplate.SellPlayer)||this,e.isSelling=ko.observable(!1),e.shouldAnimateQuickSellRow=ko.observable(!1),e.quickSellBosscoinProduct=ko.observable(),e.quickSellDeferred=Q.defer(),e.areTransfersEnabled=ko.observable(),e._transfersService=i,e._showSurfacing=f,e.areTransfersEnabled(u),o=LeanplumHelper.getInstance().getVariables("Settings","QuicksellAfterAmountOfSignupDays",0),s=Helper.calculateDaysSinceTimestamp(r),s<o&&(isQuickSellEnabled=!1),e.areTransfersEnabled()&&isQuickSellEnabled&&(e.options().centerContentsMobile=!1,e.options.valueHasMutated()),e.shownEventFunction=function(){e.shouldAnimateQuickSellRow(!0)},e.quickSellBosscoinProduct(Enumerable.from(appViewModel.bossCoinProductsPartial().getItems()).firstOrDefault(function(n){return n.name==="QuickSellFee"})),e}return __extends(t,n),t.prototype.show=function(){n.prototype.show.call(this);this._showSurfacing&&new StaffSurfacingModal(SurfacingFollowUp.SquadSellPlayerProfile,DudeType.Assistant).show().done()},t.prototype.sell=function(){var n=this;this.isSelling()||(this.isSelling(!0),this.player.sell(this.price()).fail(function(){}).fin(function(){appViewModel.surfacingPartial().skipSurfacingType(SurfacingType.SquadSellPlayer);n.hide();n.isSelling(!1)}).done())},t.prototype.quickSell=function(){var n=this;this.player&&this.quickSellBosscoinProduct().value!==undefined&&this.player.isSessionPlayer&&appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.QuickSell,this.quickSellBosscoinProduct().value,this.player.fullName,this.player.quickSellSellPrice()).then(function(){WebApi.getInstance().execute(n._transfersService.quickSell(n.player.leagueId,n.player.teamId,n.player.id,n.quickSellBosscoinProduct().id,0)).then(function(t){appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerSoldThroughQuickSell,n.player.imageLarge(),[{key:"PlayerName",value:n.player.name},{key:"ForeignClub",value:t.destinationTeam.name}],n.player.getPlayerWorldStarLevel(),n.player.rarity));n.quickSellDeferred.resolve(!0);appViewModel.refreshBossCoinsWallet();appViewModel.refreshClubFundsWallet()}).fail(function(t){WebapiHelper.handleAndAlertError(t);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(t,"could not quicksell player because of an error");n.quickSellDeferred.reject(i);n.hide()}).done()}).fail(function(){var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("Bosscoin payment for quicksell was not confirmed.");n.quickSellDeferred.reject(t)}).done()},t}(PlayerPriceModal),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayerPartial=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this,h,c,s,l,a;return o.isAttacker=!1,o.isMidfielder=!1,o.isDefender=!1,o.isGoalKeeper=!1,o.isAvailable=ko.observable(!1),o.isInjured=ko.observable(!1),o.isSuspended=ko.observable(!1),o.lineupNr=ko.observable(0),o.isInLeague=!1,o.isSessionPlayer=!1,o.statMain=0,o.imageLarge=ko.observable(),o.daysUnavailable=ko.observable(0),o.quickSellSellPrice=ko.observable(0),o.isOnTransferList=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.transferPlayerPartial()?!0:!1}),o.isInNegotiation=ko.computed(function(){return appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&appViewModel.leaguePartial().settingsPartial().areTransfersEnabled&&o.offersPartial()?o.offersPartial().getItems().length>0:!1}),o.isInTraining=ko.computed(function(){return o.trainingSessionsPartial()?o.trainingSessionsPartial().currentTrainingSession()!==null&&!o.trainingSessionsPartial().currentTrainingSession().countdownTimerPartial().claimed():!1}),o.isInSelection=ko.computed(function(){return o.lineupNr()>0}),o.isInLineup=ko.computed(function(){return o.lineupNr()>0&&o.lineupNr()<=11}),o.isOnBench=ko.computed(function(){return o.isInSelection()&&!o.isInLineup()}),o.squadNumberObservable=ko.observable(),o.squadNumbersEnabled=LeanplumHelper.getInstance().getVariables("Settings","SquadNumbersEnabled",!1),o.nameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.name:o.squadNumberObservable()+". "+o.name}),o.fullNameWithSquadNumber=ko.pureComputed(function(){return!o.squadNumbersEnabled||0===o.squadNumberObservable()?o.fullName:o.squadNumberObservable()+". "+o.fullName}),o.squadOrLineupNumber=ko.pureComputed(function(){var n=o.squadNumbersEnabled?o.squadNumberObservable():o.lineupNr();return n===0?"":""+n}),o.nameWithSquadNumberForMatch=ko.pureComputed(function(){return o.playerGradePartial()&&o.playerGradePartial().squadNumber!==0?o.playerGradePartial().squadNumber+". "+o.name:o.name}),Helper.copyProperties(t,o),o.daysUnavailable(o.unavailable),i&&(o._playersService=i),r&&(o._offersService=r),o.nationality&&o.nationalityPartial(new NationalityPartial(o.nationality)),o.team&&o.teamPartial(new TeamPartial(o.team)),h=LeanplumHelper.getInstance().getVariables("Settings","AssetsPlayersEnabled",!0),o.assets&&h&&o.assetsPartial(new AssetsPartial(o.assets)),o.foul&&o.foulPartial(new FoulPartial(o.foul)),o.injury&&o.injuryPartial(new InjuryPartial(o.injury)),o.doctorTreatment&&o.doctorTreatmentPartial(new DoctorTreatmentPartial(o.doctorTreatment)),o.doctorTreatments&&o.doctorTreatmentsPartial(new DoctorTreatmentsPartial(o.doctorTreatments)),o.trainingSessions&&o.trainingSessionsPartial(new TrainingSessionsPartial(o.trainingSessions,u,e)),o.transferPlayer&&o.transferPlayerPartial(new TransferPlayerPartial(o.transferPlayer,f)),o.playerGrade&&o.playerGradePartial(new PlayerGradePartial(o.playerGrade)),o.playerGrades&&o.playerGradesPartial(new PlayerGradesPartial(o.playerGrades)),o.training&&o.trainingForecastPartial(new TrainingForecastPartial(o.training)),o.offers&&o.offersPartial(new OffersPartial(o.offers)),o.isAttacker=o.position===PlayerPosition.A,o.isMidfielder=o.position===PlayerPosition.M,o.isDefender=o.position===PlayerPosition.D,o.isGoalKeeper=o.position===PlayerPosition.G,o.isAvailable(o.status===PlayerStatus.Available),o.isInjured(o.status===PlayerStatus.Injured),o.isSuspended(o.status===PlayerStatus.Suspended),o.lineupNr(o.lineup),o.isInLeague=o.leagueId===SessionManager.getLeagueId(),o.isSessionPlayer=o.isInLeague&&o.teamId===SessionManager.getTeamId(),o.statMain=o.isAttacker?o.statAtt:o.isMidfielder?o.statOvr:o.statDef,o.assets&&h&&(c=Enumerable.from(o.assets).firstOrDefault(function(n){return n.type===AssetType.NormalPassport}),c!=null&&o.imageLarge(c.path)),s=new Progress,s.level=o.statMain,s.progress=o.trainingProgress,s.progressForecast=o.training?o.trainingForecastPartial().forecast:0,o.trainingProgressPartial(new ProgressPartial(s)),o.isSessionPlayer&&appViewModel&&appViewModel.gameSettingsPartial()&&(l=appViewModel.gameSettingsPartial().getGameSettings(GameVarCategory.Transfer,"QuickSellPricePercentage"),a=Enumerable.from(l).firstOrDefault(function(n){return n.variation===0&&n.increment===0}),o.quickSellSellPrice(o.value*(a.value/100))),o.squadNumberObservable(o.squadNumber),o}return __extends(t,n),t.prototype.setLineup=function(n){this.lineupNr(n)},t.prototype.sell=function(n){var i=this,t=Q.defer(),r;return this._playersService?(WebApi.getInstance().execute(this._playersService.sell(this.leagueId,this.teamId,this.id,n)).then(function(n){i.transferPlayer=n;i.transferPlayerPartial(new TransferPlayerPartial(n,new TransferPlayerService));t.resolve(n);i.addFeedbackToast()}).fail(function(n){WebapiHelper.handleAndAlertError(n);var i=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"PlayerPartial.sell.sellDeferred: Error selling player.");t.reject(i)}).done(),t.promise):(r=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("PlayerPartial.sell.sellDeferred: No playersService when trying to sell a player."),t.reject(r),t.promise)},t.prototype.offer=function(n){if(this._offersService){var t=this._offersService.post(this.leagueId,SessionManager.getTeamId(),this.id,n);return t.deferred.promise.then(function(){LeanplumHelper.getInstance().trackEvent(LeanplumTrackingService.Event.PlayerCardMakeOffer)}).done(),WebApi.getInstance().execute(t)}},t.prototype.willImproveByTraining=function(){return this.trainingForecastPartial()?this.trainingProgress+this.trainingForecastPartial().forecast>=100:!1},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.transferPlayerPartial()&&this.transferPlayerPartial().playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerToTransferlist,this.transferPlayerPartial().playerPartial().imageLarge(),[{key:"playername",value:this.transferPlayerPartial().playerPartial().name}],this.getPlayerWorldStarLevel(),this.rarity))},t.prototype.getPlayerWorldStarLevel=function(){var t=this,i=LeanplumHelper.getInstance().getVariables("WorldStar"),n=Enumerable.from(i).where(function(n){return t.statMain>=n.value}).firstOrDefault();if(!n)return PlayerWorldStarLevel.None;switch(n.key){case"MinRatingLevel1":return PlayerWorldStarLevel.WorldStar1;case"MinRatingLevel2":return PlayerWorldStarLevel.WorldStar2}},t.prototype.isWorldStar=function(){return this.getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1},t.prototype.isLegend=function(){return this.rarity==PlayerRarity.Legend},t.prototype.isInForm=function(){return this.rarity==PlayerRarity.InForm},t.prototype.getWorldStarClassName=function(){var n=this.getPlayerWorldStarLevel();switch(n){case PlayerWorldStarLevel.WorldStar1:return"world-star-1";case PlayerWorldStarLevel.WorldStar2:return"world-star-2";default:return"no-world-star"}},t.prototype.assignSquadNumber=function(n){var t=this,i=Q.defer();if(this._playersService)return WebApi.getInstance().execute(this._playersService.assignSquadNumber(this.leagueId,this.teamId,this.id,n)).then(function(n){t.squadNumber=n.squadNumber;t.squadNumberObservable(n.squadNumber);n.squadNumber&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.SquadNumberAssigned,t.imageLarge(),[{key:"SquadNumber",value:String(n.squadNumber)}],t.getPlayerWorldStarLevel(),t.rarity));i.resolve(n)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"Could not assign squad number");i.reject(t)}).done(),i.promise},t}(Player),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BidPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(Bid),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BidsPartial=function(n){function t(t){var i=n.call(this)||this;return i.lastBid=ko.computed(function(){return Enumerable.from(i.getItems()).orderByDescending(function(n){return n.createdAt}).firstOrDefault()}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new BidPartial(n))});this.setItems(t)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),OfferPartial=function(n){function t(t){var i=n.call(this)||this;return i.notYourTeamPartial=ko.computed(function(){return i.owningTeamId===SessionManager.getInstance().session.teamId?i.biddingTeamPartial():i.owningTeamPartial()}),i.isLatestBidByOwner=ko.computed(function(){return i.bidsPartial()?i.bidsPartial().lastBid().sentBy===BidSentBy.Owner:!1}),i.isIncomingOffer=ko.computed(function(){return i.bidsPartial()?i.owningTeamId===SessionManager.getTeamId():!1}),i.requiresAction=ko.computed(function(){return i.isLatestBidByOwner()&&!i.isIncomingOffer()||!i.isLatestBidByOwner()&&i.isIncomingOffer()}),Helper.copyProperties(t,i),i.player&&i.playerPartial(new PlayerPartial(i.player)),i.bids&&i.bidsPartial(new BidsPartial(i.bids)),i.biddingTeam&&i.biddingTeamPartial(new TeamPartial(i.biddingTeam)),i.owningTeam&&i.owningTeamPartial(new TeamPartial(i.owningTeam)),i}return __extends(t,n),t}(Offer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),OffersPartial=function(n){function t(t){var i=n.call(this)||this;return i.offersWithRequiredAction=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.requiresAction()}).toArray()}),i.owningOffersWithRequiredAction=ko.computed(function(){return Enumerable.from(i.getItems()).where(function(n){return n.owningTeamId===SessionManager.getTeamId()&&!n.isLatestBidByOwner()}).toArray()}),i.hasOffersBelongingToCurrentSessionTeam=ko.computed(function(){return Enumerable.from(i.getItems()).any(function(n){return n.owningTeamId===SessionManager.getTeamId()||n.biddingTeamId===SessionManager.getTeamId()})}),i.setItemsFromModels(t),i}return __extends(t,n),t.prototype.setItemsFromModels=function(n){var t=[];n.forEach(function(n){t.push(new OfferPartial(n))});this.setItems(t)},t.prototype.getLatestOfferForPlayer=function(n){if(this.getItems())return Enumerable.from(this.getItems()).orderByDescending(function(n){return n.createdAt}).firstOrDefault(function(t){return t.playerId===n})},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TrainingForecastPartial=function(n){function t(t){var i=n.call(this)||this;return Helper.copyProperties(t,i),i}return __extends(t,n),t}(TrainingForecast),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),PlayersPartial=function(n){function t(t,i,r,u,f){f===void 0&&(f=!1);var e=n.call(this)||this;return e.totalValue=ko.computed(function(){return Enumerable.from(e.getItems()).sum(function(n){return n.value})}),e.attackers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isAttacker}).toArray()}),e.midfielders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isMidfielder}).toArray()}),e.defenders=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isDefender}).toArray()}),e.goalkeepers=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isGoalKeeper}).toArray()}),e.injured=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isInjured()}).toArray()}),e.suspended=ko.computed(function(){return Enumerable.from(e.getItems()).where(function(n){return n.isSuspended()}).toArray()}),e.currentLineupAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isInLineup()})}),e.currentBenchAmount=ko.computed(function(){return Enumerable.from(e.getItems()).count(function(n){return n.isOnBench()})}),e.isLineupComplete=ko.computed(function(){return e.currentLineupAmount()==11}),e.isBenchComplete=ko.computed(function(){return e.currentBenchAmount()==7}),e._playersService=i,e._offersService=r,f&&(e.sortingEnabled(!0),e.sortOrder=SortOrder.Descending),e.setItemsFromModels(t,i,r,u),e}return __extends(t,n),t.prototype.isLineEligibleForTransfer=function(n){switch(n){case PlayerPosition.A:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.A}).count()>3;case PlayerPosition.D:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.D}).count()>4;case PlayerPosition.M:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.M}).count()>4;case PlayerPosition.G:return Enumerable.from(this.getItems()).where(function(n){return n.position===PlayerPosition.G}).count()>2;default:return!1}},t.prototype.getPlayersEligibleToBePutOnTransferlist=function(){var n=this;return Enumerable.from(this.getItems()).where(function(t){return!t.isOnTransferList()&&n.isLineEligibleForTransfer(t.position)}).toArray()},t.prototype.getReserves=function(){return this.getItems().filter(function(n){return!n.isInSelection()})},t.prototype.getNotInLineup=function(){return this.getItems().filter(function(n){return!n.isInLineup()})},t.prototype.getPlayerBySquadNumber=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.squadNumberObservable()===n})},t.prototype.getByStaffMemberType=function(n){return n===StaffMemberType.AttackerCoach?this.attackers():n===StaffMemberType.MidfielderCoach?this.midfielders():n===StaffMemberType.DefenderCoach?this.defenders():n===StaffMemberType.GoalkeeperCoach?this.goalkeepers():[]},t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.statDef})},t.prototype.orderPlayersByGoals=function(){this.sortItems(function(n){return n.goals})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.statMain})},t.prototype.orderPlayersByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByNationality=function(){this.sortItems(function(n){return n.nationality.code})},t.prototype.orderPlayersByFitness=function(){this.sortItems(function(n){return n.fitness})},t.prototype.orderPlayersByMorale=function(){this.sortItems(function(n){return n.morale})},t.prototype.orderPlayersByLineup=function(){this.sortItems(function(n){return n.lineup})},t.prototype.orderPlayersByAverage=function(){this.sortItems(function(n){return n.averagePlayerGrade})},t.prototype.orderPlayersByGradeForWeek=function(n){this.sortItems(function(t){return t.playerGradesPartial().getGradeForWeek(n)})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.position})},t.prototype.orderPlayersBySuspension=function(){this.sortItems(function(n){return n.isSuspended})},t.prototype.getTopscorers=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.goals},!0)).skip(n).take(t).toArray()},t.prototype.getAssists=function(n,t){return Enumerable.from(this.getRankedArray(function(n){return n.assists},!0)).skip(n).take(t).toArray()},t.prototype.getPlayers=function(n,t){return Enumerable.from(this.getItems()).skip(n).take(t).toArray()},t.prototype.getOrderedByPlayerGradeLineup=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerGradePartial()!==null&&n.playerGradePartial()!==undefined}).orderBy(function(n){return n.playerGradePartial().lineup}).toArray()},t.prototype.setItemsFromModels=function(n,t,i,r){var u=[];n.forEach(function(n){u.push(new PlayerPartial(n,t,i,null,r))});this.setItems(u)},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayerPartial=function(n){function t(t,i){var r=n.call(this)||this;return r._bossCoinConversionProductName="",r._bossCoinFeeProductName="",r.isBossCoinCompletionAllowed=ko.observable(!1),r.isRemoving=ko.observable(!1),r.isTransferred=ko.observable(!1),r.isBuying=ko.observable(!1),r.isOnList=!1,r._isInitialized=ko.observable(!1),r.bossCoinConversionCost=ko.computed(function(){if(!appViewModel.clubFundsWalletPartial()||!appViewModel.bossCoinProductsPartial()||!r._isInitialized())return 0;var n=appViewModel.bossCoinProductsPartial().getBossCoinProduct(r._bossCoinConversionProductName);return n?appViewModel.clubFundsWalletPartial().calculateBossCoinConversionCount(r.price,n):0}),r.bossCoinTransferFeeCost=ko.computed(function(){return!appViewModel.bossCoinProductsPartial()||!r._isInitialized()?0:appViewModel.bossCoinProductsPartial().getValue(r._bossCoinFeeProductName)}),r.clubFundsCost=ko.computed(function(){return!appViewModel.clubFundsWalletPartial()||!r._isInitialized()?0:appViewModel.clubFundsWalletPartial().calculateClubFundsRemainderForPrice(r.price)}),r.bossCoinCost=ko.computed(function(){return r.bossCoinTransferFeeCost()+r.bossCoinConversionCost()}),Helper.copyProperties(t,r),r._transferPlayerService=i,r.team&&r.teamPartial(new TeamPartial(r.team)),t.type===TransferPlayerType.Scout?(r._bossCoinFeeProductName="ScoutFee",r._bossCoinConversionProductName="BossCoinConversionRateScout"):t.player.rarity==PlayerRarity.Legend&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignLegendTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):t.player.rarity==PlayerRarity.InForm&&r.teamPartial()&&r.teamPartial().isForeignTeam?(r._bossCoinFeeProductName="ForeignInFormTransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"):(r._bossCoinFeeProductName="TransferFee",r._bossCoinConversionProductName="BossCoinConversionRateTransfer"),r.countdownTimer&&(r.countdownTimerPartial(new CountdownTimerPartial(r.countdownTimer)),r.isOnList=r.countdownTimer.finishedTimestamp>Helper.unixTimeStamp()),r.player&&(r.team&&(r.player.team=r.team),r.playerPartial(new PlayerPartial(r.player))),appViewModel.leaguePartial()&&appViewModel.leaguePartial().settingsPartial()&&r.isBossCoinCompletionAllowed(appViewModel.leaguePartial().settingsPartial().isBossCoinCompletionAllowed),r._isInitialized(!0),r}return __extends(t,n),t.prototype.buy=function(){this.isBossCoinCompletionAllowed()?this.buyWithBossCoinCompletion():this.buyWithoutBossCoinCompletion()},t.prototype.buyWithBossCoinCompletion=function(){var n=this,t,i,r;this.isBuying()||(t=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinConversionProductName),t)&&(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),i=this.price,r=this.clubFundsCost(),WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){appViewModel.exchangeBossCoinsToClubFundsWhenNeeded(PaidGameOption.TransferPlayer,i,t,n.bossCoinTransferFeeCost(),!1,n.player.name).then(function(u){var f=n.bossCoinCost()>n.bossCoinTransferFeeCost();f&&LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(t.name,n.bossCoinConversionCost());appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinCost(),n.playerPartial().name,r,f,!0,!0,n._bossCoinFeeProductName,{},!1).then(function(){appViewModel.bossCoinWalletPartial().convertBossCoinsToClubFunds(u).then(function(){appViewModel.executePaidAction(n.transferPlayer(i,r));n.isBuying(!1)})}).fail(function(t){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done())},t.prototype.buyWithoutBossCoinCompletion=function(){var n=this;this.isBuying()||(this.isBuying(!0),LeanplumHelper.getInstance().trackBossCoinSpendIntentEvent(this._bossCoinFeeProductName,this.bossCoinTransferFeeCost()),this._isInitialized&&appViewModel.clubFundsWalletPartial()&&appViewModel.clubFundsWalletPartial().calculateClubFundsShortageForPrice(this.price)===0?WebApi.getInstance().execute(this._transferPlayerService.validateTransfer(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){var t=n.clubFundsCost();appViewModel.bossCoinWalletPartial().confirmBossCoinPayment(PaidGameOption.TransferPlayer,n.bossCoinTransferFeeCost(),n.playerPartial().name,t,!1,!0,!0,n._bossCoinFeeProductName).then(function(){appViewModel.executePaidAction(n.transferPlayer(t,t));n.isBuying(!1)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done()}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.isBuying(!1)}).done():(new NotEnoughClubFundsModal(this.price,this.bossCoinTransferFeeCost(),!1).show(),this.isBuying(!1)))},t.prototype.transferPlayer=function(n,t){var i=Q.defer(),r=appViewModel.bossCoinProductsPartial().getBossCoinProduct(this._bossCoinFeeProductName),u;return r==null?(u=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionError("TransferPlayerPartial.transferPlayer.deferred: No Boss Coin product partial when transfering a player."),i.reject(u),i.promise):(this.executeTransfer(r,n,t).then(function(n){i.resolve(n)}),i.promise)},t.prototype.executeTransfer=function(n,t,i){var r=this,u=Q.defer(),f=this.bossCoinTransferFeeCost();return WebApi.getInstance().execute(this._transferPlayerService.buy(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id,n.id)).then(function(){r.addFeedbackToast();r.isTransferred(!0);LeanplumHelper.getInstance().trackBossCoinSpentEvent(r._bossCoinFeeProductName,f);var n;switch(r.type){case TransferPlayerType.Scout:n=LeanplumHelper.ClubFundsProductType.ScoutPlayer;break;case TransferPlayerType.SpecialOffer:n=LeanplumHelper.ClubFundsProductType.SpecialOfferPlayer;break;case TransferPlayerType.Transferlist:default:n=LeanplumHelper.ClubFundsProductType.TransferPlayer}LeanplumHelper.getInstance().trackClubFundsSpentEvent(n,i,t,{PlayerName:r.playerPartial()?r.playerPartial().name:""});u.resolve(!0)}).fail(function(n){WebapiHelper.handleAndAlertError(n);var t=ErrorHandlerInstanceFactory.getErrorHandlerInstance().createPromiseRejectionWebApiError(n,"failed to buy player");u.reject(t)}).done(),u.promise},t.prototype.removeFromTransferlist=function(){var t=this,n=Q.defer();return this.isRemoving(!0),WebApi.getInstance().execute(this._transferPlayerService.deleteById(SessionManager.getLeagueId(),SessionManager.getTeamId(),this.id)).then(function(){t.isTransferred(!0);n.resolve(!0)}).fail(function(t){WebapiHelper.handleAndAlertError(t);n.resolve(!1)}).fin(function(){t.isRemoving(!1)}).done(),n.promise},t.prototype.addFeedbackToast=function(){appViewModel&&appViewModel.toastsPartial&&this.playerPartial()&&appViewModel.toastsPartial().addItem(new FeedbackToast(FeedbackToast.Type.PlayerBought,this.playerPartial().imageLarge(),[{key:"playername",value:this.playerPartial().name}],this.playerPartial().getPlayerWorldStarLevel(),this.playerPartial().rarity))},t}(TransferPlayer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPlayersPartial=function(n){function t(t,i){var r=n.call(this)||this;return r.countdownTimerPartial=ko.observable(),r.playerHasBeenTransferred=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isTransferred()})}),r.hasScoutResults=ko.computed(function(){return Enumerable.from(r.getItems()).any(function(n){return n.isOnList})}),r._transferPlayerService=i,r.sortingEnabled(!0),r.sortOrder=SortOrder.Descending,r.setItemsFromModels(t,i),r}return __extends(t,n),t.prototype.orderPlayersByName=function(){this.sortItems(function(n){return n.player.name})},t.prototype.orderPlayersByAge=function(){this.sortItems(function(n){return n.player.age})},t.prototype.orderPlayersByTeam=function(){this.sortItems(function(n){return n.team.name})},t.prototype.orderPlayersByDefence=function(){this.sortItems(function(n){return n.player.statDef})},t.prototype.orderPlayersByAttack=function(){this.sortItems(function(n){return n.player.statAtt})},t.prototype.orderPlayersByOvr=function(){this.sortItems(function(n){return n.player.statOvr})},t.prototype.orderPlayersByMain=function(){this.sortItems(function(n){return n.playerPartial().statMain})},t.prototype.orderPlayersByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderPlayersByPosition=function(){this.sortItems(function(n){return n.playerPartial().position})},t.prototype.getByPlayerId=function(n){return Enumerable.from(this.getItems()).firstOrDefault(function(t){return t.player.id===n})},t.prototype.setItemsFromModels=function(n,t){var i=this,r=[];n.forEach(function(n){!i.countdownTimerPartial()&&n.countdownTimer&&i.countdownTimerPartial(new CountdownTimerPartial(n.countdownTimer));r.push(new TransferPlayerPartial(n,t))});this.setItems(r);this.orderPlayersByPrice()},t.prototype.getAbleToBuy=function(n,t){return Enumerable.from(this.getExcludedOwningTeam(n)).where(function(n){return n.price<=t}).toArray()},t.prototype.getExcludedOwningTeam=function(n){return Enumerable.from(this.getItems()).where(function(t){return t.playerPartial().teamId!==n}).toArray()},t.prototype.getWorldStar=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1}).toArray()},t.prototype.getLegends=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isLegend()}).toArray()},t.prototype.containsWorldStar=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().getPlayerWorldStarLevel()>=PlayerWorldStarLevel.WorldStar1})},t.prototype.getInForms=function(){return Enumerable.from(this.getItems()).where(function(n){return n.playerPartial()&&n.playerPartial().isInForm()}).toArray()},t.prototype.containsInForm=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isInForm()})},t.prototype.containsLegend=function(){return Enumerable.from(this.getItems()).any(function(n){return n.playerPartial()&&n.playerPartial().isLegend()})},t}(PartialArrayViewModel),TransferPlayersGroupablePartial=function(){function n(n,t,i){var r=this,u,f;i===void 0&&(i=!0);this.sortedTransferPlayersListByLine=ko.observableArray();this.sortedTransferPlayers=ko.observableArray();this.sortTransferPlayersByLine=ko.observable(!0);this.getPlayers=ko.computed(function(){return r.sortTransferPlayersByLine()?r.sortedTransferPlayersListByLine():r.sortedTransferPlayers()});this.hasPlayers=ko.computed(function(){return r.sortedTransferPlayers()===undefined||r.sortedTransferPlayers()===null?!1:Enumerable.from(r.sortedTransferPlayers()).any(function(n){return Enumerable.from(n.players.getItems()).any()})});u=new TransferPlayersPartial(n,t);this.sortedTransferPlayers([{position:PlayerPosition.None,players:u}]);f=Enumerable.from(n).groupBy(function(n){return n.player.position},function(n){return n},function(n,i){var r=new TransferPlayersPartial(i.toArray(),t);return{position:n,players:r}});this.sortedTransferPlayersListByLine(Enumerable.from(f).orderBy(function(n){return n.position}).toArray());this.sortTransferPlayersByLine(i)}return n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return Helper.copyProperties(t,u),u.player&&u.playerPartial(new PlayerPartial(u.player,i,r)),u.destinationTeam&&u.destinationTeamPartial(new TeamPartial(u.destinationTeam)),u.sourceTeam&&u.sourceTeamPartial(new TeamPartial(u.sourceTeam)),u}return __extends(t,n),t}(Transfer),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransfersPartial=function(n){function t(t,i,r){var u=n.call(this)||this;return u.getLatest=ko.computed(function(){return Enumerable.from(u.getItems()).orderByDescending(function(n){return n.timestamp}).firstOrDefault()}),u.sortingEnabled(!0),u.setItemsFromModels(t,i,r),u}return __extends(t,n),t.prototype.orderByPlayerName=function(){this.sortItems(function(n){return n.player.name})},t.prototype.orderBySourceTeamName=function(){this.sortItems(function(n){return n.sourceTeam.name})},t.prototype.orderByDestinationTeamName=function(){this.sortItems(function(n){return n.destinationTeam.name})},t.prototype.orderByValue=function(){this.sortItems(function(n){return n.value})},t.prototype.orderByPrice=function(){this.sortItems(function(n){return n.price})},t.prototype.orderByWeek=function(){this.sortItems(function(n){return n.weekNr})},t.prototype.orderByDate=function(){this.sortItems(function(n){return n.timestamp})},t.prototype.orderByPosition=function(){this.sortItems(function(n){return n.player.position})},t.prototype.setItemsFromModels=function(n,t,i){var r=[];n.forEach(function(n){r.push(new TransferPartial(n,t,i))});this.setItems(r);this.sortOrder=SortOrder.Descending;this.orderByDate()},t}(PartialArrayViewModel),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),TransferListView=function(n){function t(i,r,u,f,e,o,s){var h=n.call(this)||this;return h.transferPlayersGroupablePartial=ko.observable(),h.transfersPartial=ko.observable(),h.rssFeedPartial=ko.observable(),h.specialOfferPlayerPartial=ko.observable(),h.legendPlayersPartial=ko.observable(),h._sessionTeamOffersPartial=ko.observable(),h.isGroupFilterVisible=ko.observable(!0),h._fetchNumberOfTransfers=50,h._transfersFetchedCount=0,h.isLoadingTransfers=ko.observable(!1),h.areAllTransfersLoaded=ko.observable(!1),h.currentTab=ko.observable(t.Tab.List),h.isInitialized=ko.observable(!1),h.hasSpecialOffer=ko.computed(function(){return h.specialOfferPlayerPartial()&&h.specialOfferPlayerPartial().countdownTimerPartial()&&h.specialOfferPlayerPartial().countdownTimerPartial().timerState()===TimerState.InProgress}),h.rightColumnPartialState=ko.computed(function(){return!h.specialOfferPlayerPartial&&!h.rssFeedPartial?PartialState.Loading:PartialState.Success}),h._onTransferredPlayer=ko.computed(function(){if(h.transferPlayersGroupablePartial()){if(h.specialOfferPlayerPartial()&&h.specialOfferPlayerPartial().isTransferred()){h.specialOfferPlayerPartial(null);appViewModel.refreshTimers();return}(Enumerable.from(h.transferPlayersGroupablePartial().sortedTransferPlayers()).any(function(n){return n.players.playerHasBeenTransferred()})||Enumerable.from(h.transferPlayersGroupablePartial().sortedTransferPlayersListByLine()).any(function(n){return n.players.playerHasBeenTransferred()}))&&h.refreshTransferlist()}}),h._transferPlayerService=i,h._transfersService=r,h._rssFeedsService=u,h._playersService=f,h._offersService=e,WebApi.getInstance().execute(o.getBySession(!0)).then(function(n){WebApi.getInstance().execute(s.getByLeagueId(SessionManager.getLeagueId(),n.seasonNr)).done(function(n){var t=new LeagueSettingsPartial(n).areTransfersEnabled;t||appViewModel.redirect(RedirectionFlow.AccountState);h.refreshTransferlist()})}),h}return __extends(t,n),t.prototype.switchTabs=function(n){switch(n){case"#transfer-list":this.currentTab(t.Tab.List);break;case"#transfer-history":this.currentTab(t.Tab.History);break;default:this.currentTab(t.Tab.List)}this.loadData()},t.prototype.loadData=function(){switch(this.currentTab()){case t.Tab.List:this.loadList();LeanplumHelper.getInstance().pageOpened(LeanplumTrackingService.State.TransferlistTransferlist);break;case t.Tab.History:this.loadHistory()}},t.prototype.loadList=function(){var t=this,n,f,i,r,u;this.transferPlayersGroupablePartial()||(n=new WebApiBatch,f=this.transferPlayersGroupablePartial()?this.transferPlayersGroupablePartial().sortTransferPlayersByLine():!0,n.add(this._offersService.getByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId())).then(function(n){t._sessionTeamOffersPartial(new OffersPartial(n))}).fail(function(){}).done(),i=this._transferPlayerService.getByTransferPlayerType(SessionManager.getLeagueId(),SessionManager.getTeamId(),TransferPlayerType.Transferlist),n.add(i),r=this._transferPlayerService.getByTransferPlayerType(SessionManager.getLeagueId(),SessionManager.getTeamId(),TransferPlayerType.Legend),n.add(r),u=this._transferPlayerService.getByTransferPlayerType(SessionManager.getLeagueId(),SessionManager.getTeamId(),TransferPlayerType.InForm),n.add(u),Q.all([i.deferred.promise,r.deferred.promise,u.deferred.promise]).spread(function(n,i,r){var u=n.concat(i,r);t.transferPlayersGroupablePartial(new TransferPlayersGroupablePartial(u,t._transferPlayerService,f))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(),n.add(this._transferPlayerService.getByTransferPlayerType(SessionManager.getLeagueId(),SessionManager.getTeamId(),TransferPlayerType.SpecialOffer)).then(function(n){t.specialOfferPlayerPartial(new TransferPlayerPartial(Enumerable.from(n).first(),t._transferPlayerService))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(),n.add(this._rssFeedsService.getAll()).then(function(n){t.rssFeedPartial(new RssFeedPartial(n))}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).done(),n.execute().finally(function(){t.isInitialized(!0)}).done())},t.prototype.loadHistory=function(){this.transfersPartial()||this.loadMoreTransfers()},t.prototype.refreshTransferlist=function(){this.transferPlayersGroupablePartial(null);this.transfersPartial(null);this.areAllTransfersLoaded(!1);this._transfersFetchedCount=0;this.loadData()},t.prototype.getTranslatedPosition=function(n){return $("#transfer-list").data("position"+n)},t.prototype.showBuyPlayerModal=function(n){var t=this,i=ModalTemplate.BuyForeignPlayer,r,u;if(n.teamPartial().isSessionTeam())i=ModalTemplate.CancelTransferPlayer;else if(!n.teamPartial().isForeignTeam){r=this._sessionTeamOffersPartial()?this._sessionTeamOffersPartial().getLatestOfferForPlayer(n.playerPartial().id):null;new TransferDomesticPlayerModal(n,this._offersService,r).show().then(function(){t.isInitialized(!1);WebApi.getInstance().execute(t._offersService.getByTeam(SessionManager.getLeagueId(),SessionManager.getTeamId())).then(function(n){t._sessionTeamOffersPartial(new OffersPartial(n))}).fail(function(){}).done(function(){t.isInitialized(!0)})});return}u=new TransferPlayerModal(n,i);u.show()},t.prototype.showTransferHistoryPlayerModal=function(n){var r=this,t,i;n.teamId===SessionManager.getTeamId()?(t=new SellPlayerModal(n,this._transfersService,appViewModel.userPartialV1Dot1().signUpTimestamp),t.show(),t.quickSellDeferred.promise.then(function(){r.refreshTransferlist()})):(i=new PlayerModal(n,ModalTemplate.Player),i.show())},t.prototype.loadMoreTransfers=function(){this.areAllTransfersLoaded()||this.isLoadingTransfers()||WebApi.getInstance().execute(this.getMoreTransfersRequestItem())},t.prototype.getMoreTransfersRequestItem=function(){var n=this,i,t;return this.isLoadingTransfers(!0),i=this._transfersFetchedCount*this._fetchNumberOfTransfers,t=this._transfersService.getAllTransfers(SessionManager.getLeagueId(),i,this._fetchNumberOfTransfers),t.deferred.promise.then(function(t){var i,r;n._transfersFetchedCount++;t.length<n._fetchNumberOfTransfers&&n.areAllTransfersLoaded(!0);i=new TransfersPartial(t,n._playersService,n._offersService);n.transfersPartial()?(r=n.transfersPartial().getItems().concat(i.getItems()),n.transfersPartial().setItems(r)):n.transfersPartial(i)}).fail(function(n){ErrorHandlerInstanceFactory.getErrorHandlerInstance().handleFail(n)}).fin(function(){n.isLoadingTransfers(!1)}).done(),t},t.prototype.openHelpTextModal=function(){new HelpTextModal(ModalTemplate.TransferlistHelpText,HelpTextModal.Type.Transferlist).show()},t}(BaseView);(function(n){var t;(function(n){n[n.List=0]="List";n[n.History=1]="History"})(t=n.Tab||(n.Tab={}))})(TransferListView||(TransferListView={}));window.onload=function(){initLayout().done(function(){appViewModel.appViewModelDataLoadedDeferred.promise.then(function(){var n=new TransferListView(new TransferPlayerService,new TransfersService,new RssFeedsService,new PlayersService,new OffersService,new LeaguesService,new LeagueSettingsService);$("#cached-html-wrapper-transferlist").load("/Cached/TransferlistPartial?v="+buildReleaseVersion,null,function(){ko.bindContentViewModel(n);$("a[data-toggle='tab']").on("shown.bs.tab",function(t){var i=t.target;n.switchTabs($(i).attr("href"))});var t=window.location.hash;t!==""&&$(".nav-tabs a[href="+t+"]").tab("show")})})})}